# Raftå…±è¯†ç®—æ³•è¯¦è§£

> **ä¸»é¢˜**: æ˜“ç†è§£çš„å…±è¯†ç®—æ³•è®¾è®¡ä¸è¯æ˜
> **åˆ›å»ºæ—¥æœŸ**: 2025-12-02
> **éš¾åº¦**: â­â­â­â­
> **å‰ç½®çŸ¥è¯†**: åˆ†å¸ƒå¼ç³»ç»Ÿã€çŠ¶æ€æœºå¤åˆ¶

---

## ğŸ“‹ ç›®å½•

- [Raftå…±è¯†ç®—æ³•è¯¦è§£](#raftå…±è¯†ç®—æ³•è¯¦è§£)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [1. Raftè®¾è®¡åŠ¨æœº](#1-raftè®¾è®¡åŠ¨æœº)
    - [1.1 Paxosçš„é—®é¢˜](#11-paxosçš„é—®é¢˜)
    - [1.2 å¯ç†è§£æ€§ä¼˜å…ˆ](#12-å¯ç†è§£æ€§ä¼˜å…ˆ)
  - [2. Raftæ ¸å¿ƒæœºåˆ¶](#2-raftæ ¸å¿ƒæœºåˆ¶)
    - [2.1 é¢†å¯¼è€…é€‰ä¸¾](#21-é¢†å¯¼è€…é€‰ä¸¾)
    - [2.2 æ—¥å¿—å¤åˆ¶](#22-æ—¥å¿—å¤åˆ¶)
    - [2.3 å®‰å…¨æ€§ä¿è¯](#23-å®‰å…¨æ€§ä¿è¯)
  - [3. å½¢å¼åŒ–è¯æ˜](#3-å½¢å¼åŒ–è¯æ˜)
    - [3.1 å…³é”®ä¸å˜é‡](#31-å…³é”®ä¸å˜é‡)
    - [3.2 TLA+è§„èŒƒ](#32-tlaè§„èŒƒ)
  - [4. vs Paxoså¯¹æ¯”](#4-vs-paxoså¯¹æ¯”)
  - [5. å®è·µåº”ç”¨](#5-å®è·µåº”ç”¨)
    - [5.1 etcd](#51-etcd)
    - [5.2 æ€§èƒ½åˆ†æ](#52-æ€§èƒ½åˆ†æ)
  - [6. é€’å½’ç†è®ºè§†è§’](#6-é€’å½’ç†è®ºè§†è§’)
  - [7. ä¸»é¢˜-å­ä¸»é¢˜è®ºè¯é€»è¾‘å…³ç³»å›¾](#7-ä¸»é¢˜-å­ä¸»é¢˜è®ºè¯é€»è¾‘å…³ç³»å›¾)
    - [7.1 è®ºè¯ä¾èµ–å…³ç³»](#71-è®ºè¯ä¾èµ–å…³ç³»)
    - [7.2 æ¦‚å¿µä¾èµ–å…³ç³»](#72-æ¦‚å¿µä¾èµ–å…³ç³»)
  - [8. å‚è€ƒèµ„æº](#8-å‚è€ƒèµ„æº)
    - [8.1 ç»å…¸è®ºæ–‡](#81-ç»å…¸è®ºæ–‡)
    - [8.2 æ•™æ](#82-æ•™æ)
    - [8.3 åœ¨çº¿èµ„æº](#83-åœ¨çº¿èµ„æº)

---

## 1. Raftè®¾è®¡åŠ¨æœº

### 1.1 Paxosçš„é—®é¢˜

```text
Paxos (Lamport 1998):
âœ“ ç†è®ºä¼˜é›…
âœ“ è¯æ˜æ­£ç¡®
âœ— éš¾ä»¥ç†è§£ âš ï¸âš ï¸âš ï¸
âœ— éš¾ä»¥å®ç°

é—®é¢˜:
- ä¸¤é˜¶æ®µåè®®å¤æ‚
- æ´»é”å¯èƒ½
- Multi-Paxosä¸æ˜ç¡®
â†’ å·¥ç¨‹å®è·µå›°éš¾
```

---

### 1.2 å¯ç†è§£æ€§ä¼˜å…ˆ

**Raftè®¾è®¡åŸåˆ™ (2014)**:

```text
ç›®æ ‡: Understandability â­â­â­â­â­

æ‰‹æ®µ:
1. é—®é¢˜åˆ†è§£
   - é€‰ä¸¾
   - æ—¥å¿—å¤åˆ¶
   - å®‰å…¨æ€§

2. çŠ¶æ€ç©ºé—´ç®€åŒ–
   - å¼ºé¢†å¯¼è€…
   - é™åˆ¶æ¡ä»¶å¤š

3. å¯è§†åŒ–æ•™å­¦
   - åŠ¨ç”»æ¼”ç¤º
   - æ¸…æ™°æ–‡æ¡£

ç»“æœ:
âœ“ å¹¿æ³›é‡‡ç”¨
âœ“ å¤šç§å®ç°
â†’ å¯ç†è§£æ€§çš„èƒœåˆ© â­
```

---

## 2. Raftæ ¸å¿ƒæœºåˆ¶

### 2.1 é¢†å¯¼è€…é€‰ä¸¾

**çŠ¶æ€æœº**:

```text
ä¸‰ç§è§’è‰²:
- Follower (è·Ÿéšè€…)
- Candidate (å€™é€‰äºº)
- Leader (é¢†å¯¼è€…)

é€‰ä¸¾æµç¨‹:
1. Followerè¶…æ—¶ â†’ Candidate
2. Candidateè¯·æ±‚æŠ•ç¥¨
3. å¤šæ•°ç¥¨ â†’ Leader
4. å…¶ä»– â†’ å›åˆ°Follower

Term (ä»»æœŸ):
é€’å¢æ•´æ•°ï¼Œç”¨äºæ£€æµ‹è¿‡æ—¶ä¿¡æ¯
```

**é€‰ä¸¾è§„åˆ™**:

```text
æŠ•ç¥¨è§„åˆ™:
âœ“ æ¯termæœ€å¤šæŠ•ä¸€ç¥¨
âœ“ å…ˆåˆ°å…ˆå¾—
âœ“ æ—¥å¿—è‡³å°‘ä¸€æ ·æ–°

é˜²æ­¢åˆ†è£‚è„‘:
âœ“ å¤šæ•°ç¥¨è¦æ±‚ (>n/2)
âœ“ Termæœºåˆ¶
â†’ æœ€å¤šä¸€ä¸ªLeader per term âœ“

é€’å½’æ€§è´¨:
âœ“ Termé€’å¢
âœ“ çŠ¶æ€é€’å½’è½¬æ¢
```

---

### 2.2 æ—¥å¿—å¤åˆ¶

**æ—¥å¿—ç»“æ„**:

```text
Log: [Entryâ‚, Entryâ‚‚, ..., Entryâ‚™]

Entry = (term, index, command)

å¤åˆ¶æµç¨‹:
1. Client â†’ Leader: command
2. Leader â†’ Followers: AppendEntries RPC
3. Followers â†’ Leader: ACK
4. å¤šæ•°ç¡®è®¤ â†’ Committed âœ“
5. Leader â†’ Followers: commitIndex
6. Apply to state machine

ä¸€è‡´æ€§ä¿è¯:
âœ“ Log Matching Property
âœ“ Leader Completeness
â†’ å¼ºä¸€è‡´æ€§ âœ“
```

---

### 2.3 å®‰å…¨æ€§ä¿è¯

**å…³é”®çº¦æŸ**:

```text
é€‰ä¸¾çº¦æŸ:
Candidateæ—¥å¿—å¿…é¡»"è‡³å°‘ä¸€æ ·æ–°":
- Termæ›´å¤§, æˆ–
- Termç›¸åŒä½†indexæ›´å¤§

â†’ ç¡®ä¿Leaderæœ‰æ‰€æœ‰committedæ—¥å¿— âœ“

æäº¤è§„åˆ™:
Leaderåªèƒ½æäº¤å½“å‰termçš„æ—¥å¿—
(é€šè¿‡å¤šæ•°å¤åˆ¶)

â†’ é˜²æ­¢è¦†ç›–committedæ—¥å¿— âœ“
```

---

## 3. å½¢å¼åŒ–è¯æ˜

### 3.1 å…³é”®ä¸å˜é‡

**Raftä¸å˜é‡**:

```text
1. Election Safety:
   âˆ€term: æœ€å¤šä¸€ä¸ªLeader

2. Leader Append-Only:
   Leaderä¸åˆ é™¤/è¦†ç›–æ—¥å¿—

3. Log Matching:
   ä¸¤ä¸ªæ—¥å¿—è‹¥(term, index)ç›¸åŒ
   â†’ è¯¥ä½ç½®åŠä¹‹å‰æ‰€æœ‰æ—¥å¿—ç›¸åŒ

4. Leader Completeness:
   æ—¥å¿—committed â†’ æ‰€æœ‰æœªæ¥LeaderåŒ…å«å®ƒ

5. State Machine Safety:
   ä¸¤èŠ‚ç‚¹è‹¥applyåŒä¸€index
   â†’ commandç›¸åŒ âœ“

é€’å½’è¯æ˜:
âœ“ å½’çº³åŸºç¡€ (åˆå§‹çŠ¶æ€)
âœ“ å½’çº³æ­¥éª¤ (æ¯ä¸ªRPC)
â†’ ä¸å˜é‡ä¿æŒ âœ“
```

---

### 3.2 TLA+è§„èŒƒ

**å½¢å¼åŒ–éªŒè¯**:

```text
TLA+ (Lamport):
æ—¶åºé€»è¾‘è§„èŒƒè¯­è¨€

Raft TLA+è§„èŒƒ:
- å®Œæ•´çŠ¶æ€æœº
- æ‰€æœ‰RPC
- æ‰€æœ‰ä¸å˜é‡

éªŒè¯:
TLCæ¨¡å‹æ£€æŸ¥å™¨
â†’ è‡ªåŠ¨éªŒè¯ä¸å˜é‡ âœ“

å‘ç°:
è®ºæ–‡åˆç‰ˆæœ‰bug âš ï¸
TLA+éªŒè¯å‘ç°å¹¶ä¿®å¤ âœ“
â†’ å½¢å¼åŒ–æ–¹æ³•ä»·å€¼ â­â­â­â­â­
```

---

## 4. vs Paxoså¯¹æ¯”

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç»´åº¦        â”‚ Paxos    â”‚ Raft     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¯ç†è§£æ€§    â”‚ âœ—ä½      â”‚ âœ“é«˜â­    â”‚
â”‚ ç†è®ºä¼˜é›…    â”‚ âœ“é«˜â­    â”‚ âš ï¸ä¸­ç­‰   â”‚
â”‚ å®ç°éš¾åº¦    â”‚ âœ—é«˜      â”‚ âœ“ä½      â”‚
â”‚ æ€§èƒ½        â”‚ âœ“ç•¥ä¼˜    â”‚ âš ï¸å¯æ¯”   â”‚
â”‚ å¼ºé¢†å¯¼è€…    â”‚ âœ—æ—       â”‚ âœ“æœ‰      â”‚
â”‚ æˆå‘˜å˜æ›´    â”‚ âš ï¸å›°éš¾   â”‚ âœ“æ¸…æ™°    â”‚
â”‚ å·¥ä¸šåº”ç”¨    â”‚ å°‘       â”‚ å¤šâ­     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç»“è®º:
Paxos: ç†è®ºä¼˜å…ˆ
Raft: å·¥ç¨‹ä¼˜å…ˆ âœ“
â†’ Raftæ›´æµè¡Œ (2024)
```

---

## 5. å®è·µåº”ç”¨

### 5.1 etcd

**Kubernetesæ ¸å¿ƒç»„ä»¶**:

```text
etcd:
- åŸºäºRaft
- åˆ†å¸ƒå¼KVå­˜å‚¨
- Kubernetesé…ç½®å­˜å‚¨

ç‰¹æ€§:
âœ“ å¼ºä¸€è‡´æ€§
âœ“ é«˜å¯ç”¨ (5èŠ‚ç‚¹)
âœ“ çº¿æ€§åŒ–è¯»å†™

æ€§èƒ½:
å†™: ~10K ops/s
è¯»: ~100K ops/s (æœ¬åœ°)
å»¶è¿Ÿ: <10ms

å¸‚åœº:
âœ“ Kubernetesæ ‡é…
âœ“ äº‘åŸç”Ÿç”Ÿæ€æ ¸å¿ƒ
â†’ Raftæœ€æˆåŠŸåº”ç”¨ â­â­â­â­â­
```

---

### 5.2 æ€§èƒ½åˆ†æ

```text
Raftæ€§èƒ½:

å†™æ“ä½œ:
1 RTT (Leader â†’ Followers)
+ Diskå†™å…¥
â‰ˆ 5-10ms

è¯»æ“ä½œ:
Leaderæœ¬åœ°è¯» (çº¿æ€§åŒ–)
æˆ– Followerè¯» (å¯èƒ½è¿‡æœŸ)

ç“¶é¢ˆ:
âš ï¸ å•Leaderå†™å…¥
âš ï¸ ç½‘ç»œRTT
âš ï¸ Disk I/O

ä¼˜åŒ–:
âœ“ æ‰¹å¤„ç† (batching)
âœ“ æµæ°´çº¿ (pipelining)
âœ“ å¼‚æ­¥å¤åˆ¶ (å¯é€‰)
```

---

## 6. é€’å½’ç†è®ºè§†è§’

```text
Raft âˆˆ RE?

ç­”æ¡ˆ: âœ“æ˜¯çš„

è¯æ˜:
- RaftçŠ¶æ€æœºå¯é€’å½’å®šä¹‰
- RPCå¯é€’å½’å¤„ç†
- æ—¥å¿—å¯é€’å½’å¤åˆ¶
â†’ Raft âˆˆ RE âœ“

vs FLP:
FLP: å¼‚æ­¥å…±è¯†ä¸å¯èƒ½
Raft: éƒ¨åˆ†åŒæ­¥å¯è¡Œ âœ“
â†’ è¶…æ—¶å‡è®¾ç»•è¿‡FLP

é€’å½’æ€§è´¨:
âœ“ Termé€’å¢ (é€’å½’è®¡æ•°)
âœ“ æ—¥å¿—é€’å½’è¿½åŠ 
âœ“ çŠ¶æ€é€’å½’è½¬æ¢

å½¢å¼åŒ–:
âœ“ TLA+å®Œæ•´è§„èŒƒ
âœ“ å¯æœºæ¢°éªŒè¯
âœ“ Coqè¯æ˜å­˜åœ¨
â†’ å½¢å¼åŒ–çš„æˆåŠŸæ¡ˆä¾‹ â­â­â­â­â­

å·¥ç¨‹vsç†è®º:
Paxos: ç†è®ºä¼˜é›…
Raft: å·¥ç¨‹å®ç”¨
â†’ å¯ç†è§£æ€§â‰ˆæ­£ç¡®æ€§ (å®è·µä¸­)
```

---

## 7. ä¸»é¢˜-å­ä¸»é¢˜è®ºè¯é€»è¾‘å…³ç³»å›¾

### 7.1 è®ºè¯ä¾èµ–å…³ç³»

```mermaid
graph TD
    A[Raftç®—æ³•] --> B[é—®é¢˜æå‡º]
    B --> C[Raftè®¾è®¡åŠ¨æœº]

    C --> D[å®šä¹‰å»ºç«‹]
    D --> D1[Paxosé—®é¢˜]
    D --> D2[å¯ç†è§£æ€§ä¼˜å…ˆ]

    D1 --> E[æ€§è´¨æ¢ç´¢]
    D2 --> E
    E --> E1[Raftæ ¸å¿ƒæœºåˆ¶]
    E --> E2[å½¢å¼åŒ–è¯æ˜]

    E1 --> F[è¯æ˜æ„é€ ]
    E2 --> F
    F --> F1[é¢†å¯¼è€…é€‰ä¸¾]
    F --> F2[æ—¥å¿—å¤åˆ¶]

    F1 --> G[åº”ç”¨å±•ç¤º]
    F2 --> G
    G --> G1[vs Paxoså¯¹æ¯”]
    G --> G2[å®è·µåº”ç”¨]

    G1 --> H[æ‰¹åˆ¤åæ€]
    G2 --> H
    H --> H1[é€’å½’ç†è®ºè§†è§’]
    H --> H2[å¯ç†è§£æ€§]

    style A fill:#ffcccc
    style D fill:#ccffcc
    style F fill:#ccccff
    style H fill:#ffffcc
```

### 7.2 æ¦‚å¿µä¾èµ–å…³ç³»

```mermaid
graph LR
    A[Raft] --> B[å…±è¯†ç®—æ³•]

    B --> C[é¢†å¯¼è€…é€‰ä¸¾]
    B --> D[æ—¥å¿—å¤åˆ¶]

    C --> E[å®‰å…¨æ€§]
    D --> E

    E --> F[å½¢å¼åŒ–è¯æ˜]
    E --> G[å®è·µåº”ç”¨]

    F --> H[é€’å½’ç†è®º]
    G --> H

    H --> I[å¯ç†è§£æ€§]
    H --> J[å·¥ç¨‹å®ç”¨]

    style A fill:#ffffcc
    style B fill:#ffcccc
    style E fill:#ccffcc
    style H fill:#ccccff
```

**è®ºè¯é€»è¾‘é“¾æ¡**ï¼š

1. **é—®é¢˜æå‡º** (1èŠ‚)ï¼š
   - Raftè®¾è®¡åŠ¨æœº

2. **å®šä¹‰å»ºç«‹** (1.1-1.2èŠ‚)ï¼š
   - Paxosçš„é—®é¢˜å’Œå¯ç†è§£æ€§ä¼˜å…ˆ

3. **æ€§è´¨æ¢ç´¢** (2-3èŠ‚)ï¼š
   - Raftæ ¸å¿ƒæœºåˆ¶ï¼ˆ2èŠ‚ï¼‰
   - å½¢å¼åŒ–è¯æ˜ï¼ˆ3èŠ‚ï¼‰

4. **è¯æ˜æ„é€ ** (2.1-2.3, 3.1-3.2èŠ‚)ï¼š
   - é¢†å¯¼è€…é€‰ä¸¾ã€æ—¥å¿—å¤åˆ¶å’Œå…³é”®ä¸å˜é‡

5. **åº”ç”¨å±•ç¤º** (4-5èŠ‚)ï¼š
   - vs Paxoså¯¹æ¯”ï¼ˆ4èŠ‚ï¼‰
   - å®è·µåº”ç”¨ï¼ˆ5èŠ‚ï¼‰

6. **æ‰¹åˆ¤åæ€** (6èŠ‚)ï¼š
   - é€’å½’ç†è®ºè§†è§’

---

## 8. å‚è€ƒèµ„æº

### 8.1 ç»å…¸è®ºæ–‡

1. **Ongaro, D., & Ousterhout, J.** (2014). "In Search of an Understandable Consensus Algorithm"
   - _USENIX ATC 2014_. 2014 USENIX Annual Technical Conference
   - RaftåŸè®ºæ–‡ â­â­â­â­â­

2. **Lamport, L.** (2001). "Paxos Made Simple"
   - _ACM SIGACT News_, 32(4), 51-58
   - Paxosç®€åŒ–ç‰ˆ

3. **Wilcox, J. R., et al.** (2015). "Verdi: A framework for formally verifying distributed systems"
   - _PLDI 2015_. Proceedings of the 36th ACM SIGPLAN Conference on Programming Language Design and Implementation
   - Raft Coqè¯æ˜

### 8.2 æ•™æ

1. **Tanenbaum, A. S., & Van Steen, M.** (2017)
   - _Distributed Systems: Principles and Paradigms_ (3rd ed.)
   - Pearson. ISBN 978-1530281756
   - åˆ†å¸ƒå¼ç³»ç»ŸåŸºç¡€

2. **Lynch, N. A.** (1996)
   - _Distributed Algorithms_
   - Morgan Kaufmann. ISBN 978-1558603486
   - åˆ†å¸ƒå¼ç®—æ³•æ•™æ

### 8.3 åœ¨çº¿èµ„æº

1. **Raft Algorithm**
   - https://raft.github.io/
   - Raftç®—æ³•å®˜æ–¹ç½‘ç«™

2. **Raft Visualization**
   - https://thesecretlivesofdata.com/raft/
   - Raftç®—æ³•å¯è§†åŒ–

3. **etcd - Raft Implementation**
   - https://etcd.io/docs/latest/learning/raft/
   - etcdçš„Raftå®ç°

---

**æœ€åæ›´æ–°**: 2025-12-04
**Tier**: 1-2 (ç†è®º+å·¥ç¨‹)
**é‡è¦æ€§**: åˆ†å¸ƒå¼ç³»ç»Ÿæ ¸å¿ƒ â­â­â­â­â­
**ä¼˜åŠ¿**: å¯ç†è§£æ€§ > Paxos âœ“
**çŠ¶æ€**: âœ… å·²æ·»åŠ ä¸»é¢˜-å­ä¸»é¢˜è®ºè¯é€»è¾‘å…³ç³»å›¾å’Œå‚è€ƒèµ„æºç« èŠ‚
