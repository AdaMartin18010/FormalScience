# CRDTæ— å†²çªå¤åˆ¶æ•°æ®ç±»å‹

> **ä¸»é¢˜**: æœ€ç»ˆä¸€è‡´æ€§çš„æ•°å­¦åŸºç¡€
> **åˆ›å»ºæ—¥æœŸ**: 2025-12-02
> **éš¾åº¦**: â­â­â­â­
> **å‰ç½®çŸ¥è¯†**: åˆ†å¸ƒå¼ç³»ç»Ÿã€æ ¼è®ºã€å¹¶å‘ç†è®º

---

## ğŸ“‹ ç›®å½•

- [CRDTæ— å†²çªå¤åˆ¶æ•°æ®ç±»å‹](#crdtæ— å†²çªå¤åˆ¶æ•°æ®ç±»å‹)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [1. CRDTåŠ¨æœº](#1-crdtåŠ¨æœº)
    - [1.1 CAPå®šç†å›é¡¾](#11-capå®šç†å›é¡¾)
    - [1.2 æœ€ç»ˆä¸€è‡´æ€§](#12-æœ€ç»ˆä¸€è‡´æ€§)
  - [2. CRDTç†è®ºåŸºç¡€](#2-crdtç†è®ºåŸºç¡€)
    - [2.1 æ ¼è®º](#21-æ ¼è®º)
    - [2.2 æ”¶æ•›æ€§ä¿è¯](#22-æ”¶æ•›æ€§ä¿è¯)
  - [3. çŠ¶æ€å‹CRDT](#3-çŠ¶æ€å‹crdt)
    - [3.1 G-Counter](#31-g-counter)
    - [3.2 PN-Counter](#32-pn-counter)
    - [3.3 OR-Set](#33-or-set)
  - [4. æ“ä½œå‹CRDT](#4-æ“ä½œå‹crdt)
    - [4.1 æ“ä½œè½¬æ¢](#41-æ“ä½œè½¬æ¢)
    - [4.2 å› æœå†å²](#42-å› æœå†å²)
  - [5. å®è·µåº”ç”¨](#5-å®è·µåº”ç”¨)
    - [5.1 ååŒç¼–è¾‘](#51-ååŒç¼–è¾‘)
    - [5.2 åˆ†å¸ƒå¼æ•°æ®åº“](#52-åˆ†å¸ƒå¼æ•°æ®åº“)
  - [6. é€’å½’ç†è®ºåˆ†æ](#6-é€’å½’ç†è®ºåˆ†æ)
  - [ğŸ“š å‚è€ƒæ–‡çŒ®](#-å‚è€ƒæ–‡çŒ®)

---

## 1. CRDTåŠ¨æœº

### 1.1 CAPå®šç†å›é¡¾

```text
CAPä¸å¯èƒ½ä¸‰è§’:
- C (Consistency): å¼ºä¸€è‡´æ€§
- A (Availability): é«˜å¯ç”¨
- P (Partition tolerance): åˆ†åŒºå®¹é”™

å®šç†: æœ€å¤šé€‰2ä¸ª

é€‰æ‹©:
CP: ä¼ ç»Ÿæ•°æ®åº“ (ç‰ºç‰²A)
AP: NoSQL/CRDT (ç‰ºç‰²C) âœ“
â†’ CRDTé€‰æ‹©AP
```

---

### 1.2 æœ€ç»ˆä¸€è‡´æ€§

**Eventual Consistency**:

```text
å®šä¹‰:
å¦‚æœåœæ­¢æ›´æ–° âˆ§ æ¶ˆæ¯æœ€ç»ˆåˆ°è¾¾
â†’ æ‰€æœ‰å‰¯æœ¬æœ€ç»ˆæ”¶æ•› âœ“

vs å¼ºä¸€è‡´æ€§:
å¼ºä¸€è‡´: ç«‹å³ä¸€è‡´
æœ€ç»ˆ: ç¨åä¸€è‡´ âš ï¸

é—®é¢˜:
? å¦‚ä½•ä¿è¯æ”¶æ•›ï¼Ÿ
? æ”¶æ•›åˆ°ä»€ä¹ˆå€¼ï¼Ÿ

CRDTç­”æ¡ˆ:
âœ“ æ•°å­¦ä¿è¯æ”¶æ•›
âœ“ ç¡®å®šæ€§ç»“æœ
â†’ æœ€ç»ˆä¸€è‡´æ€§å¯ç”¨ â­
```

---

## 2. CRDTç†è®ºåŸºç¡€

### 2.1 æ ¼è®º

**æ ¼ (Lattice)**:

```text
å®šä¹‰:
ååºé›†(L, â‰¤) + ä¸¤ä¸ªæ“ä½œ
- join (âˆ¨): æœ€å°ä¸Šç•Œ
- meet (âˆ§): æœ€å¤§ä¸‹ç•Œ

ä¾‹å­:
è‡ªç„¶æ•° (â„•, â‰¤)
join = max
meet = min

æ ¼å…¬ç†:
äº¤æ¢å¾‹: aâˆ¨b = bâˆ¨a
ç»“åˆå¾‹: (aâˆ¨b)âˆ¨c = aâˆ¨(bâˆ¨c)
å¹‚ç­‰å¾‹: aâˆ¨a = a
å¸æ”¶å¾‹: aâˆ¨(aâˆ§b) = a
```

---

### 2.2 æ”¶æ•›æ€§ä¿è¯

**CRDTå®šç†**:

```text
å®šç† (Shapiro 2011):
çŠ¶æ€å‹CRDTæ”¶æ•› âŸº
åˆå¹¶æ“ä½œæ˜¯:
1. äº¤æ¢å¾‹: merge(a,b) = merge(b,a)
2. ç»“åˆå¾‹: merge(merge(a,b),c) = merge(a,merge(b,c))
3. å¹‚ç­‰å¾‹: merge(a,a) = a

è¯æ˜:
æ ¼joinæ“ä½œ = æ»¡è¶³ä¸Šè¿° âœ“
â†’ æ”¶æ•›ä¿è¯ âœ“

é€’å½’æ€§è´¨:
âœ“ åˆå¹¶é€’å½’åº”ç”¨
âœ“ çŠ¶æ€é€’å½’æ”¶æ•›
âœ“ å¿…è¾¾ä¸åŠ¨ç‚¹ â­
```

---

## 3. çŠ¶æ€å‹CRDT

### 3.1 G-Counter

**Grow-only Counter**:

```text
ç»“æ„:
Map[ReplicaID, Int]

æ“ä½œ:
increment(i):
  counter[myID] += i

query():
  return Î£ counter

merge(other):
  âˆ€id: counter[id] = max(counter[id], other[id])

æ€§è´¨:
âœ“ åªå¢ä¸å‡
âœ“ merge = max (æ ¼join)
âœ“ è‡ªåŠ¨æ”¶æ•› âœ“

ä¾‹å­:
å‰¯æœ¬1: {A:5, B:2}
å‰¯æœ¬2: {A:3, B:4}
merge: {A:5, B:4} âœ“
```

---

### 3.2 PN-Counter

**Positive-Negative Counter**:

```text
ç»“æ„:
å¢é‡G-Counter + å‡é‡G-Counter

æ“ä½œ:
increment(i):
  P.increment(i)

decrement(i):
  N.increment(i)

query():
  return P.value() - N.value()

merge(other):
  P.merge(other.P)
  N.merge(other.N)

æ€§è´¨:
âœ“ å¯å¢å¯å‡
âœ“ åŸºäºG-Counterç»„åˆ
âœ“ æ”¶æ•›ä¿è¯ âœ“
```

---

### 3.3 OR-Set

**Observed-Remove Set**:

```text
é—®é¢˜:
å¹¶å‘add(x) vs remove(x)
â†’ è°èƒœï¼Ÿ

ç­–ç•¥:
Add-wins: addèƒœå‡º âœ“ (OR-Set)
Remove-wins: removeèƒœå‡º

OR-Setå®ç°:
å…ƒç´  = (value, unique_id)

add(x):
  set.add((x, unique_id()))

remove(x):
  tombstoneæ‰€æœ‰è§‚å¯Ÿåˆ°çš„(x, id)

merge:
  union + ç§»é™¤tombstone

æ€§è´¨:
âœ“ add-winsè¯­ä¹‰
âœ“ å› æœä¸€è‡´
âœ“ æ”¶æ•› âœ“
```

---

## 4. æ“ä½œå‹CRDT

### 4.1 æ“ä½œè½¬æ¢

**æ“ä½œä¼ æ’­**:

```text
vs çŠ¶æ€å‹:
çŠ¶æ€å‹: ä¼ æ’­å®Œæ•´çŠ¶æ€
æ“ä½œå‹: ä¼ æ’­æ“ä½œ âœ“
â†’ å¸¦å®½ä¼˜åŠ¿

è¦æ±‚:
æ“ä½œäº¤æ¢å¾‹:
op1(op2(s)) = op2(op1(s))

ä¾‹å­: ååŒç¼–è¾‘
insert(pos, char)
éœ€è¦è°ƒæ•´pos âš ï¸

OT (Operational Transformation):
è½¬æ¢å†²çªæ“ä½œ
â†’ ä¿æŒæ”¶æ•› âœ“
```

---

### 4.2 å› æœå†å²

**Version Vector**:

```text
å‘é‡æ—¶é’Ÿ:
VV[A] = [A:5, B:3, C:2]
= Açœ‹åˆ°: Açš„5ä¸ª, Bçš„3ä¸ª, Cçš„2ä¸ª

å› æœå…³ç³»:
VV1 < VV2 âŸº VV1åœ¨VV2å› æœå†å²ä¸­

å¹¶å‘:
VV1 || VV2 âŸº æ—¢éVV1<VV2ä¹ŸéVV2<VV1
â†’ éœ€è¦åˆå¹¶ âœ“

é€’å½’æ€§è´¨:
âœ“ æ—¶é’Ÿé€’å½’æ›´æ–°
âœ“ å› æœé€’å½’ä¼ æ’­
```

---

## 5. å®è·µåº”ç”¨

### 5.1 ååŒç¼–è¾‘

**Google Docsç±»åº”ç”¨**:

```text
æŒ‘æˆ˜:
å¤šç”¨æˆ·åŒæ—¶ç¼–è¾‘
ä½å»¶è¿Ÿè¦æ±‚
ç¦»çº¿æ”¯æŒ âœ“

CRDTæ–¹æ¡ˆ:
RGA (Replicated Growable Array)
- æ¯å­—ç¬¦å”¯ä¸€ID
- å› æœé¡ºåºæ’å…¥
- Tombstoneåˆ é™¤

æ€§èƒ½:
âœ“ æœ¬åœ°å³æ—¶å“åº”
âœ“ æ— å†²çªåˆå¹¶
âœ“ æœ€ç»ˆä¸€è‡´ âœ“

vs OT:
OT: å¤æ‚è½¬æ¢å‡½æ•°
CRDT: æ•°å­¦ä¿è¯ âœ“
â†’ CRDTæ›´ç®€å•
```

---

### 5.2 åˆ†å¸ƒå¼æ•°æ®åº“

**Riak/Redis Enterprise**:

```text
Riak:
åŸºäºOR-Set
æ”¯æŒCRDTæ•°æ®ç±»å‹:
- Counter
- Set
- Map
- Flag

Redis Enterprise:
CRDB (Conflict-free Replicated Database)
è·¨åœ°åŸŸå¤åˆ¶
æœ€ç»ˆä¸€è‡´æ€§ âœ“

æ€§èƒ½:
âœ“ ä½å»¶è¿Ÿè¯»å†™
âœ“ é«˜å¯ç”¨ (AP)
âš ï¸ éå¼ºä¸€è‡´ (trade-off)

åº”ç”¨:
âœ“ è´­ç‰©è½¦
âœ“ ä¼šè¯ç®¡ç†
âœ“ å®æ—¶åä½œ
```

---

## 6. é€’å½’ç†è®ºåˆ†æ

```text
CRDT âˆˆ RE?

ç­”æ¡ˆ: âœ“æ˜¯çš„

è¯æ˜:
- çŠ¶æ€å¯é€’å½’è¡¨ç¤º
- åˆå¹¶å¯é€’å½’è®¡ç®—
- æ”¶æ•›å¯é€’å½’éªŒè¯
â†’ CRDT âˆˆ RE âœ“

å¤æ‚åº¦:
G-Counter: O(n) (n=å‰¯æœ¬æ•°)
OR-Set: O(m) (m=å…ƒç´ æ•°)
â†’ çº¿æ€§å¯æ¥å— âœ“

æ”¶æ•›æ€§:
æ ¼join = ä¸åŠ¨ç‚¹æ”¶æ•›
â†’ Tarskiå®šç†åº”ç”¨ â­

é€’å½’æ€§è´¨:
âœ“ çŠ¶æ€é€’å½’åˆå¹¶
âœ“ æ“ä½œé€’å½’åº”ç”¨
âœ“ æ”¶æ•›é€’å½’ä¿è¯

ç†è®ºåŸºç¡€:
æ ¼è®º (1930s)
â†’ CRDT (2011)
â†’ 80å¹´ç†è®ºåˆ°å®è·µ

vs å…±è¯†:
å…±è¯†: å¼ºä¸€è‡´ (CP)
CRDT: æœ€ç»ˆä¸€è‡´ (AP)
â†’ ä¸åŒæƒè¡¡

é€‚ç”¨åœºæ™¯:
âœ“ ååŒç¼–è¾‘
âœ“ ç¦»çº¿åº”ç”¨
âœ“ åœ°ç†åˆ†å¸ƒ
âœ— é‡‘èäº¤æ˜“ (éœ€å¼ºä¸€è‡´)
â†’ åœºæ™¯å†³å®šé€‰æ‹©

æœªæ¥:
Delta-CRDT: æ›´é«˜æ•ˆ âœ“
Pure CRDT: æ›´ç®€æ´
â†’ æŒç»­æ¼”åŒ–

é€’å½’èŒƒå¼:
âœ“ CRDT = æ ¼é€’å½’æ”¶æ•›
âœ“ æœ€ç»ˆä¸€è‡´ = é€’å½’ä¸åŠ¨ç‚¹
âœ“ åˆ†å¸ƒå¼ = é€’å½’åˆå¹¶
â†’ é€’å½’ç†è®ºçš„APå®ç° â­â­â­â­â­
```

---

## ğŸ“š å‚è€ƒæ–‡çŒ®

[1] **Shapiro, M. et al.** (2011). "Conflict-free Replicated Data Types"
    _SSS 2011_. **CRDTå¥ åŸº** â­â­â­â­â­

[2] **Shapiro, M. et al.** (2011). "A Comprehensive Study of CRDTs"
    Technical Report RR-7506, INRIA. **CRDTç»¼è¿°**

[3] **PreguiÃ§a, N., Baquero, C., & Shapiro, M.** (2018). "Conflict-free Replicated Data Types"
    _Computing Surveys_. **æœ€æ–°ç»¼è¿°**

---

**æœ€åæ›´æ–°**: 2025-12-02
**Tier**: 1-2 (ç†è®º+å·¥ç¨‹)
**é‡è¦æ€§**: APç³»ç»Ÿæ ¸å¿ƒ â­â­â­â­â­
**æ•°å­¦åŸºç¡€**: æ ¼è®º âœ“
