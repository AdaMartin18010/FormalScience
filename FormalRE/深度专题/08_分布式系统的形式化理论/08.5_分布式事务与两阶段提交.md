# åˆ†å¸ƒå¼äº‹åŠ¡ä¸ä¸¤é˜¶æ®µæäº¤

> **ä¸»é¢˜**: åˆ†å¸ƒå¼äº‹åŠ¡çš„ACIDä¿è¯ä¸åè®®
> **åˆ›å»ºæ—¥æœŸ**: 2025-12-02
> **éš¾åº¦**: â­â­â­â­
> **å‰ç½®çŸ¥è¯†**: æ•°æ®åº“ç³»ç»Ÿã€åˆ†å¸ƒå¼ç³»ç»Ÿã€å½¢å¼åŒ–æ–¹æ³•

---

## ğŸ“‹ ç›®å½•

- [åˆ†å¸ƒå¼äº‹åŠ¡ä¸ä¸¤é˜¶æ®µæäº¤](#åˆ†å¸ƒå¼äº‹åŠ¡ä¸ä¸¤é˜¶æ®µæäº¤)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [1. äº‹åŠ¡ACIDå±æ€§](#1-äº‹åŠ¡acidå±æ€§)
    - [1.1 ACIDå®šä¹‰](#11-acidå®šä¹‰)
    - [1.2 åˆ†å¸ƒå¼æŒ‘æˆ˜](#12-åˆ†å¸ƒå¼æŒ‘æˆ˜)
  - [2. ä¸¤é˜¶æ®µæäº¤](#2-ä¸¤é˜¶æ®µæäº¤)
    - [2.1 2PCåè®®](#21-2pcåè®®)
    - [2.2 é˜»å¡é—®é¢˜](#22-é˜»å¡é—®é¢˜)
  - [3. ä¸‰é˜¶æ®µæäº¤](#3-ä¸‰é˜¶æ®µæäº¤)
    - [3.1 3PCæ”¹è¿›](#31-3pcæ”¹è¿›)
    - [3.2 ç½‘ç»œåˆ†åŒºé—®é¢˜](#32-ç½‘ç»œåˆ†åŒºé—®é¢˜)
  - [4. Sagaæ¨¡å¼](#4-sagaæ¨¡å¼)
    - [4.1 é•¿äº‹åŠ¡å¤„ç†](#41-é•¿äº‹åŠ¡å¤„ç†)
    - [4.2 è¡¥å¿æœºåˆ¶](#42-è¡¥å¿æœºåˆ¶)
  - [5. å®è·µåº”ç”¨](#5-å®è·µåº”ç”¨)
    - [5.1 XAè§„èŒƒ](#51-xaè§„èŒƒ)
    - [5.2 å¾®æœåŠ¡äº‹åŠ¡](#52-å¾®æœåŠ¡äº‹åŠ¡)
  - [6. é€’å½’ç†è®ºåˆ†æ](#6-é€’å½’ç†è®ºåˆ†æ)
  - [7. ä¸»é¢˜-å­ä¸»é¢˜è®ºè¯é€»è¾‘å…³ç³»å›¾](#7-ä¸»é¢˜-å­ä¸»é¢˜è®ºè¯é€»è¾‘å…³ç³»å›¾)
    - [7.1 è®ºè¯ä¾èµ–å…³ç³»](#71-è®ºè¯ä¾èµ–å…³ç³»)
    - [7.2 æ¦‚å¿µä¾èµ–å…³ç³»](#72-æ¦‚å¿µä¾èµ–å…³ç³»)
  - [8. å‚è€ƒèµ„æº](#8-å‚è€ƒèµ„æº)
    - [8.1 ç»å…¸è®ºæ–‡](#81-ç»å…¸è®ºæ–‡)
    - [8.2 æ•™æ](#82-æ•™æ)
    - [8.3 åœ¨çº¿èµ„æº](#83-åœ¨çº¿èµ„æº)

---

## 1. äº‹åŠ¡ACIDå±æ€§

### 1.1 ACIDå®šä¹‰

```text
åŸå­æ€§ (Atomicity):
å…¨éƒ¨æˆåŠŸ æˆ– å…¨éƒ¨å¤±è´¥
æ— ä¸­é—´çŠ¶æ€ âœ“

ä¸€è‡´æ€§ (Consistency):
äº‹åŠ¡ä¿æŒæ•°æ®åº“çº¦æŸ
ä¸å˜é‡ç»´æŒ âœ“

éš”ç¦»æ€§ (Isolation):
å¹¶å‘äº‹åŠ¡äº’ä¸å¹²æ‰°
å¦‚åŒä¸²è¡Œæ‰§è¡Œ âœ“

æŒä¹…æ€§ (Durability):
æäº¤åæ°¸ä¹…ä¿å­˜
å³ä½¿å´©æºƒ âœ“

é€’å½’æ€§è´¨:
âœ“ çº¦æŸé€’å½’ç»´æŠ¤
âœ“ æ—¥å¿—é€’å½’å†™å…¥
```

---

### 1.2 åˆ†å¸ƒå¼æŒ‘æˆ˜

**å•æœºvsåˆ†å¸ƒå¼**:

```text
å•æœº:
âœ“ ACIDæ˜“ä¿è¯
âœ“ å•ç‚¹æ§åˆ¶
âœ“ æœ¬åœ°æ—¥å¿—

åˆ†å¸ƒå¼:
âœ— è·¨èŠ‚ç‚¹åè°ƒå›°éš¾
âœ— ç½‘ç»œæ•…éšœ
âœ— éƒ¨åˆ†å¤±è´¥
â†’ æ ¹æœ¬æ€§å›°éš¾ âš ï¸âš ï¸âš ï¸

CAPå½±å“:
åˆ†åŒº (P) å­˜åœ¨ â†’
ä¸€è‡´ (C) vs å¯ç”¨ (A)
ACIDäº‹åŠ¡ â†’ é€‰C
â†’ ç‰ºç‰²A âš ï¸

vs NoSQL:
NoSQL: BASE (åŸºæœ¬å¯ç”¨)
ACID: å¼ºä¸€è‡´ âœ“
â†’ æƒè¡¡ä¸åŒ
```

---

## 2. ä¸¤é˜¶æ®µæäº¤

### 2.1 2PCåè®®

**Gray (1978)**:

```text
è§’è‰²:
- åè°ƒè€… (Coordinator)
- å‚ä¸è€… (Participants)

Phase 1: å‡†å¤‡é˜¶æ®µ
Coordinator â†’ All: PREPARE
Participants:
  - å†™redo/undoæ—¥å¿—
  - é”å®šèµ„æº
  - è¿”å›: YES/NO

Phase 2: æäº¤é˜¶æ®µ
if All YES:
  Coordinator â†’ All: COMMIT
  Participants: æäº¤ âœ“
else:
  Coordinator â†’ All: ABORT
  Participants: å›æ»š âœ—

åŸå­æ€§ä¿è¯:
âœ“ å…¨éƒ¨æäº¤ æˆ– å…¨éƒ¨å›æ»š
â†’ 2PCæ ¸å¿ƒ â­
```

---

### 2.2 é˜»å¡é—®é¢˜

**åè°ƒè€…æ•…éšœ**:

```text
åœºæ™¯:
Phase 1å®Œæˆ (All YES)
Coordinatorå‘é€COMMITåcrash
éƒ¨åˆ†å‚ä¸è€…æ”¶åˆ°ï¼Œéƒ¨åˆ†æœªæ”¶åˆ°
â†’ å‚ä¸è€…é˜»å¡ âš ï¸âš ï¸âš ï¸

å‚ä¸è€…å›°å¢ƒ:
? æäº¤è¿˜æ˜¯å›æ»š
? æ— æ³•åˆ¤æ–­å…¶ä»–å‚ä¸è€…çŠ¶æ€
â†’ å¿…é¡»ç­‰å¾…Coordinatoræ¢å¤ âœ—

é˜»å¡æˆæœ¬:
é”å®šèµ„æº
é˜»å¡å…¶ä»–äº‹åŠ¡
å¯èƒ½æ•°åˆ†é’Ÿ âš ï¸
â†’ å¯ç”¨æ€§ä¸‹é™

vs éé˜»å¡:
3PCå°è¯•è§£å†³
ä½†å¼•å…¥æ–°é—®é¢˜ âš ï¸
```

---

## 3. ä¸‰é˜¶æ®µæäº¤

### 3.1 3PCæ”¹è¿›

**Skeen (1981)**:

```text
Phase 1: Can-Commit
Coordinator â†’ All: CAN_COMMIT
Participants â†’ YES/NO

Phase 2: Pre-Commit
Coordinator â†’ All: PRE_COMMIT
Participants: å‡†å¤‡æäº¤ï¼Œä½†æœªæäº¤

Phase 3: Do-Commit
Coordinator â†’ All: DO_COMMIT
Participants: æäº¤ âœ“

è¶…æ—¶è§„åˆ™:
Phase 2åè¶…æ—¶ â†’ å¯æäº¤ âœ“
(å› ä¸ºçŸ¥é“å…¶ä»–æ–¹éƒ½PRE_COMMIT)

ä¼˜åŠ¿:
âœ“ éé˜»å¡ (ç†è®ºä¸Š)
âœ“ è¶…æ—¶å¯å†³ç­–
```

---

### 3.2 ç½‘ç»œåˆ†åŒºé—®é¢˜

**3PCçš„è‡´å‘½ç¼ºé™·**:

```text
åœºæ™¯:
ç½‘ç»œåˆ†åŒº
Coordinator + éƒ¨åˆ†å‚ä¸è€… (P1)
å…¶ä»–å‚ä¸è€… (P2)

P1æ”¶åˆ°PRE_COMMIT
P2æœªæ”¶åˆ°

è¶…æ—¶å:
P1: æäº¤ âœ“
P2: å›æ»š âœ—
â†’ ä¸ä¸€è‡´ âš ï¸âš ï¸âš ï¸

æ ¹æœ¬åŸå› :
FLPå®šç†:
å¼‚æ­¥ç³»ç»Ÿ + æ•…éšœ â†’ æ— ç¡®å®šå…±è¯† âœ—
â†’ 3PCä¹Ÿä¸èƒ½å®Œå…¨è§£å†³ âš ï¸

å®è·µ:
3PCå¾ˆå°‘ç”¨
2PC + è¶…æ—¶/é‡è¯• âœ“
â†’ ç®€å•å®ç”¨ â­
```

---

## 4. Sagaæ¨¡å¼

### 4.1 é•¿äº‹åŠ¡å¤„ç†

**Garcia-Molina & Salem (1987)**:

```text
é—®é¢˜:
é•¿äº‹åŠ¡ (å°æ—¶çº§)
2PCé”å®šå¤ªä¹… âš ï¸

Sagaæ€æƒ³:
T = Tâ‚, Tâ‚‚, ..., Tâ‚™ (å­äº‹åŠ¡åºåˆ—)
æ¯ä¸ªTáµ¢ç‹¬ç«‹æäº¤ âœ“

å¤±è´¥å¤„ç†:
Táµ¢å¤±è´¥ â†’ æ‰§è¡Œè¡¥å¿:
C_{i-1}, C_{i-2}, ..., Câ‚
â†’ å›æ»šæ•ˆæœ âš ï¸

é€’å½’æ€§è´¨:
âœ“ äº‹åŠ¡é€’å½’æ‰§è¡Œ
âœ“ è¡¥å¿é€’å½’å›æ»š
âœ“ Sagaé€’å½’åµŒå¥—
```

---

### 4.2 è¡¥å¿æœºåˆ¶

**è¡¥å¿äº‹åŠ¡**:

```text
ä¾‹å­:
è®¢å•æµç¨‹:
1. é¢„è®¢æœºç¥¨ â†’ å–æ¶ˆæœºç¥¨
2. é¢„è®¢é…’åº— â†’ å–æ¶ˆé…’åº—
3. æ‰£æ¬¾     â†’ é€€æ¬¾

å¤±è´¥:
æ­¥éª¤3å¤±è´¥
â†’ æ‰§è¡ŒCâ‚‚, Câ‚ (å€’åºè¡¥å¿)
â†’ æœ€ç»ˆä¸€è‡´ âœ“

é™åˆ¶:
âš ï¸ è¡¥å¿å¯è§ (å·²æäº¤)
âš ï¸ éACID (ä¸­é—´çŠ¶æ€å¯è§)
âš ï¸ è¡¥å¿å¯èƒ½å¤±è´¥

æƒè¡¡:
2PC: ACID âœ“, é˜»å¡ âš ï¸
Saga: éé˜»å¡ âœ“, éACID âš ï¸
â†’ é•¿äº‹åŠ¡é€‰æ‹©Saga â­

é€’å½’:
âœ“ å‰å‘é€’å½’æ‰§è¡Œ
âœ“ åå‘é€’å½’è¡¥å¿
```

---

## 5. å®è·µåº”ç”¨

### 5.1 XAè§„èŒƒ

**X/Open XA**:

```text
æ ‡å‡†æ¥å£:
TM (Transaction Manager)
RM (Resource Manager)

æ¥å£:
xa_start()
xa_prepare()  // Phase 1
xa_commit()   // Phase 2
xa_rollback()

å®ç°:
- MySQL
- PostgreSQL
- Oracle
â†’ æ•°æ®åº“æ ‡é… âœ“

æ€§èƒ½:
å‡†å¤‡: åŒæ­¥å†™æ—¥å¿—
æäº¤: åŒæ­¥åˆ·ç›˜
â†’ 2æ¬¡ç£ç›˜I/O âš ï¸
â†’ æ€§èƒ½ç“¶é¢ˆ

é€’å½’:
âœ“ èµ„æºé€’å½’æ³¨å†Œ
âœ“ æäº¤é€’å½’åè°ƒ
```

---

### 5.2 å¾®æœåŠ¡äº‹åŠ¡

**ç°ä»£æŒ‘æˆ˜**:

```text
å¾®æœåŠ¡:
æœåŠ¡A â†’ æœåŠ¡B â†’ æœåŠ¡C
è·¨æœåŠ¡äº‹åŠ¡ï¼Ÿâš ï¸

æ–¹æ¡ˆ1: 2PC
âœ— æ€§èƒ½å·®
âœ— è€¦åˆå¼º
â†’ å¾®æœåŠ¡åæ¨¡å¼ âš ï¸

æ–¹æ¡ˆ2: Saga
âœ“ å¼‚æ­¥ç¼–æ’
âœ“ æœ€ç»ˆä¸€è‡´
âœ“ æ¾è€¦åˆ â­
â†’ å¾®æœåŠ¡é¦–é€‰

æ–¹æ¡ˆ3: äº‹ä»¶æº¯æº
âœ“ äº‹ä»¶æ—¥å¿—
âœ“ å¹‚ç­‰å¤„ç†
âœ“ å¯é‡æ”¾
â†’ CQRSæ¨¡å¼ â­

å®è·µ:
Netflix: Saga
Uber: äº‹ä»¶æº¯æº
â†’ æ”¾å¼ƒå¼ºä¸€è‡´ âœ“
```

---

## 6. é€’å½’ç†è®ºåˆ†æ

```text
åˆ†å¸ƒå¼äº‹åŠ¡ âˆˆ RE?

ç­”æ¡ˆ: âœ“æ˜¯çš„

è¯æ˜:
- 2PCåè®®å¯é€’å½’æ‰§è¡Œ
- æ—¥å¿—å¯é€’å½’å†™å…¥
- çŠ¶æ€å¯é€’å½’è½¬æ¢
â†’ åˆ†å¸ƒå¼äº‹åŠ¡ âˆˆ RE âœ“

ä½†:
âœ— åœ¨FLPé™åˆ¶ä¸‹
âœ— å¼‚æ­¥ + æ•…éšœ â†’ æ— ç¡®å®šå…±è¯†
âš ï¸ éœ€è¦åŒæ­¥å‡è®¾æˆ–æ¦‚ç‡

å¤æ‚åº¦:
2PC: 2è½® (å‡†å¤‡+æäº¤)
æ¶ˆæ¯: O(n) (n=å‚ä¸è€…)
å»¶è¿Ÿ: 2Ã—RTT + 2Ã—Disk
â†’ å¤šé¡¹å¼ä½†æ˜‚è´µ âš ï¸

vs å•æœº:
å•æœºäº‹åŠ¡: O(1)è½®
åˆ†å¸ƒå¼: O(1)è½®ä½†ç½‘ç»œå»¶è¿Ÿ
â†’ 100-1000Ã—æ…¢ âš ï¸

é€’å½’æ€§è´¨:
âœ“ äº‹åŠ¡é€’å½’åµŒå¥—
âœ“ æäº¤é€’å½’åè°ƒ
âœ“ å›æ»šé€’å½’ä¼ æ’­
âœ“ æ—¥å¿—é€’å½’ç»´æŠ¤
â†’ å¤šå±‚é€’å½’ â­

ç†è®ºvså®è·µ:
ç†è®º: 2PC/3PCä¿è¯ACID
å®è·µ:
- é˜»å¡é—®é¢˜ âš ï¸
- æ€§èƒ½å¼€é”€ âš ï¸
- å·¥ç¨‹å¤æ‚ âš ï¸
â†’ ç°ä»£è¶‹åŠ¿: æ”¾å¼ƒå¼ºä¸€è‡´

BASEæ›¿ä»£:
Basically Available
Soft state
Eventually consistent
â†’ NoSQL/å¾®æœåŠ¡é€‰æ‹© âœ“

é€’å½’èŒƒå¼è´¡çŒ®:
âœ“ æ˜ç¡®åè®®è¾¹ç•Œ (FLP)
âœ“ å½¢å¼åŒ–æ­£ç¡®æ€§è¯æ˜
âœ“ é€’å½’åè°ƒæœºåˆ¶
â†’ ç†è®ºæŒ‡å¯¼å®è·µ â­

å“²å­¦:
ACID = ç†æƒ³
BASE = ç°å®
â†’ CAPæƒè¡¡
â†’ ä¸€è‡´æ€§ vs å¯ç”¨æ€§ âš ï¸

æœªæ¥:
å…±è¯†ç®—æ³• (Raft/PBFT)
â†’ æ›¿ä»£2PC
â†’ éé˜»å¡ + å®¹é”™ âœ“

åŒºå—é“¾å¯å‘:
æœ€ç»ˆä¸€è‡´ + å¯†ç å­¦
â†’ æ–°èŒƒå¼ â­
```

---

## 7. ä¸»é¢˜-å­ä¸»é¢˜è®ºè¯é€»è¾‘å…³ç³»å›¾

### 7.1 è®ºè¯ä¾èµ–å…³ç³»

```mermaid
graph TD
    A[åˆ†å¸ƒå¼äº‹åŠ¡] --> B[é—®é¢˜æå‡º]
    B --> C[äº‹åŠ¡ACIDå±æ€§]

    C --> D[å®šä¹‰å»ºç«‹]
    D --> D1[ACID]
    D --> D2[ä¸¤é˜¶æ®µæäº¤]

    D1 --> E[æ€§è´¨æ¢ç´¢]
    D2 --> E
    E --> E1[ä¸‰é˜¶æ®µæäº¤]
    E --> E2[Sagaæ¨¡å¼]

    E1 --> F[è¯æ˜æ„é€ ]
    E2 --> F
    F --> F1[2PCåè®®]
    F --> F2[3PCåè®®]

    F1 --> G[åº”ç”¨å±•ç¤º]
    F2 --> G
    G --> G1[å®è·µåº”ç”¨]
    G --> G2[äº‹åŠ¡å¤„ç†]

    G1 --> H[æ‰¹åˆ¤åæ€]
    G2 --> H
    H --> H1[é€’å½’ç†è®ºåˆ†æ]
    H --> H2[äº‹åŠ¡ä¸€è‡´æ€§]

    style A fill:#ffcccc
    style D fill:#ccffcc
    style F fill:#ccccff
    style H fill:#ffffcc
```

### 7.2 æ¦‚å¿µä¾èµ–å…³ç³»

```mermaid
graph LR
    A[åˆ†å¸ƒå¼äº‹åŠ¡] --> B[ACID]

    B --> C[ä¸¤é˜¶æ®µæäº¤]
    B --> D[ä¸‰é˜¶æ®µæäº¤]

    C --> E[Sagaæ¨¡å¼]
    D --> E

    E --> F[äº‹åŠ¡å¤„ç†]
    E --> G[ä¸€è‡´æ€§]

    F --> H[é€’å½’ç†è®º]
    G --> H

    H --> I[äº‹åŠ¡ä¸€è‡´æ€§]
    H --> J[å®è·µåº”ç”¨]

    style A fill:#ffffcc
    style B fill:#ffcccc
    style E fill:#ccffcc
    style H fill:#ccccff
```

**è®ºè¯é€»è¾‘é“¾æ¡**ï¼š

1. **é—®é¢˜æå‡º** (1èŠ‚)ï¼š
   - äº‹åŠ¡ACIDå±æ€§

2. **å®šä¹‰å»ºç«‹** (1èŠ‚)ï¼š
   - ACIDå±æ€§

3. **æ€§è´¨æ¢ç´¢** (2-4èŠ‚)ï¼š
   - ä¸¤é˜¶æ®µæäº¤ï¼ˆ2èŠ‚ï¼‰
   - ä¸‰é˜¶æ®µæäº¤ï¼ˆ3èŠ‚ï¼‰
   - Sagaæ¨¡å¼ï¼ˆ4èŠ‚ï¼‰

4. **è¯æ˜æ„é€ ** (è´¯ç©¿å…¨æ–‡)ï¼š
   - 2PCå’Œ3PCåè®®

5. **åº”ç”¨å±•ç¤º** (5èŠ‚)ï¼š
   - å®è·µåº”ç”¨

6. **æ‰¹åˆ¤åæ€** (6èŠ‚)ï¼š
   - é€’å½’ç†è®ºåˆ†æ

---

## 8. å‚è€ƒèµ„æº

### 8.1 ç»å…¸è®ºæ–‡

1. **Gray, J.** (1978). "Notes on Data Base Operating Systems"
   - In Bayer, R., et al. (eds.), _Operating Systems: An Advanced Course_
   - Springer. ä¸¤é˜¶æ®µæäº¤

2. **Skeen, D.** (1981). "Nonblocking Commit Protocols"
   - _SIGMOD 1981_. Proceedings of the 1981 ACM SIGMOD International Conference on Management of Data
   - ä¸‰é˜¶æ®µæäº¤

3. **Garcia-Molina, H., & Salem, K.** (1987). "Sagas"
   - _SIGMOD 1987_. Proceedings of the 1987 ACM SIGMOD International Conference on Management of Data
   - Sagaæ¨¡å¼ â­â­â­â­â­

### 8.2 æ•™æ

1. **Bernstein, P. A., & Newcomer, E.** (2009)
   - _Principles of Transaction Processing_ (2nd ed.)
   - Morgan Kaufmann. ISBN 978-1558606234
   - äº‹åŠ¡å¤„ç†æ•™æ

2. **Tanenbaum, A. S., & Van Steen, M.** (2017)
   - _Distributed Systems: Principles and Paradigms_ (3rd ed.)
   - Pearson. ISBN 978-1530281756
   - åˆ†å¸ƒå¼ç³»ç»ŸåŸºç¡€

### 8.3 åœ¨çº¿èµ„æº

1. **Two-Phase Commit**
   - https://en.wikipedia.org/wiki/Two-phase_commit_protocol
   - ä¸¤é˜¶æ®µæäº¤åŸºæœ¬æ¦‚å¿µ

2. **Saga Pattern**
   - https://microservices.io/patterns/data/saga.html
   - Sagaæ¨¡å¼

3. **Distributed Transactions**
   - https://www.cockroachlabs.com/blog/acid-rain/
   - åˆ†å¸ƒå¼äº‹åŠ¡å®è·µ

---

**æœ€åæ›´æ–°**: 2025-12-04
**Tier**: 2 (å·¥ç¨‹)
**é‡è¦æ€§**: æ•°æ®åº“æ ¸å¿ƒ â­â­â­â­â­
**ç°çŠ¶**: 2PCç»å…¸ï¼ŒSagaç°ä»£ âœ“
**çŠ¶æ€**: âœ… å·²æ·»åŠ ä¸»é¢˜-å­ä¸»é¢˜è®ºè¯é€»è¾‘å…³ç³»å›¾å’Œå‚è€ƒèµ„æºç« èŠ‚
