# DeFiåè®®çš„æ•°å­¦å»ºæ¨¡

> **ä¸»é¢˜**: DeFiåè®®çš„å½¢å¼åŒ–æ•°å­¦æ¨¡å‹
> **åˆ›å»ºæ—¥æœŸ**: 2025-12-02
> **éš¾åº¦**: â­â­â­â­
> **å‰ç½®çŸ¥è¯†**: åŒºå—é“¾ã€ç»æµå­¦ã€åšå¼ˆè®º

---

## ğŸ“‹ ç›®å½•

- [DeFiåè®®çš„æ•°å­¦å»ºæ¨¡](#defiåè®®çš„æ•°å­¦å»ºæ¨¡)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [1. Uniswap V2 æ•°å­¦æ¨¡å‹](#1-uniswap-v2-æ•°å­¦æ¨¡å‹)
    - [1.1 å¸¸æ•°ä¹˜ç§¯å…¬å¼](#11-å¸¸æ•°ä¹˜ç§¯å…¬å¼)
    - [1.2 ä»·æ ¼å‘ç°æœºåˆ¶](#12-ä»·æ ¼å‘ç°æœºåˆ¶)
    - [1.3 æ»‘ç‚¹åˆ†æ](#13-æ»‘ç‚¹åˆ†æ)
  - [2. Uniswap V3 é›†ä¸­æµåŠ¨æ€§](#2-uniswap-v3-é›†ä¸­æµåŠ¨æ€§)
    - [2.1 æ•°å­¦æ¨¡å‹](#21-æ•°å­¦æ¨¡å‹)
    - [2.2 èµ„æœ¬æ•ˆç‡](#22-èµ„æœ¬æ•ˆç‡)
  - [3. å€Ÿè´·åè®® (Aave/Compound)](#3-å€Ÿè´·åè®®-aavecompound)
    - [3.1 åˆ©ç‡æ¨¡å‹](#31-åˆ©ç‡æ¨¡å‹)
    - [3.2 æ¸…ç®—æœºåˆ¶](#32-æ¸…ç®—æœºåˆ¶)
  - [4. ç¨³å®šå¸æœºåˆ¶](#4-ç¨³å®šå¸æœºåˆ¶)
    - [4.1 æŠµæŠ¼å‹ (DAI)](#41-æŠµæŠ¼å‹-dai)
    - [4.2 ç®—æ³•å‹ (Terraæ¡ˆä¾‹)](#42-ç®—æ³•å‹-terraæ¡ˆä¾‹)
  - [5. é£é™©ä¸ä¸å¯åˆ¤å®šæ€§](#5-é£é™©ä¸ä¸å¯åˆ¤å®šæ€§)
    - [5.1 ç»„åˆæ€§é£é™©](#51-ç»„åˆæ€§é£é™©)
    - [5.2 ç³»ç»Ÿæ€§é£é™©](#52-ç³»ç»Ÿæ€§é£é™©)
  - [6. é€’å½’ç†è®ºåˆ†æ](#6-é€’å½’ç†è®ºåˆ†æ)
  - [7. ä¸»é¢˜-å­ä¸»é¢˜è®ºè¯é€»è¾‘å…³ç³»å›¾](#7-ä¸»é¢˜-å­ä¸»é¢˜è®ºè¯é€»è¾‘å…³ç³»å›¾)
    - [7.1 è®ºè¯ä¾èµ–å…³ç³»](#71-è®ºè¯ä¾èµ–å…³ç³»)
    - [7.2 æ¦‚å¿µä¾èµ–å…³ç³»](#72-æ¦‚å¿µä¾èµ–å…³ç³»)
  - [8. å‚è€ƒèµ„æº](#8-å‚è€ƒèµ„æº)
    - [8.1 ç»å…¸è®ºæ–‡](#81-ç»å…¸è®ºæ–‡)
    - [8.2 æ•™æ](#82-æ•™æ)
    - [8.3 åœ¨çº¿èµ„æº](#83-åœ¨çº¿èµ„æº)

---

## 1. Uniswap V2 æ•°å­¦æ¨¡å‹

### 1.1 å¸¸æ•°ä¹˜ç§¯å…¬å¼

**æ ¸å¿ƒä¸å˜é‡**:

```text
x Â· y = k (å¸¸æ•°)

å…¶ä¸­:
- x: Token Xå‚¨å¤‡é‡
- y: Token Yå‚¨å¤‡é‡
- k: å¸¸æ•°

äº¤æ˜“ Î”x â†’ Î”y:
(x + Î”x)(y - Î”y) = k
â†’ Î”y = y - k/(x+Î”x)
     = yÂ·Î”x/(x+Î”x)

å½¢å¼åŒ– (Coq):
Record Pool : Type := {
  reserve_x : nat;
  reserve_y : nat;
  invariant : reserve_x * reserve_y = k
}.

Definition swap (p : Pool) (dx : nat) : Pool * nat :=
  let dy := (p.reserve_y * dx) / (p.reserve_x + dx) in
  ({| reserve_x := p.reserve_x + dx;
      reserve_y := p.reserve_y - dy |}, dy).
```

---

### 1.2 ä»·æ ¼å‘ç°æœºåˆ¶

**è¾¹é™…ä»·æ ¼**:

```text
Price = dy/dx = y/x (å°é¢äº¤æ˜“)

ä»·æ ¼å®šç†:
Theorem price_positive:
  âˆ€p dx, dx > 0 â†’
    Price_after(swap p dx) > Price_before(p).

è¯æ˜:
Price = y/x
After: Price' = (y-Î”y)/(x+Î”x)
â†’ Price' = y/(x+Î”x+yÂ·Î”x/x)
â†’ Price' > Price âœ“

å«ä¹‰: å¤§é¢äº¤æ˜“æ¨é«˜ä»·æ ¼
â†’ è‡ªåŠ¨åšå¸‚ âœ“
```

---

### 1.3 æ»‘ç‚¹åˆ†æ

**æ»‘ç‚¹å…¬å¼**:

```text
ç†æƒ³ä»·æ ¼: P = y/x
å®é™…ä»·æ ¼: P' = Î”y/Î”x
æ»‘ç‚¹: Slippage = (P' - P)/P

è®¡ç®—:
Slippage = Î”x/(2x + Î”x)

ä¾‹å­:
x=1000, Î”x=100
Slippage = 100/2100 â‰ˆ 4.76%

â†’ äº¤æ˜“é‡è¶Šå¤§ï¼Œæ»‘ç‚¹è¶Šé«˜ âš ï¸
```

---

## 2. Uniswap V3 é›†ä¸­æµåŠ¨æ€§

### 2.1 æ•°å­¦æ¨¡å‹

**ä»·æ ¼åŒºé—´æµåŠ¨æ€§**:

```text
Position = (P_low, P_high, L)

Active_L(P) = Î£ {L | P_low â‰¤ P â‰¤ P_high}

è™šæ‹Ÿå‚¨å¤‡:
x_virtual = L/âˆšP
y_virtual = LÂ·âˆšP

äº¤æ˜“ä»éµå¾ª:
x_virtual Â· y_virtual = LÂ² (å±€éƒ¨æ’å®š)

å¤æ‚åº¦:
çŠ¶æ€ç©ºé—´: O(n) positions
è®¡ç®—: O(log n) (æ’åºåŒºé—´)
â†’ æ¯”V2å¤æ‚ âš ï¸
```

---

### 2.2 èµ„æœ¬æ•ˆç‡

**æ•ˆç‡æå‡**:

```text
V2: æµåŠ¨æ€§åˆ†æ•£åœ¨[0, âˆ]
V3: æµåŠ¨æ€§é›†ä¸­åœ¨[P_low, P_high]

ä¾‹å­:
V2: 100ä¸‡å‡åŒ€åˆ†å¸ƒ
V3: 100ä¸‡é›†ä¸­åœ¨[0.95, 1.05]
â†’ æœ‰æ•ˆæµåŠ¨æ€§ ~10Ã— â­

trade-off:
âœ“ èµ„æœ¬æ•ˆç‡é«˜
âœ— ä»·æ ¼å‡ºç•Œâ†’æ— æµåŠ¨æ€§
âš ï¸ LPéœ€è¦ä¸»åŠ¨ç®¡ç†
```

---

## 3. å€Ÿè´·åè®® (Aave/Compound)

### 3.1 åˆ©ç‡æ¨¡å‹

**åˆ©ç”¨ç‡æ¨¡å‹**:

```text
Utilization = Borrowed / (Borrowed + Available)

Borrow Rate = Base + U Â· Slope
            = f(U)

Supply Rate = Borrow Rate Â· U Â· (1 - Reserve%)

é€’å½’å¹³è¡¡:
é«˜åˆ©ç‡ â†’ è¿˜æ¬¾å¢åŠ  â†’ Uä¸‹é™ â†’ åˆ©ç‡é™ä½
â†’ åŠ¨æ€å¹³è¡¡ (ä¸åŠ¨ç‚¹)

ä¸åŠ¨ç‚¹:
U* = Optimal_Utilization (~80%)
```

---

### 3.2 æ¸…ç®—æœºåˆ¶

**å¥åº·å› å­**:

```text
Health Factor = CollateralÂ·LTV / Debt

HF < 1 â†’ å¯æ¸…ç®— âš ï¸

æ¸…ç®—:
Liquidator:
1. å¿è¿˜éƒ¨åˆ†å€ºåŠ¡
2. è·å¾—æŠµæŠ¼å“ (æœ‰æŠ˜æ‰£)

æ¸…ç®—é€’å½’:
HF < 1 â†’ æ¸…ç®— â†’ HFä¸Šå‡ â†’ é‡å¤
â†’ ç›´åˆ°HF > 1 æˆ–å€ºåŠ¡æ¸…é›¶

é£é™©:
âš ï¸ é¢„è¨€æœºæ“çºµ (é—ªç”µè´·æ”»å‡»)
âš ï¸ çº§è”æ¸…ç®— (2020å¹´3Â·12)
```

---

## 4. ç¨³å®šå¸æœºåˆ¶

### 4.1 æŠµæŠ¼å‹ (DAI)

**MakerDAOæ¨¡å‹**:

```text
æŠµæŠ¼ç‡: 150%
1 DAIéœ€è¦$1.5 ETHæŠµæŠ¼

ç¨³å®šæœºåˆ¶:
Price > $1: é“¸é€ æ¿€åŠ±
Price < $1: å›è´­/æ¸…ç®—

é€’å½’ç¨³å®š:
Price â† â†’ Supply â† â†’ Collateral
â†’ è´Ÿåé¦ˆå¾ªç¯ âœ“
```

---

### 4.2 ç®—æ³•å‹ (Terraæ¡ˆä¾‹)

**æ­»äº¡èºæ—‹**:

```text
Terra (2022å´©æºƒ):
UST â† â†’ LUNA (ç®—æ³•ç¨³å®š)

æœºåˆ¶:
$1 UST âŸº $1 LUNA
å¯äº’æ¢

å´©æºƒé€’å½’:
USTè„±é”š($0.9)
â†’ å¥—åˆ©è€…: USTâ†’LUNA
â†’ LUNAæŠ›å‹
â†’ LUNAä¸‹è·Œ
â†’ éœ€æ›´å¤šLUNAç¨³å®š
â†’ LUNAè¿›ä¸€æ­¥ä¸‹è·Œ
â†’ USTæ›´è„±é”š
â†’ æ­»äº¡èºæ—‹ âš ï¸âš ï¸âš ï¸

é€’å½’ç†è®º:
âœ— æ­£åé¦ˆå¾ªç¯
âœ— ä¸ç¨³å®šä¸åŠ¨ç‚¹
âœ— ç³»ç»Ÿå´©æºƒ
â†’ ç®—æ³•ç¨³å®šå¸æ ¹æœ¬ç¼ºé™·
```

---

## 5. é£é™©ä¸ä¸å¯åˆ¤å®šæ€§

### 5.1 ç»„åˆæ€§é£é™©

**DeFiä¹é«˜**:

```text
åè®®å †å :
Lend (Aave)
  â†“ æŠµæŠ¼
Swap (Uniswap)
  â†“ LPä»£å¸
Farm (Convex)
  â†“ æ”¶ç›Š
å†æŠµæŠ¼...

é€’å½’ä¾èµ–:
Aä¾èµ–B, Bä¾èµ–C, Cä¾èµ–A
â†’ å¾ªç¯é£é™© âš ï¸

ä¸å¯åˆ¤å®š:
âœ— å…¨å±€é£é™©ä¸å¯è®¡ç®—
âœ— ç»„åˆæ•ˆåº”æŒ‡æ•°å¤æ‚
â†’ Riceå®šç† âœ—
```

---

### 5.2 ç³»ç»Ÿæ€§é£é™©

**æ¡ˆä¾‹**: 2020å¹´3Â·12

```text
ETHæš´è·Œ â†’ MakerDAOæ¸…ç®—
â†’ æ‹¥å µ â†’ Gasè´¹æš´æ¶¨
â†’ æ¸…ç®—å¤±è´¥ â†’ åè´¦
â†’ DAIè„±é”š

é€’å½’å´©æºƒ:
é£é™©ä¼ æ’­å›¾:
Price crash â†’ Liquidation â†’ Congestion
     â†’ Failed liquidation â†’ Bad debt
     â†’ Depegging â†’ More panic
     â†’ Price crash (å¾ªç¯)

æ•™è®­:
âš ï¸ å•ç‚¹æ•…éšœ (é¢„è¨€æœº)
âš ï¸ æ‹¥å¡è„†å¼±æ€§
âš ï¸ é€’å½’æ€§å´©æºƒ
```

---

## 6. é€’å½’ç†è®ºåˆ†æ

```text
DeFiåè®® âˆˆ RE?

ç­”æ¡ˆ: âœ“æ˜¯çš„

è¯æ˜:
- AMMå…¬å¼å¯é€’å½’è®¡ç®—
- åˆ©ç‡æ¨¡å‹å¯é€’å½’
- æ¸…ç®—é€»è¾‘å¯é€’å½’
â†’ DeFi âˆˆ RE âœ“

ä½†:
âœ— ç»„åˆå®‰å…¨æ€§ä¸å¯åˆ¤å®š
âœ— Nashå‡è¡¡éš¾è®¡ç®— (PPAD-å®Œå…¨)
âœ— é»‘å¤©é¹…äº‹ä»¶ä¸å¯é¢„æµ‹

å®è·µ:
âœ“ å•ä¸ªåè®®å¯å½¢å¼åŒ–
âœ— ç»„åˆç³»ç»Ÿéš¾éªŒè¯
âœ“ å‹åŠ›æµ‹è¯•+å®¡è®¡
âœ— å®Œå…¨ä¿è¯ä¸å¯èƒ½

é€’å½’æ€§è´¨:
âœ“ åè®®é€’å½’å®šä¹‰
âœ“ ä¸åŠ¨ç‚¹æ±‚è§£ (åˆ©ç‡/ä»·æ ¼)
âœ— å…¨å±€ç¨³å®šæ€§ä¸ä¿è¯
â†’ DeFi = å¤æ‚é€’å½’ç³»ç»Ÿ âš ï¸
```

---

## 7. ä¸»é¢˜-å­ä¸»é¢˜è®ºè¯é€»è¾‘å…³ç³»å›¾

### 7.1 è®ºè¯ä¾èµ–å…³ç³»

```mermaid
graph TD
    A[DeFiåè®®å»ºæ¨¡] --> B[é—®é¢˜æå‡º]
    B --> C[DeFiåè®®æ¦‚è¿°]

    C --> D[å®šä¹‰å»ºç«‹]
    D --> D1[Uniswap V2æ¨¡å‹]
    D --> D2[Uniswap V3æ¨¡å‹]

    D1 --> E[æ€§è´¨æ¢ç´¢]
    D2 --> E
    E --> E1[å€Ÿè´·åè®®]
    E --> E2[ç¨³å®šå¸æœºåˆ¶]

    E1 --> F[è¯æ˜æ„é€ ]
    E2 --> F
    F --> F1[åˆ©ç‡æ¨¡å‹]
    F --> F2[æ¸…ç®—æœºåˆ¶]

    F1 --> G[åº”ç”¨å±•ç¤º]
    F2 --> G
    G --> G1[é£é™©åˆ†æ]
    G --> G2[ä¸å¯åˆ¤å®šæ€§]

    G1 --> H[æ‰¹åˆ¤åæ€]
    G2 --> H
    H --> H1[é€’å½’ç†è®ºåˆ†æ]
    H --> H2[ç³»ç»Ÿæ€§é£é™©]

    style A fill:#ffcccc
    style D fill:#ccffcc
    style F fill:#ccccff
    style H fill:#ffffcc
```

### 7.2 æ¦‚å¿µä¾èµ–å…³ç³»

```mermaid
graph LR
    A[DeFiåè®®] --> B[æ•°å­¦æ¨¡å‹]

    B --> C[Uniswap]
    B --> D[å€Ÿè´·åè®®]
    B --> E[ç¨³å®šå¸]

    C --> F[å¸¸æ•°ä¹˜ç§¯]
    D --> G[åˆ©ç‡æ¨¡å‹]
    E --> H[ç¨³å®šæœºåˆ¶]

    F --> I[é£é™©]
    G --> I
    H --> I

    I --> J[é€’å½’ç†è®º]
    I --> K[ä¸å¯åˆ¤å®šæ€§]

    style A fill:#ffffcc
    style B fill:#ffcccc
    style I fill:#ccffcc
    style J fill:#ccccff
```

**è®ºè¯é€»è¾‘é“¾æ¡**ï¼š

1. **é—®é¢˜æå‡º** (1èŠ‚)ï¼š
   - Uniswap V2æ•°å­¦æ¨¡å‹

2. **å®šä¹‰å»ºç«‹** (1.1-1.3èŠ‚)ï¼š
   - å¸¸æ•°ä¹˜ç§¯å…¬å¼ã€ä»·æ ¼å‘ç°æœºåˆ¶ã€æ»‘ç‚¹åˆ†æ

3. **æ€§è´¨æ¢ç´¢** (2-4èŠ‚)ï¼š
   - Uniswap V3é›†ä¸­æµåŠ¨æ€§ï¼ˆ2èŠ‚ï¼‰
   - å€Ÿè´·åè®®ï¼ˆ3èŠ‚ï¼‰
   - ç¨³å®šå¸æœºåˆ¶ï¼ˆ4èŠ‚ï¼‰

4. **è¯æ˜æ„é€ ** (è´¯ç©¿å…¨æ–‡)ï¼š
   - å„ç§æ•°å­¦æ¨¡å‹çš„æ¨å¯¼

5. **åº”ç”¨å±•ç¤º** (5èŠ‚)ï¼š
   - é£é™©ä¸ä¸å¯åˆ¤å®šæ€§

6. **æ‰¹åˆ¤åæ€** (6èŠ‚)ï¼š
   - é€’å½’ç†è®ºåˆ†æ

---

## 8. å‚è€ƒèµ„æº

### 8.1 ç»å…¸è®ºæ–‡

1. **Adams, H., et al.** (2021). "Uniswap v3 Core"
   - Whitepaper. https://uniswap.org/whitepaper-v3.pdf
   - Uniswap V3æŠ€æœ¯æ–‡æ¡£

2. **Gudgeon, L., et al.** (2020). "DeFi Protocols for Loanable Funds: Interest Rates, Liquidity and Market Efficiency"
   - _Financial Cryptography and Data Security 2020_
   - å€Ÿè´·åè®®åˆ†æ

3. **Klages-Mundt, A., & Minca, A.** (2021). "While Stability Lasts: A Stochastic Model of Stablecoins"
   - arXiv:2101.12332
   - ç¨³å®šå¸é£é™©åˆ†æ

### 8.2 æ•™æ

1. **Mas-Colell, A., Whinston, M. D., & Green, J. R.** (1995)
   - _Microeconomic Theory_
   - Oxford University Press. ISBN 978-0195073409
   - å¾®è§‚ç»æµå­¦ç†è®º

2. **Osborne, M. J., & Rubinstein, A.** (1994)
   - _A Course in Game Theory_
   - MIT Press. ISBN 978-0262650403
   - åšå¼ˆè®ºåŸºç¡€

### 8.3 åœ¨çº¿èµ„æº

1. **Uniswap Documentation**
   - https://docs.uniswap.org/
   - Uniswapåè®®æ–‡æ¡£

2. **Aave Documentation**
   - https://docs.aave.com/
   - Aaveå€Ÿè´·åè®®æ–‡æ¡£

3. **DeFi Pulse**
   - https://defipulse.com/
   - DeFiåè®®æ•°æ®å’Œåˆ†æ

---

**æœ€åæ›´æ–°**: 2025-12-04
**Tier**: 2-3 (ç§‘å­¦+ç»æµ)
**é£é™©**: âš ï¸âš ï¸âš ï¸ (ç³»ç»Ÿæ€§é£é™©)
**å¯éªŒè¯æ€§**: éƒ¨åˆ† âš ï¸
**çŠ¶æ€**: âœ… å·²æ·»åŠ ä¸»é¢˜-å­ä¸»é¢˜è®ºè¯é€»è¾‘å…³ç³»å›¾å’Œå‚è€ƒèµ„æºç« èŠ‚
