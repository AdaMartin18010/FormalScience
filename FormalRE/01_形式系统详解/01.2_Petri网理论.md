# Petri网理论：并发系统的形式化模型

> **主题**: Carl Adam Petri的并发计算模型
> **创建日期**: 2025-12-02
> **难度**: ⭐⭐⭐⭐
> **前置知识**: 图论、并发系统基础

---

## 📋 目录

- [Petri网理论：并发系统的形式化模型](#petri网理论并发系统的形式化模型)
  - [📋 目录](#-目录)
  - [1. Petri网基础](#1-petri网基础)
    - [1.1 精确定义](#11-精确定义)
    - [1.2 图形表示](#12-图形表示)
    - [1.3 标识与变迁触发](#13-标识与变迁触发)
  - [2. 动态行为与可达性](#2-动态行为与可达性)
    - [2.1 可达性问题](#21-可达性问题)
    - [2.2 向量加法系统 (VASS)](#22-向量加法系统-vass)
  - [3. 带抑止弧的Petri网](#3-带抑止弧的petri网)
    - [3.1 抑止弧 (Inhibitor Arc)](#31-抑止弧-inhibitor-arc)
    - [3.2 图灵完备性](#32-图灵完备性)
  - [4. 图灵完备性](#4-图灵完备性)
    - [4.1 从2计数器机到图灵机](#41-从2计数器机到图灵机)
    - [4.2 实践含义](#42-实践含义)
  - [5. 应用场景](#5-应用场景)
    - [5.1 微服务架构](#51-微服务架构)
    - [5.2 区块链智能合约](#52-区块链智能合约)
    - [5.3 工作流系统](#53-工作流系统)
  - [6. 习题](#6-习题)
    - [习题1](#习题1)
    - [习题2](#习题2)
    - [习题3](#习题3)
  - [7. 参考资源](#7-参考资源)
    - [经典论文](#经典论文)
    - [教材](#教材)

---

## 1. Petri网基础

### 1.1 精确定义

**定义1.1 (Petri网)**:

一个Petri网 N 是一个四元组：

```text
N = (P, T, F, M₀)
```

其中：

- **P**: 库所 (Places) 的有限集
- **T**: 变迁 (Transitions) 的有限集（P ∩ T = ∅）
- **F**: (P×T) ∪ (T×P) → ℕ — 流关系（弧权重）
- **M₀**: P → ℕ — 初始标识 (Marking)

### 1.2 图形表示

**符号**:

- ○ 库所 (Place)
- ▭ 变迁 (Transition)
- ● 令牌 (Token)
- → 弧 (Arc)

**例子**: 生产者-消费者

```text
    (buffer)
  ○─────○─────○
  ↑     ●     ↓
  │           │
[produce]  [consume]
  ▭           ▭
  ↑           ↓
```

### 1.3 标识与变迁触发

**标识 (Marking)**: M: P → ℕ

- M(p) = 库所 p 中的令牌数

**使能 (Enabled)**: 变迁 t 在标识 M 下使能，如果：

```text
∀p ∈ P. M(p) ≥ F(p, t)
```

**触发 (Firing)**: M →ᵗ M'

```text
M'(p) = M(p) - F(p,t) + F(t,p)
```

---

## 2. 动态行为与可达性

### 2.1 可达性问题

**定义2.1**: 标识 M' 从 M₀ **可达**，如果：

```text
∃t₁, ..., tₙ. M₀ →^t₁ M₁ →^t₂ ··· →^tₙ M'
```

**可达集**: Reach(N, M₀) = {M | M₀ →* M}

**可达性问题**: 给定 M'，判定 M' ∈ Reach(N, M₀)?

**定理2.1 (Mayr 1984, Kosaraju 1982)**:
基本Petri网的可达性问题**可判定**！

**但**: 复杂度极高 —— Ackermann函数级别

### 2.2 向量加法系统 (VASS)

**等价**: 基本Petri网 ≡ VASS

**VASS定义**: (ℕᵏ, V, v₀)

- 状态 = k维向量
- 转移 = 向量加法
- v → v + δ （当 v + δ ≥ 0）

**Petri网 → VASS**:

- 库所 → 向量维度
- 标识 → 向量
- 变迁 → 向量加法

---

## 3. 带抑止弧的Petri网

### 3.1 抑止弧 (Inhibitor Arc)

**新元素**: 从库所 p 到变迁 t 的**抑止弧**

**语义**: t 使能当且仅当：

```text
M(p) = 0  (p 中没有令牌)
```

**图形**: ○──⊸ ▭ (圆圈箭头)

### 3.2 图灵完备性

**定理3.1**: 带抑止弧的Petri网 ≡ 图灵机

**证明思路**: 模拟2计数器机 (Minsky机)

**2计数器机**:

- 2个计数器 c₁, c₂ ∈ ℕ
- 操作: INC(cᵢ), DEC(cᵢ), if cᵢ=0 then goto

**Petri网模拟**:

- 库所 p₁, p₂ 分别存储 c₁, c₂ 的值
- INC(c₁) → 变迁向 p₁ 增加令牌
- DEC(c₁) → 变迁从 p₁ 移除令牌
- if c₁=0 → 用抑止弧检测！

**结论**:

- **无抑止弧**: 可判定（VASS）
- **有抑止弧**: 图灵完备（不可判定）

---

## 4. 图灵完备性

### 4.1 从2计数器机到图灵机

**定理4.1 (Minsky 1961)**: 2计数器机 ≡ 图灵机

**编码思路**:

```text
磁带内容: ...010110...
          ↑
          头位置

编码为两个数:
  c₁ = 左边的二进制数
  c₂ = 右边的二进制数
```

**操作**:

- 右移: c₁ ← 2c₁ + b, c₂ ← ⌊c₂/2⌋
- 左移: c₁ ← ⌊c₁/2⌋, c₂ ← 2c₂ + b'

### 4.2 实践含义

**带抑止弧的Petri网**:

- ✅ 表达力强（图灵完备）
- ❌ 可达性不可判定（停机问题）
- ❌ 所有分析都不可判定

**基本Petri网 (VASS)**:

- ✅ 可达性可判定
- ✅ 有界性可判定
- ❌ 表达力受限

---

## 5. 应用场景

### 5.1 微服务架构

**Kubernetes调度**:

```text
库所 = 资源池（CPU, 内存）
令牌 = 资源单位
变迁 = Pod启动/销毁
抑止弧 = "内存不足时禁止启动"
```

**可达性 = 死锁检测**:

- 基本Petri网: 可判定（但复杂）
- 带抑止弧: 不可判定

### 5.2 区块链智能合约

**以太坊状态转换**:

```text
库所 = 账户余额
变迁 = 交易
抑止弧 = "余额不足时交易失败"
```

**图灵完备性**:

- Solidity ≈ 带抑止弧的Petri网
- → 无法静态验证所有性质

### 5.3 工作流系统

**业务流程建模**:

- 库所 = 流程状态
- 变迁 = 任务执行
- 令牌 = 工作项

**验证**: 活性、安全性

- 基本Petri网: 可分析
- 复杂扩展: 需要抽象

---

## 6. 习题

### 习题1

画出生产者-消费者系统的Petri网，并找出所有可达标识。

### 习题2

证明: 无抑止弧的Petri网无法实现"零测试"。

### 习题3

设计一个带抑止弧的Petri网，模拟简单的2计数器机。

---

## 7. 参考资源

### 经典论文

1. **Petri, C.A. (1962)**. "Kommunikation mit Automaten"
2. **Mayr, E. (1984)**. "An Algorithm for the General Petri Net Reachability Problem"

### 教材

1. **Reisig, W.** - _Petri Nets: An Introduction_
2. **Murata, T. (1989)**. "Petri Nets: Properties, Analysis and Applications"

---

**最后更新**: 2025-12-02
**状态**: 初稿完成
**关联**: → `Composed/PetriNetView/` (深度研究)
