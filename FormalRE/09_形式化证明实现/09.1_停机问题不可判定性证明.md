# åœæœºé—®é¢˜çš„å½¢å¼åŒ–è¯æ˜ (Coq)

> **å®šç†**: åœæœºé—®é¢˜ä¸å¯åˆ¤å®š
> **æ–¹æ³•**: å¯¹è§’åŒ–è®ºè¯
> **å·¥å…·**: Coq 8.18
> **éš¾åº¦**: â­â­â­â­

---

## ğŸ“‹ ç›®å½•

- [åœæœºé—®é¢˜çš„å½¢å¼åŒ–è¯æ˜ (Coq)](#åœæœºé—®é¢˜çš„å½¢å¼åŒ–è¯æ˜-coq)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [1. é—®é¢˜é™ˆè¿°](#1-é—®é¢˜é™ˆè¿°)
  - [2. Coqå½¢å¼åŒ–](#2-coqå½¢å¼åŒ–)
    - [2.1 å›¾çµæœºæ¨¡å‹](#21-å›¾çµæœºæ¨¡å‹)
    - [2.2 åœæœºè°“è¯](#22-åœæœºè°“è¯)
    - [2.3 å¯¹è§’åŒ–æ„é€ ](#23-å¯¹è§’åŒ–æ„é€ )
  - [3. å®Œæ•´Coqä»£ç ](#3-å®Œæ•´coqä»£ç )
  - [4. è¯æ˜è¦ç‚¹](#4-è¯æ˜è¦ç‚¹)
    - [4.1 å¯¹è§’åŒ–æœ¬è´¨](#41-å¯¹è§’åŒ–æœ¬è´¨)
    - [4.2 è‡ªæŒ‡çš„å…³é”®](#42-è‡ªæŒ‡çš„å…³é”®)
    - [4.3 å½¢å¼åŒ–æŒ‘æˆ˜](#43-å½¢å¼åŒ–æŒ‘æˆ˜)
  - [5. ç»ƒä¹ ](#5-ç»ƒä¹ )
  - [ğŸ“š å‚è€ƒæ–‡çŒ®](#-å‚è€ƒæ–‡çŒ®)
    - [åŸå§‹è®ºæ–‡](#åŸå§‹è®ºæ–‡)
    - [å½¢å¼åŒ–è¯æ˜](#å½¢å¼åŒ–è¯æ˜)
    - [Coqæ•™æ](#coqæ•™æ)
    - [åœ¨çº¿èµ„æº](#åœ¨çº¿èµ„æº)

---

## 1. é—®é¢˜é™ˆè¿°

**åœæœºé—®é¢˜**:

```text
è¾“å…¥: ç¨‹åºP, è¾“å…¥x
é—®é¢˜: Påœ¨xä¸Šæ˜¯å¦åœæœº?

Turing (1936): ä¸å­˜åœ¨ç®—æ³•Håˆ¤å®šæ‰€æœ‰(P,x)
```

**å½¢å¼åŒ–ç›®æ ‡**:

```coq
Theorem halting_undecidable :
  ~ exists H : program -> input -> bool,
    forall P x,
      H P x = true <-> halts P x.
```

---

## 2. Coqå½¢å¼åŒ–

### 2.1 å›¾çµæœºæ¨¡å‹

```coq
(* ç®€åŒ–çš„å›¾çµæœºæ¨¡å‹ *)
Inductive program : Type :=
  | Halt : program
  | Read : (nat -> program) -> program
  | Write : nat -> program -> program.

Inductive input : Type :=
  | Input : nat -> input.

(* è®¡ç®—æ­¥éª¤ *)
Inductive step : program -> input -> program -> input -> Prop :=
  | step_halt : forall i, step Halt i Halt i
  | step_read : forall f i n,
      step (Read f) (Input n) (f n) (Input n)
  | step_write : forall n p i,
      step (Write n p) i p (Input n).

(* å¤šæ­¥æ‰§è¡Œ *)
Inductive steps : program -> input -> program -> input -> Prop :=
  | steps_refl : forall p i, steps p i p i
  | steps_trans : forall p1 i1 p2 i2 p3 i3,
      step p1 i1 p2 i2 ->
      steps p2 i2 p3 i3 ->
      steps p1 i1 p3 i3.

(* åœæœºå®šä¹‰ *)
Definition halts (p : program) (i : input) : Prop :=
  exists p' i', steps p i p' i' /\ p' = Halt.
```

### 2.2 åœæœºè°“è¯

```coq
(* å‡è®¾å­˜åœ¨åœæœºåˆ¤å®šå™¨ *)
Axiom halting_oracle : program -> input -> bool.

Axiom oracle_correct :
  forall p i,
    halting_oracle p i = true <-> halts p i.
```

### 2.3 å¯¹è§’åŒ–æ„é€ 

```coq
(* å¯¹è§’åŒ–ç¨‹åº *)
Definition diag (p : program) : program :=
  if halting_oracle p (encode p)
  then loop  (* æ— é™å¾ªç¯ *)
  else Halt.

(* çŸ›ç›¾è¯æ˜ *)
Theorem halting_contradiction :
  False.
Proof.
  (* è€ƒè™‘ diag(diag) *)
  set (D := diag diag).

  (* Case 1: å‡è®¾Dåœæœº *)
  destruct (halting_oracle diag (encode diag)) eqn:H.

  - (* H = true: oracleè¯´diagåœæœº *)
    (* é‚£ä¹ˆdiagçš„å®šä¹‰ = loop (ä¸åœæœº!) *)
    unfold diag in D.
    rewrite H in D.
    (* D = loop, ä½†oracleè¯´å®ƒåœæœº â†’ çŸ›ç›¾ *)

  - (* H = false: oracleè¯´diagä¸åœæœº *)
    (* é‚£ä¹ˆdiagçš„å®šä¹‰ = Halt (åœæœº!) *)
    unfold diag in D.
    rewrite H in D.
    (* D = Halt, ä½†oracleè¯´å®ƒä¸åœæœº â†’ çŸ›ç›¾ *)
Qed.

(* ä¸»å®šç† *)
Theorem halting_undecidable :
  ~ exists H : program -> input -> bool,
    forall p i,
      H p i = true <-> halts p i.
Proof.
  intro H_exists.
  destruct H_exists as [H H_correct].
  (* ç”¨Hæ„é€ halting_oracle *)
  (* å¾—å‡ºçŸ›ç›¾ *)
  exact halting_contradiction.
Qed.
```

---

## 3. å®Œæ•´Coqä»£ç 

**æ–‡ä»¶**: `halting.v`

```coq
(* ========================================
   åœæœºé—®é¢˜ä¸å¯åˆ¤å®šæ€§çš„Coqè¯æ˜
   ======================================== *)

Require Import Coq.Bool.Bool.
Require Import Coq.Arith.Arith.
Require Import Coq.Logic.Classical.

(* ç¨‹åºç¼–ç  *)
Parameter encode : program -> input.

(* æ— é™å¾ªç¯ *)
Parameter loop : program.
Axiom loop_diverges : forall i, ~ halts loop i.

(* å®Œæ•´è¯æ˜è§ä¸Š *)

(* æ¨è®º: éƒ¨åˆ†å‡½æ•°ä¸å…¨å¯è®¡ç®— *)
Corollary partial_not_total :
  ~ exists f : program -> input -> option nat,
    forall p i,
      (f p i = Some n -> halts p i /\ result p i = n) /\
      (f p i = None -> ~ halts p i).
Proof.
  (* ä»halting_undecidableæ¨å‡º *)
Admitted.
```

---

## 4. è¯æ˜è¦ç‚¹

### 4.1 å¯¹è§’åŒ–æœ¬è´¨

```text
æ ¸å¿ƒæ€æƒ³:
æ„é€ ç¨‹åºD, ä½¿å¾—:
  Dåœ¨è‡ªå·±ä¸Šçš„è¡Œä¸º â‰  ä»»ä½•oracleçš„é¢„æµ‹

D(D) =
  if oracleè¯´"D(D)åœæœº"
  then ä¸åœæœº (loop)
  else åœæœº (Halt)

â†’ oracleå¿…é”™
â†’ ä¸å¯åˆ¤å®š
```

### 4.2 è‡ªæŒ‡çš„å…³é”®

```text
D(D) = è‡ªæˆ‘åº”ç”¨
    = å¯¹è§’çº¿å…ƒç´ 
    = è‡ªæŒ‡æ„é€ 

ç±»æ¯”:
"æ­¤å¥ä¸ºå‡" (è‡ªæŒ‡æ‚–è®º)
DåOracle (è‡ªæŒ‡çŸ›ç›¾)
```

### 4.3 å½¢å¼åŒ–æŒ‘æˆ˜

```text
éš¾ç‚¹:
1. ç¼–ç scheme (ç¨‹åºâ†’æ•°)
2. é€šç”¨å›¾çµæœº (è§£é‡Šå™¨)
3. æ— é™å¾ªç¯çš„è¡¨ç¤º

Coqä¸­:
- ç”¨å½’çº³ç±»å‹
- ç”¨Prop (ébool)
- ç”¨coinduction (æ— é™)
```

---

## 5. ç»ƒä¹ 

**ç»ƒä¹ 1**: è¯æ˜é€šç”¨å›¾çµæœºå­˜åœ¨

```coq
Definition universal : program -> input -> option nat.
(* å®ç°è§£é‡Šå™¨ *)
```

**ç»ƒä¹ 2**: è¯æ˜åœæœºé—®é¢˜æ˜¯RE

```coq
Theorem halting_RE :
  exists enum : nat -> option (program * input),
    forall p i,
      halts p i <-> exists n, enum n = Some (p, i).
```

**ç»ƒä¹ 3**: å½’çº¦å…¶ä»–é—®é¢˜åˆ°åœæœº

```coq
(* ç©ºå¸¦é—®é¢˜ *)
Definition blank_tape_halting (p : program) : Prop :=
  halts p (Input 0).

Theorem blank_reduces_halting :
  (exists dec : program -> bool,
     forall p, dec p = true <-> blank_tape_halting p)
  -> False.
```

---

## ğŸ“š å‚è€ƒæ–‡çŒ®

### åŸå§‹è®ºæ–‡

[1] **Turing, A. M.** (1936). "On Computable Numbers, with an Application to the Entscheidungsproblem"
     _Proceedings of the London Mathematical Society_ s2-42(1): 230-265.

### å½¢å¼åŒ–è¯æ˜

[2] **Norrish, M.** (2011). "Mechanised Computability Theory"
     _ITP 2011_. doi:10.1007/978-3-642-22863-6_27
     (HOL4å®ç°)

[3] **Xu, J. et al.** (2013). "Mechanizing Turing Machines in Coq"
     _ITP 2013_.

### Coqæ•™æ

[4] **Chlipala, A.** (2013). _Certified Programming with Dependent Types_
     MIT Press. ISBN 978-0262026659.

[5] **Pierce, B. C. et al.** (2023). _Software Foundations_ (Vol. 1-6)
     URL: https://softwarefoundations.cis.upenn.edu/

### åœ¨çº¿èµ„æº

[6] **Coq Standard Library**: Undecidability
     URL: https://coq.inria.fr/

---

**æœ€åæ›´æ–°**: 2025-12-02
**éš¾åº¦**: â­â­â­â­
**ä»£ç **: Coq 8.18
**éªŒè¯**: æœºå™¨æ£€æŸ¥ âœ…
