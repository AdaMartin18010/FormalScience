# å•å­ç†è®º (Monad Theory)

> **ä¸»é¢˜**: èŒƒç•´è®ºä¸­çš„è®¡ç®—æ•ˆåº”æŠ½è±¡
> **åˆ›å»ºæ—¥æœŸ**: 2025-12-02
> **éš¾åº¦**: â­â­â­â­
> **åº”ç”¨**: Haskell, å‰¯ä½œç”¨ç®¡ç†, ä»£æ•°æ•ˆåº”

---

## ğŸ“‹ ç›®å½•

- [å•å­ç†è®º (Monad Theory)](#å•å­ç†è®º-monad-theory)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [1. åŠ¨æœº](#1-åŠ¨æœº)
    - [1.1 å‰¯ä½œç”¨é—®é¢˜](#11-å‰¯ä½œç”¨é—®é¢˜)
    - [1.2 å•å­è§£å†³æ–¹æ¡ˆ](#12-å•å­è§£å†³æ–¹æ¡ˆ)
  - [2. èŒƒç•´è®ºå®šä¹‰](#2-èŒƒç•´è®ºå®šä¹‰)
    - [2.1 å•å­ä¸‰å…ƒç»„](#21-å•å­ä¸‰å…ƒç»„)
    - [2.2 å•å­å¾‹](#22-å•å­å¾‹)
  - [3. KleislièŒƒç•´](#3-kleislièŒƒç•´)
  - [4. å¸¸è§å•å­](#4-å¸¸è§å•å­)
    - [4.1 Maybeå•å­](#41-maybeå•å­)
    - [4.2 Listå•å­](#42-listå•å­)
    - [4.3 Stateå•å­](#43-stateå•å­)
    - [4.4 IOå•å­](#44-ioå•å­)
  - [5. å•å­å˜æ¢å™¨](#5-å•å­å˜æ¢å™¨)
  - [6. ä¸ä»£æ•°ç†è®º](#6-ä¸ä»£æ•°ç†è®º)
    - [6.1 å•å­ä¸ä»£æ•°](#61-å•å­ä¸ä»£æ•°)
    - [6.2 ä»£æ•°æ•ˆåº”](#62-ä»£æ•°æ•ˆåº”)
  - [7. æ‰¹åˆ¤æ€§åˆ†æ](#7-æ‰¹åˆ¤æ€§åˆ†æ)
    - [7.1 ç†è®ºä¼˜åŠ¿](#71-ç†è®ºä¼˜åŠ¿)
    - [7.2 å®è·µä»·å€¼](#72-å®è·µä»·å€¼)
    - [7.3 äº‰è®®](#73-äº‰è®®)
  - [ğŸ“š å‚è€ƒæ–‡çŒ®](#-å‚è€ƒæ–‡çŒ®)
    - [èŒƒç•´è®º](#èŒƒç•´è®º)
    - [è®¡ç®—åº”ç”¨](#è®¡ç®—åº”ç”¨)
    - [Haskell](#haskell)
    - [åœ¨çº¿èµ„æº](#åœ¨çº¿èµ„æº)
  - [ğŸ¯ å…³é”®è¦ç‚¹](#-å…³é”®è¦ç‚¹)
    - [æ ¸å¿ƒæ¦‚å¿µ](#æ ¸å¿ƒæ¦‚å¿µ)
    - [æ·±åˆ»æ´å¯Ÿ](#æ·±åˆ»æ´å¯Ÿ)
    - [å®è·µæ„ä¹‰](#å®è·µæ„ä¹‰)

---

## 1. åŠ¨æœº

### 1.1 å‰¯ä½œç”¨é—®é¢˜

**çº¯å‡½æ•°å¼ç¼–ç¨‹å›°å¢ƒ**:

```haskell
-- çº¯å‡½æ•°
add :: Int -> Int -> Int
add x y = x + y  -- æ— å‰¯ä½œç”¨

-- ä½†ç°å®éœ€è¦å‰¯ä½œç”¨:
print :: String -> ???  -- IOå‰¯ä½œç”¨
readFile :: FilePath -> ???  -- IO
parseJSON :: String -> ???  -- å¯èƒ½å¤±è´¥
random :: () -> ???  -- éç¡®å®šæ€§

é—®é¢˜: å¦‚ä½•åœ¨çº¯å‡½æ•°ä¸­å¤„ç†å‰¯ä½œç”¨ï¼Ÿ
```

### 1.2 å•å­è§£å†³æ–¹æ¡ˆ

**æ ¸å¿ƒæ€æƒ³**:

> å°†å‰¯ä½œç”¨"åŒ…è£…"åœ¨ç±»å‹ä¸­

```haskell
print :: String -> IO ()
readFile :: FilePath -> IO String
parseJSON :: String -> Maybe Value
random :: () -> State StdGen Int

å‰¯ä½œç”¨åœ¨ç±»å‹ä¸­æ˜ç¡®æ ‡æ³¨ âœ…
```

**ç»„åˆå‰¯ä½œç”¨**:

```haskell
-- ç»„åˆå¸¦å‰¯ä½œç”¨çš„è®¡ç®—
do
  file <- readFile "config.json"
  config <- parseJSON file
  print (show config)

-- å•å­æä¾›ç»„åˆæœºåˆ¶ï¼
```

---

## 2. èŒƒç•´è®ºå®šä¹‰

### 2.1 å•å­ä¸‰å…ƒç»„

**å®šä¹‰2.1** (å•å­):

```text
èŒƒç•´Cä¸Šçš„å•å­ = (T, Î·, Î¼)

T: C â†’ C  (è‡ªå‡½å­)
Î·: Id â‡’ T  (å•ä½è‡ªç„¶å˜æ¢, unit)
Î¼: Tâˆ˜T â‡’ T  (ä¹˜æ³•è‡ªç„¶å˜æ¢, multiplication/join)

ç›´è§‰:
T: åŒ…è£…ç±»å‹ (a â†’ T a)
Î·: çº¯å€¼æ³¨å…¥ (return)
Î¼: æ‰å¹³åŒ– (join, flatten)
```

**Haskellå¯¹åº”**:

```haskell
class Monad m where
  return :: a -> m a           -- Î·
  (>>=)  :: m a -> (a -> m b) -> m b  -- bind

  -- æˆ–ç­‰ä»·å®šä¹‰:
  join   :: m (m a) -> m a     -- Î¼

-- bindç”¨Î·å’ŒÎ¼å®šä¹‰:
m >>= f = join (fmap f m)
```

### 2.2 å•å­å¾‹

**ä¸‰æ¡æ³•åˆ™**:

```text
1. å·¦å•ä½å¾‹:
   Î¼ âˆ˜ T(Î·) = id_T

2. å³å•ä½å¾‹:
   Î¼ âˆ˜ Î·_T = id_T

3. ç»“åˆå¾‹:
   Î¼ âˆ˜ T(Î¼) = Î¼ âˆ˜ Î¼_T

å›¾è¡¨äº¤æ¢å¼
```

**Haskellç‰ˆæœ¬**:

```haskell
-- å·¦å•ä½å¾‹
return a >>= f  â‰¡  f a

-- å³å•ä½å¾‹
m >>= return  â‰¡  m

-- ç»“åˆå¾‹
(m >>= f) >>= g  â‰¡  m >>= (\x -> f x >>= g)
```

**ç›´è§‰**:

```text
returnæ˜¯ä¸­æ€§å…ƒ
>>= æ»¡è¶³ç»“åˆå¾‹

â†’ å•å­ = "å¯ç»„åˆçš„è®¡ç®—"
```

---

## 3. KleislièŒƒç•´

**å®šä¹‰3.1**:

```text
ç»™å®šå•å­(T,Î·,Î¼)ï¼ŒKleislièŒƒç•´C_T:

å¯¹è±¡: ä¸Cç›¸åŒ
æ€å°„: C_T(A,B) = C(A, T(B))
  (Kleisliç®­å¤´: A â†’ T B)

å¤åˆ: f: Aâ†’TB, g: Bâ†’TC
  g â‹† f = Î¼_C âˆ˜ T(g) âˆ˜ f: A â†’ TC

å•ä½: Î·_A: A â†’ TA
```

**Haskell**:

```haskell
-- Kleisliç®­å¤´
type Kleisli m a b = a -> m b

-- Kleisliå¤åˆ (fish operator)
(>=>) :: Monad m => (a -> m b) -> (b -> m c) -> (a -> m c)
f >=> g = \a -> f a >>= g

-- å•å­å¾‹ âŸº KleislièŒƒç•´å¾‹
return >=> f  â‰¡  f  (å·¦å•ä½)
f >=> return  â‰¡  f  (å³å•ä½)
(f >=> g) >=> h  â‰¡  f >=> (g >=> h)  (ç»“åˆ)
```

---

## 4. å¸¸è§å•å­

### 4.1 Maybeå•å­

**å¤„ç†å¤±è´¥**:

```haskell
data Maybe a = Nothing | Just a

instance Monad Maybe where
  return = Just

  Nothing >>= f = Nothing
  Just x  >>= f = f x

-- ä¾‹å­: å®‰å…¨é™¤æ³•é“¾
safeDivide :: Double -> Double -> Maybe Double
safeDivide _ 0 = Nothing
safeDivide x y = Just (x / y)

compute :: Double -> Double -> Maybe Double
compute x y = do
  a <- safeDivide x y
  b <- safeDivide a 2
  c <- safeDivide b 3
  return c

-- ä¸€æ—¦å¤±è´¥ï¼Œä¼ æ’­Nothing âœ…
```

### 4.2 Listå•å­

**éç¡®å®šæ€§è®¡ç®—**:

```haskell
instance Monad [] where
  return x = [x]
  xs >>= f = concat (map f xs)

-- ä¾‹å­: æ‰€æœ‰å¯èƒ½ç»„åˆ
pairs :: [a] -> [b] -> [(a,b)]
pairs xs ys = do
  x <- xs
  y <- ys
  return (x, y)

-- pairs [1,2] [3,4] = [(1,3),(1,4),(2,3),(2,4)]
```

### 4.3 Stateå•å­

**çŠ¶æ€ä¼ é€’**:

```haskell
newtype State s a = State { runState :: s -> (a, s) }

instance Monad (State s) where
  return a = State (\s -> (a, s))

  m >>= f = State $ \s ->
    let (a, s') = runState m s
        (b, s'') = runState (f a) s'
    in (b, s'')

-- ä¾‹å­: è®¡æ•°å™¨
tick :: State Int ()
tick = State (\s -> ((), s+1))

program :: State Int Int
program = do
  tick
  tick
  tick
  get  -- è¿”å›å½“å‰çŠ¶æ€

-- runState program 0 = (3, 3)
```

### 4.4 IOå•å­

**IOå‰¯ä½œç”¨**:

```haskell
-- IOæ˜¯åŸå§‹å•å­ï¼Œç”±è¿è¡Œæ—¶å®ç°
main :: IO ()
main = do
  putStrLn "Enter name:"
  name <- getLine
  putStrLn ("Hello, " ++ name)

-- éš”ç¦»å‰¯ä½œç”¨ âœ…
-- ç±»å‹ç³»ç»Ÿå¼ºåˆ¶ âœ…
```

---

## 5. å•å­å˜æ¢å™¨

**ç»„åˆå¤šä¸ªæ•ˆåº”**:

```haskell
-- MaybeT: åœ¨ä»»æ„å•å­ä¸Šæ·»åŠ Maybe
newtype MaybeT m a = MaybeT { runMaybeT :: m (Maybe a) }

instance Monad m => Monad (MaybeT m) where
  return = MaybeT . return . Just

  m >>= f = MaybeT $ do
    maybeA <- runMaybeT m
    case maybeA of
      Nothing -> return Nothing
      Just a  -> runMaybeT (f a)

-- ä¾‹å­: IO + Maybe
type App = MaybeT IO

readConfig :: App Config
readConfig = do
  file <- liftIO $ readFile "config.json"
  parseJSON file  -- Maybeå¤±è´¥

-- ç»„åˆIOå’ŒMaybeæ•ˆåº” âœ…
```

**æ ‡å‡†å˜æ¢å™¨æ ˆ**:

```haskell
-- ReaderT: ç¯å¢ƒ
-- StateT: çŠ¶æ€
-- ExceptT: å¼‚å¸¸
-- WriterT: æ—¥å¿—

type App = ReaderT Config (StateT AppState (ExceptT Error IO))

-- å¤šå±‚æ•ˆåº”ï¼
```

---

## 6. ä¸ä»£æ•°ç†è®º

### 6.1 å•å­ä¸ä»£æ•°

**Eilenberg-MooreèŒƒç•´**:

```text
å•å­Tçš„ä»£æ•° = (A, h: T(A) â†’ A)
æ»¡è¶³:
  h âˆ˜ Î·_A = id_A
  h âˆ˜ Î¼_A = h âˆ˜ T(h)

ä¾‹: Listå•å­çš„ä»£æ•° = Monoid
  (M, âŠ•): [M] â†’ M
  âŠ• = fold/concat
```

### 6.2 ä»£æ•°æ•ˆåº”

**ç°ä»£å‘å±•**:

```text
å•å­ â†’ ä»£æ•°æ•ˆåº”ç³»ç»Ÿ

ä¼˜åŠ¿:
- æ•ˆåº”æ›´æ¨¡å—åŒ–
- å¤„ç†å™¨å¯æ›¿æ¢
- ç±»å‹æ›´ç®€å•

è¯­è¨€: Eff, Koka, OCaml 5.0

å‚è€ƒ: [07_æ•ˆåº”ç³»ç»Ÿ](../../Composed/formal_lang_view/07_æ•ˆåº”ç³»ç»Ÿ/)
```

---

## 7. æ‰¹åˆ¤æ€§åˆ†æ

### 7.1 ç†è®ºä¼˜åŠ¿

**ä¼˜åŠ¿**:

- âœ… çº¯å‡½æ•°å¼å‰¯ä½œç”¨
- âœ… ç±»å‹å®‰å…¨
- âœ… å¯ç»„åˆ

**å±€é™**:

- âš ï¸ å­¦ä¹ æ›²çº¿é™¡å³­
- âš ï¸ é”™è¯¯ä¿¡æ¯å¤æ‚
- âš ï¸ æ€§èƒ½å¼€é”€ (æœ‰æ—¶)

### 7.2 å®è·µä»·å€¼

**Haskell**: â­â­â­â­â­

```text
âœ… æ ¸å¿ƒæŠ½è±¡ (IOå¿…éœ€)
âœ… å¹¿æ³›åº”ç”¨
âœ… æˆç†Ÿç”Ÿæ€

Haskell = å•å­çš„ä¸»åœº
```

**å…¶ä»–è¯­è¨€**: â­â­â­

```text
Scala: âœ… Cats, Scalaz
Rust: âš ï¸ Option, Result (ä¸å«å•å­)
JavaScript: âš ï¸ Promise (å•å­-ish)

æ¦‚å¿µå¯å‘ > ç›´æ¥ä½¿ç”¨
```

### 7.3 äº‰è®®

**"å•å­æ•™ç¨‹è¯…å’’"**:

```text
é—®é¢˜: æ¯ä¸ªäººç”¨ä¸åŒæ¯”å–»è§£é‡Šå•å­
  - "å¤ªç©ºæœ" ğŸš€
  - "å¢¨è¥¿å“¥å·é¥¼" ğŸŒ¯
  - "å®¹å™¨" ğŸ“¦

æ‰¹åˆ¤: æ¯”å–»å¾€å¾€è¯¯å¯¼

æœ€å¥½: ç›´æ¥å­¦èŒƒç•´è®ºå®šä¹‰ + å¤šç»ƒä¹ 
```

**å•å­ vs ä»£æ•°æ•ˆåº”**:

```text
å•å­: æˆç†Ÿï¼ŒHaskellæ ‡å‡†
ä»£æ•°æ•ˆåº”: æ›´çµæ´»ï¼Œæ–°å…´

æœªæ¥: å¯èƒ½è¢«ä»£æ•°æ•ˆåº”å–ä»£ï¼Ÿ
```

---

## ğŸ“š å‚è€ƒæ–‡çŒ®

### èŒƒç•´è®º

[1] **Mac Lane, S.** (1998). _Categories for the Working Mathematician_ (2nd ed.)
     Springer. ISBN 0-387-98403-8.
     - Chapter VI: Monads and Algebras

[2] **Awodey, S.** (2010). _Category Theory_ (2nd ed.)
     Oxford University Press.
     - Chapter 10: Monads

### è®¡ç®—åº”ç”¨

[3] **Moggi, E.** (1991). "Notions of Computation and Monads"
     _Information and Computation_ 93(1): 55-92.
     doi:10.1016/0890-5401(91)90052-4
     (å¼€åˆ›æ€§è®ºæ–‡)

[4] **Wadler, P.** (1992). "The Essence of Functional Programming"
     _POPL 1992_. doi:10.1145/143165.143169
     (å•å­ç”¨äºç¼–ç¨‹)

### Haskell

[5] **LipovaÄa, M.** (2011). _Learn You a Haskell for Great Good!_
     No Starch Press. ISBN 978-1593272838.
     - Chapter 12-13: Monads

### åœ¨çº¿èµ„æº

[6] **Haskell Wiki**: Monad
     URL: https://wiki.haskell.org/Monad
     (è®¿é—®: 2025-12-02)

---

## ğŸ¯ å…³é”®è¦ç‚¹

### æ ¸å¿ƒæ¦‚å¿µ

1. **å•å­ = (T, Î·, Î¼)**: è‡ªå‡½å­ + è‡ªç„¶å˜æ¢
2. **å•å­å¾‹**: å·¦/å³å•ä½ + ç»“åˆå¾‹
3. **KleislièŒƒç•´**: å•å­è¯±å¯¼çš„èŒƒç•´
4. **ç»„åˆæ•ˆåº”**: doè®°æ³•, >>=

### æ·±åˆ»æ´å¯Ÿ

> å•å­ = å¯ç»„åˆçš„è®¡ç®—
> å‰¯ä½œç”¨ = ç±»å‹ä¸­çš„æ ‡æ³¨
> çº¯å‡½æ•° + å•å­ = å‰¯ä½œç”¨ç®¡ç†

### å®è·µæ„ä¹‰

- Haskellæ ¸å¿ƒ (IOå¿…éœ€)
- å‰¯ä½œç”¨éš”ç¦»
- å¯ç»„åˆè®¾è®¡æ¨¡å¼

---

**æœ€åæ›´æ–°**: 2025-12-02
**éš¾åº¦**: â­â­â­â­
**æ¨è**: Haskellå¼€å‘è€…å¿…ä¿®
**æ‰¹åˆ¤æ€§**: å®è·µæœ‰ç”¨ï¼Œä½†æœ‰äº‰è®®

**å¦è§**:

- [03.8 Yonedaå¼•ç†](03.8_Yonedaå¼•ç†.md) (èŒƒç•´è®ºåŸºç¡€)
- [03.1 ç¬›å¡å°”é—­èŒƒç•´](03.1_ç¬›å¡å°”é—­èŒƒç•´CCC.md)
- [06.4 ç±»å‹ç³»ç»Ÿ](../06_å·¥ç¨‹å®è·µåº”ç”¨/06.4_ç±»å‹ç³»ç»Ÿä¸ç¼–ç¨‹è¯­è¨€.md) (Haskell)
- [00.4 ä¸åŠ¨ç‚¹ç†è®º](../00_æ ¸å¿ƒç†è®ºä½“ç³»/00.4_ä¸åŠ¨ç‚¹ç†è®º.md) (fixç‚¹)
