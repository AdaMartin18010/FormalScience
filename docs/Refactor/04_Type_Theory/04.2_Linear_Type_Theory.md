# 04.2 线性类型理论 (Linear Type Theory)

## 📋 概述

线性类型以资源一次性使用为核心约束，源于线性逻辑，支撑安全的资源管理、并发与所有权模型。

## 语法与类型直觉

- 线性函数：`A ⊸ B` 表示消耗一个 `A` 产生一个 `B`
- 乘法与加法：`A ⊗ B`、`A ⅋ B`、`A ⊕ B`、`A & B`
- 单位：`1`、`⊥`；可能的指数`!A` 允许复制/弱化

## 规则（轮廓）

- 资源纪律：无隐式复制与丢弃；在 `!` 标记下恢复常规结构
- 典型规则：线性λ、⊗ 引入/消解、&/⊕ 分支、! 的提升/削弱

## 性质与应用

- 保证使用精确性，避免悬挂资源/重复释放
- 并发与进程通信的类型化约束；IO、文件句柄、锁的类型化生命周期

## 代码片段

```rust
// 线性直觉的工程对应：所有权/借用保证“恰好一次释放”
struct File { fd: i32 }

fn consume(f: File) -> Result<(), ()> {
    // f 在此被“线性消费”，函数结束后无法再使用
    Ok(())
}

fn main() {
    let f = File { fd: 3 };
    let _ = consume(f);
    // 下面若再次使用 f 则编译错误：已被移动（moved）
}
```

```haskell
-- Linear Haskell 风格：函数要求线性使用其参数
{-# LANGUAGE LinearTypes #-}

idL :: a %1 -> a
idL x = x

pairUse :: a %1 -> a %1 -> (a, a)
pairUse x y = (x, y)  -- x 与 y 各线性使用一次
```

## 参考文献

1. Girard, Linear Logic.
2. Wadler, Linear Types.

## 批判性分析

- 多元理论视角：
  - 逻辑—类型—工程三位一体：线性逻辑到线性类型再到所有权/借用，统一资源“守恒”语义。
  - 并发语义：以线性通道约束会话协议，减少竞态与悬空引用。
- 局限性分析：
  - 心智负担与可用性：严格资源纪律提升正确性同时增加开发复杂度；与垃圾回收/借用检查的协同需权衡。
  - 库生态要求高：普适数据结构与API需重写以适配线性接口。
- 争议与分歧：
  - 线性 vs. 仿射（允许丢弃）：工程上常采用仿射以换取实用性；指数`!`的引入粒度与代价讨论。
- 应用前景：
  - 安全系统编程、零拷贝与高并发、可验证协议通道、形式化资源会计。
- 改进建议：
  - 提供从“仿射→线性”的渐进引导；建立常用模式（线性迭代器、会话通道、借用桥接）与基准。
