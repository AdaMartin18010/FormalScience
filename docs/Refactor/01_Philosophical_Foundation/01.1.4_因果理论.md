# 01.1.4 å› æœç†è®º

## ğŸ“‹ æ¦‚è¿°

å› æœç†è®ºæ˜¯å½¢è€Œä¸Šå­¦ä¸­ç ”ç©¶å› æœå…³ç³»æœ¬è´¨ã€ç»“æ„å’Œè§„å¾‹çš„æ ¸å¿ƒç†è®ºã€‚å®ƒæ¢è®¨äº‹ç‰©ä¹‹é—´çš„å› æœè”ç³»ï¼Œåˆ†æå› æœå…³ç³»çš„å¿…ç„¶æ€§ã€å¶ç„¶æ€§å’Œåäº‹å®æ¡ä»¶ï¼Œä¸ºç†è§£ç°å®ä¸–ç•Œçš„å› æœç»“æ„æä¾›å“²å­¦åŸºç¡€ã€‚

## ğŸ¯ æ ¸å¿ƒç›®æ ‡

1. **å»ºç«‹å› æœå…³ç³»çš„å½¢å¼åŒ–ä½“ç³»**
2. **åˆ†æå› æœå…³ç³»çš„æœ¬è´¨ç‰¹å¾**
3. **æ¢è®¨å› æœå¿…ç„¶æ€§ä¸å¶ç„¶æ€§**
4. **æ„å»ºåäº‹å®å› æœåˆ†ææ¡†æ¶**
5. **ç ”ç©¶å› æœæ¨ç†çš„æœ‰æ•ˆæ€§**

## ğŸ“š ç›®å½•

1. [åŸºæœ¬æ¦‚å¿µ](#1-åŸºæœ¬æ¦‚å¿µ)
2. [å½¢å¼åŒ–å®šä¹‰](#2-å½¢å¼åŒ–å®šä¹‰)
3. [å®šç†ä¸è¯æ˜](#3-å®šç†ä¸è¯æ˜)
4. [ä»£ç å®ç°](#4-ä»£ç å®ç°)
5. [åº”ç”¨ç¤ºä¾‹](#5-åº”ç”¨ç¤ºä¾‹)
6. [ç›¸å…³ç†è®º](#6-ç›¸å…³ç†è®º)
7. [å‚è€ƒæ–‡çŒ®](#7-å‚è€ƒæ–‡çŒ®)

## 1. åŸºæœ¬æ¦‚å¿µ

### 1.1 å› æœå…³ç³»

**å®šä¹‰ 1.1.1** (å› æœå…³ç³»)
å› æœå…³ç³»æ˜¯æŒ‡ä¸¤ä¸ªäº‹ä»¶æˆ–çŠ¶æ€ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œå…¶ä¸­ï¼š
- **åŸå› ** (Cause): äº§ç”Ÿæˆ–å½±å“ç»“æœçš„äº‹ä»¶æˆ–çŠ¶æ€
- **ç»“æœ** (Effect): è¢«åŸå› äº§ç”Ÿæˆ–å½±å“çš„äº‹ä»¶æˆ–çŠ¶æ€
- **å› æœé“¾** (Causal Chain): ä¸€ç³»åˆ—è¿ç»­çš„å› æœå…³ç³»

### 1.2 å› æœç±»å‹

**å®šä¹‰ 1.1.2** (å› æœç±»å‹åˆ†ç±»)
å› æœå…³ç³»å¯ä»¥åˆ†ä¸ºä»¥ä¸‹ç±»å‹ï¼š

1. **å……åˆ†åŸå› **: å•ç‹¬è¶³ä»¥äº§ç”Ÿç»“æœçš„åŸå› 
2. **å¿…è¦åŸå› **: ç»“æœäº§ç”Ÿæ‰€å¿…éœ€çš„åŸå› 
3. **è´¡çŒ®åŸå› **: å¯¹ç»“æœäº§ç”Ÿæœ‰è´¡çŒ®ä½†ä¸å……åˆ†çš„åŸå› 
4. **ç›´æ¥åŸå› **: ä¸ç»“æœç›´æ¥ç›¸å…³çš„åŸå› 
5. **é—´æ¥åŸå› **: é€šè¿‡å…¶ä»–å› ç´ å½±å“ç»“æœçš„åŸå› 

### 1.3 å› æœæ¨¡æ€

**å®šä¹‰ 1.1.3** (å› æœæ¨¡æ€)
å› æœæ¨¡æ€æ˜¯æŒ‡å› æœå…³ç³»çš„ä¸åŒå­˜åœ¨æ–¹å¼ï¼š
- **å› æœå¿…ç„¶æ€§**: åŸå› å¿…ç„¶äº§ç”Ÿç»“æœ
- **å› æœå¯èƒ½æ€§**: åŸå› å¯èƒ½äº§ç”Ÿç»“æœ
- **å› æœå¶ç„¶æ€§**: åŸå› å¶ç„¶äº§ç”Ÿç»“æœ
- **å› æœä¸å¯èƒ½æ€§**: åŸå› ä¸å¯èƒ½äº§ç”Ÿç»“æœ

## 2. å½¢å¼åŒ–å®šä¹‰

### 2.1 å› æœé€»è¾‘è¯­è¨€

**å®šä¹‰ 1.2.1** (å› æœé€»è¾‘è¯­è¨€)
å› æœé€»è¾‘è¯­è¨€ $\mathcal{L}_C$ ç”±ä»¥ä¸‹éƒ¨åˆ†ç»„æˆï¼š

1. **äº‹ä»¶å˜å…ƒ**: $e_1, e_2, e_3, \ldots \in \mathcal{E}$
2. **æ—¶é—´å˜å…ƒ**: $t_1, t_2, t_3, \ldots \in \mathcal{T}$
3. **å› æœç®—å­**: $\rightarrow_c$ (å› æœè•´å«), $\Rightarrow_c$ (å› æœå¿…ç„¶)
4. **æ—¶é—´ç®—å­**: $\prec$ (æ—¶é—´ä¼˜å…ˆ), $\sim$ (åŒæ—¶)
5. **é€»è¾‘è¿æ¥è¯**: $\neg, \land, \lor, \rightarrow, \leftrightarrow$

**è¯­æ³•è§„åˆ™**:
- å¦‚æœ $e \in \mathcal{E}$ ä¸” $t \in \mathcal{T}$ï¼Œåˆ™ $e@t$ æ˜¯åŸå­å…¬å¼
- å¦‚æœ $\varphi, \psi$ æ˜¯å…¬å¼ï¼Œåˆ™ $\neg\varphi, (\varphi \land \psi), (\varphi \lor \psi), (\varphi \rightarrow \psi), (\varphi \leftrightarrow \psi)$ æ˜¯å…¬å¼
- å¦‚æœ $\varphi, \psi$ æ˜¯å…¬å¼ï¼Œåˆ™ $(\varphi \rightarrow_c \psi), (\varphi \Rightarrow_c \psi)$ æ˜¯å…¬å¼
- å¦‚æœ $t_1, t_2 \in \mathcal{T}$ï¼Œåˆ™ $(t_1 \prec t_2), (t_1 \sim t_2)$ æ˜¯å…¬å¼

### 2.2 å› æœæ¨¡å‹

**å®šä¹‰ 1.2.2** (å› æœæ¨¡å‹)
å› æœæ¨¡å‹æ˜¯ä¸€ä¸ªå››å…ƒç»„ $\mathcal{C} = (W, \prec, \rightarrow_c, V)$ï¼Œå…¶ä¸­ï¼š
- $W$ æ˜¯éç©ºçš„ä¸–ç•Œé›†åˆ
- $\prec \subseteq W \times W$ æ˜¯æ—¶é—´ä¼˜å…ˆå…³ç³»
- $\rightarrow_c \subseteq W \times W$ æ˜¯å› æœå…³ç³»
- $V: \mathcal{E} \times \mathcal{T} \rightarrow 2^W$ æ˜¯äº‹ä»¶èµ‹å€¼å‡½æ•°

**å®šä¹‰ 1.2.3** (å› æœå…¬å¼çš„çœŸå€¼)
ç»™å®šå› æœæ¨¡å‹ $\mathcal{C} = (W, \prec, \rightarrow_c, V)$ å’Œä¸–ç•Œ $w \in W$ï¼Œå› æœå…¬å¼çš„çœŸå€¼å®šä¹‰å¦‚ä¸‹ï¼š

1. $\mathcal{C}, w \models e@t$ å½“ä¸”ä»…å½“ $w \in V(e, t)$
2. $\mathcal{C}, w \models \neg\varphi$ å½“ä¸”ä»…å½“ $\mathcal{C}, w \not\models \varphi$
3. $\mathcal{C}, w \models \varphi \land \psi$ å½“ä¸”ä»…å½“ $\mathcal{C}, w \models \varphi$ ä¸” $\mathcal{C}, w \models \psi$
4. $\mathcal{C}, w \models \varphi \lor \psi$ å½“ä¸”ä»…å½“ $\mathcal{C}, w \models \varphi$ æˆ– $\mathcal{C}, w \models \psi$
5. $\mathcal{C}, w \models \varphi \rightarrow \psi$ å½“ä¸”ä»…å½“ $\mathcal{C}, w \not\models \varphi$ æˆ– $\mathcal{C}, w \models \psi$
6. $\mathcal{C}, w \models \varphi \rightarrow_c \psi$ å½“ä¸”ä»…å½“ å­˜åœ¨ $v$ ä½¿å¾— $w \rightarrow_c v$ ä¸” $\mathcal{C}, v \models \varphi \rightarrow \psi$
7. $\mathcal{C}, w \models \varphi \Rightarrow_c \psi$ å½“ä¸”ä»…å½“ å¯¹æ‰€æœ‰ $v$ ä½¿å¾— $w \rightarrow_c v$ï¼Œæœ‰ $\mathcal{C}, v \models \varphi \rightarrow \psi$

### 2.3 åäº‹å®æ¡ä»¶

**å®šä¹‰ 1.2.4** (åäº‹å®æ¡ä»¶)
åäº‹å®æ¡ä»¶æ˜¯æŒ‡å½¢å¼ä¸º"å¦‚æœ $A$ å‘ç”Ÿï¼Œé‚£ä¹ˆ $B$ ä¼šå‘ç”Ÿ"çš„é™ˆè¿°ï¼Œè®°ä½œ $A \square\!\!\!\rightarrow B$ã€‚

åœ¨å› æœæ¨¡å‹ $\mathcal{C}$ ä¸­ï¼š
$$\mathcal{C}, w \models A \square\!\!\!\rightarrow B$$
å½“ä¸”ä»…å½“ åœ¨æ‰€æœ‰æœ€æ¥è¿‘ $w$ ä¸” $A$ ä¸ºçœŸçš„ä¸–ç•Œä¸­ï¼Œ$B$ éƒ½ä¸ºçœŸã€‚

## 3. å®šç†ä¸è¯æ˜

### 3.1 å› æœä¼ é€’æ€§

**å®šç† 1.3.1** (å› æœä¼ é€’æ€§)
å¦‚æœ $A \rightarrow_c B$ ä¸” $B \rightarrow_c C$ï¼Œåˆ™ $A \rightarrow_c C$ã€‚

**è¯æ˜**:
è®¾ $\mathcal{C} = (W, \prec, \rightarrow_c, V)$ æ˜¯å› æœæ¨¡å‹ï¼Œ$w \in W$ æ˜¯ä»»æ„ä¸–ç•Œã€‚

å‡è®¾ $\mathcal{C}, w \models A \rightarrow_c B$ ä¸” $\mathcal{C}, w \models B \rightarrow_c C$ã€‚

1. $\mathcal{C}, w \models A \rightarrow_c B$ æ„å‘³ç€å­˜åœ¨ $v_1$ ä½¿å¾— $w \rightarrow_c v_1$ ä¸” $\mathcal{C}, v_1 \models A \rightarrow B$
2. $\mathcal{C}, w \models B \rightarrow_c C$ æ„å‘³ç€å­˜åœ¨ $v_2$ ä½¿å¾— $w \rightarrow_c v_2$ ä¸” $\mathcal{C}, v_2 \models B \rightarrow C$

ç”±äºå› æœå…³ç³»å…·æœ‰ä¼ é€’æ€§ï¼Œå¦‚æœ $w \rightarrow_c v_1$ ä¸” $v_1 \rightarrow_c v_2$ï¼Œåˆ™ $w \rightarrow_c v_2$ã€‚

å› æ­¤ï¼Œå­˜åœ¨ $v_2$ ä½¿å¾— $w \rightarrow_c v_2$ ä¸” $\mathcal{C}, v_2 \models A \rightarrow C$ã€‚

æ‰€ä»¥ $\mathcal{C}, w \models A \rightarrow_c C$ã€‚

### 3.2 å› æœéå¯¹ç§°æ€§

**å®šç† 1.3.2** (å› æœéå¯¹ç§°æ€§)
å› æœå…³ç³»æ˜¯éå¯¹ç§°çš„ï¼šå¦‚æœ $A \rightarrow_c B$ï¼Œåˆ™ $B \not\rightarrow_c A$ã€‚

**è¯æ˜**:
è®¾ $\mathcal{C} = (W, \prec, \rightarrow_c, V)$ æ˜¯å› æœæ¨¡å‹ã€‚

å‡è®¾ $A \rightarrow_c B$ ä¸” $B \rightarrow_c A$ã€‚

1. $A \rightarrow_c B$ æ„å‘³ç€åŸå› åœ¨æ—¶é—´ä¸Šå…ˆäºç»“æœ
2. $B \rightarrow_c A$ æ„å‘³ç€ç»“æœåœ¨æ—¶é—´ä¸Šå…ˆäºåŸå› 

è¿™å¯¼è‡´æ—¶é—´çŸ›ç›¾ï¼Œå› ä¸ºåŒä¸€ä¸ªäº‹ä»¶ä¸èƒ½æ—¢å…ˆäºåˆåäºå¦ä¸€ä¸ªäº‹ä»¶ã€‚

å› æ­¤ï¼Œå› æœå…³ç³»å¿…é¡»æ˜¯éå¯¹ç§°çš„ã€‚

### 3.3 å› æœå¿…ç„¶æ€§

**å®šç† 1.3.3** (å› æœå¿…ç„¶æ€§)
å¦‚æœ $A \Rightarrow_c B$ï¼Œåˆ™ $\Box(A \rightarrow B)$ã€‚

**è¯æ˜**:
è®¾ $\mathcal{C} = (W, \prec, \rightarrow_c, V)$ æ˜¯å› æœæ¨¡å‹ï¼Œ$w \in W$ æ˜¯ä»»æ„ä¸–ç•Œã€‚

å‡è®¾ $\mathcal{C}, w \models A \Rightarrow_c B$ã€‚

è¿™æ„å‘³ç€å¯¹æ‰€æœ‰ $v$ ä½¿å¾— $w \rightarrow_c v$ï¼Œéƒ½æœ‰ $\mathcal{C}, v \models A \rightarrow B$ã€‚

ç”±äºå› æœå¿…ç„¶æ€§åœ¨æ‰€æœ‰å¯èƒ½ä¸–ç•Œä¸­éƒ½æˆç«‹ï¼Œæˆ‘ä»¬æœ‰ $\mathcal{C}, w \models \Box(A \rightarrow B)$ã€‚

### 3.4 åäº‹å®åˆ†æ

**å®šç† 1.3.4** (åäº‹å®ç­‰ä»·)
å¯¹äºä»»æ„å…¬å¼ $A, B$ï¼Œæœ‰ï¼š
$$A \square\!\!\!\rightarrow B \equiv \Diamond A \land \Box(A \rightarrow B)$$

**è¯æ˜**:
è®¾ $\mathcal{C} = (W, \prec, \rightarrow_c, V)$ æ˜¯å› æœæ¨¡å‹ï¼Œ$w \in W$ æ˜¯ä»»æ„ä¸–ç•Œã€‚

1. è¯æ˜ $A \square\!\!\!\rightarrow B \rightarrow \Diamond A \land \Box(A \rightarrow B)$:
   - $\mathcal{C}, w \models A \square\!\!\!\rightarrow B$ æ„å‘³ç€åœ¨æ‰€æœ‰æœ€æ¥è¿‘ $w$ ä¸” $A$ ä¸ºçœŸçš„ä¸–ç•Œä¸­ï¼Œ$B$ éƒ½ä¸ºçœŸ
   - è¿™è¦æ±‚å­˜åœ¨ $A$ ä¸ºçœŸçš„ä¸–ç•Œï¼Œå³ $\mathcal{C}, w \models \Diamond A$
   - åŒæ—¶è¦æ±‚åœ¨æ‰€æœ‰ $A$ ä¸ºçœŸçš„ä¸–ç•Œä¸­ï¼Œ$B$ éƒ½ä¸ºçœŸï¼Œå³ $\mathcal{C}, w \models \Box(A \rightarrow B)$

2. è¯æ˜ $\Diamond A \land \Box(A \rightarrow B) \rightarrow A \square\!\!\!\rightarrow B$:
   - $\mathcal{C}, w \models \Diamond A$ æ„å‘³ç€å­˜åœ¨ $A$ ä¸ºçœŸçš„ä¸–ç•Œ
   - $\mathcal{C}, w \models \Box(A \rightarrow B)$ æ„å‘³ç€åœ¨æ‰€æœ‰ $A$ ä¸ºçœŸçš„ä¸–ç•Œä¸­ï¼Œ$B$ éƒ½ä¸ºçœŸ
   - å› æ­¤ï¼Œåœ¨æ‰€æœ‰æœ€æ¥è¿‘ $w$ ä¸” $A$ ä¸ºçœŸçš„ä¸–ç•Œä¸­ï¼Œ$B$ éƒ½ä¸ºçœŸ
   - æ‰€ä»¥ $\mathcal{C}, w \models A \square\!\!\!\rightarrow B$

## 4. ä»£ç å®ç°

### 4.1 å› æœé€»è¾‘è¯­è¨€å®ç°

```rust
use std::collections::HashMap;
use std::fmt;

/// äº‹ä»¶æ ‡è¯†ç¬¦
pub type EventId = String;

/// æ—¶é—´ç‚¹
pub type TimePoint = usize;

/// ä¸–ç•Œæ ‡è¯†ç¬¦
pub type WorldId = usize;

/// å› æœé€»è¾‘å…¬å¼
#[derive(Debug, Clone, PartialEq)]
pub enum CausalFormula {
    /// äº‹ä»¶åœ¨æ—¶é—´ç‚¹å‘ç”Ÿ
    EventAt(EventId, TimePoint),
    /// å¦å®š
    Not(Box<CausalFormula>),
    /// åˆå–
    And(Box<CausalFormula>, Box<CausalFormula>),
    /// æå–
    Or(Box<CausalFormula>, Box<CausalFormula>),
    /// è•´å«
    Implies(Box<CausalFormula>, Box<CausalFormula>),
    /// ç­‰ä»·
    Iff(Box<CausalFormula>, Box<CausalFormula>),
    /// å› æœè•´å«
    CausalImplies(Box<CausalFormula>, Box<CausalFormula>),
    /// å› æœå¿…ç„¶
    CausalNecessity(Box<CausalFormula>, Box<CausalFormula>),
    /// åäº‹å®æ¡ä»¶
    Counterfactual(Box<CausalFormula>, Box<CausalFormula>),
    /// æ—¶é—´ä¼˜å…ˆ
    TimeBefore(TimePoint, TimePoint),
    /// æ—¶é—´åŒæ—¶
    TimeSimultaneous(TimePoint, TimePoint),
}

impl fmt::Display for CausalFormula {
    fn fmt(&self, f: &mut fmt::Formatter) -> fmt::Result {
        match self {
            CausalFormula::EventAt(event, time) => write!(f, "{}@{}", event, time),
            CausalFormula::Not(phi) => write!(f, "Â¬({})", phi),
            CausalFormula::And(phi, psi) => write!(f, "({} âˆ§ {})", phi, psi),
            CausalFormula::Or(phi, psi) => write!(f, "({} âˆ¨ {})", phi, psi),
            CausalFormula::Implies(phi, psi) => write!(f, "({} â†’ {})", phi, psi),
            CausalFormula::Iff(phi, psi) => write!(f, "({} â†” {})", phi, psi),
            CausalFormula::CausalImplies(phi, psi) => write!(f, "({} â†’_c {})", phi, psi),
            CausalFormula::CausalNecessity(phi, psi) => write!(f, "({} â‡’_c {})", phi, psi),
            CausalFormula::Counterfactual(phi, psi) => write!(f, "({} â–¡â†’ {})", phi, psi),
            CausalFormula::TimeBefore(t1, t2) => write!(f, "({} â‰º {})", t1, t2),
            CausalFormula::TimeSimultaneous(t1, t2) => write!(f, "({} âˆ¼ {})", t1, t2),
        }
    }
}

/// å› æœæ¨¡å‹
#[derive(Debug)]
pub struct CausalModel {
    pub worlds: Vec<WorldId>,
    pub time_order: Vec<Vec<TimePoint>>, // æ—¶é—´ä¼˜å…ˆå…³ç³»
    pub causal_relation: Vec<Vec<WorldId>>, // å› æœå…³ç³»
    pub event_valuation: HashMap<(EventId, TimePoint), Vec<WorldId>>, // äº‹ä»¶èµ‹å€¼
    pub similarity: HashMap<WorldId, Vec<WorldId>>, // ä¸–ç•Œç›¸ä¼¼æ€§
}

impl CausalModel {
    /// åˆ›å»ºæ–°çš„å› æœæ¨¡å‹
    pub fn new(world_count: usize, time_count: usize) -> Self {
        let worlds: Vec<WorldId> = (0..world_count).collect();
        let time_order = vec![Vec::new(); world_count];
        let causal_relation = vec![Vec::new(); world_count];
        let event_valuation = HashMap::new();
        let similarity = HashMap::new();
        
        CausalModel {
            worlds,
            time_order,
            causal_relation,
            event_valuation,
            similarity,
        }
    }
    
    /// æ·»åŠ æ—¶é—´ä¼˜å…ˆå…³ç³»
    pub fn add_time_order(&mut self, world: WorldId, before: TimePoint, after: TimePoint) {
        if world < self.worlds.len() {
            self.time_order[world].push((before, after));
        }
    }
    
    /// æ·»åŠ å› æœå…³ç³»
    pub fn add_causal_relation(&mut self, from: WorldId, to: WorldId) {
        if from < self.worlds.len() && to < self.worlds.len() {
            self.causal_relation[from].push(to);
        }
    }
    
    /// è®¾ç½®äº‹ä»¶åœ¨ä¸–ç•Œå’Œæ—¶é—´çš„çœŸå€¼
    pub fn set_event(&mut self, event: &str, time: TimePoint, worlds: Vec<WorldId>) {
        self.event_valuation.insert((event.to_string(), time), worlds);
    }
    
    /// è®¾ç½®ä¸–ç•Œç›¸ä¼¼æ€§
    pub fn set_similarity(&mut self, world: WorldId, similar_worlds: Vec<WorldId>) {
        self.similarity.insert(world, similar_worlds);
    }
    
    /// æ£€æŸ¥å…¬å¼åœ¨ä¸–ç•Œçš„çœŸå€¼
    pub fn satisfies(&self, world: WorldId, formula: &CausalFormula) -> bool {
        match formula {
            CausalFormula::EventAt(event, time) => {
                self.event_valuation.get(&(event.clone(), *time))
                    .map(|worlds| worlds.contains(&world))
                    .unwrap_or(false)
            }
            CausalFormula::Not(phi) => !self.satisfies(world, phi),
            CausalFormula::And(phi, psi) => {
                self.satisfies(world, phi) && self.satisfies(world, psi)
            }
            CausalFormula::Or(phi, psi) => {
                self.satisfies(world, phi) || self.satisfies(world, psi)
            }
            CausalFormula::Implies(phi, psi) => {
                !self.satisfies(world, phi) || self.satisfies(world, psi)
            }
            CausalFormula::Iff(phi, psi) => {
                self.satisfies(world, phi) == self.satisfies(world, psi)
            }
            CausalFormula::CausalImplies(phi, psi) => {
                self.causal_relation[world].iter()
                    .any(|&v| self.satisfies(v, &CausalFormula::Implies(phi.clone(), psi.clone())))
            }
            CausalFormula::CausalNecessity(phi, psi) => {
                self.causal_relation[world].iter()
                    .all(|&v| self.satisfies(v, &CausalFormula::Implies(phi.clone(), psi.clone())))
            }
            CausalFormula::Counterfactual(phi, psi) => {
                self.evaluate_counterfactual(world, phi, psi)
            }
            CausalFormula::TimeBefore(t1, t2) => {
                self.time_order[world].contains(&(*t1, *t2))
            }
            CausalFormula::TimeSimultaneous(t1, t2) => {
                t1 == t2 || self.time_order[world].contains(&(*t1, *t2)) && 
                self.time_order[world].contains(&(*t2, *t1))
            }
        }
    }
    
    /// è¯„ä¼°åäº‹å®æ¡ä»¶
    fn evaluate_counterfactual(&self, world: WorldId, phi: &CausalFormula, psi: &CausalFormula) -> bool {
        // æ‰¾åˆ°æœ€ç›¸ä¼¼ä¸”phiä¸ºçœŸçš„ä¸–ç•Œ
        if let Some(similar_worlds) = self.similarity.get(&world) {
            let phi_worlds: Vec<WorldId> = similar_worlds.iter()
                .filter(|&&w| self.satisfies(w, phi))
                .cloned()
                .collect();
            
            // æ£€æŸ¥åœ¨è¿™äº›ä¸–ç•Œä¸­psiæ˜¯å¦éƒ½ä¸ºçœŸ
            phi_worlds.iter().all(|&w| self.satisfies(w, psi))
        } else {
            false
        }
    }
    
    /// æ£€æŸ¥å…¬å¼æ˜¯å¦åœ¨æ‰€æœ‰ä¸–ç•Œä¸ºçœŸ
    pub fn is_valid(&self, formula: &CausalFormula) -> bool {
        self.worlds.iter().all(|&w| self.satisfies(w, formula))
    }
    
    /// æ£€æŸ¥å…¬å¼æ˜¯å¦åœ¨æŸä¸ªä¸–ç•Œä¸ºçœŸ
    pub fn is_satisfiable(&self, formula: &CausalFormula) -> bool {
        self.worlds.iter().any(|&w| self.satisfies(w, formula))
    }
}

/// å› æœæ¨ç†ç³»ç»Ÿ
pub struct CausalReasoningSystem {
    pub model: CausalModel,
}

impl CausalReasoningSystem {
    pub fn new(model: CausalModel) -> Self {
        CausalReasoningSystem { model }
    }
    
    /// éªŒè¯å› æœä¼ é€’æ€§
    pub fn verify_transitivity(&self, a: &CausalFormula, b: &CausalFormula, c: &CausalFormula) -> bool {
        let ab = CausalFormula::CausalImplies(Box::new(a.clone()), Box::new(b.clone()));
        let bc = CausalFormula::CausalImplies(Box::new(b.clone()), Box::new(c.clone()));
        let ac = CausalFormula::CausalImplies(Box::new(a.clone()), Box::new(c.clone()));
        
        let premise = CausalFormula::And(Box::new(ab), Box::new(bc));
        let conclusion = ac;
        
        self.model.is_valid(&CausalFormula::Implies(Box::new(premise), Box::new(conclusion)))
    }
    
    /// éªŒè¯å› æœéå¯¹ç§°æ€§
    pub fn verify_asymmetry(&self, a: &CausalFormula, b: &CausalFormula) -> bool {
        let ab = CausalFormula::CausalImplies(Box::new(a.clone()), Box::new(b.clone()));
        let ba = CausalFormula::CausalImplies(Box::new(b.clone()), Box::new(a.clone()));
        
        // å¦‚æœAå› æœè•´å«Bï¼Œé‚£ä¹ˆBä¸èƒ½å› æœè•´å«A
        !self.model.is_valid(&CausalFormula::And(Box::new(ab), Box::new(ba)))
    }
    
    /// å› æœæ¨ç†
    pub fn causal_inference(&self, premises: &[CausalFormula], conclusion: &CausalFormula) -> bool {
        // æ£€æŸ¥å‰ææ˜¯å¦åœ¨æ‰€æœ‰ä¸–ç•Œä¸ºçœŸ
        let premises_valid = premises.iter().all(|p| self.model.is_valid(p));
        
        if premises_valid {
            // æ£€æŸ¥ç»“è®ºæ˜¯å¦åœ¨æ‰€æœ‰ä¸–ç•Œä¸ºçœŸ
            self.model.is_valid(conclusion)
        } else {
            false
        }
    }
}

/// å› æœåˆ†æå™¨
pub struct CausalAnalyzer {
    system: CausalReasoningSystem,
}

impl CausalAnalyzer {
    pub fn new(system: CausalReasoningSystem) -> Self {
        CausalAnalyzer { system }
    }
    
    /// è¯†åˆ«å› æœå…³ç³»
    pub fn identify_causality(&self, events: &[(EventId, TimePoint)]) -> Vec<(EventId, EventId)> {
        let mut causal_pairs = Vec::new();
        
        for i in 0..events.len() {
            for j in i+1..events.len() {
                let (event1, time1) = &events[i];
                let (event2, time2) = &events[j];
                
                let phi = CausalFormula::EventAt(event1.clone(), *time1);
                let psi = CausalFormula::EventAt(event2.clone(), *time2);
                
                if self.system.model.satisfies(0, &CausalFormula::CausalImplies(
                    Box::new(phi), Box::new(psi)
                )) {
                    causal_pairs.push((event1.clone(), event2.clone()));
                }
            }
        }
        
        causal_pairs
    }
    
    /// åäº‹å®åˆ†æ
    pub fn counterfactual_analysis(&self, antecedent: &CausalFormula, consequent: &CausalFormula) -> bool {
        self.system.model.satisfies(0, &CausalFormula::Counterfactual(
            Box::new(antecedent.clone()), Box::new(consequent.clone())
        ))
    }
    
    /// å› æœå¼ºåº¦åˆ†æ
    pub fn causal_strength(&self, cause: &CausalFormula, effect: &CausalFormula) -> f64 {
        let mut strength = 0.0;
        let mut total_worlds = 0;
        
        for &world in &self.system.model.worlds {
            total_worlds += 1;
            
            if self.system.model.satisfies(world, &CausalFormula::CausalImplies(
                Box::new(cause.clone()), Box::new(effect.clone())
            )) {
                strength += 1.0;
            }
        }
        
        if total_worlds > 0 {
            strength / total_worlds as f64
        } else {
            0.0
        }
    }
}

/// å› æœé€»è¾‘æµ‹è¯•
#[cfg(test)]
mod tests {
    use super::*;
    
    #[test]
    fn test_causal_transitivity() {
        let mut model = CausalModel::new(3, 3);
        
        // è®¾ç½®å› æœå…³ç³»
        model.add_causal_relation(0, 1);
        model.add_causal_relation(1, 2);
        
        // è®¾ç½®äº‹ä»¶
        model.set_event("A", 0, vec![0]);
        model.set_event("B", 1, vec![1]);
        model.set_event("C", 2, vec![2]);
        
        let system = CausalReasoningSystem::new(model);
        let analyzer = CausalAnalyzer::new(system);
        
        let a = CausalFormula::EventAt("A".to_string(), 0);
        let b = CausalFormula::EventAt("B".to_string(), 1);
        let c = CausalFormula::EventAt("C".to_string(), 2);
        
        assert!(analyzer.system.verify_transitivity(&a, &b, &c));
    }
    
    #[test]
    fn test_causal_asymmetry() {
        let mut model = CausalModel::new(2, 2);
        
        // è®¾ç½®å› æœå…³ç³»
        model.add_causal_relation(0, 1);
        
        // è®¾ç½®äº‹ä»¶
        model.set_event("A", 0, vec![0]);
        model.set_event("B", 1, vec![1]);
        
        let system = CausalReasoningSystem::new(model);
        let analyzer = CausalAnalyzer::new(system);
        
        let a = CausalFormula::EventAt("A".to_string(), 0);
        let b = CausalFormula::EventAt("B".to_string(), 1);
        
        assert!(analyzer.system.verify_asymmetry(&a, &b));
    }
    
    #[test]
    fn test_counterfactual_analysis() {
        let mut model = CausalModel::new(3, 2);
        
        // è®¾ç½®ä¸–ç•Œç›¸ä¼¼æ€§
        model.set_similarity(0, vec![0, 1, 2]);
        
        // è®¾ç½®äº‹ä»¶
        model.set_event("A", 0, vec![1, 2]); // Aåœ¨ç›¸ä¼¼ä¸–ç•Œä¸­ä¸ºçœŸ
        model.set_event("B", 1, vec![1, 2]); // Båœ¨ç›¸ä¼¼ä¸–ç•Œä¸­ä¸ºçœŸ
        
        let system = CausalReasoningSystem::new(model);
        let analyzer = CausalAnalyzer::new(system);
        
        let a = CausalFormula::EventAt("A".to_string(), 0);
        let b = CausalFormula::EventAt("B".to_string(), 1);
        
        assert!(analyzer.counterfactual_analysis(&a, &b));
    }
}
```

## 5. åº”ç”¨ç¤ºä¾‹

### 5.1 ç‰©ç†å› æœåˆ†æ

**ç¤ºä¾‹ 1**: ç‰©ç†å› æœå…³ç³»
```rust
// ç‰©ç†å› æœåˆ†æ
let mut physics_model = CausalModel::new(5, 4);

// è®¾ç½®æ—¶é—´é¡ºåº
for world in 0..5 {
    physics_model.add_time_order(world, 0, 1);
    physics_model.add_time_order(world, 1, 2);
    physics_model.add_time_order(world, 2, 3);
}

// è®¾ç½®å› æœå…³ç³»
physics_model.add_causal_relation(0, 1);
physics_model.add_causal_relation(1, 2);
physics_model.add_causal_relation(2, 3);

// è®¾ç½®ç‰©ç†äº‹ä»¶
physics_model.set_event("force_applied", 0, vec![0]);
physics_model.set_event("acceleration", 1, vec![1]);
physics_model.set_event("velocity_change", 2, vec![2]);
physics_model.set_event("position_change", 3, vec![3]);

let system = CausalReasoningSystem::new(physics_model);
let analyzer = CausalAnalyzer::new(system);

// åˆ†æå› æœé“¾
let events = vec![
    ("force_applied".to_string(), 0),
    ("acceleration".to_string(), 1),
    ("velocity_change".to_string(), 2),
    ("position_change".to_string(), 3),
];

let causal_pairs = analyzer.identify_causality(&events);
println!("è¯†åˆ«çš„å› æœå…³ç³»: {:?}", causal_pairs);
```

### 5.2 ç¤¾ä¼šå› æœåˆ†æ

**ç¤ºä¾‹ 2**: ç¤¾ä¼šå› æœå…³ç³»
```rust
// ç¤¾ä¼šå› æœåˆ†æ
let mut social_model = CausalModel::new(4, 3);

// è®¾ç½®ç¤¾ä¼šå› æœå…³ç³»
social_model.add_causal_relation(0, 1);
social_model.add_causal_relation(0, 2);
social_model.add_causal_relation(1, 3);
social_model.add_causal_relation(2, 3);

// è®¾ç½®ç¤¾ä¼šäº‹ä»¶
social_model.set_event("policy_change", 0, vec![0]);
social_model.set_event("economic_growth", 1, vec![1]);
social_model.set_event("social_unrest", 2, vec![2]);
social_model.set_event("political_stability", 3, vec![3]);

let system = CausalReasoningSystem::new(social_model);
let analyzer = CausalAnalyzer::new(system);

// åˆ†ææ”¿ç­–å˜åŒ–çš„å› æœå½±å“
let policy = CausalFormula::EventAt("policy_change".to_string(), 0);
let stability = CausalFormula::EventAt("political_stability".to_string(), 3);

let strength = analyzer.causal_strength(&policy, &stability);
println!("æ”¿ç­–å˜åŒ–å¯¹æ”¿æ²»ç¨³å®šçš„å› æœå¼ºåº¦: {}", strength);
```

### 5.3 ç”Ÿç‰©å› æœåˆ†æ

**ç¤ºä¾‹ 3**: ç”Ÿç‰©å› æœå…³ç³»
```rust
// ç”Ÿç‰©å› æœåˆ†æ
let mut bio_model = CausalModel::new(3, 4);

// è®¾ç½®ç”Ÿç‰©å› æœå…³ç³»
bio_model.add_causal_relation(0, 1);
bio_model.add_causal_relation(1, 2);
bio_model.add_causal_relation(2, 3);

// è®¾ç½®ç”Ÿç‰©äº‹ä»¶
bio_model.set_event("gene_activation", 0, vec![0]);
bio_model.set_event("protein_synthesis", 1, vec![1]);
bio_model.set_event("cellular_response", 2, vec![2]);
bio_model.set_event("organism_behavior", 3, vec![3]);

let system = CausalReasoningSystem::new(bio_model);
let analyzer = CausalAnalyzer::new(system);

// åäº‹å®åˆ†æï¼šå¦‚æœæ²¡æœ‰åŸºå› æ¿€æ´»ä¼šæ€æ ·ï¼Ÿ
let no_gene = CausalFormula::Not(Box::new(
    CausalFormula::EventAt("gene_activation".to_string(), 0)
));
let no_behavior = CausalFormula::Not(Box::new(
    CausalFormula::EventAt("organism_behavior".to_string(), 3)
));

let counterfactual = analyzer.counterfactual_analysis(&no_gene, &no_behavior);
println!("åäº‹å®åˆ†æç»“æœ: {}", counterfactual);
```

## 6. ç›¸å…³ç†è®º

### 6.1 ä¸å­˜åœ¨ç†è®ºçš„å…³ç³»

å› æœç†è®ºä¸å­˜åœ¨ç†è®ºå¯†åˆ‡ç›¸å…³ï¼š
- **å› æœå­˜åœ¨**: æ¢è®¨å› æœå…³ç³»çš„å­˜åœ¨æ–¹å¼
- **å› æœå¿…ç„¶æ€§**: åˆ†æå› æœè§„å¾‹çš„å¿…ç„¶æ€§
- **å› æœå®åœ¨æ€§**: è®¨è®ºå› æœå…³ç³»çš„å®åœ¨æ€§

### 6.2 ä¸å®ä½“ç†è®ºçš„å…³ç³»

å› æœç†è®ºä¸ºå®ä½“ç†è®ºæä¾›åˆ†ææ¡†æ¶ï¼š
- **å®ä½“å› æœ**: åˆ†æå®ä½“ä¹‹é—´çš„å› æœå…³ç³»
- **å› æœå±æ€§**: æ¢è®¨å®ä½“çš„å› æœå±æ€§
- **å› æœåŒä¸€æ€§**: ç ”ç©¶å› æœåŒä¸€æ€§é—®é¢˜

### 6.3 ä¸æ¨¡æ€ç†è®ºçš„å…³ç³»

å› æœç†è®ºåˆ©ç”¨æ¨¡æ€ç†è®ºçš„åˆ†æå·¥å…·ï¼š
- **å› æœæ¨¡æ€**: åˆ†æå› æœå…³ç³»çš„æ¨¡æ€ç‰¹å¾
- **å¯èƒ½ä¸–ç•Œ**: åŸºäºå¯èƒ½ä¸–ç•Œçš„å› æœåˆ†æ
- **åäº‹å®æ¡ä»¶**: æ¨¡æ€ç†è®ºåœ¨å› æœåˆ†æä¸­çš„åº”ç”¨

## 7. å‚è€ƒæ–‡çŒ®

1. Lewis, D. (1973). Causation. *The Journal of Philosophy*, 70(17), 556-567.

2. Woodward, J. (2003). *Making things happen: A theory of causal explanation*. Oxford University Press.

3. Pearl, J. (2009). *Causality: Models, reasoning, and inference*. Cambridge University Press.

4. Spirtes, P., Glymour, C., & Scheines, R. (2000). *Causation, prediction, and search*. MIT Press.

5. Cartwright, N. (1989). *Nature's capacities and their measurement*. Oxford University Press.

---

**ç›¸å…³æ–‡æ¡£**:
- [01.1.1 å­˜åœ¨ç†è®º](../01.1.1_å­˜åœ¨ç†è®º.md)
- [01.1.2 å®ä½“ç†è®º](../01.1.2_å®ä½“ç†è®º.md)
- [01.1.3 æ¨¡æ€ç†è®º](../01.1.3_æ¨¡æ€ç†è®º.md)
- [01.2.1 çŸ¥è¯†ç†è®º](../02_Epistemology/01.2.1_çŸ¥è¯†ç†è®º.md)

**è¿”å›**: [å“²å­¦åŸºç¡€ç†è®º](../README.md) | [ä¸»ç´¢å¼•](../../00_Master_Index/README.md) 