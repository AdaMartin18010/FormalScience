# 03.2.3 上下文相关文法 (Context-Sensitive Grammar)

## 📚 概述 | Overview

上下文相关文法是形式语言理论中的重要文法类型，它生成的语言恰好是线性有界自动机能够识别的语言。上下文相关文法是乔姆斯基谱系中的1型文法，比上下文无关文法更强大，能够描述更复杂的语言结构。

Context-sensitive grammar (CSG) is an important type of grammar in formal language theory. The languages it generates are exactly those recognized by linear bounded automata. As Type-1 grammars in the Chomsky hierarchy, CSGs are more powerful than context-free grammars and can describe more complex language structures.

## 🔍 形式定义

**定义 3.2.3.1** (上下文相关文法)
上下文相关文法是一个四元组 $G = (V, \Sigma, P, S)$，其中：

1. $V$ 是非终结符集合
2. $\Sigma$ 是终结符集合，且 $V \cap \Sigma = \emptyset$
3. $P$ 是产生式集合，每个产生式形如 $\alpha A \beta \to \alpha \gamma \beta$，其中 $A \in V$，$\alpha, \beta \in (V \cup \Sigma)^*$，$\gamma \in (V \cup \Sigma)^+$
4. $S \in V$ 是起始符号

**注**: 特殊情况下，允许产生式 $S \to \varepsilon$，前提是 $S$ 不出现在任何产生式的右部。

**定义 3.2.3.2** (推导)
对于上下文相关文法 $G = (V, \Sigma, P, S)$，如果 $\alpha A \beta \to \alpha \gamma \beta \in P$，则有 $\delta \alpha A \beta \eta \Rightarrow \delta \alpha \gamma \beta \eta$，其中 $\delta, \eta \in (V \cup \Sigma)^*$。

**定义 3.2.3.3** (语言)
上下文相关文法 $G$ 生成的语言定义为：
$$L(G) = \{w \in \Sigma^* \mid S \Rightarrow^* w\}$$

## 🧩 核心概念与定义 | Core Concepts & Definitions

- **上下文相关文法（Context-Sensitive Grammar, CSG）**：产生式允许上下文限制，且右侧长度不少于左侧。
  
  A grammar whose productions allow context restrictions and whose right-hand side is at least as long as the left.
- **非缩短性（Non-contracting Property）**：所有产生式满足 $|\alpha| \leq |\beta|$。
  
  All productions satisfy $|\alpha| \leq |\beta|$.
- **上下文相关语言（Context-Sensitive Language, CSL）**：可由CSG生成或LBA识别的语言。
  
  Languages generated by CSGs or recognized by linear bounded automata.

## 🧠 理论性质与定理 | Theoretical Properties & Theorems

- **等价性定理（Equivalence Theorem）**：CSG生成的语言类与LBA识别的语言类完全一致。
  
  The class of languages generated by CSGs is exactly the class recognized by LBAs.
- **闭包性质（Closure Properties）**：上下文相关语言对并、交、连接、克林闭包等运算封闭，但对补不封闭。
  
  CSLs are closed under union, intersection, concatenation, and Kleene star, but not under complement.
- **判定性（Decidability）**：成员资格、空性等问题可判定，但等价性不可判定。
  
  Membership and emptiness are decidable for CSGs, but equivalence is undecidable.

## 🛠️ 应用示例

### 复制语言

```text
S → aSb | ab
```

此文法生成语言 $L = \{a^n b^n \mid n \geq 1\}$，是上下文无关语言。

```text
S → aSBC | aBC
CB → BC
aB → ab
bB → bb
bC → bc
cC → cc
```

此文法生成语言 $L = \{a^n b^n c^n \mid n \geq 1\}$，是上下文相关语言但不是上下文无关语言。

### 计数语言

```text
S → ABC
AB → ABc
BC → BcC
A → a
B → b
C → c
```

此文法生成语言 $L = \{a^n b^n c^n \mid n \geq 1\}$，展示了上下文相关文法处理多重依赖的能力。

## 🔗 实现示例

```python
class CSG:
    def __init__(self, variables, terminals, productions, start_symbol):
        self.variables = variables          # 非终结符集合
        self.terminals = terminals          # 终结符集合
        self.productions = productions      # 产生式规则
        self.start_symbol = start_symbol    # 起始符号
    
    def is_context_sensitive(self):
        """检查文法是否为上下文相关文法"""
        for lhs, rhs_list in self.productions.items():
            for rhs in rhs_list:
                # 检查特殊规则 S → ε
                if lhs == self.start_symbol and rhs == "":
                    continue
                
                # 检查非缩短性
                if len(lhs) > len(rhs):
                    return False
                
                # 检查上下文相关形式
                # 这里简化了检查，完整检查需要分析产生式结构
                
        return True
    
    def derive(self, string, max_steps=1000):
        """模拟推导过程"""
        current = self.start_symbol
        steps = 0
        
        while steps < max_steps and current != string:
            steps += 1
            # 尝试应用产生式规则
            applied = False
            
            for lhs, rhs_list in self.productions.items():
                for rhs in rhs_list:
                    # 查找并替换
                    if lhs in current:
                        current = current.replace(lhs, rhs, 1)
                        applied = True
                        break
                
                if applied:
                    break
            
            if not applied:
                return False  # 无法继续推导
        
        return current == string
```

## 🏛️ 国际对标与批判性分析 | International Perspective & Critical Analysis

- 上下文相关文法是理论计算机科学、复杂系统建模等领域的重要工具。
- 但其实际工程实现复杂，且与自然语言、编程语言的直接联系有限。
- 非缩短性保证了空间受限的可计算性，但也限制了文法的灵活性。
- 近年来，CSG理论被用于DNA计算、分子编程等新兴领域。

Context-sensitive grammars are important tools in theoretical computer science and complex systems modeling. However, their practical implementation is complex, and their direct connection to natural and programming languages is limited. The non-contracting property ensures space-bounded computability but also restricts grammar flexibility. Recently, CSG theory has been applied to emerging fields such as DNA computing and molecular programming.

## 🔗 相关内容

- [03.1.3 线性有界自动机](../03.1_Automata_Theory/03.1.3_Linear_Bounded_Automata.md) - 与上下文相关文法等价的计算模型
- [03.2.2 上下文无关文法](03.2.2_Context_Free_Grammar.md) - 比上下文相关文法更受限的文法
- [03.2.4 无限制文法](03.2.4_Unrestricted_Grammar.md) - 比上下文相关文法更强大的文法
- [03.3.1 乔姆斯基谱系](../03.3_Language_Hierarchy/03.3.1_Chomsky_Hierarchy.md) - 上下文相关文法在语言层次中的位置

## 参考文献 | References

- Hopcroft, J.E., Motwani, R., Ullman, J.D. "Introduction to Automata Theory, Languages, and Computation"
- Wikipedia: [Context-sensitive grammar](https://en.wikipedia.org/wiki/Context-sensitive_grammar)
- Stanford Encyclopedia of Philosophy: [Formal Languages](https://plato.stanford.edu/entries/formal-languages/)
- Kuroda, S.-Y. "Classes of languages and linear-bounded automata" (1964)
- Chomsky, N. "Context-sensitive grammars and pushdown storage" (1963)

---

## 批判性分析 | Critical Analysis

- 上下文相关文法理论强调形式化、复杂性和空间受限可计算性，但在实际工程和自然语言处理中的应用有限。
- 非缩短性虽保证了空间约束，但也导致文法表达能力受限。
- 新兴领域（如DNA计算、复杂系统）为CSG理论提供了新的应用场景，但实际可验证性和工程落地仍需进一步研究。
- 不同学派对CSG与认知、语言复杂性的关系存在争议。

- Context-sensitive grammar theory emphasizes formalization, complexity, and space-bounded computability, but has limited application in engineering and natural language processing.
- The non-contracting property ensures space constraints but also limits grammar expressiveness.
- Emerging fields (e.g., DNA computing, complex systems) provide new application scenarios for CSG theory, but practical verifiability and engineering realization require further research.
- There are debates among different schools regarding the relationship between CSGs, cognition, and language complexity.
