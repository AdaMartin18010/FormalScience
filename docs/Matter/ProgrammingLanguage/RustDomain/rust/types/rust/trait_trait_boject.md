# Trait å’Œ Trait Object

åœ¨ Rust ä¸­ï¼ŒTrait å’Œ Trait Object æ˜¯ä¸¤ä¸ªå¯†åˆ‡ç›¸å…³ä½†ç”¨é€”ä¸åŒçš„æ¦‚å¿µã€‚
ä»¥ä¸‹æ˜¯å®ƒä»¬çš„å®šä¹‰ã€åŒºåˆ«å’Œè”ç³»ï¼š

## ğŸ“‹ ç›®å½•

- [1 Trait çš„å®šä¹‰ä¸ä½œç”¨](#1-trait-çš„å®šä¹‰ä¸ä½œç”¨)
- [2 Trait Object çš„å®šä¹‰ä¸ä½œç”¨](#2-trait-object-çš„å®šä¹‰ä¸ä½œç”¨)
- [3 Trait ä¸ Trait Object çš„åŒºåˆ«](#3-trait-ä¸-trait-object-çš„åŒºåˆ«)
- [4 Trait ä¸ Trait Object çš„è”ç³»](#4-trait-ä¸-trait-object-çš„è”ç³»)

---

## 1 Trait çš„å®šä¹‰ä¸ä½œç”¨

Trait æ˜¯ Rust ä¸­ç”¨äºå®šä¹‰å…±äº«è¡Œä¸ºçš„æŠ½è±¡æœºåˆ¶ï¼Œç±»ä¼¼äºå…¶ä»–è¯­è¨€ä¸­çš„æ¥å£ã€‚
é€šè¿‡ Traitï¼Œå¯ä»¥æŒ‡å®šä¸€ç»„æ–¹æ³•ç­¾åï¼Œè€Œå…·ä½“çš„å®ç°ç”±å®ç°äº†è¯¥ Trait çš„ç±»å‹æä¾›ã€‚
ä¾‹å¦‚ï¼š

```rust
trait Draw {
    fn draw(&self);
}
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒDraw Trait å®šä¹‰äº†ä¸€ä¸ª draw æ–¹æ³•ï¼Œä»»ä½•å®ç°äº† Draw Trait çš„ç±»å‹éƒ½å¿…é¡»æä¾› draw æ–¹æ³•çš„å…·ä½“å®ç°ã€‚

## 2 Trait Object çš„å®šä¹‰ä¸ä½œç”¨

Trait Object æ˜¯ä¸€ç§ç‰¹æ®Šçš„ç±»å‹ï¼Œå®ƒå…è®¸å°†å®ç°äº†ç‰¹å®š Trait çš„ä¸åŒå…·ä½“ç±»å‹æŠ½è±¡ä¸ºä¸€ç§é€šç”¨ç±»å‹ã€‚
Trait Object æä¾›äº†åŠ¨æ€åˆ†å‘çš„èƒ½åŠ›ï¼Œå³åœ¨è¿è¡Œæ—¶å†³å®šè°ƒç”¨å“ªä¸ªå…·ä½“ç±»å‹çš„æ–¹æ³•ã€‚
Trait Object çš„è¯­æ³•å½¢å¼ä¸º dyn Traitï¼Œé€šå¸¸éœ€è¦ä¸æŒ‡é’ˆç±»å‹ï¼ˆå¦‚ & å¼•ç”¨ã€`Box<T>` ç­‰ï¼‰ä¸€èµ·ä½¿ç”¨ã€‚
ä¾‹å¦‚ï¼š

```rust
fn render(scene: &dyn Draw) {
    scene.draw();
}
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œrender å‡½æ•°æ¥å—ä¸€ä¸ªå®ç°äº† Draw Trait çš„ Trait Objectï¼Œè€Œå…·ä½“çš„ç±»å‹åœ¨è¿è¡Œæ—¶ç¡®å®šã€‚

## 3 Trait ä¸ Trait Object çš„åŒºåˆ«

é™æ€åˆ†å‘ vs åŠ¨æ€åˆ†å‘ï¼š
    Traitï¼šé€šå¸¸ç”¨äºæ³›å‹ç¼–ç¨‹ï¼Œç¼–è¯‘æ—¶ç¡®å®šå…·ä½“ç±»å‹ï¼Œæ€§èƒ½æ›´é«˜ã€‚
    Trait Objectï¼šè¿è¡Œæ—¶ç¡®å®šå…·ä½“ç±»å‹ï¼Œæä¾›äº†æ›´å¤§çš„çµæ´»æ€§ï¼Œä½†æ¶‰åŠè™šè¡¨ï¼ˆvtableï¼‰æŸ¥æ‰¾ï¼Œæ€§èƒ½ç¨ä½ã€‚
ç±»å‹å¤§å°ï¼š
    Traitï¼šä¸èƒ½ç›´æ¥ä½œä¸ºæ•°æ®ç±»å‹ä½¿ç”¨ï¼Œå› ä¸º Trait çš„å¤§å°åœ¨ç¼–è¯‘æ—¶ä¸ç¡®å®šã€‚
    Trait Objectï¼šé€šè¿‡æŒ‡é’ˆå’Œè™šè¡¨å®ç°ï¼Œå¤§å°å›ºå®šï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€å¤„ç†ä¸åŒç±»å‹ã€‚
ä½¿ç”¨åœºæ™¯ï¼š
    Traitï¼šé€‚ç”¨äºç¼–è¯‘æ—¶å·²çŸ¥æ‰€æœ‰å…·ä½“ç±»å‹çš„åœºæ™¯ã€‚
    Trait Objectï¼šé€‚ç”¨äºè¿è¡Œæ—¶éœ€è¦å¤„ç†å¤šç§æœªçŸ¥ç±»å‹çš„åœºæ™¯ã€‚

## 4 Trait ä¸ Trait Object çš„è”ç³»

Trait æ˜¯ Trait Object çš„åŸºç¡€ã€‚
Trait å®šä¹‰äº†è¡Œä¸ºè§„èŒƒï¼Œè€Œ Trait Object åˆ™æ˜¯åŸºäºè¿™äº›è§„èŒƒå®ç°åŠ¨æ€åˆ†å‘çš„æœºåˆ¶ã€‚
æ¢å¥è¯è¯´ï¼ŒTrait Object æ˜¯ä¸€ç§ç‰¹æ®Šçš„ç±»å‹ï¼Œå®ƒä¾èµ–äº Trait æ¥å®šä¹‰å…¶è¡Œä¸ºã€‚

æ€»ç»“æ¥è¯´ï¼ŒTrait å’Œ Trait Object éƒ½æ˜¯ Rust ä¸­å®ç°å¤šæ€çš„å·¥å…·ï¼Œ
ä½† Trait æ›´é€‚åˆé™æ€åˆ†å‘å’Œæ€§èƒ½æ•æ„Ÿçš„åœºæ™¯ï¼Œè€Œ Trait Object åˆ™é€‚åˆåŠ¨æ€åˆ†å‘å’Œçµæ´»æ€§æ›´é«˜çš„åœºæ™¯ã€‚

Rust çš„ç‰¹å¾ï¼ˆTraitï¼‰æ¦‚å¿µã€å®šä¹‰ã€è§£é‡Šå’Œç”¨ä¾‹
æ¦‚å¿µ
    Rust çš„ç‰¹å¾ï¼ˆTraitï¼‰æ˜¯ä¸€ç§å¼ºå¤§çš„è¯­è¨€æœºåˆ¶ï¼Œç”¨äºå®šä¹‰å…±äº«è¡Œä¸ºå¹¶å®ç°ä»£ç çš„æŠ½è±¡ã€‚
    ç‰¹å¾å¯ä»¥è¢«çœ‹ä½œæ˜¯ä¸€ç§çº¦æŸï¼Œç”¨äºæè¿°ç±»å‹çš„è¡Œä¸ºã€‚
    é€šè¿‡ä¸ºç±»å‹å®ç°ç‰¹å¾ï¼Œå¯ä»¥å®šä¹‰ç±»å‹åº”è¯¥å…·å¤‡çš„æ–¹æ³•å’Œè¡Œä¸ºã€‚
    ç‰¹å¾ç±»ä¼¼äºå…¶ä»–è¯­è¨€ä¸­çš„æ¥å£ï¼ˆå¦‚ Java çš„ interface æˆ– C++ çš„ abstract classï¼‰ï¼Œä½†å…·æœ‰æ›´å¼ºå¤§çš„åŠŸèƒ½ã€‚

å®šä¹‰
    ç‰¹å¾é€šè¿‡ trait å…³é”®å­—å®šä¹‰ï¼ŒåŒ…å«ä¸€ç»„æ–¹æ³•ç­¾åï¼Œä½†ä¸æä¾›å…·ä½“å®ç°ã€‚ä¾‹å¦‚ï¼š

```rust
trait Summary {
    fn summarize(&self) -> String;
}
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒSummary ç‰¹å¾å®šä¹‰äº†ä¸€ä¸ªæ–¹æ³• summarizeï¼Œä»»ä½•å®ç°è¯¥ç‰¹å¾çš„ç±»å‹éƒ½å¿…é¡»æä¾›è¯¥æ–¹æ³•çš„å…·ä½“å®ç°ã€‚
è§£é‡Š
    ç‰¹å¾ä½œä¸ºæ¥å£ï¼š
    ç‰¹å¾å®šä¹‰äº†ä¸€ç»„æ–¹æ³•ï¼Œå¯ä»¥è¢«å¤šç§ç±»å‹å®ç°ï¼Œä»è€Œå…è®¸åœ¨ Rust ä¸­å®ç°å¤šæ€ã€‚
    ä¾‹å¦‚ï¼Œstd::ops::Add ç‰¹å¾å®šä¹‰äº†åŠ æ³•æ“ä½œçš„è¡Œä¸ºï¼Œä»»ä½•å®ç°äº†è¯¥ç‰¹å¾çš„ç±»å‹éƒ½å¯ä»¥è¿›è¡ŒåŠ æ³•è¿ç®—ã€‚
é»˜è®¤å®ç°ï¼š
    ç‰¹å¾å¯ä»¥æä¾›é»˜è®¤å®ç°ï¼Œè¿™æ ·åœ¨å®ç°ç‰¹å¾æ—¶å¯ä»¥é€‰æ‹©æ€§åœ°è¦†ç›–é»˜è®¤è¡Œä¸ºã€‚

ä¾‹å¦‚ï¼š

```rust
trait Printable {
    fn print(&self) {
        println!("Printing...");
    }
}
struct Person {
    name: String,
}
impl Printable for Person {
    fn print(&self) {
        println!("Person: {}", self.name);
    }
}
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒPrintable ç‰¹å¾æä¾›äº†ä¸€ä¸ªé»˜è®¤çš„ print æ–¹æ³•ï¼Œè€Œ Person ç»“æ„ä½“å®ç°äº† Printable ç‰¹å¾å¹¶è¦†ç›–äº†é»˜è®¤çš„ print æ–¹æ³•ã€‚

æ³›å‹ç‰¹å¾ï¼š
    ç‰¹å¾å¯ä»¥ä¸æ³›å‹ç»“åˆï¼Œå®šä¹‰æ³›å‹è¡Œä¸ºã€‚
ä¾‹å¦‚ï¼š

```rust
trait Add<Output = Self> {
    fn add(self, other: Self) -> Output;
}
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒAdd ç‰¹å¾å®šä¹‰äº†ä¸€ä¸ªæ³›å‹æ–¹æ³• addï¼Œå…è®¸ä¸åŒç±»å‹å®ç°è¯¥ç‰¹å¾å¹¶å®šä¹‰è‡ªå·±çš„åŠ æ³•è¡Œä¸ºã€‚
å…³è”ç±»å‹ï¼š
    ç‰¹å¾å¯ä»¥å®šä¹‰å…³è”ç±»å‹ï¼Œå…è®¸ç‰¹å¾æ–¹æ³•ä½¿ç”¨è¿™äº›ç±»å‹ã€‚
ä¾‹å¦‚ï¼š

```rust
trait Iterator {
    type Item;
    fn next(&mut self) -> Option<Self::Item>;
}
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒIterator ç‰¹å¾å®šä¹‰äº†ä¸€ä¸ªå…³è”ç±»å‹ Itemï¼Œè¡¨ç¤ºè¿­ä»£å™¨çš„å…ƒç´ ç±»å‹ã€‚

ç‰¹å¾çº¦æŸï¼š
    ç‰¹å¾å¯ä»¥ä½œä¸ºå‡½æ•°å‚æ•°æˆ–è¿”å›å€¼çš„çº¦æŸï¼Œå®ç°å¤šæ€è¡Œä¸ºã€‚
ä¾‹å¦‚ï¼š

```rust
fn output<T: Summary>(item: T) {
    println!("Summary: {}", item.summarize());
}
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œoutput å‡½æ•°æ¥å—ä»»ä½•å®ç°äº† Summary ç‰¹å¾çš„ç±»å‹ä½œä¸ºå‚æ•°ã€‚

ç”¨ä¾‹
    å®šä¹‰å…±äº«è¡Œä¸ºï¼š
    ä¾‹å¦‚ï¼Œå®šä¹‰ä¸€ä¸ª Summary ç‰¹å¾ï¼Œç”¨äºæ€»ç»“ä¸åŒç±»å‹çš„å†…å®¹ï¼š

```rust
trait Summary {
    fn summarize(&self) -> String;
}

struct Post {
    title: String,
    content: String,
}

impl Summary for Post {
    fn summarize(&self) -> String {
        format!("Summary: {}", self.title)
    }
}

struct Weibo {
    content: String,
}

impl Summary for Weibo {
    fn summarize(&self) -> String {
        format!("Summary: {}", self.content)
    }
}
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒPost å’Œ Weibo éƒ½å®ç°äº† Summary ç‰¹å¾ï¼Œå¯ä»¥ä½¿ç”¨ summarize æ–¹æ³•ç”Ÿæˆæ‘˜è¦ã€‚

å¤šæ€è¡Œä¸ºï¼š
    ä¾‹å¦‚ï¼Œä½¿ç”¨ç‰¹å¾ä½œä¸ºå‡½æ•°å‚æ•°ï¼Œå®ç°å¤šæ€è¡Œä¸ºï¼š

```rust
trait Printable {
    fn print(&self);
}
struct Person {
    name: String,
}
impl Printable for Person {
    fn print(&self) {
        println!("Person: {}", self.name);
    }
}
struct Book {
    title: String,
}
impl Printable for Book {
    fn print(&self) {
        println!("Book: {}", self.title);
    }
}
fn print_item<T: Printable>(item: T) {
    item.print();
}
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œprint_item å‡½æ•°å¯ä»¥æ¥å—ä»»ä½•å®ç°äº† Printable ç‰¹å¾çš„ç±»å‹ä½œä¸ºå‚æ•°ï¼Œå¹¶è°ƒç”¨å…¶ print æ–¹æ³•ã€‚
é»˜è®¤å®ç°ï¼š
ä¾‹å¦‚ï¼Œå®šä¹‰ä¸€ä¸ª Printable ç‰¹å¾ï¼Œå¹¶æä¾›é»˜è®¤å®ç°ï¼š

```rust
trait Printable {
    fn print(&self) {
        println!("Printing...");
    }
}
struct Person {
    name: String,
}
impl Printable for Person {
    fn print(&self) {
        println!("Person: {}", self.name);
    }
}
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒPrintable ç‰¹å¾æä¾›äº†ä¸€ä¸ªé»˜è®¤çš„ print æ–¹æ³•ï¼Œè€Œ Person ç»“æ„ä½“å®ç°äº† Printable ç‰¹å¾å¹¶è¦†ç›–äº†é»˜è®¤çš„ print æ–¹æ³•ã€‚
æ€ç»´å¯¼å›¾
ä»¥ä¸‹æ˜¯ä¸€ä¸ªå…³äº Rust ç‰¹å¾çš„æ€ç»´å¯¼å›¾ï¼Œå±•ç¤ºäº†ç‰¹å¾çš„å®šä¹‰ã€ç”¨ä¾‹å’Œç›¸å…³æ¦‚å¿µï¼š
plaintextå¤åˆ¶
Rust ç‰¹å¾ (Trait)
â”œâ”€â”€ æ¦‚å¿µ
â”‚   â”œâ”€â”€ å®šä¹‰å…±äº«è¡Œä¸º
â”‚   â”œâ”€â”€ ç±»ä¼¼äºæ¥å£
â”‚   â”œâ”€â”€ å®ç°å¤šæ€
â”œâ”€â”€ å®šä¹‰
â”‚   â”œâ”€â”€ ä½¿ç”¨ `trait` å…³é”®å­—
â”‚   â”œâ”€â”€ æ–¹æ³•ç­¾å
â”‚   â”œâ”€â”€ ç¤ºä¾‹
â”‚       â”œâ”€â”€ trait Summary {
â”‚       â”‚   fn summarize(&self) -> String;
â”‚       â”‚}
â”‚       â””â”€â”€ struct Post {
â”‚           title: String,
â”‚           content: String,
â”‚       }
â”‚       â””â”€â”€ impl Summary for Post {
â”‚           fn summarize(&self) -> String {
â”‚               format!("Summary: {}", self.title)
â”‚           }
â”‚       }
â”œâ”€â”€ ç”¨ä¾‹
â”‚   â”œâ”€â”€ é»˜è®¤å®ç°
â”‚   â”‚   â”œâ”€â”€ trait Printable {
â”‚   â”‚   â”‚   fn print(&self) {
â”‚   â”‚   â”‚       println!("Printing...");
â”‚   â”‚   â”‚   }
â”‚   â”‚   â”‚}
â”‚   â”‚   â””â”€â”€ struct Person {
â”‚   â”‚       name: String,
â”‚   â”‚   }
â”‚   â”‚   â””â”€â”€ impl Printable for Person {
â”‚   â”‚       fn print(&self) {
â”‚   â”‚           println!("Person: {}", self.name);
â”‚   â”‚       }
â”‚   â”‚   }
â”‚   â”œâ”€â”€ æ³›å‹ç‰¹å¾
â”‚   â”‚   â”œâ”€â”€ trait Add<Output = Self> {
â”‚   â”‚   â”‚   fn add(self, other: Self) -> Output;
â”‚   â”‚   â”‚}
â”‚   â”‚   â””â”€â”€ ç¤ºä¾‹
â”‚   â”‚       â”œâ”€â”€ struct Number(i32);
â”‚   â”‚       â””â”€â”€ impl Add for Number {
â”‚   â”‚           fn add(self, other: Number) -> Number {
â”‚   â”‚               Number(self.0 + other.0)
â”‚   â”‚           }
â”‚   â”‚       }
â”‚   â”œâ”€â”€ å…³è”ç±»å‹
â”‚   â”‚   â”œâ”€â”€ trait Iterator {
â”‚   â”‚   â”‚   type Item;
â”‚   â”‚   â”‚   fn next(&mut self) -> `Option<Self::Item>`;
â”‚   â”‚   â”‚}
â”‚   â”‚   â””â”€â”€ ç¤ºä¾‹
â”‚   â”‚       â”œâ”€â”€ struct IntIterator(i32);
â”‚   â”‚       â””â”€â”€ impl Iterator for IntIterator {
â”‚   â”‚           type Item = i32;
â”‚   â”‚           fn next(&mut self) -> `Option<i32>` {
â”‚   â”‚               Some(self.0)
â”‚   â”‚           }
â”‚   â”‚       }
â”‚   â”œâ”€â”€ ç‰¹å¾çº¦æŸ
â”‚   â”‚   â”œâ”€â”€ ç¤ºä¾‹
â”‚   â”‚   â”‚   â”œâ”€â”€ fn output<T: Summary>(item: T) {
â”‚   â”‚   â”‚   â”‚   println!("Summary: {}", item.summarize());
â”‚   â”‚   â”‚   â”‚}
â”‚   â”‚   â”‚   â””â”€â”€ let post = Post {
â”‚   â”‚   â”‚       title: String::from("Hello"),
â”‚   â”‚   â”‚       content: String::from("World"),
â”‚   â”‚   â”‚   };
â”‚   â”‚   â”‚   output(post);
â”‚   â”‚   â””â”€â”€ è¾“å‡º
â”‚   â”‚       â””â”€â”€ Summary: Hello
â”‚   â””â”€â”€ å¤šæ€è¡Œä¸º
â”‚       â”œâ”€â”€ ç¤ºä¾‹
â”‚       â”‚   â”œâ”€â”€ trait Printable {
â”‚       â”‚   â”‚   fn print(&self);
â”‚       â”‚   â”‚}
â”‚       â”‚   â”œâ”€â”€ struct Person {
â”‚       â”‚   â”‚   name: String,
â”‚       â”‚   â”‚}
â”‚       â”‚   â””â”€â”€ impl Printable for Person {
â”‚       â”‚       fn print(&self) {
â”‚       â”‚           println!("Person: {}", self.name);
â”‚       â”‚       }
â”‚       â”‚   }
â”‚       â””â”€â”€ å‡½æ•°
â”‚           â”œâ”€â”€ fn print_item<T: Printable>(item: T) {
â”‚           â”‚   item.print();
â”‚           â”‚}
â”‚           â””â”€â”€ let person = Person {
â”‚               name: String::from("Alice"),
â”‚           };
â”‚           print_item(person);
â”œâ”€â”€ ç›¸å…³æ¦‚å¿µ
â”‚   â”œâ”€â”€ æ³›å‹
â”‚   â”œâ”€â”€ å…³è”ç±»å‹
â”‚   â”œâ”€â”€ ç‰¹å¾çº¦æŸ
â”‚   â”œâ”€â”€ å¤šæ€
â””â”€â”€ æ€ç»´å¯¼å›¾
    â”œâ”€â”€ Rust ç‰¹å¾ (Trait)
    â”œâ”€â”€ æ¦‚å¿µ
    â”œâ”€â”€ å®šä¹‰
    â”œâ”€â”€ ç”¨ä¾‹
    â””â”€â”€ ç›¸å…³æ¦‚å¿µ
