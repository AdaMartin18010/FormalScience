# Rust haskell

Rust 2024 ç‰ˆæœ¬å¼•å…¥çš„ `gen`ã€`async`ã€`yield`ã€`next` å’Œ `await` ç­‰ç‰¹æ€§ï¼Œè™½ç„¶å¢å¼ºäº† Rust çš„å¼‚æ­¥ç¼–ç¨‹èƒ½åŠ›ï¼Œ
ä½†è¦å®ç°ç±»ä¼¼äº Haskell çš„èŒƒç•´è®ºï¼ˆCategory Theoryï¼‰æ”¯æŒçš„æ‰€æœ‰å‡½æ•°å¼ç¼–ç¨‹ç‰¹æ€§ï¼Œä»ç„¶å­˜åœ¨ä¸€äº›å·®å¼‚ã€‚
Haskell æ˜¯ä¸€ç§çº¯å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€ï¼Œå¤©ç„¶æ”¯æŒèŒƒç•´è®ºçš„æ¦‚å¿µï¼Œå¦‚å‡½å­ï¼ˆFunctorï¼‰ã€å•å­ï¼ˆMonadï¼‰ã€åº”ç”¨å‡½å­ï¼ˆApplicative Functorï¼‰ç­‰ï¼Œ
è€Œ Rust åˆ™æ˜¯å¤šèŒƒå¼çš„ç³»ç»Ÿç¼–ç¨‹è¯­è¨€ã€‚

## ğŸ“‹ ç›®å½•

- [1 Rust ä¸ Haskell åœ¨èŒƒç•´è®ºæ”¯æŒä¸Šçš„å¯¹æ¯”](#1-rust-ä¸-haskell-åœ¨èŒƒç•´è®ºæ”¯æŒä¸Šçš„å¯¹æ¯”)
  - [1.1 Rust 2024 çš„å¼‚æ­¥ç‰¹æ€§ä¸èŒƒç•´è®º](#11-rust-2024-çš„å¼‚æ­¥ç‰¹æ€§ä¸èŒƒç•´è®º)
    - [1.1.1 ç¤ºä¾‹ï¼šå¼‚æ­¥å•å­](#111-ç¤ºä¾‹å¼‚æ­¥å•å­)
    - [1.1.2 ç¤ºä¾‹ï¼šå¼‚æ­¥å‡½å­](#112-ç¤ºä¾‹å¼‚æ­¥å‡½å­)
  - [1.2 æ€»ç»“ä¸æ€ç»´å¯¼å›¾](#12-æ€»ç»“ä¸æ€ç»´å¯¼å›¾)
    - [2.2.1 æ€ç»´å¯¼å›¾æ€»ç»“](#221-æ€ç»´å¯¼å›¾æ€»ç»“)
  - [1.3 ç¼–ç¨‹å»ºè®®](#13-ç¼–ç¨‹å»ºè®®)
  - [1.4 æ ¸å¿ƒæ ‡å‡†åº“ç±»å‹å’Œæ¦‚å¿µ](#14-æ ¸å¿ƒæ ‡å‡†åº“ç±»å‹å’Œæ¦‚å¿µ)
  - [1.5 ç±»å‹ä¹‹é—´çš„å…³ç³»ã€è½¬æ¢ã€çº¦æŸå’Œé™åˆ¶](#15-ç±»å‹ä¹‹é—´çš„å…³ç³»è½¬æ¢çº¦æŸå’Œé™åˆ¶)
  - [1.6 é”™è¯¯å’Œå¼‚å¸¸å¤„ç†è§„èŒƒ](#16-é”™è¯¯å’Œå¼‚å¸¸å¤„ç†è§„èŒƒ)
  - [1.7 æ€ç»´å¯¼å›¾](#17-æ€ç»´å¯¼å›¾)
  - [1.8 æ€»ç»“](#18-æ€»ç»“)

---

## 1 Rust ä¸ Haskell åœ¨èŒƒç•´è®ºæ”¯æŒä¸Šçš„å¯¹æ¯”

1. **å‡½å­ï¼ˆFunctorï¼‰**
   - **Haskell**: é€šè¿‡ `Functor` ç±»å‹ç±»å®ç°ï¼Œæä¾› `fmap` å‡½æ•°ã€‚
   - **Rust**: å¯ä»¥é€šè¿‡å®ç° `map` æ–¹æ³•çš„ trait æ¥æ¨¡æ‹Ÿã€‚

   ```rust
   trait Functor<T> {
       fn map<U, F: FnOnce(T) -> U>(self, f: F) -> Self::Output;
   }
   ```

2. **å•å­ï¼ˆMonadï¼‰**
   - **Haskell**: é€šè¿‡ `Monad` ç±»å‹ç±»å®ç°ï¼Œæä¾› `bind`ï¼ˆ`>>=`ï¼‰å’Œ `return`ã€‚
   - **Rust**: ä½¿ç”¨ `and_then` å’Œ `map` æ–¹æ³•æ¥æ¨¡æ‹Ÿã€‚

   ```rust
   trait Monad<T>: Functor<T> {
       fn bind<U, F: FnOnce(T) -> Self::Output>(self, f: F) -> Self::Output;
   }
   ```

3. **åº”ç”¨å‡½å­ï¼ˆApplicative Functorï¼‰**
   - **Haskell**: é€šè¿‡ `Applicative` ç±»å‹ç±»å®ç°ï¼Œæä¾› `<*>` å’Œ `pure`ã€‚
   - **Rust**: å¯ä»¥é€šè¿‡ç»„åˆ `map` å’Œ `and_then` æ¥å®ç°ç±»ä¼¼åŠŸèƒ½ã€‚

### 1.1 Rust 2024 çš„å¼‚æ­¥ç‰¹æ€§ä¸èŒƒç•´è®º

Rust çš„å¼‚æ­¥ç‰¹æ€§ä¸»è¦ç”¨äºå¤„ç†å¹¶å‘å’Œå¼‚æ­¥æ“ä½œï¼Œè€Œä¸æ˜¯ç›´æ¥ç”¨äºèŒƒç•´è®ºçš„æŠ½è±¡ã€‚
ç„¶è€Œï¼Œå¼‚æ­¥ç‰¹æ€§å¯ä»¥ä¸èŒƒç•´è®ºçš„æ¦‚å¿µç»“åˆï¼Œæä¾›æ›´å¼ºå¤§çš„æŠ½è±¡èƒ½åŠ›ã€‚

#### 1.1.1 ç¤ºä¾‹ï¼šå¼‚æ­¥å•å­

```rust
use std::future::Future;
use std::pin::Pin;
use std::task::{Context, Poll};

struct AsyncMonad<T> {
    value: T,
}

impl<T> AsyncMonad<T> {
    fn new(value: T) -> Self {
        AsyncMonad { value }
    }

    async fn bind<U, F>(self, f: F) -> AsyncMonad<U>
    where
        F: FnOnce(T) -> AsyncMonad<U>,
    {
        f(self.value)
    }
}

async fn example() {
    let monad = AsyncMonad::new(5);
    let result = monad.bind(|x| AsyncMonad::new(x + 1)).await;
    // ä½¿ç”¨ result
}
```

#### 1.1.2 ç¤ºä¾‹ï¼šå¼‚æ­¥å‡½å­

```rust
impl<T> AsyncMonad<T> {
    async fn map<U, F>(self, f: F) -> AsyncMonad<U>
    where
        F: FnOnce(T) -> U,
    {
        AsyncMonad::new(f(self.value))
    }
}

async fn example_map() {
    let monad = AsyncMonad::new(5);
    let result = monad.map(|x| x * 2).await;
    // ä½¿ç”¨ result
}
```

### 1.2 æ€»ç»“ä¸æ€ç»´å¯¼å›¾

Rust çš„å¼‚æ­¥ç‰¹æ€§å¯ä»¥ä¸èŒƒç•´è®ºçš„æ¦‚å¿µç»“åˆï¼Œæä¾›å¼ºå¤§çš„æŠ½è±¡èƒ½åŠ›ï¼Œä½†ç”±äºè¯­è¨€è®¾è®¡çš„ä¸åŒï¼ŒRust å¹¶ä¸èƒ½å®Œå…¨å®ç° Haskell çš„æ‰€æœ‰èŒƒç•´è®ºç‰¹æ€§ã€‚
Rust æ›´é€‚åˆåœ¨ç³»ç»Ÿç¼–ç¨‹å’Œæ€§èƒ½å…³é”®çš„åœºæ™¯ä¸­ä½¿ç”¨ï¼Œè€Œ Haskell åˆ™åœ¨çº¯å‡½æ•°å¼ç¼–ç¨‹å’Œæ•°å­¦æŠ½è±¡ä¸­è¡¨ç°å‡ºè‰²ã€‚

#### 2.2.1 æ€ç»´å¯¼å›¾æ€»ç»“

```text
Rust 2024 Edition
â”œâ”€â”€ å¼‚æ­¥ç‰¹æ€§
â”‚   â”œâ”€â”€ gen
â”‚   â”œâ”€â”€ async
â”‚   â”œâ”€â”€ yield
â”‚   â”œâ”€â”€ next
â”‚   â””â”€â”€ await
â”œâ”€â”€ èŒƒç•´è®ºæ¦‚å¿µ
â”‚   â”œâ”€â”€ Functor
â”‚   â”‚   â””â”€â”€ map
â”‚   â”œâ”€â”€ Monad
â”‚   â”‚   â”œâ”€â”€ bind
â”‚   â”‚   â””â”€â”€ return
â”‚   â””â”€â”€ Applicative
â”‚       â”œâ”€â”€ pure
â”‚       â””â”€â”€ apply
â””â”€â”€ ç»“åˆä¸åº”ç”¨
    â”œâ”€â”€ å¼‚æ­¥å•å­
    â”œâ”€â”€ å¼‚æ­¥å‡½å­
    â””â”€â”€ ç¼–ç¨‹å»ºè®®
```

### 1.3 ç¼–ç¨‹å»ºè®®

1. **ç†è§£å¼‚æ­¥ä¸åŒæ­¥çš„åŒºåˆ«**: åœ¨ Rust ä¸­ï¼Œå¼‚æ­¥ç‰¹æ€§ä¸»è¦ç”¨äºå¤„ç† I/O å¯†é›†å‹ä»»åŠ¡ã€‚
2. **ç»“åˆèŒƒç•´è®ºæ¦‚å¿µ**: ä½¿ç”¨ Rust çš„ trait ç³»ç»Ÿæ¨¡æ‹ŸèŒƒç•´è®ºçš„æ¦‚å¿µã€‚
3. **å…³æ³¨æ€§èƒ½**: Rust çš„è®¾è®¡åˆè¡·æ˜¯é«˜æ€§èƒ½å’Œå®‰å…¨æ€§ï¼Œä½¿ç”¨å¼‚æ­¥ç‰¹æ€§æ—¶è¦æ³¨æ„æ€§èƒ½ä¼˜åŒ–ã€‚
4. **å­¦ä¹  Haskell**: å¦‚æœå¯¹èŒƒç•´è®ºæœ‰æ·±å…¥å…´è¶£ï¼Œå­¦ä¹  Haskell å¯ä»¥æä¾›æ›´å¥½çš„ç†è§£ã€‚

é€šè¿‡è¿™äº›ç‰¹æ€§å’Œå»ºè®®ï¼Œå¼€å‘è€…å¯ä»¥åœ¨ Rust ä¸­å®ç°æ›´å¤æ‚çš„æŠ½è±¡å’Œå¼‚æ­¥æ“ä½œï¼ŒåŒæ—¶ä¿æŒä»£ç çš„é«˜æ•ˆå’Œå®‰å…¨ã€‚

åœ¨ Rust 2024 ç‰ˆæœ¬ä¸­ï¼Œæ ¸å¿ƒæ ‡å‡†åº“æä¾›äº†è®¸å¤šç±»å‹å’Œæ¦‚å¿µï¼Œè¿™äº›ç±»å‹å’Œæ¦‚å¿µæ„æˆäº† Rust è¯­è¨€çš„åŸºç¡€ã€‚
ä»¥ä¸‹æ˜¯ä¸€äº›å…³é”®ç±»å‹å’Œæ¦‚å¿µçš„å®šä¹‰ã€æœ€ä½³ä½¿ç”¨ç¤ºä¾‹ï¼Œä»¥åŠå®ƒä»¬ä¹‹é—´çš„å…³ç³»ã€è½¬æ¢ã€çº¦æŸã€é™åˆ¶å’Œé”™è¯¯å¤„ç†è§„èŒƒã€‚

### 1.4 æ ¸å¿ƒæ ‡å‡†åº“ç±»å‹å’Œæ¦‚å¿µ

1. **åŸºæœ¬ç±»å‹**
   - **æ•´æ•°ç±»å‹**: `i8`, `i16`, `i32`, `i64`, `i128`, `u8`, `u16`, `u32`, `u64`, `u128`
   - **æµ®ç‚¹ç±»å‹**: `f32`, `f64`
   - **å¸ƒå°”ç±»å‹**: `bool`
   - **å­—ç¬¦ç±»å‹**: `char`
   - **å­—ç¬¦ä¸²ç±»å‹**: `&str`, `String`

   **ç¤ºä¾‹**:

   ```rust
   let x: i32 = 42;
   let y: f64 = 3.14;
   let is_active: bool = true;
   let letter: char = 'A';
   let name: &str = "Rust";
   let greeting: String = String::from("Hello, Rust!");
   ```

2. **é›†åˆç±»å‹**
   - **æ•°ç»„**: `[T; N]`
   - **å‘é‡**: `Vec<T>`
   - **å“ˆå¸Œæ˜ å°„**: `HashMap<K, V>`
   - **å“ˆå¸Œé›†åˆ**: `HashSet<T>`

   **ç¤ºä¾‹**:

   ```rust
   let numbers: [i32; 3] = [1, 2, 3];
   let mut vec = Vec::new();
   vec.push(1);
   let mut map = HashMap::new();
   map.insert("key", "value");
   ```

3. **æšä¸¾å’Œç»“æ„ä½“**
   - **æšä¸¾**: `enum`
   - **ç»“æ„ä½“**: `struct`

   **ç¤ºä¾‹**:

   ```rust
   enum Direction {
       North,
       South,
       East,
       West,
   }

   struct Point {
       x: i32,
       y: i32,
   }
   ```

4. **é”™è¯¯å¤„ç†**
   - **Result**: `Result<T, E>`
   - **Option**: `Option<T>`

   **ç¤ºä¾‹**:

   ```rust
   fn divide(a: i32, b: i32) -> Result<i32, String> {
       if b == 0 {
           Err(String::from("Division by zero"))
       } else {
           Ok(a / b)
       }
   }

   let result = divide(10, 2);
   match result {
       Ok(value) => println!("Result: {}", value),
       Err(e) => println!("Error: {}", e),
   }
   ```

5. **æ™ºèƒ½æŒ‡é’ˆ**
   - **Box**: `Box<T>`
   - **Rc**: `Rc<T>`
   - **Arc**: `Arc<T>`
   - **RefCell**: `RefCell<T>`

   **ç¤ºä¾‹**:

   ```rust
   use std::rc::Rc;

   let a = Rc::new(5);
   let b = Rc::clone(&a);
   ```

6. **å¹¶å‘**
   - **çº¿ç¨‹**: `std::thread`
   - **é€šé“**: `std::sync::mpsc`
   - **äº’æ–¥é”**: `Mutex<T>`
   - **è¯»å†™é”**: `RwLock<T>`

   **ç¤ºä¾‹**:

   ```rust
   use std::thread;
   use std::sync::mpsc;
   use std::sync::Mutex;
   use std::sync::Arc;

   let (tx, rx) = mpsc::channel();
   let data = Arc::new(Mutex::new(0));

   let tx1 = tx.clone();
   let data1 = Arc::clone(&data);
   thread::spawn(move || {
       let mut num = data1.lock().unwrap();
       *num += 1;
       tx1.send(*num).unwrap();
   });

   println!("Received: {}", rx.recv().unwrap());
   ```

### 1.5 ç±»å‹ä¹‹é—´çš„å…³ç³»ã€è½¬æ¢ã€çº¦æŸå’Œé™åˆ¶

- **è½¬æ¢**: ä½¿ç”¨ `as` å…³é”®å­—è¿›è¡ŒåŸºæœ¬ç±»å‹è½¬æ¢ã€‚
- **çº¦æŸ**: ä½¿ç”¨ trait bounds é™åˆ¶æ³›å‹ç±»å‹ã€‚
- **é™åˆ¶**: Rust çš„æ‰€æœ‰æƒå’Œå€Ÿç”¨ç³»ç»Ÿé™åˆ¶äº†æ•°æ®çš„ä½¿ç”¨æ–¹å¼ï¼Œç¡®ä¿å†…å­˜å®‰å…¨ã€‚

### 1.6 é”™è¯¯å’Œå¼‚å¸¸å¤„ç†è§„èŒƒ

- **Result å’Œ Option**: ä½¿ç”¨ `match` æˆ– `?` æ“ä½œç¬¦å¤„ç†ã€‚
- **Panic**: ä½¿ç”¨ `panic!` å®å¼•å‘è¿è¡Œæ—¶é”™è¯¯ï¼Œé€šå¸¸ç”¨äºä¸å¯æ¢å¤çš„é”™è¯¯ã€‚

### 1.7 æ€ç»´å¯¼å›¾

```text
Rust 2024 Core Library
â”œâ”€â”€ åŸºæœ¬ç±»å‹
â”‚   â”œâ”€â”€ æ•´æ•°
â”‚   â”œâ”€â”€ æµ®ç‚¹
â”‚   â”œâ”€â”€ å¸ƒå°”
â”‚   â”œâ”€â”€ å­—ç¬¦
â”‚   â””â”€â”€ å­—ç¬¦ä¸²
â”œâ”€â”€ é›†åˆç±»å‹
â”‚   â”œâ”€â”€ æ•°ç»„
â”‚   â”œâ”€â”€ å‘é‡
â”‚   â”œâ”€â”€ å“ˆå¸Œæ˜ å°„
â”‚   â””â”€â”€ å“ˆå¸Œé›†åˆ
â”œâ”€â”€ æšä¸¾å’Œç»“æ„ä½“
â”‚   â”œâ”€â”€ æšä¸¾
â”‚   â””â”€â”€ ç»“æ„ä½“
â”œâ”€â”€ é”™è¯¯å¤„ç†
â”‚   â”œâ”€â”€ Result
â”‚   â””â”€â”€ Option
â”œâ”€â”€ æ™ºèƒ½æŒ‡é’ˆ
â”‚   â”œâ”€â”€ Box
â”‚   â”œâ”€â”€ Rc
â”‚   â”œâ”€â”€ Arc
â”‚   â””â”€â”€ RefCell
â””â”€â”€ å¹¶å‘
    â”œâ”€â”€ çº¿ç¨‹
    â”œâ”€â”€ é€šé“
    â”œâ”€â”€ äº’æ–¥é”
    â””â”€â”€ è¯»å†™é”
```

### 1.8 æ€»ç»“

Rust 2024 çš„æ ¸å¿ƒæ ‡å‡†åº“æä¾›äº†ä¸°å¯Œçš„ç±»å‹å’Œæ¦‚å¿µï¼Œæ”¯æŒé«˜æ•ˆã€å®‰å…¨çš„ç³»ç»Ÿç¼–ç¨‹ã€‚
é€šè¿‡ç†è§£è¿™äº›ç±»å‹çš„å…³ç³»ã€è½¬æ¢ã€çº¦æŸå’Œé™åˆ¶ï¼Œå¼€å‘è€…å¯ä»¥ç¼–å†™å‡ºé«˜æ€§èƒ½ä¸”å®‰å…¨çš„ä»£ç ã€‚
é”™è¯¯å¤„ç†è§„èŒƒç¡®ä¿äº†ç¨‹åºçš„å¥å£®æ€§ï¼Œè€Œå¹¶å‘ç‰¹æ€§åˆ™æä¾›äº†å¼ºå¤§çš„å¤šçº¿ç¨‹æ”¯æŒã€‚
