# Tokio å¼‚æ­¥è¿è¡Œæ—¶

Rust å¼‚æ­¥ç¼–ç¨‹é¢†åŸŸå†…ï¼Œç›®å‰ä½¿ç”¨æœ€å¹¿æ³›ä¸”æœ€æˆç†Ÿçš„å¼‚æ­¥è¿è¡Œæ—¶åº“æ˜¯ **Tokio**ã€‚
åœ¨å®ƒä¹‹ä¸Šæ„å»ºäº†è®¸å¤šæˆç†Ÿçš„åº”ç”¨é¢†åŸŸå’Œæ¡†æ¶ï¼Œä¸‹é¢åšä¸ªè¯¦ç»†è¯´æ˜ï¼š

## ğŸ“‹ ç›®å½•

- [1 Tokio åŠå…¶ç”Ÿæ€](#1-tokio-åŠå…¶ç”Ÿæ€)
  - [1.1 ç½‘ç»œæœåŠ¡ä¸ Web æ¡†æ¶](#11-ç½‘ç»œæœåŠ¡ä¸-web-æ¡†æ¶)
  - [1.2 æ•°æ®åº“é©±åŠ¨ä¸ä¸­é—´ä»¶](#12-æ•°æ®åº“é©±åŠ¨ä¸ä¸­é—´ä»¶)
  - [1.3 åˆ†å¸ƒå¼ç³»ç»Ÿä¸å¾®æœåŠ¡](#13-åˆ†å¸ƒå¼ç³»ç»Ÿä¸å¾®æœåŠ¡)
- [2 å…¶ä»–å¼‚æ­¥è¿è¡Œæ—¶åŠæ¡†æ¶](#2-å…¶ä»–å¼‚æ­¥è¿è¡Œæ—¶åŠæ¡†æ¶)
- [3 åº”ç”¨é¢†åŸŸ](#3-åº”ç”¨é¢†åŸŸ)
- [4 æ€»ç»“](#4-æ€»ç»“)
- [5 Tokio ä¸­çš„å¼‚æ­¥ä»»åŠ¡èƒ½å¦æŒ‡å®šä¼˜å…ˆçº§](#5-tokio-ä¸­çš„å¼‚æ­¥ä»»åŠ¡èƒ½å¦æŒ‡å®šä¼˜å…ˆçº§)
- [6 æ›¿ä»£æ–¹æ¡ˆä¸å˜é€šæ–¹æ³•](#6-æ›¿ä»£æ–¹æ¡ˆä¸å˜é€šæ–¹æ³•)
- [7 æ€»ç»“](#7-æ€»ç»“)
- [8 Rust å¦‚ä½•å®ç°è¿è¡Œæ—¶è´Ÿè½½æ„ŸçŸ¥å¹¶è°ƒæ•´è¿è¡Œç­–ç•¥](#8-rust-å¦‚ä½•å®ç°è¿è¡Œæ—¶è´Ÿè½½æ„ŸçŸ¥å¹¶è°ƒæ•´è¿è¡Œç­–ç•¥)
- [9 è´Ÿè½½ç›‘æ§](#9-è´Ÿè½½ç›‘æ§)
  - [9.1 åˆ©ç”¨ç³»ç»Ÿä¿¡æ¯æŸ¥è¯¢åº“](#91-åˆ©ç”¨ç³»ç»Ÿä¿¡æ¯æŸ¥è¯¢åº“)
  - [9.2 å®šæ—¶é‡‡é›†æŒ‡æ ‡å¹¶ç›‘æ§](#92-å®šæ—¶é‡‡é›†æŒ‡æ ‡å¹¶ç›‘æ§)
- [10 åŠ¨æ€è°ƒæ•´ç­–ç•¥](#10-åŠ¨æ€è°ƒæ•´ç­–ç•¥)
- [11 åº”ç”¨åœºæ™¯æ•´åˆ](#11-åº”ç”¨åœºæ™¯æ•´åˆ)
  - [11.1 å¼‚æ­¥ä»»åŠ¡è°ƒåº¦](#111-å¼‚æ­¥ä»»åŠ¡è°ƒåº¦)
  - [11.2 å¾®æœåŠ¡ IoT ç½‘å…³](#112-å¾®æœåŠ¡-iot-ç½‘å…³)
- [12 å°ç»“](#12-å°ç»“)

---

## 1 Tokio åŠå…¶ç”Ÿæ€

**Tokio** æ˜¯ Rust ç”Ÿæ€ä¸­åº”ç”¨æœ€å¹¿æ³›çš„å¼‚æ­¥è¿è¡Œæ—¶ï¼Œå®ƒæä¾›äº†ï¼š

- **å¼‚æ­¥ I/O åŸè¯­ï¼š** å¦‚ TCP/UDP ç½‘ç»œã€å®šæ—¶å™¨ã€æ–‡ä»¶ I/O ç­‰å¼‚æ­¥æ“ä½œï¼Œå‡åŸºäºéé˜»å¡æ¨¡å‹ã€‚
- **ä»»åŠ¡è°ƒåº¦ä¸åä½œå¼å¹¶å‘ï¼š** åˆ©ç”¨è½»é‡çº§ä»»åŠ¡çš„è°ƒåº¦ï¼Œæ”¯æŒé«˜å¹¶å‘æ‰§è¡Œè€Œæ— éœ€åˆ›å»ºå¤§é‡çº¿ç¨‹ã€‚

åŸºäº Tokio çš„æˆç†Ÿç”Ÿæ€æ„å»ºäº†å¾ˆå¤šé«˜æ€§èƒ½ã€ç”Ÿäº§çº§çš„åº”ç”¨å’Œæ¡†æ¶ï¼š

### 1.1 ç½‘ç»œæœåŠ¡ä¸ Web æ¡†æ¶

- **HTTP æœåŠ¡å™¨/å®¢æˆ·ç«¯ï¼š**
  - **Hyper:** åŸºäº Tokio æ„å»ºçš„é«˜æ€§èƒ½ HTTP åº“ï¼Œæä¾›æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯åŠŸèƒ½ï¼Œæ˜¯å¾ˆå¤š Web æ¡†æ¶çš„åº•å±‚ä¾èµ–ã€‚
  - **Warp:** åŸºäº Hyper ä¸ Tokio çš„ Web æ¡†æ¶ï¼Œæä¾›ç®€æ´çš„è¿‡æ»¤å™¨ç»„åˆ APIï¼Œä¾¿äºæ„å»ºé«˜æ€§èƒ½ HTTP æœåŠ¡ã€‚
  - **Axum:** æ„å»ºåœ¨ Towerï¼ˆå¦ä¸€å¥—æ„å»ºæ¨¡å—åŒ–æœåŠ¡ç»„ä»¶çš„åº“ï¼‰ä¹‹ä¸Šï¼Œé›†æˆ Tokio ä¸ `tracing`ï¼Œç”¨äºæ„å»ºç°ä»£ Web æœåŠ¡ã€‚

- **gRPC æ¡†æ¶ï¼š**
  - **Tonic:** ä¸€ä¸ªåŸºäº Tokio çš„ gRPC æ¡†æ¶ï¼Œç”¨äºæ„å»ºé«˜æ€§èƒ½å¾®æœåŠ¡é—´é€šä¿¡ç³»ç»Ÿï¼Œå¹¿æ³›åº”ç”¨äºåˆ†å¸ƒå¼æœåŠ¡æ¶æ„ã€‚

### 1.2 æ•°æ®åº“é©±åŠ¨ä¸ä¸­é—´ä»¶

- **å¼‚æ­¥æ•°æ®åº“é©±åŠ¨ï¼š**
  - å¦‚ **tokio-postgres**ã€**sqlx** ç­‰ï¼Œéƒ½æ˜¯åŸºäº Tokio å®ç°å¼‚æ­¥æ•°æ®åº“è®¿é—®ï¼Œå¹¿æ³›åº”ç”¨åœ¨é«˜å¹¶å‘æ•°æ®å­˜å‚¨ç³»ç»Ÿä¸­ã€‚

- **å¼‚æ­¥ä¸­é—´ä»¶ï¼š**
  - Tower ç”Ÿæ€ä¸­çš„å„ç±»ä¸­é—´ä»¶ï¼ˆä¾‹å¦‚è´Ÿè½½å‡è¡¡ã€é‡è¯•ã€ç†”æ–­ç­‰ï¼‰éƒ½ä¸ Tokio æ·±åº¦é›†æˆï¼Œåœ¨å¾®æœåŠ¡å’Œåˆ†å¸ƒå¼ç³»ç»Ÿä¸­å‘æŒ¥é‡è¦ä½œç”¨ã€‚

### 1.3 åˆ†å¸ƒå¼ç³»ç»Ÿä¸å¾®æœåŠ¡

åˆ©ç”¨ Tokio çš„é«˜å¹¶å‘èƒ½åŠ›å’Œä»»åŠ¡è°ƒåº¦ï¼Œè®¸å¤šåˆ†å¸ƒå¼ç³»ç»Ÿã€æ¶ˆæ¯é˜Ÿåˆ—å’Œå¾®æœåŠ¡æ¶æ„å‡é‡‡ç”¨è¯¥è¿è¡Œæ—¶ï¼Œå¹¶ç»“åˆä»¥ä¸‹ç»„ä»¶ï¼š

- **Tracing:** ç”¨äºåˆ†å¸ƒå¼è°ƒç”¨é“¾çš„æ”¶é›†å’Œç»“æ„åŒ–æ—¥å¿—è®°å½•ï¼ˆåŒæ—¶è·¨è¶Š `.await` è¾¹ç•Œä¼ é€’ä¸Šä¸‹æ–‡ï¼‰ã€‚
- **Tokio Console:** å®æ—¶ç›‘æ§ Tokio ä»»åŠ¡ã€è°ƒåº¦å™¨çŠ¶æ€å’Œæ€§èƒ½æŒ‡æ ‡ï¼Œå¸®åŠ©è°ƒè¯•å’Œä¼˜åŒ–å¤æ‚çš„å¼‚æ­¥ç³»ç»Ÿã€‚

---

## 2 å…¶ä»–å¼‚æ­¥è¿è¡Œæ—¶åŠæ¡†æ¶

é™¤ Tokio ä¹‹å¤–ï¼Œè¿˜æœ‰å…¶ä»–å‡ ç§å¼‚æ­¥è¿è¡Œæ—¶ï¼Œä½†åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å’Œå¤§è§„æ¨¡é¡¹ç›®ä¸­ä½¿ç”¨è¾ƒå°‘ï¼š

- **async-std:**  
  è®¾è®¡ç†å¿µä¸Šæ›´æ¥è¿‘æ ‡å‡†åº“çš„ APIï¼Œéƒ¨åˆ† Web æ¡†æ¶ï¼ˆå¦‚ Tideï¼‰åŸºäº async-std å¼€å‘ã€‚å°½ç®¡ç®€å•æ˜“ç”¨ï¼Œä½†ç”Ÿæ€å’Œæ€§èƒ½ä¸Šå°šä¸å¦‚ Tokio æˆç†Ÿã€‚
  
- **smol:**  
  ä¸€ä¸ªè½»é‡çº§å¼‚æ­¥è¿è¡Œæ—¶ï¼Œé€‚ç”¨äºå¾®å‹é¡¹ç›®æˆ–éœ€è¦æ›´ç»†ç²’åº¦æ§åˆ¶çš„æƒ…å½¢ï¼Œä¸è¿‡å¸‚åœºä»½é¢å’Œç”Ÿæ€å½±å“åŠ›ç›¸å¯¹æœ‰é™ã€‚

---

## 3 åº”ç”¨é¢†åŸŸ

åŸºäºä»¥ä¸Šå¼‚æ­¥è¿è¡Œæ—¶å’Œæ¡†æ¶ï¼ŒRust å¼‚æ­¥ç¼–ç¨‹ä¸»è¦åœ¨ä»¥ä¸‹å‡ ä¸ªæˆç†Ÿé¢†åŸŸå†…è·å¾—äº†å¤§é‡åº”ç”¨ï¼š

- **é«˜æ€§èƒ½ Web æœåŠ¡å™¨å’Œ API æœåŠ¡ï¼š**  
  å¦‚ Hyperã€Warp å’Œ Axum æ¶æ„çš„ HTTP æœåŠ¡ï¼Œä»¥åŠ Tonic åŸºäº gRPC æ„å»ºçš„å¾®æœåŠ¡é€šä¿¡éƒ½è·å¾—äº†å¹¿æ³›åº”ç”¨ã€‚
  
- **åˆ†å¸ƒå¼ç³»ç»Ÿä¸å¾®æœåŠ¡æ¶æ„ï¼š**  
  åˆ©ç”¨ Tokio çš„ä»»åŠ¡è°ƒåº¦åŠå…¶ä¸ tracingã€Tower ç­‰åº“é›†æˆï¼Œæ„å»ºå¯é ã€æ˜“ç›‘æ§å’Œæ‰©å±•çš„åˆ†å¸ƒå¼ç³»ç»Ÿã€‚
  
- **é«˜å¹¶å‘ç½‘ç»œç¼–ç¨‹ï¼š**  
  åŒ…æ‹¬å®æ—¶æ•°æ®å¤„ç†ã€èŠå¤©æœåŠ¡ã€æµåª’ä½“å¤„ç†ã€ç‰©è”ç½‘ï¼ˆIoTï¼‰ç½‘å…³ç­‰åº”ç”¨åœºæ™¯ã€‚
  
- **å¼‚æ­¥æ•°æ®åº“æ“ä½œï¼š**  
  å¼‚æ­¥æ•°æ®åº“é©±åŠ¨çš„ä½¿ç”¨ï¼Œæ»¡è¶³é«˜å¹¶å‘ç¯å¢ƒä¸‹çš„æ•°æ®åº“è®¿é—®éœ€æ±‚ã€‚

---

## 4 æ€»ç»“

- **Tokio** æ˜¯å½“å‰ Rust å¼‚æ­¥ç¼–ç¨‹é¢†åŸŸä¸­æœ€æˆç†Ÿã€æœ€å¹¿æ³›ä½¿ç”¨çš„è¿è¡Œæ—¶ï¼Œå…¶ç”Ÿæ€æ¶µç›–äº†é«˜æ€§èƒ½ç½‘ç»œæœåŠ¡ã€å¾®æœåŠ¡ã€æ•°æ®åº“é©±åŠ¨ã€åˆ†å¸ƒå¼ç³»ç»Ÿç­‰ä¼—å¤šåº”ç”¨åœºæ™¯ã€‚
- åŸºäº Tokio æ„å»ºçš„æ¡†æ¶ï¼ˆå¦‚ Hyperã€Warpã€Axumã€Tonic ç­‰ï¼‰æ„æˆäº†ä¸€ä¸ªå®Œå–„ä¸”æˆç†Ÿçš„å¼‚æ­¥ç”Ÿæ€ç³»ç»Ÿï¼Œå¸®åŠ©å¼€å‘è€…æ„å»ºç¨³å®šé«˜æ•ˆçš„ç”Ÿäº§çº§åº”ç”¨ã€‚
- è™½ç„¶ **async-std**ã€**smol** ç­‰ä¹Ÿæä¾›äº†å¼‚æ­¥è¿è¡Œæ—¶åŠŸèƒ½ï¼Œä½†åœ¨ç¨³å®šæ€§ã€æ€§èƒ½å’Œç”Ÿæ€å®Œå–„åº¦ä¸Šï¼Œç›®å‰ Tokico æ˜¾ç„¶æ˜¯ä¸»æµé€‰æ‹©ã€‚

è¿™äº›æˆç†Ÿçš„åº”ç”¨é¢†åŸŸå’Œæ¡†æ¶è¯æ˜äº† Rust å¼‚æ­¥æŠ€æœ¯çš„é«˜æ•ˆæ€§å’Œå¯é æ€§ï¼Œä¹Ÿæ¨åŠ¨äº†å…¶åœ¨é«˜å¹¶å‘ã€ä½å»¶è¿Ÿé¢†åŸŸçš„å¹¿æ³›åº”ç”¨ã€‚

## 5 Tokio ä¸­çš„å¼‚æ­¥ä»»åŠ¡èƒ½å¦æŒ‡å®šä¼˜å…ˆçº§

ç›®å‰ï¼Œ**Tokio** çš„è®¾è®¡ç›®æ ‡æ˜¯ä¸ºå¤§é‡å¼‚æ­¥ä»»åŠ¡æä¾›é«˜æ•ˆä¸”å…¬å¹³çš„è°ƒåº¦ï¼Œä½†å®ƒæ²¡æœ‰ä¸ºå¼‚æ­¥ä»»åŠ¡æä¾›å†…å»ºçš„**ä¼˜å…ˆçº§**è®¾ç½®ã€‚è¿™æ„å‘³ç€ï¼š

- **å†…ç½®è°ƒåº¦ç­–ç•¥**ï¼š  
  Tokio çš„å¤šçº¿ç¨‹è°ƒåº¦å™¨é‡‡ç”¨äº†å·¥ä½œçªƒå–ï¼ˆwork-stealingï¼‰ç®—æ³•ï¼Œæ—¨åœ¨åœ¨å„ä¸ªä»»åŠ¡ä¹‹é—´å®ç°å°½é‡å…¬å¹³çš„è°ƒåº¦ï¼Œè€Œä¸æ˜¯æŒ‰ç…§å¼€å‘è€…æŒ‡å®šçš„ä¼˜å…ˆçº§æ¥å¤„ç†ä»»åŠ¡ã€‚

- **æ²¡æœ‰ç›´æ¥çš„ API**ï¼š  
  åœ¨ Tokio æä¾›çš„å®˜æ–¹ API ä¸­ï¼Œå¹¶æ²¡æœ‰æ¥å£èƒ½å¤Ÿè®©ä½ ä¸ºä»»åŠ¡è®¾ç½®ä¼˜å…ˆçº§å‚æ•°ï¼Œä»»åŠ¡è¢«æ”¾å…¥è¿è¡Œæ—¶åï¼Œè°ƒåº¦å™¨ä¼šæŒ‰ç…§å†…éƒ¨æœºåˆ¶å†³å®šä»»åŠ¡æ‰§è¡Œçš„å…ˆåé¡ºåºã€‚

---

## 6 æ›¿ä»£æ–¹æ¡ˆä¸å˜é€šæ–¹æ³•

å¯¹äºæœ‰ç‰¹æ®Šä¼˜å…ˆçº§éœ€æ±‚çš„åœºæ™¯ï¼Œå¯ä»¥è€ƒè™‘ä»¥ä¸‹å‡ ç§æ›¿ä»£æ–¹æ¡ˆï¼š

1. **è‡ªå®šä¹‰è°ƒåº¦é€»è¾‘**  
   - å¯ä»¥åœ¨åº”ç”¨å±‚é¢è®¾è®¡å¤šä¸ªä»»åŠ¡é˜Ÿåˆ—ï¼Œå°†é«˜ä¼˜å…ˆçº§å’Œä½ä¼˜å…ˆçº§çš„ä»»åŠ¡åˆ†åˆ«æ”¾å…¥ä¸åŒçš„é˜Ÿåˆ—ã€‚  
   - ç„¶åé€šè¿‡ä¸€ä¸ªè‡ªå®šä¹‰çš„è°ƒåº¦å™¨æŒ‰éœ€è°ƒç”¨è¿™äº›é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼Œä»è€Œå®ç°ä¸€å®šç¨‹åº¦çš„ä»»åŠ¡ä¼˜å…ˆè°ƒåº¦ã€‚

2. **ä½¿ç”¨å¤šä¸ª Tokio å®ä¾‹**  
   - é€šè¿‡åˆ›å»ºä¸åŒçš„ Tokio è¿è¡Œæ—¶ï¼Œæ¯ä¸ªè¿è¡Œæ—¶è´Ÿè´£å¤„ç†ä¸åŒçº§åˆ«çš„ä»»åŠ¡ã€‚  
   - é«˜ä¼˜å…ˆçº§ä»»åŠ¡å¯ä»¥æ”¾åœ¨ä¸€ä¸ªä¸“é—¨çš„è¿è¡Œæ—¶ä¸­ï¼Œä»¥æœŸè·å¾—æ›´å¿«é€Ÿçš„å“åº”ã€‚ä¸è¿‡éœ€è¦æ³¨æ„èµ„æºç«äº‰å’Œè·¨è¿è¡Œæ—¶é€šä¿¡çš„é—®é¢˜ã€‚

3. **å€ŸåŠ©ç¬¬ä¸‰æ–¹åº“**  
   - ç¤¾åŒºä¸­æœ‰ä¸€äº›å®éªŒæ€§è´¨çš„æ–¹æ¡ˆæˆ–åº“å°è¯•å®ç°åŸºäº Tokio çš„ä¼˜å…ˆçº§è°ƒåº¦ï¼Œä½†ç›®å‰å°šå¤„äºæ¢ç´¢å’Œè¯•éªŒé˜¶æ®µï¼Œç¨³å®šæ€§å’Œå…¼å®¹æ€§éœ€ä»”ç»†è¯„ä¼°ã€‚

4. **æ‰‹åŠ¨æ’å…¥è°ƒåº¦ç‚¹**  
   - åœ¨ä»»åŠ¡å†…éƒ¨é€‚å½“çš„åœ°æ–¹ä¸»åŠ¨è°ƒç”¨ `tokio::task::yield_now().await`ï¼Œä»¥ä¾¿è®©å‡ºæ‰§è¡Œæƒï¼Œä»è€Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šè°ƒæ•´ä»»åŠ¡é—´çš„æ‰§è¡Œé¡ºåºã€‚ä½†è¿™ç§æ–¹æ³•æ›´å¤šæ˜¯åº”ç”¨å±‚é¢çš„â€œåˆä½œå¼è°ƒåº¦â€ï¼Œå¹¶éçœŸæ­£æ„ä¹‰ä¸Šçš„ä¼˜å…ˆçº§æ§åˆ¶ã€‚

---

## 7 æ€»ç»“

- **å®˜æ–¹ç›®å‰ä¸æ”¯æŒ**ï¼š  
  Tokio å¹¶æ²¡æœ‰å†…ç½®çš„æœºåˆ¶å…è®¸ä¸ºå¼‚æ­¥ä»»åŠ¡ç›´æ¥åˆ†é…ä¸åŒçš„ä¼˜å…ˆçº§ï¼Œæ‰€æœ‰ä»»åŠ¡å‡æŒ‰ç…§è°ƒåº¦å™¨å†…éƒ¨çš„å…¬å¹³æ€§ç­–ç•¥æ‰§è¡Œã€‚

- **éœ€æ±‚åœºæ™¯ä¸‹çš„è§£å†³æ–¹æ¡ˆ**ï¼š  
  å¦‚æœä½ çš„åº”ç”¨åœºæ™¯å¯¹ä»»åŠ¡çš„å“åº”æ—¶é—´æœ‰ä¸¥æ ¼çš„ä¼˜å…ˆçº§è¦æ±‚ï¼Œå¯ä»¥è€ƒè™‘è‡ªå®šä¹‰è°ƒåº¦é€»è¾‘æˆ–ä½¿ç”¨å¤šä¸ªè¿è¡Œæ—¶ã€‚ä½†è¿™äº›æ–¹æ¡ˆéœ€è¦é¢å¤–çš„è®¾è®¡å’Œè°ƒè¯•å·¥ä½œï¼Œå¹¶ä¸å¦‚å†…å»ºæ”¯æŒé‚£æ ·ç›´è§‚å’Œç®€å•ã€‚

æ€»çš„æ¥è¯´ï¼Œè™½ç„¶ Tokio çš„ç°æœ‰æ¶æ„ä¸æ”¯æŒæ˜¾å¼ä»»åŠ¡ä¼˜å…ˆçº§ï¼Œä½†é€šè¿‡å·¥ç¨‹ä¸Šçš„ä¸€äº›å˜é€šæ–¹æ¡ˆï¼Œä»ç„¶å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šå®ç°ç±»ä¼¼æ•ˆæœã€‚æœªæ¥å¦‚æœç¤¾åŒºæå‡ºè¶³å¤Ÿå¤šçš„éœ€æ±‚ï¼Œæˆ–è€… Tokio å›¢é˜Ÿå†³å®šå¼•å…¥è¿™ä¸€ç‰¹æ€§ï¼Œå¯èƒ½ä¼šæœ‰æ–°çš„è§£å†³æ–¹æ¡ˆå‡ºç°ã€‚

## 8 Rust å¦‚ä½•å®ç°è¿è¡Œæ—¶è´Ÿè½½æ„ŸçŸ¥å¹¶è°ƒæ•´è¿è¡Œç­–ç•¥

Rust æœ¬èº«æ²¡æœ‰å†…ç½®â€œè´Ÿè½½æ„ŸçŸ¥â€çš„æœºåˆ¶ï¼Œä½†é€šè¿‡ç»„åˆç°æœ‰çš„åº“ä¸è®¾è®¡æ¨¡å¼ï¼Œå®Œå…¨å¯ä»¥æ„å»ºä¸€ä¸ªèƒ½å¤Ÿç›‘æ§ç³»ç»Ÿè´Ÿè½½å¹¶åŠ¨æ€è°ƒæ•´è¿è¡Œç­–ç•¥çš„åº”ç”¨ç¨‹åºã€‚ä¸‹é¢ä»‹ç»å‡ ç§å®ç°æ€è·¯å’Œå¯ç”¨çš„å·¥å…·ï¼š

## 9 è´Ÿè½½ç›‘æ§

### 9.1 åˆ©ç”¨ç³»ç»Ÿä¿¡æ¯æŸ¥è¯¢åº“

ä½ å¯ä»¥é€šè¿‡è°ƒç”¨æ“ä½œç³»ç»Ÿ API æˆ–ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“è·å–å½“å‰ç³»ç»Ÿçš„çŠ¶æ€æŒ‡æ ‡ï¼Œæ¯”å¦‚ CPU ä½¿ç”¨ç‡ã€å†…å­˜å ç”¨ã€ç£ç›˜ I/O ç­‰ã€‚å¸¸è§çš„åº“æœ‰ï¼š

- **sysinfo**  
  å¯ä»¥ç”¨æ¥å®æ—¶æŸ¥è¯¢ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µã€‚

- **heim**  
  å¦ä¸€æ¬¾è·¨å¹³å°çš„ç³»ç»Ÿç›‘æ§åº“ï¼ŒåŠŸèƒ½ç±»ä¼¼äº sysinfoã€‚

**ç¤ºä¾‹ï¼š**  
**æ–‡ä»¶è·¯å¾„ï¼š** `src/load_monitor.rs`  

```rust
use sysinfo::{ProcessorExt, System, SystemExt};

pub fn get_cpu_usage() -> f32 {
    let mut system = System::new_all();
    system.refresh_all();
    // è·å–æ‰€æœ‰ CPU çš„å¹³å‡ä½¿ç”¨ç‡
    let cpu_usage = system
        .get_processors()
        .iter()
        .map(|proc| proc.get_cpu_usage())
        .sum::<f32>() / system.get_processors().len() as f32;
    cpu_usage
}
```

### 9.2 å®šæ—¶é‡‡é›†æŒ‡æ ‡å¹¶ç›‘æ§

ä½¿ç”¨å®šæ—¶ä»»åŠ¡ï¼ˆä¾‹å¦‚ Tokio çš„å®šæ—¶å™¨æˆ– `tokio::time::interval`ï¼‰å®šæœŸé‡‡é›†ç³»ç»Ÿè´Ÿè½½ï¼Œé€šè¿‡è½®è¯¢çš„æ–¹å¼æ„å»ºè´Ÿè½½ç›‘æ§ç»„ä»¶ã€‚

---

## 10 åŠ¨æ€è°ƒæ•´ç­–ç•¥

ç›‘æ§åˆ°ç³»ç»Ÿè´Ÿè½½ä¿¡æ¯åï¼Œä½ å¯ä»¥æ ¹æ®é¢„è®¾çš„ç­–ç•¥åŠ¨æ€è°ƒæ•´åº”ç”¨çš„è¡Œä¸ºã€‚å¸¸è§çš„è°ƒæ•´ç­–ç•¥åŒ…æ‹¬ï¼š

- **åŠ¨æ€è°ƒæ•´çº¿ç¨‹æ± å¤§å°**  
  æ¯”å¦‚åœ¨é«˜è´Ÿè½½æ—¶å‡å°‘å¹¶å‘ä»»åŠ¡æ•°ä»¥é™ä½èµ„æºç«äº‰ï¼Œåœ¨ç©ºé—²æ—¶æ¢å¤å¹¶å‘åº¦ã€‚

- **æ”¹å˜ä¸šåŠ¡é€»è¾‘æ‰§è¡Œé€Ÿç‡**  
  ä½¿ç”¨â€œåå‹â€ï¼ˆbackpressureï¼‰ç­‰æŠ€æœ¯å»¶ç¼“ä»»åŠ¡è°ƒåº¦æˆ–å‡å°‘æŸäº›ä½ä¼˜å…ˆçº§ä»»åŠ¡çš„æ‰§è¡Œé¢‘ç‡ã€‚

- **åˆ‡æ¢ç®—æ³•æˆ–æ•°æ®ç»“æ„**  
  æ ¹æ®è´Ÿè½½çš„å˜åŒ–ï¼Œé€‰æ‹©ä¸åŒçš„ç¼“å­˜æ·˜æ±°ç­–ç•¥æˆ–è€…ç®—æ³•å‚æ•°ã€‚

**ç¤ºä¾‹æ€è·¯ï¼š**  
å¯ä»¥ç¼–å†™ä¸€ä¸ªæ§åˆ¶å™¨æ¨¡å—ï¼Œè¯¥æ¨¡å—æ¯éš”ä¸€æ®µæ—¶é—´æ£€æŸ¥è´Ÿè½½æŒ‡æ ‡ï¼Œç„¶åè°ƒç”¨ä¸åŒçš„å›è°ƒå‡½æ•°æ¥åŠ¨æ€è°ƒæ•´ä»»åŠ¡çš„è°ƒåº¦å‚æ•°ç­‰ã€‚

**æ–‡ä»¶è·¯å¾„ï¼š** `src/load_controller.rs`  

```rust
use tokio::time::{self, Duration};
use crate::load_monitor::get_cpu_usage;

pub async fn monitor_and_adjust() {
    let mut interval = time::interval(Duration::from_secs(5));

    loop {
        interval.tick().await;
        let cpu = get_cpu_usage();
        println!("å½“å‰ CPU ä½¿ç”¨ç‡: {:.2}%", cpu);

        // æŒ‰ç…§ CPU ä½¿ç”¨ç‡è°ƒæ•´è¿è¡Œç­–ç•¥
        if cpu > 80.0 {
            // æ¯”å¦‚ï¼šé™ä½ä»»åŠ¡è°ƒåº¦é¢‘ç‡æˆ–å‡å°‘å¹¶å‘æ•°é‡
            println!("è´Ÿè½½è¾ƒé«˜ï¼Œé™ä½éƒ¨åˆ†ä»»åŠ¡å¹¶å‘...");
            // åœ¨è¿™é‡Œè°ƒç”¨ç›¸å…³å‡½æ•°è¿›è¡Œè°ƒæ•´
        } else if cpu < 50.0 {
            println!("è´Ÿè½½è¾ƒä½ï¼Œæ¢å¤æˆ–æå‡ä»»åŠ¡å¹¶å‘...");
            // æ¢å¤æˆ–è€…æé«˜å¹¶å‘åº¦
        }
        // å¯æ ¹æ®å®é™…éœ€æ±‚æ‰©å±•æ›´å¤šè°ƒæ•´ç­–ç•¥
    }
}
```

---

## 11 åº”ç”¨åœºæ™¯æ•´åˆ

### 11.1 å¼‚æ­¥ä»»åŠ¡è°ƒåº¦

åœ¨åŸºäº Tokio æˆ– async-std çš„åº”ç”¨ä¸­ï¼Œå¯ä»¥åœ¨ Executor ä¹‹ä¸Šæ„å»ºä¸€ä¸ªé¢å¤–çš„è°ƒåº¦å±‚ï¼ŒåŠ¨æ€è°ƒæ•´ä»»åŠ¡æäº¤é¢‘ç‡ã€‚æ¯”å¦‚ï¼š

- ä¸ºé«˜ä¼˜å…ˆçº§ä»»åŠ¡å¼€è®¾ä¸“é—¨çš„è¿è¡Œæ—¶æˆ–ä»»åŠ¡é˜Ÿåˆ—ã€‚
- åœ¨ä»»åŠ¡å†…éƒ¨å‘¨æœŸæ€§æ£€æµ‹ç³»ç»ŸçŠ¶æ€ï¼Œé€šè¿‡è‡ªé€‚åº”ç­‰å¾…æˆ–ä¸»åŠ¨ yield æ¥é™ä½ç³»ç»Ÿå¼€é”€ã€‚

### 11.2 å¾®æœåŠ¡ IoT ç½‘å…³

å¯¹äºå¾®æœåŠ¡æˆ– IoT è¾¹ç¼˜è®¡ç®—ç³»ç»Ÿï¼Œå¯ä»¥å°†è´Ÿè½½ç›‘æ§ä½œä¸ºå…¨å±€ç®¡ç†å·¥å…·ï¼ŒåŠ¨æ€è°ƒæ•´ç¼“å­˜ä½¿ç”¨ã€è¯·æ±‚é™æµã€å¹¶å‘è¿æ¥æ•°ç­‰å‚æ•°ï¼Œä¿éšœç³»ç»Ÿåœ¨é«˜è´Ÿè½½æƒ…å†µä¸‹ä»ç„¶ç¨³å®šè¿è¡Œã€‚

---

## 12 å°ç»“

- **Rust æœ¬èº«æ²¡æœ‰è‡ªåŠ¨æ„ŸçŸ¥ç³»ç»Ÿè´Ÿè½½çš„å†…ç½®æœºåˆ¶ï¼Œä½†å®Œå…¨å¯ä»¥é€šè¿‡ç¬¬ä¸‰æ–¹åº“ï¼ˆå¦‚ sysinfoã€heimï¼‰å’Œå¼‚æ­¥å®šæ—¶å™¨ç­‰æ‰‹æ®µå®ç°è´Ÿè½½ç›‘æ§ã€‚**
- **ç›‘æ§åˆ°çš„è´Ÿè½½æ•°æ®å¯ä»¥ä½œä¸ºå†³ç­–ä¾æ®ï¼Œé€šè¿‡åŠ¨æ€è°ƒæ•´çº¿ç¨‹æ± å¤§å°ã€ä»»åŠ¡è°ƒåº¦é€Ÿç‡å’Œå…¶ä»–è¿è¡Œå‚æ•°æ¥ä¼˜åŒ–ç³»ç»Ÿæ€§èƒ½ã€‚**
- **è¿™ç§è®¾è®¡å®Œå…¨ç¬¦åˆ Rust å¼ºè°ƒçš„é™æ€å®‰å…¨ä¸æ˜¾å¼æ§åˆ¶çš„ç†å¿µï¼ŒåŒæ—¶ä¹Ÿèƒ½æ„å»ºå‡ºè‡ªé€‚åº”ã€é«˜æ€§èƒ½çš„ç³»ç»Ÿã€‚**

ç»¼ä¸Šæ‰€è¿°ï¼ŒRust ç”Ÿæ€æä¾›äº†è¶³å¤Ÿçš„å·¥å…·å’Œåº“ï¼Œå¼€å‘è€…å¯ä»¥åˆ©ç”¨è¿™äº›ç»„ä»¶å®ç°ä¸€å¥—å®Œæ•´çš„ã€åŸºäºè¿è¡Œæ—¶è´Ÿè½½æ„ŸçŸ¥çš„è‡ªé€‚åº”è¿è¡Œç­–ç•¥ã€‚
