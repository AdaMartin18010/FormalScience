# é«˜çº§çº¿æ€§ç±»åž‹ç†è®º (Advanced Linear Type Theory)

## ðŸ“‹ ç›®å½•

- [1 çº¿æ€§é€»è¾‘çš„ä»£æ•°ç»“æž„](#1-çº¿æ€§é€»è¾‘çš„ä»£æ•°ç»“æž„)
  - [1.1 çº¿æ€§é€»è¾‘ä½œä¸ºä»£æ•°](#11-çº¿æ€§é€»è¾‘ä½œä¸ºä»£æ•°)
  - [1.2 çº¿æ€§é€»è¾‘çš„èŒƒç•´è¯­ä¹‰](#12-çº¿æ€§é€»è¾‘çš„èŒƒç•´è¯­ä¹‰)
- [2 é«˜é˜¶çº¿æ€§ç±»åž‹ç³»ç»Ÿ](#2-é«˜é˜¶çº¿æ€§ç±»åž‹ç³»ç»Ÿ)
  - [2.1 çº¿æ€§Î»æ¼”ç®—](#21-çº¿æ€§Î»æ¼”ç®—)
  - [2.2 çº¿æ€§é€»è¾‘ç¼–ç¨‹](#22-çº¿æ€§é€»è¾‘ç¼–ç¨‹)
- [3 èµ„æºç®¡ç†ç†è®º](#3-èµ„æºç®¡ç†ç†è®º)
  - [3.1 èµ„æºç±»åž‹ç³»ç»Ÿ](#31-èµ„æºç±»åž‹ç³»ç»Ÿ)
  - [3.2 å†…å­˜ç®¡ç†](#32-å†…å­˜ç®¡ç†)
  - [3.3 å¹¶å‘èµ„æºç®¡ç†](#33-å¹¶å‘èµ„æºç®¡ç†)
- [4 çº¿æ€§é€»è¾‘çš„è¯­ä¹‰](#4-çº¿æ€§é€»è¾‘çš„è¯­ä¹‰)
  - [4.1 æŒ‡ç§°è¯­ä¹‰](#41-æŒ‡ç§°è¯­ä¹‰)
  - [4.2 æ“ä½œè¯­ä¹‰](#42-æ“ä½œè¯­ä¹‰)
- [5 çº¿æ€§ç±»åž‹ç³»ç»Ÿçš„æ‰©å±•](#5-çº¿æ€§ç±»åž‹ç³»ç»Ÿçš„æ‰©å±•)
  - [5.1 ä»¿å°„ç±»åž‹](#51-ä»¿å°„ç±»åž‹)
  - [5.2 ç›¸å…³ç±»åž‹](#52-ç›¸å…³ç±»åž‹)
- [6 å®žé™…åº”ç”¨](#6-å®žé™…åº”ç”¨)
  - [6.1 Rustæ‰€æœ‰æƒç³»ç»Ÿ](#61-rustæ‰€æœ‰æƒç³»ç»Ÿ)
  - [6.2 å‡½æ•°å¼ç¼–ç¨‹ä¸­çš„çº¿æ€§ç±»åž‹](#62-å‡½æ•°å¼ç¼–ç¨‹ä¸­çš„çº¿æ€§ç±»åž‹)
  - [6.3 å¹¶å‘ç¼–ç¨‹](#63-å¹¶å‘ç¼–ç¨‹)
- [7 çº¿æ€§ç±»åž‹ç³»ç»Ÿçš„å…ƒç†è®º](#7-çº¿æ€§ç±»åž‹ç³»ç»Ÿçš„å…ƒç†è®º)
  - [7.1 å¼ºæ­£è§„åŒ–](#71-å¼ºæ­£è§„åŒ–)
  - [7.2 ç±»åž‹æŽ¨æ–­](#72-ç±»åž‹æŽ¨æ–­)
  - [7.3 ç±»åž‹æ£€æŸ¥](#73-ç±»åž‹æ£€æŸ¥)
- [8 ç»“è®º](#8-ç»“è®º)

---

## 1 çº¿æ€§é€»è¾‘çš„ä»£æ•°ç»“æž„

### 1.1 çº¿æ€§é€»è¾‘ä½œä¸ºä»£æ•°

**å®šä¹‰ 1.1 (çº¿æ€§é€»è¾‘ä»£æ•°)**
çº¿æ€§é€»è¾‘ä»£æ•°æ˜¯ä¸€ä¸ªå…­å…ƒç»„ $\mathcal{L} = (L, \otimes, \multimap, \&, \oplus, !)$ï¼Œå…¶ä¸­ï¼š

- $L$ æ˜¯å…¬å¼é›†åˆ
- $\otimes$ æ˜¯å¼ é‡ç§¯è¿ç®—
- $\multimap$ æ˜¯çº¿æ€§è•´å«è¿ç®—
- $\&$ æ˜¯åŠ æ³•ç§¯è¿ç®—
- $\oplus$ æ˜¯åŠ æ³•å’Œè¿ç®—
- $!$ æ˜¯æŒ‡æ•°è¿ç®—

**å®šä¹‰ 1.2 (çº¿æ€§é€»è¾‘ç­‰å¼)**
çº¿æ€§é€»è¾‘ç­‰å¼åŒ…æ‹¬ï¼š

- **å¼ é‡ç§¯ç»“åˆå¾‹**ï¼š$(A \otimes B) \otimes C = A \otimes (B \otimes C)$
- **å¼ é‡ç§¯äº¤æ¢å¾‹**ï¼š$A \otimes B = B \otimes A$
- **å¼ é‡ç§¯å•ä½å…ƒ**ï¼š$I \otimes A = A = A \otimes I$
- **çº¿æ€§è•´å«åˆ†é…å¾‹**ï¼š$A \multimap (B \multimap C) = (A \otimes B) \multimap C$

**å®šç† 1.1 (çº¿æ€§é€»è¾‘ä»£æ•°æ€§è´¨)**
çº¿æ€§é€»è¾‘ä»£æ•°æ»¡è¶³ï¼š

1. **ç»“åˆæ€§**ï¼šæ‰€æœ‰äºŒå…ƒè¿ç®—éƒ½æ»¡è¶³ç»“åˆå¾‹
2. **äº¤æ¢æ€§**ï¼šå¼ é‡ç§¯å’ŒåŠ æ³•ç§¯æ»¡è¶³äº¤æ¢å¾‹
3. **åˆ†é…æ€§**ï¼šæŒ‡æ•°è¿ç®—æ»¡è¶³åˆ†é…å¾‹
4. **å¹‚ç­‰æ€§**ï¼šåŠ æ³•ç§¯æ»¡è¶³å¹‚ç­‰å¾‹ $A \& A = A$

**è¯æ˜Žï¼š** é€šè¿‡çº¿æ€§é€»è¾‘çš„è¯æ˜Žè®ºï¼š

1. æ¯ä¸ªç­‰å¼å¯¹åº”ä¸€ä¸ªè¯æ˜Žå˜æ¢
2. è¯æ˜Žå˜æ¢ä¿æŒé€»è¾‘ç­‰ä»·æ€§
3. ä»£æ•°æ€§è´¨é€šè¿‡è¯æ˜Žå˜æ¢å®žçŽ°

### 1.2 çº¿æ€§é€»è¾‘çš„èŒƒç•´è¯­ä¹‰

**å®šä¹‰ 1.3 (å¯¹ç§°å¹ºåŠèŒƒç•´)**
å¯¹ç§°å¹ºåŠèŒƒç•´ $\mathcal{C}$ åŒ…å«ï¼š

- å¯¹è±¡é›†åˆ $\text{Ob}(\mathcal{C})$
- æ€å°„é›†åˆ $\text{Hom}(A, B)$
- å¼ é‡ç§¯å‡½å­ $\otimes : \mathcal{C} \times \mathcal{C} \rightarrow \mathcal{C}$
- å•ä½å¯¹è±¡ $I \in \text{Ob}(\mathcal{C})$
- è‡ªç„¶åŒæž„ï¼š
  - ç»“åˆå¾‹ï¼š$\alpha_{A,B,C} : (A \otimes B) \otimes C \rightarrow A \otimes (B \otimes C)$
  - å•ä½å¾‹ï¼š$\lambda_A : I \otimes A \rightarrow A$, $\rho_A : A \otimes I \rightarrow A$
  - å¯¹ç§°å¾‹ï¼š$\sigma_{A,B} : A \otimes B \rightarrow B \otimes A$

**å®šä¹‰ 1.4 (çº¿æ€§é€»è¾‘æ¨¡åž‹)**
çº¿æ€§é€»è¾‘æ¨¡åž‹æ˜¯ä¸‰å…ƒç»„ $(\mathcal{C}, \otimes, \multimap)$ï¼Œå…¶ä¸­ï¼š

- $\mathcal{C}$ æ˜¯å¯¹ç§°å¹ºåŠé—­èŒƒç•´
- $\otimes$ æ˜¯å¼ é‡ç§¯
- $\multimap$ æ˜¯å†…éƒ¨Homå‡½å­ï¼Œæ»¡è¶³ï¼š
  $$\text{Hom}(A \otimes B, C) \cong \text{Hom}(A, B \multimap C)$$

**å®šç† 1.2 (çº¿æ€§é€»è¾‘å®Œå¤‡æ€§)**
çº¿æ€§é€»è¾‘ç›¸å¯¹äºŽå¯¹ç§°å¹ºåŠé—­èŒƒç•´æ˜¯å®Œå¤‡çš„ã€‚

**è¯æ˜Žï¼š** é€šè¿‡æž„é€ æ€§è¯æ˜Žï¼š

1. æ¯ä¸ªçº¿æ€§é€»è¾‘å…¬å¼å¯¹åº”èŒƒç•´ä¸­çš„å¯¹è±¡
2. æ¯ä¸ªè¯æ˜Žå¯¹åº”èŒƒç•´ä¸­çš„æ€å°„
3. è¯æ˜Žç­‰ä»·æ€§å¯¹åº”æ€å°„ç›¸ç­‰

## 2 é«˜é˜¶çº¿æ€§ç±»åž‹ç³»ç»Ÿ

### 2.1 çº¿æ€§Î»æ¼”ç®—

**å®šä¹‰ 2.1 (çº¿æ€§Î»æ¼”ç®—è¯­æ³•)**
çº¿æ€§Î»æ¼”ç®—çš„é¡¹ï¼š
$$M ::= x \mid \lambda x.M \mid M N \mid M \otimes N \mid \text{let } x \otimes y = M \text{ in } N$$

**å®šä¹‰ 2.2 (çº¿æ€§ä¸Šä¸‹æ–‡)**
çº¿æ€§ä¸Šä¸‹æ–‡ $\Gamma$ æ˜¯å˜é‡åˆ°ç±»åž‹çš„æ˜ å°„ï¼Œæ»¡è¶³ï¼š

- æ¯ä¸ªå˜é‡æ°å¥½å‡ºçŽ°ä¸€æ¬¡
- ä¸Šä¸‹æ–‡å¯ä»¥åˆ†è§£ä¸ºä¸ç›¸äº¤çš„éƒ¨åˆ†

**å®šä¹‰ 2.3 (çº¿æ€§ç±»åž‹è§„åˆ™)**
çº¿æ€§ç±»åž‹è§„åˆ™ï¼š
$$\frac{x : A \in \Gamma}{\Gamma \vdash x : A}$$

$$\frac{\Gamma, x : A \vdash M : B}{\Gamma \vdash \lambda x.M : A \multimap B}$$

$$\frac{\Gamma_1 \vdash M : A \multimap B \quad \Gamma_2 \vdash N : A}{\Gamma_1, \Gamma_2 \vdash M N : B}$$

$$\frac{\Gamma_1 \vdash M : A \quad \Gamma_2 \vdash N : B}{\Gamma_1, \Gamma_2 \vdash M \otimes N : A \otimes B}$$

$$\frac{\Gamma_1 \vdash M : A \otimes B \quad \Gamma_2, x : A, y : B \vdash N : C}{\Gamma_1, \Gamma_2 \vdash \text{let } x \otimes y = M \text{ in } N : C}$$

**å®šç† 2.1 (çº¿æ€§æ€§ä¿æŒ)**
å¦‚æžœ $\Gamma \vdash M : A$ï¼Œåˆ™ $\Gamma$ ä¸­çš„æ¯ä¸ªå˜é‡åœ¨ $M$ ä¸­æ°å¥½å‡ºçŽ°ä¸€æ¬¡ã€‚

**è¯æ˜Žï¼š** é€šè¿‡ç»“æž„å½’çº³æ³•ï¼š

1. **å˜é‡**ï¼šç›´æŽ¥æ»¡è¶³çº¿æ€§æ€§
2. **æŠ½è±¡**ï¼šé€šè¿‡å½’çº³å‡è®¾ï¼Œå˜é‡åœ¨ä½“ä¸­æ°å¥½å‡ºçŽ°ä¸€æ¬¡
3. **åº”ç”¨**ï¼šé€šè¿‡ä¸Šä¸‹æ–‡åˆ†ç¦»ï¼Œç¡®ä¿å˜é‡ä¸é‡å¤ä½¿ç”¨
4. **å¼ é‡ç§¯**ï¼šé€šè¿‡ä¸Šä¸‹æ–‡åˆ†ç¦»
5. **æ¨¡å¼åŒ¹é…**ï¼šé€šè¿‡ä¸Šä¸‹æ–‡åˆ†ç¦»å’Œçº¿æ€§æ€§çº¦æŸ

### 2.2 çº¿æ€§é€»è¾‘ç¼–ç¨‹

**å®šä¹‰ 2.4 (çº¿æ€§é€»è¾‘ç¨‹åº)**
çº¿æ€§é€»è¾‘ç¨‹åºæ˜¯å­å¥é›†åˆï¼š
$$\text{Program} ::= \text{Clause}^*$$
$$\text{Clause} ::= \text{Head} \multimap \text{Body}$$
$$\text{Head} ::= \text{Atom}$$
$$\text{Body} ::= \text{Atom}^*$$

**å®šä¹‰ 2.5 (çº¿æ€§é€»è¾‘è¯æ˜Ž)**
çº¿æ€§é€»è¾‘è¯æ˜Žæ˜¯è¯æ˜Žæ ‘ï¼Œå…¶ä¸­ï¼š

- å¶å­èŠ‚ç‚¹æ˜¯å…¬ç†
- å†…éƒ¨èŠ‚ç‚¹æ˜¯æŽ¨ç†è§„åˆ™åº”ç”¨
- æ¯ä¸ªå…¬å¼æ°å¥½ä½¿ç”¨ä¸€æ¬¡

-**ç®—æ³• 2.1 (çº¿æ€§é€»è¾‘è¯æ˜Žæœç´¢)**

```haskell
linearProofSearch :: Program -> Goal -> [Proof]
linearProofSearch program goal = 
  case goal of
    [] -> [EmptyProof]
    (atom:atoms) -> do
      clause <- findClause program atom
      let (head, body) = decomposeClause clause
      unifier <- unify atom head
      subproofs <- mapM (linearProofSearch program) (applyUnifier unifier body)
      return (ProofStep clause unifier subproofs)
```

**å®šç† 2.2 (çº¿æ€§é€»è¾‘è¯æ˜Žæœç´¢å®Œå¤‡æ€§)**
å¦‚æžœç›®æ ‡ $G$ åœ¨çº¿æ€§é€»è¾‘ç¨‹åºä¸­å¯è¯æ˜Žï¼Œåˆ™è¯æ˜Žæœç´¢ç®—æ³•èƒ½æ‰¾åˆ°è¯æ˜Žã€‚

**è¯æ˜Žï¼š** é€šè¿‡å½’çº³æ³•ï¼š

1. åŸºç¡€æƒ…å†µï¼šç©ºç›®æ ‡
2. å½’çº³æƒ…å†µï¼šé€šè¿‡å­å¥é€‰æ‹©å’Œç»Ÿä¸€

## 3 èµ„æºç®¡ç†ç†è®º

### 3.1 èµ„æºç±»åž‹ç³»ç»Ÿ

**å®šä¹‰ 3.1 (èµ„æºç±»åž‹)**
èµ„æºç±»åž‹è¡¨ç¤ºéœ€è¦ç²¾ç¡®ç®¡ç†çš„ç³»ç»Ÿèµ„æºï¼š
$$\text{Resource} ::= \text{FileHandle} \mid \text{MemoryRef} \mid \text{NetworkConn} \mid \text{DatabaseConn} \mid \text{Lock}$$

**å®šä¹‰ 3.2 (èµ„æºæ“ä½œ)**
èµ„æºæ“ä½œåŒ…æ‹¬ï¼š

- **åˆ›å»º**ï¼š$\text{create} : \text{ResourceType} \rightarrow \text{Resource}$
- **ä½¿ç”¨**ï¼š$\text{use} : \text{Resource} \multimap (\text{Resource} \otimes \text{Result})$
- **é”€æ¯**ï¼š$\text{destroy} : \text{Resource} \multimap \text{Unit}$

**å®šä¹‰ 3.3 (èµ„æºå®‰å…¨)**
èµ„æºå®‰å…¨æ€§è´¨ï¼š

- **æ— é‡å¤é‡Šæ”¾**ï¼šæ¯ä¸ªèµ„æºæœ€å¤šé‡Šæ”¾ä¸€æ¬¡
- **æ— æ‚¬ç©ºå¼•ç”¨**ï¼šä¸ä¼šè®¿é—®å·²é‡Šæ”¾çš„èµ„æº
- **æ— èµ„æºæ³„æ¼**ï¼šæ‰€æœ‰èµ„æºæœ€ç»ˆè¢«é‡Šæ”¾

**å®šç† 3.1 (çº¿æ€§ç±»åž‹èµ„æºå®‰å…¨)**
åœ¨çº¿æ€§ç±»åž‹ç³»ç»Ÿä¸­ï¼Œèµ„æºæ“ä½œæ»¡è¶³èµ„æºå®‰å…¨æ€§è´¨ã€‚

**è¯æ˜Žï¼š** é€šè¿‡çº¿æ€§æ€§çº¦æŸï¼š

1. **æ— é‡å¤é‡Šæ”¾**ï¼šæ¯ä¸ªèµ„æºå˜é‡æœ€å¤šä½¿ç”¨ä¸€æ¬¡
2. **æ— æ‚¬ç©ºå¼•ç”¨**ï¼šèµ„æºé”€æ¯åŽå˜é‡ä¸å¯ç”¨
3. **æ— èµ„æºæ³„æ¼**ï¼šæ‰€æœ‰èµ„æºå˜é‡å¿…é¡»è¢«ä½¿ç”¨

### 3.2 å†…å­˜ç®¡ç†

**å®šä¹‰ 3.4 (çº¿æ€§å¼•ç”¨)**
çº¿æ€§å¼•ç”¨ç³»ç»Ÿï¼š

```haskell
data LinearRef a where
  NewRef :: a -> LinearRef a
  ReadRef :: LinearRef a -> (a, LinearRef a)
  WriteRef :: LinearRef a -> a -> LinearRef a
  FreeRef :: LinearRef a -> ()
```

**å®šä¹‰ 3.5 (å†…å­˜å®‰å…¨)**
å†…å­˜å®‰å…¨æ€§è´¨ï¼š

- **ç±»åž‹å®‰å…¨**ï¼šå¼•ç”¨ç±»åž‹ä¸Žå€¼ç±»åž‹åŒ¹é…
- **ç”Ÿå‘½å‘¨æœŸå®‰å…¨**ï¼šå¼•ç”¨ä¸è¶…è¿‡è¢«å¼•ç”¨å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ
- **å¹¶å‘å®‰å…¨**ï¼šæ— æ•°æ®ç«žäº‰

**å®šç† 3.2 (çº¿æ€§å¼•ç”¨å†…å­˜å®‰å…¨)**
çº¿æ€§å¼•ç”¨ç³»ç»Ÿä¿è¯å†…å­˜å®‰å…¨ã€‚

**è¯æ˜Žï¼š** é€šè¿‡çº¿æ€§ç±»åž‹ç³»ç»Ÿï¼š

1. **ç±»åž‹å®‰å…¨**ï¼šé€šè¿‡ç±»åž‹æ£€æŸ¥ä¿è¯
2. **ç”Ÿå‘½å‘¨æœŸå®‰å…¨**ï¼šé€šè¿‡çº¿æ€§æ€§ä¿è¯
3. **å¹¶å‘å®‰å…¨**ï¼šé€šè¿‡å”¯ä¸€æ‰€æœ‰æƒä¿è¯

### 3.3 å¹¶å‘èµ„æºç®¡ç†

**å®šä¹‰ 3.6 (å¹¶å‘èµ„æº)**
å¹¶å‘èµ„æºç®¡ç†ï¼š

```haskell
data ConcurrentResource a where
  SharedRef :: a -> ConcurrentResource a
  ExclusiveRef :: a -> ConcurrentResource a
  ReadLock :: ConcurrentResource a -> (a, ReadLock a)
  WriteLock :: ConcurrentResource a -> (a, WriteLock a)
  ReleaseLock :: Lock a -> ConcurrentResource a
```

**å®šä¹‰ 3.7 (å¹¶å‘å®‰å…¨)**
å¹¶å‘å®‰å…¨æ€§è´¨ï¼š

- **äº’æ–¥è®¿é—®**ï¼šå†™é”äº’æ–¥
- **å…±äº«è¯»å–**ï¼šè¯»é”å¯å…±äº«
- **æ— æ­»é”**ï¼šä¸ä¼šå‡ºçŽ°å¾ªçŽ¯ç­‰å¾…

**å®šç† 3.3 (å¹¶å‘èµ„æºå®‰å…¨)**
å¹¶å‘èµ„æºç³»ç»Ÿä¿è¯å¹¶å‘å®‰å…¨ã€‚

**è¯æ˜Žï¼š** é€šè¿‡é”åè®®ï¼š

1. **äº’æ–¥è®¿é—®**ï¼šé€šè¿‡å†™é”äº’æ–¥ä¿è¯
2. **å…±äº«è¯»å–**ï¼šé€šè¿‡è¯»é”å…±äº«ä¿è¯
3. **æ— æ­»é”**ï¼šé€šè¿‡é”èŽ·å–é¡ºåºä¿è¯

## 4 çº¿æ€§é€»è¾‘çš„è¯­ä¹‰

### 4.1 æŒ‡ç§°è¯­ä¹‰

**å®šä¹‰ 4.1 (çº¿æ€§å‡½æ•°ç©ºé—´)**
çº¿æ€§å‡½æ•°ç©ºé—´ $A \multimap B$ çš„è¯­ä¹‰ï¼š
$$\llbracket A \multimap B \rrbracket = \llbracket A \rrbracket \rightarrow \llbracket B \rrbracket$$

**å®šä¹‰ 4.2 (å¼ é‡ç§¯è¯­ä¹‰)**
å¼ é‡ç§¯ $A \otimes B$ çš„è¯­ä¹‰ï¼š
$$\llbracket A \otimes B \rrbracket = \llbracket A \rrbracket \times \llbracket B \rrbracket$$

**å®šä¹‰ 4.3 (æŒ‡æ•°ç±»åž‹è¯­ä¹‰)**
æŒ‡æ•°ç±»åž‹ $!A$ çš„è¯­ä¹‰ï¼š
$$\llbracket !A \rrbracket = \text{Comonad}(\llbracket A \rrbracket)$$

**å®šç† 4.1 (è¯­ä¹‰ä¸€è‡´æ€§)**
å¦‚æžœ $\Gamma \vdash M : A$ ä¸” $M \rightarrow M'$ï¼Œåˆ™ $\llbracket M \rrbracket = \llbracket M' \rrbracket$ã€‚

**è¯æ˜Žï¼š** é€šè¿‡å½’çº¦è§„åˆ™ï¼š

1. æ¯ä¸ªå½’çº¦è§„åˆ™ä¿æŒè¯­ä¹‰
2. é€šè¿‡ç»“æž„å½’çº³æ³•è¯æ˜Ž
3. è¯­ä¹‰å‡½æ•°æ˜¯è¿žç»­çš„

### 4.2 æ“ä½œè¯­ä¹‰

**å®šä¹‰ 4.4 (çº¿æ€§å½’çº¦)**
çº¿æ€§å½’çº¦è§„åˆ™ï¼š
$$(\lambda x.M) N \rightarrow M[N/x]$$

$$\text{let } x \otimes y = M \otimes N \text{ in } P \rightarrow P[M/x, N/y]$$

**å®šä¹‰ 4.5 (çº¿æ€§æ±‚å€¼)**
çº¿æ€§æ±‚å€¼å…³ç³» $\Downarrow$ï¼š
$$M \Downarrow V$$

**å®šç† 4.2 (çº¿æ€§è¯­ä¹‰ç­‰ä»·æ€§)**
çº¿æ€§å½’çº¦å’Œçº¿æ€§æ±‚å€¼ç­‰ä»·ï¼š
$$M \Downarrow V \text{ å½“ä¸”ä»…å½“ } M \rightarrow^* V$$

**è¯æ˜Žï¼š** é€šè¿‡åŒå‘å½’çº³ï¼š

1. æ±‚å€¼è•´å«å½’çº¦ï¼šé€šè¿‡æ±‚å€¼è§„åˆ™
2. å½’çº¦è•´å«æ±‚å€¼ï¼šé€šè¿‡å½’çº¦åºåˆ—

## 5 çº¿æ€§ç±»åž‹ç³»ç»Ÿçš„æ‰©å±•

### 5.1 ä»¿å°„ç±»åž‹

**å®šä¹‰ 5.1 (ä»¿å°„ç±»åž‹)**
ä»¿å°„ç±»åž‹å…è®¸å˜é‡æœ€å¤šä½¿ç”¨ä¸€æ¬¡ï¼š
$$\tau ::= \text{Base} \mid \tau_1 \rightarrow \tau_2 \mid \tau_1 \& \tau_2$$

**å®šä¹‰ 5.2 (ä»¿å°„å¼±åŒ–)**
ä»¿å°„å¼±åŒ–è§„åˆ™ï¼š
$$\frac{\Gamma \vdash M : A}{\Gamma, x : B \vdash M : A}$$

**å®šç† 5.1 (ä»¿å°„æ€§ä¿æŒ)**
åœ¨ä»¿å°„ç±»åž‹ç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªå˜é‡æœ€å¤šä½¿ç”¨ä¸€æ¬¡ã€‚

**è¯æ˜Žï¼š** é€šè¿‡ç»“æž„å½’çº³æ³•ï¼š

1. å˜é‡ï¼šç›´æŽ¥æ»¡è¶³
2. æŠ½è±¡ï¼šé€šè¿‡å½’çº³å‡è®¾
3. åº”ç”¨ï¼šé€šè¿‡ä¸Šä¸‹æ–‡åˆ†ç¦»
4. å¼±åŒ–ï¼šå…è®¸å˜é‡ä¸ä½¿ç”¨

### 5.2 ç›¸å…³ç±»åž‹

**å®šä¹‰ 5.3 (ç›¸å…³ç±»åž‹)**
ç›¸å…³ç±»åž‹è¦æ±‚å˜é‡è‡³å°‘ä½¿ç”¨ä¸€æ¬¡ï¼š
$$\tau ::= \text{Base} \mid \tau_1 \rightarrow \tau_2 \mid \tau_1 \oplus \tau_2$$

**å®šä¹‰ 5.4 (ç›¸å…³æ”¶ç¼©)**
ç›¸å…³æ”¶ç¼©è§„åˆ™ï¼š
$$\frac{\Gamma, x : A, y : A \vdash M : B}{\Gamma, z : A \vdash M[z/x, z/y] : B}$$

**å®šç† 5.2 (ç›¸å…³æ€§ä¿æŒ)**
åœ¨ç›¸å…³ç±»åž‹ç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªå˜é‡è‡³å°‘ä½¿ç”¨ä¸€æ¬¡ã€‚

**è¯æ˜Žï¼š** é€šè¿‡ç»“æž„å½’çº³æ³•ï¼š

1. å˜é‡ï¼šç›´æŽ¥æ»¡è¶³
2. æŠ½è±¡ï¼šé€šè¿‡å½’çº³å‡è®¾
3. åº”ç”¨ï¼šé€šè¿‡ä¸Šä¸‹æ–‡åˆ†ç¦»
4. æ”¶ç¼©ï¼šå…è®¸å˜é‡é‡å¤ä½¿ç”¨

## 6 å®žé™…åº”ç”¨

### 6.1 Rustæ‰€æœ‰æƒç³»ç»Ÿ

**å®šä¹‰ 6.1 (Rustæ‰€æœ‰æƒ)**
Rustæ‰€æœ‰æƒç³»ç»ŸåŸºäºŽçº¿æ€§ç±»åž‹ç†è®ºï¼š

```rust
fn consume_string(s: String) {
    // s è¢«æ¶ˆè´¹ï¼Œæ— æ³•å†æ¬¡ä½¿ç”¨
}

fn main() {
    let s = String::from("hello");
    consume_string(s);
    // è¿™é‡Œæ— æ³•ä½¿ç”¨ sï¼Œå› ä¸ºå®ƒå·²ç»è¢«æ¶ˆè´¹
}
```

**å®šç† 6.1 (Rustå†…å­˜å®‰å…¨)**
Rustçš„æ‰€æœ‰æƒç³»ç»Ÿä¿è¯å†…å­˜å®‰å…¨ã€‚

**è¯æ˜Žï¼š** é€šè¿‡çº¿æ€§ç±»åž‹ç³»ç»Ÿï¼š

1. æ¯ä¸ªå€¼æœ€å¤šæœ‰ä¸€ä¸ªæ‰€æœ‰è€…
2. ç§»åŠ¨æ“ä½œè½¬ç§»æ‰€æœ‰æƒ
3. å€Ÿç”¨æ£€æŸ¥é˜²æ­¢æ•°æ®ç«žäº‰

### 6.2 å‡½æ•°å¼ç¼–ç¨‹ä¸­çš„çº¿æ€§ç±»åž‹

-**å®šä¹‰ 6.2 (çº¿æ€§å‡½æ•°)**

```haskell
class Linear a where
  consume :: a -> ()
  duplicate :: a -> (a, a)  -- ä»…å¯¹éžçº¿æ€§ç±»åž‹å¯ç”¨
```

**å®šç† 6.2 (çº¿æ€§å‡½æ•°æ€§è´¨)**
çº¿æ€§å‡½æ•°æ»¡è¶³ï¼š

1. å‚æ•°æ°å¥½ä½¿ç”¨ä¸€æ¬¡
2. æ”¯æŒèµ„æºç®¡ç†
3. ä¿è¯å†…å­˜å®‰å…¨

### 6.3 å¹¶å‘ç¼–ç¨‹

**å®šä¹‰ 6.3 (çº¿æ€§å¹¶å‘)**
çº¿æ€§å¹¶å‘ç¼–ç¨‹ï¼š

```haskell
data LinearChannel a where
  NewChannel :: LinearChannel a
  Send :: LinearChannel a -> a -> ()
  Receive :: LinearChannel a -> (a, LinearChannel a)
  Close :: LinearChannel a -> ()
```

**å®šç† 6.3 (çº¿æ€§é€šé“å®‰å…¨)**
çº¿æ€§é€šé“ä¿è¯ï¼š

1. æ¶ˆæ¯ä¸ä¼šä¸¢å¤±
2. é€šé“ä¸ä¼šé‡å¤å…³é—­
3. æ— æ•°æ®ç«žäº‰

## 7 çº¿æ€§ç±»åž‹ç³»ç»Ÿçš„å…ƒç†è®º

### 7.1 å¼ºæ­£è§„åŒ–

**å®šç† 7.1 (çº¿æ€§å¼ºæ­£è§„åŒ–)**
åœ¨çº¿æ€§ç±»åž‹ç³»ç»Ÿä¸­ï¼Œæ‰€æœ‰è‰¯ç±»åž‹é¡¹éƒ½æ˜¯å¼ºæ­£è§„åŒ–çš„ã€‚

**è¯æ˜Žï¼š** é€šè¿‡é€»è¾‘å…³ç³»æ–¹æ³•ï¼š

1. å®šä¹‰ç±»åž‹ä¸Šçš„é€»è¾‘å…³ç³»
2. è¯æ˜Žæ‰€æœ‰è‰¯ç±»åž‹é¡¹åœ¨é€»è¾‘å…³ç³»ä¸­
3. é€»è¾‘å…³ç³»è•´å«å¼ºæ­£è§„åŒ–

### 7.2 ç±»åž‹æŽ¨æ–­

-**ç®—æ³• 7.1 (çº¿æ€§ç±»åž‹æŽ¨æ–­)**

```haskell
inferLinear :: Context -> Expr -> Either TypeError (Type, Context)
inferLinear ctx (Var x) = case lookup x ctx of
  Just t -> Right (t, singleton x t)
  Nothing -> Left (UnboundVariable x)

inferLinear ctx (App e1 e2) = do
  (t1, ctx1) <- inferLinear ctx e1
  (t2, ctx2) <- inferLinear ctx e2
  case t1 of
    LinearArrow t1' t2' | t1' == t2 -> Right (t2', ctx1 `union` ctx2)
    _ -> Left TypeMismatch

inferLinear ctx (Lambda x e) = do
  alpha <- freshTypeVar
  (tau, ctx') <- inferLinear (extend ctx x alpha) e
  return (LinearArrow alpha tau, remove ctx' x)
```

**å®šç† 7.2 (çº¿æ€§ç±»åž‹æŽ¨æ–­æ­£ç¡®æ€§)**
å¦‚æžœçº¿æ€§ç±»åž‹æŽ¨æ–­æˆåŠŸï¼Œåˆ™è¿”å›žçš„ç±»åž‹æ˜¯æ­£ç¡®çš„ã€‚

**è¯æ˜Žï¼š** é€šè¿‡å½’çº³æ³•ï¼š

1. åŸºç¡€æƒ…å†µï¼šå˜é‡
2. å½’çº³æƒ…å†µï¼šåº”ç”¨å’ŒæŠ½è±¡
3. ä¸Šä¸‹æ–‡åˆ†ç¦»ä¿è¯çº¿æ€§æ€§

### 7.3 ç±»åž‹æ£€æŸ¥

-**ç®—æ³• 7.2 (çº¿æ€§ç±»åž‹æ£€æŸ¥)**

```haskell
checkLinear :: Context -> Expr -> Type -> Either TypeError Context
checkLinear ctx (Var x) t = 
  case lookup x ctx of
    Just t' | t == t' -> Right (singleton x t)
    _ -> Left TypeMismatch

checkLinear ctx (App e1 e2) t = do
  alpha <- freshTypeVar
  ctx1 <- checkLinear ctx e1 (LinearArrow alpha t)
  ctx2 <- checkLinear ctx e2 alpha
  return (ctx1 `union` ctx2)

checkLinear ctx (Lambda x e) (LinearArrow t1 t2) = do
  ctx' <- checkLinear (extend ctx x t1) e t2
  return (remove ctx' x)
```

**å®šç† 7.3 (çº¿æ€§ç±»åž‹æ£€æŸ¥å®Œå¤‡æ€§)**
å¦‚æžœè¡¨è¾¾å¼æœ‰ç±»åž‹ï¼Œåˆ™ç±»åž‹æ£€æŸ¥ç®—æ³•èƒ½æ‰¾åˆ°ç±»åž‹ã€‚

**è¯æ˜Žï¼š** é€šè¿‡ç®—æ³•è®¾è®¡ï¼š

1. ç®—æ³•ç”Ÿæˆæ‰€æœ‰å¿…è¦çº¦æŸ
2. çº¦æŸæ±‚è§£æ‰¾åˆ°ç±»åž‹
3. ç±»åž‹æ»¡è¶³çº¿æ€§æ€§è¦æ±‚

## 8 ç»“è®º

é«˜çº§çº¿æ€§ç±»åž‹ç†è®ºä¸ºèµ„æºç®¡ç†å’Œå†…å­˜å®‰å…¨æä¾›äº†å¼ºå¤§çš„å½¢å¼åŒ–åŸºç¡€ï¼š

1. **ç²¾ç¡®çš„èµ„æºç®¡ç†**ï¼šç¡®ä¿æ¯ä¸ªèµ„æºæ°å¥½ä½¿ç”¨ä¸€æ¬¡
2. **å†…å­˜å®‰å…¨ä¿è¯**ï¼šé˜²æ­¢æ‚¬ç©ºæŒ‡é’ˆå’Œé‡å¤é‡Šæ”¾
3. **å¹¶å‘å®‰å…¨**ï¼šé€šè¿‡çº¿æ€§æ€§é˜²æ­¢æ•°æ®ç«žäº‰
4. **ç±»åž‹å®‰å…¨**ï¼šåœ¨ç¼–è¯‘æ—¶æ•èŽ·èµ„æºç®¡ç†é”™è¯¯

çº¿æ€§ç±»åž‹ç†è®ºåœ¨çŽ°ä»£ç¼–ç¨‹è¯­è¨€è®¾è®¡ä¸­å‘æŒ¥ç€å…³é”®ä½œç”¨ï¼Œç‰¹åˆ«æ˜¯åœ¨ç³»ç»Ÿç¼–ç¨‹å’Œå¹¶å‘ç¼–ç¨‹é¢†åŸŸã€‚é€šè¿‡å½¢å¼åŒ–çš„ç±»åž‹ç³»ç»Ÿï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç¼–è¯‘æ—¶ä¿è¯ç¨‹åºçš„èµ„æºå®‰å…¨æ€§å’Œå†…å­˜å®‰å…¨æ€§ã€‚
