# Petriç½‘ç†è®º (Petri Net Theory)

## ğŸ“‹ ç›®å½•

- [1 Petriç½‘åŸºç¡€](#1-petriç½‘åŸºç¡€)
  - [1.1 Petriç½‘å®šä¹‰](#11-petriç½‘å®šä¹‰)
  - [1.2 å˜è¿è§„åˆ™](#12-å˜è¿è§„åˆ™)
- [2 å¯è¾¾æ€§åˆ†æ](#2-å¯è¾¾æ€§åˆ†æ)
  - [2.1 å¯è¾¾æ€§å…³ç³»](#21-å¯è¾¾æ€§å…³ç³»)
  - [2.2 çŠ¶æ€ç©ºé—´åˆ†æ](#22-çŠ¶æ€ç©ºé—´åˆ†æ)
- [3 å¹¶å‘æ€§åˆ†æ](#3-å¹¶å‘æ€§åˆ†æ)
  - [3.1 å¹¶å‘å˜è¿](#31-å¹¶å‘å˜è¿)
  - [3.2 å†²çªåˆ†æ](#32-å†²çªåˆ†æ)
- [4 ç»“æ„æ€§è´¨](#4-ç»“æ„æ€§è´¨)
  - [4.1 æœ‰ç•Œæ€§](#41-æœ‰ç•Œæ€§)
  - [4.2 æ´»æ€§](#42-æ´»æ€§)
  - [4.3 å¯é€†æ€§](#43-å¯é€†æ€§)
- [5 é«˜çº§Petriç½‘](#5-é«˜çº§petriç½‘)
  - [5.1 æ—¶é—´Petriç½‘](#51-æ—¶é—´petriç½‘)
  - [5.2 ç€è‰²Petriç½‘](#52-ç€è‰²petriç½‘)
- [6 å®é™…åº”ç”¨](#6-å®é™…åº”ç”¨)
  - [6.1 å¹¶å‘ç³»ç»Ÿå»ºæ¨¡](#61-å¹¶å‘ç³»ç»Ÿå»ºæ¨¡)
  - [6.2 å·¥ä½œæµå»ºæ¨¡](#62-å·¥ä½œæµå»ºæ¨¡)
- [7 åˆ†æç®—æ³•](#7-åˆ†æç®—æ³•)
  - [7.1 ä¸å˜å¼åˆ†æ](#71-ä¸å˜å¼åˆ†æ)
  - [7.2 è¦†ç›–æ€§åˆ†æ](#72-è¦†ç›–æ€§åˆ†æ)
- [8 ç»“è®º](#8-ç»“è®º)

---

## 1 Petriç½‘åŸºç¡€

### 1.1 Petriç½‘å®šä¹‰

**å®šä¹‰ 1.1 (Petriç½‘)**
Petriç½‘æ˜¯ä¸€ä¸ªå››å…ƒç»„ $N = (P, T, F, M_0)$ï¼Œå…¶ä¸­ï¼š

- $P$ æ˜¯æœ‰é™çš„ä½ç½®é›†åˆï¼ˆplacesï¼‰
- $T$ æ˜¯æœ‰é™çš„å˜è¿é›†åˆï¼ˆtransitionsï¼‰
- $F \subseteq (P \times T) \cup (T \times P)$ æ˜¯æµå…³ç³»ï¼ˆflow relationï¼‰
- $M_0 : P \rightarrow \mathbb{N}$ æ˜¯åˆå§‹æ ‡è¯†ï¼ˆinitial markingï¼‰

**å®šä¹‰ 1.2 (æ ‡è¯†)**
æ ‡è¯† $M : P \rightarrow \mathbb{N}$ è¡¨ç¤ºæ¯ä¸ªä½ç½®ä¸­çš„æ‰˜è‚¯ï¼ˆtokenï¼‰æ•°é‡ã€‚

**å®šä¹‰ 1.3 (å‰é›†å’Œåé›†)**
å¯¹äº $x \in P \cup T$ï¼š

- $^\bullet x = \{y \mid (y, x) \in F\}$ æ˜¯ $x$ çš„å‰é›†
- $x^\bullet = \{y \mid (x, y) \in F\}$ æ˜¯ $x$ çš„åé›†

### 1.2 å˜è¿è§„åˆ™

**å®šä¹‰ 1.4 (å˜è¿ä½¿èƒ½)**
å˜è¿ $t \in T$ åœ¨æ ‡è¯† $M$ ä¸‹ä½¿èƒ½ï¼Œè®°ä½œ $M[t\rangle$ï¼Œå½“ä¸”ä»…å½“ï¼š
$$\forall p \in ^\bullet t : M(p) \geq F(p, t)$$

**å®šä¹‰ 1.5 (å˜è¿å‘ç”Ÿ)**
å¦‚æœ $M[t\rangle$ï¼Œåˆ™å˜è¿ $t$ å¯ä»¥å‘ç”Ÿï¼Œäº§ç”Ÿæ–°æ ‡è¯† $M'$ï¼Œè®°ä½œ $M[t\rangle M'$ï¼Œå…¶ä¸­ï¼š
$$M'(p) = M(p) - F(p, t) + F(t, p)$$

**å®šç† 1.1 (å˜è¿å‘ç”Ÿä¿æŒæ‰˜è‚¯å®ˆæ’)**
å¯¹äºä»»ä½•å˜è¿ $t$ å’Œæ ‡è¯† $M$ï¼Œå¦‚æœ $M[t\rangle M'$ï¼Œåˆ™ï¼š
$$\sum_{p \in P} M'(p) = \sum_{p \in P} M(p)$$

**è¯æ˜ï¼š** é€šè¿‡æµå…³ç³»çš„å®šä¹‰ï¼š
$$\sum_{p \in P} M'(p) = \sum_{p \in P} (M(p) - F(p, t) + F(t, p)) = \sum_{p \in P} M(p)$$

## 2 å¯è¾¾æ€§åˆ†æ

### 2.1 å¯è¾¾æ€§å…³ç³»

**å®šä¹‰ 2.1 (å¯è¾¾æ€§)**
æ ‡è¯† $M'$ ä»æ ‡è¯† $M$ å¯è¾¾ï¼Œè®°ä½œ $M \rightarrow^* M'$ï¼Œå¦‚æœå­˜åœ¨å˜è¿åºåˆ— $\sigma = t_1 t_2 \cdots t_n$ ä½¿å¾—ï¼š
$$M[t_1\rangle M_1[t_2\rangle M_2 \cdots [t_n\rangle M'$$

**å®šä¹‰ 2.2 (å¯è¾¾é›†)**
ä»æ ‡è¯† $M$ å¯è¾¾çš„æ‰€æœ‰æ ‡è¯†é›†åˆï¼š
$$R(M) = \{M' \mid M \rightarrow^* M'\}$$

**å®šç† 2.1 (å¯è¾¾æ€§ä¿æŒ)**
å¦‚æœ $M \rightarrow^* M'$ ä¸” $M'[t\rangle M''$ï¼Œåˆ™ $M \rightarrow^* M''$ã€‚

**è¯æ˜ï¼š** é€šè¿‡å¯è¾¾æ€§çš„ä¼ é€’æ€§ï¼š

1. $M \rightarrow^* M'$ å­˜åœ¨å˜è¿åºåˆ— $\sigma$
2. $M'[t\rangle M''$ è¡¨ç¤º $t$ åœ¨ $M'$ ä¸‹ä½¿èƒ½
3. å› æ­¤ $M \rightarrow^* M''$ é€šè¿‡åºåˆ— $\sigma t$

### 2.2 çŠ¶æ€ç©ºé—´åˆ†æ

**å®šä¹‰ 2.3 (çŠ¶æ€ç©ºé—´)**
Petriç½‘çš„çŠ¶æ€ç©ºé—´æ˜¯å›¾ $G = (V, E)$ï¼Œå…¶ä¸­ï¼š

- $V = R(M_0)$ æ˜¯å¯è¾¾æ ‡è¯†é›†åˆ
- $E = \{(M, M') \mid \exists t : M[t\rangle M'\}$ æ˜¯å˜è¿å…³ç³»

-**ç®—æ³• 2.1 (å¯è¾¾æ€§åˆ†æ)**

```haskell
reachabilityAnalysis :: PetriNet -> [Marking]
reachabilityAnalysis net = 
  let initial = initialMarking net
      reachable = bfs initial [initial]
  in reachable
  where
    bfs :: Marking -> [Marking] -> [Marking]
    bfs current visited = 
      let enabled = enabledTransitions net current
          newMarkings = [fireTransition net current t | t <- enabled]
          unvisited = filter (`notElem` visited) newMarkings
      in if null unvisited 
         then visited
         else bfs (head unvisited) (visited ++ unvisited)
```

## 3 å¹¶å‘æ€§åˆ†æ

### 3.1 å¹¶å‘å˜è¿

**å®šä¹‰ 3.1 (å¹¶å‘å˜è¿)**
ä¸¤ä¸ªå˜è¿ $t_1, t_2 \in T$ åœ¨æ ‡è¯† $M$ ä¸‹å¹¶å‘ï¼Œè®°ä½œ $M[t_1, t_2\rangle$ï¼Œå½“ä¸”ä»…å½“ï¼š

1. $M[t_1\rangle$ ä¸” $M[t_2\rangle$
2. $^\bullet t_1 \cap ^\bullet t_2 = \emptyset$ï¼ˆæ— å…±äº«è¾“å…¥ä½ç½®ï¼‰

**å®šç† 3.1 (å¹¶å‘äº¤æ¢æ€§)**
å¦‚æœ $M[t_1, t_2\rangle$ï¼Œåˆ™ $M[t_1\rangle M_1[t_2\rangle M'$ ä¸” $M[t_2\rangle M_2[t_1\rangle M'$ï¼Œå…¶ä¸­ $M_1 \neq M_2$ ä½† $M'$ ç›¸åŒã€‚

**è¯æ˜ï¼š** é€šè¿‡å¹¶å‘å˜è¿çš„å®šä¹‰ï¼š

1. æ— å…±äº«è¾“å…¥ä½ç½®ç¡®ä¿ç‹¬ç«‹æ€§
2. å˜è¿å‘ç”Ÿé¡ºåºä¸å½±å“æœ€ç»ˆç»“æœ
3. ä¸­é—´æ ‡è¯†å¯èƒ½ä¸åŒä½†æœ€ç»ˆæ ‡è¯†ç›¸åŒ

### 3.2 å†²çªåˆ†æ

**å®šä¹‰ 3.2 (å†²çª)**
ä¸¤ä¸ªå˜è¿ $t_1, t_2 \in T$ åœ¨æ ‡è¯† $M$ ä¸‹å†²çªï¼Œå½“ä¸”ä»…å½“ï¼š

1. $M[t_1\rangle$ ä¸” $M[t_2\rangle$
2. $^\bullet t_1 \cap ^\bullet t_2 \neq \emptyset$ï¼ˆæœ‰å…±äº«è¾“å…¥ä½ç½®ï¼‰

**å®šç† 3.2 (å†²çªè§£å†³)**
å¦‚æœ $t_1, t_2$ åœ¨ $M$ ä¸‹å†²çªï¼Œåˆ™æœ€å¤šåªèƒ½å‘ç”Ÿå…¶ä¸­ä¸€ä¸ªå˜è¿ã€‚

**è¯æ˜ï¼š** é€šè¿‡å†²çªå®šä¹‰ï¼š

1. å…±äº«è¾“å…¥ä½ç½®é™åˆ¶æ‰˜è‚¯æ•°é‡
2. ä¸€ä¸ªå˜è¿çš„å‘ç”Ÿä¼šæ¶ˆè€—å…±äº«æ‰˜è‚¯
3. å¦ä¸€ä¸ªå˜è¿å°†ä¸å†ä½¿èƒ½

## 4 ç»“æ„æ€§è´¨

### 4.1 æœ‰ç•Œæ€§

**å®šä¹‰ 4.1 (æœ‰ç•Œæ€§)**
ä½ç½® $p \in P$ æ˜¯ $k$-æœ‰ç•Œçš„ï¼Œå¦‚æœå¯¹äºæ‰€æœ‰å¯è¾¾æ ‡è¯† $M \in R(M_0)$ï¼Œéƒ½æœ‰ $M(p) \leq k$ã€‚

**å®šä¹‰ 4.2 (å®‰å…¨Petriç½‘)**
Petriç½‘æ˜¯å®‰å…¨çš„ï¼Œå¦‚æœæ‰€æœ‰ä½ç½®éƒ½æ˜¯1-æœ‰ç•Œçš„ã€‚

**å®šç† 4.1 (æœ‰ç•Œæ€§åˆ¤å®š)**
ä½ç½® $p$ æ˜¯ $k$-æœ‰ç•Œçš„å½“ä¸”ä»…å½“åœ¨çŠ¶æ€ç©ºé—´ä¸­ $M(p) \leq k$ å¯¹æ‰€æœ‰å¯è¾¾æ ‡è¯† $M$ æˆç«‹ã€‚

### 4.2 æ´»æ€§

**å®šä¹‰ 4.3 (æ´»æ€§)**
å˜è¿ $t \in T$ æ˜¯æ´»çš„ï¼Œå¦‚æœå¯¹äºæ¯ä¸ªå¯è¾¾æ ‡è¯† $M \in R(M_0)$ï¼Œéƒ½å­˜åœ¨æ ‡è¯† $M' \in R(M)$ ä½¿å¾— $M'[t\rangle$ã€‚

**å®šä¹‰ 4.4 (æ­»é”)**
æ ‡è¯† $M$ æ˜¯æ­»é”ï¼Œå¦‚æœæ²¡æœ‰å˜è¿åœ¨ $M$ ä¸‹ä½¿èƒ½ã€‚

**å®šç† 4.2 (æ´»æ€§ä¿æŒ)**
å¦‚æœæ‰€æœ‰å˜è¿éƒ½æ˜¯æ´»çš„ï¼Œåˆ™Petriç½‘ä¸ä¼šå‡ºç°æ­»é”ã€‚

**è¯æ˜ï¼š** é€šè¿‡æ´»æ€§å®šä¹‰ï¼š

1. æ¯ä¸ªå˜è¿åœ¨ä»»ä½•å¯è¾¾æ ‡è¯†åéƒ½èƒ½å†æ¬¡ä½¿èƒ½
2. ä¸å­˜åœ¨æ‰€æœ‰å˜è¿éƒ½æ— æ³•ä½¿èƒ½çš„æ ‡è¯†
3. å› æ­¤ä¸ä¼šå‡ºç°æ­»é”

### 4.3 å¯é€†æ€§

**å®šä¹‰ 4.5 (å¯é€†æ€§)**
Petriç½‘æ˜¯å¯é€†çš„ï¼Œå¦‚æœå¯¹äºæ¯ä¸ªå¯è¾¾æ ‡è¯† $M \in R(M_0)$ï¼Œéƒ½æœ‰ $M \rightarrow^* M_0$ã€‚

**å®šç† 4.3 (å¯é€†æ€§åˆ¤å®š)**
Petriç½‘æ˜¯å¯é€†çš„å½“ä¸”ä»…å½“åˆå§‹æ ‡è¯† $M_0$ åœ¨çŠ¶æ€ç©ºé—´ä¸­æ˜¯å¼ºè¿é€šçš„ã€‚

## 5 é«˜çº§Petriç½‘

### 5.1 æ—¶é—´Petriç½‘

**å®šä¹‰ 5.1 (æ—¶é—´Petriç½‘)**
æ—¶é—´Petriç½‘æ˜¯å…­å…ƒç»„ $N = (P, T, F, M_0, I, D)$ï¼Œå…¶ä¸­ï¼š

- $(P, T, F, M_0)$ æ˜¯åŸºç¡€Petriç½‘
- $I : T \rightarrow \mathbb{R}^+ \times \mathbb{R}^+$ æ˜¯æ—¶é—´é—´éš”å‡½æ•°
- $D : T \rightarrow \mathbb{R}^+$ æ˜¯æŒç»­æ—¶é—´å‡½æ•°

**å®šä¹‰ 5.2 (æ—¶é—´å˜è¿å‘ç”Ÿ)**
æ—¶é—´å˜è¿ $t$ åœ¨æ—¶é—´ $\tau$ å‘ç”Ÿï¼Œå¦‚æœï¼š

1. $M[t\rangle$
2. $\tau \in I(t)$
3. å˜è¿æŒç»­æ—¶é—´ä¸º $D(t)$

### 5.2 ç€è‰²Petriç½‘

**å®šä¹‰ 5.3 (ç€è‰²Petriç½‘)**
ç€è‰²Petriç½‘æ˜¯äº”å…ƒç»„ $N = (P, T, F, M_0, C)$ï¼Œå…¶ä¸­ï¼š

- $(P, T, F, M_0)$ æ˜¯åŸºç¡€Petriç½‘
- $C : P \cup T \rightarrow \text{Type}$ æ˜¯é¢œè‰²å‡½æ•°

**å®šä¹‰ 5.4 (ç€è‰²æ ‡è¯†)**
ç€è‰²æ ‡è¯† $M : P \rightarrow \text{Multiset}(C(p))$ è¡¨ç¤ºæ¯ä¸ªä½ç½®ä¸­çš„æœ‰è‰²æ‰˜è‚¯ã€‚

## 6 å®é™…åº”ç”¨

### 6.1 å¹¶å‘ç³»ç»Ÿå»ºæ¨¡

-**å®šä¹‰ 6.1 (ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹)**

```haskell
data ProducerConsumer = ProducerConsumer
  { buffer :: Place
  , producer :: Transition
  , consumer :: Transition
  , produce :: Arc
  , consume :: Arc
  , capacity :: Int
  }
```

**å®šç† 6.1 (ç”Ÿäº§è€…-æ¶ˆè´¹è€…å®‰å…¨)**
ç”Ÿäº§è€…-æ¶ˆè´¹è€…Petriç½‘æ˜¯å®‰å…¨çš„å½“ä¸”ä»…å½“ç¼“å†²åŒºå®¹é‡ä¸º1ã€‚

### 6.2 å·¥ä½œæµå»ºæ¨¡

-**å®šä¹‰ 6.2 (å·¥ä½œæµPetriç½‘)**

```haskell
data WorkflowNet = WorkflowNet
  { tasks :: [Place]
  , conditions :: [Place]
  , transitions :: [Transition]
  , start :: Place
  , end :: Place
  }
```

**å®šç† 6.2 (å·¥ä½œæµæ­£ç¡®æ€§)**
å·¥ä½œæµPetriç½‘æ˜¯æ­£ç¡®çš„å½“ä¸”ä»…å½“ï¼š

1. ä»å¼€å§‹ä½ç½®å¯è¾¾ç»“æŸä½ç½®
2. ç»“æŸä½ç½®å¯è¾¾å¼€å§‹ä½ç½®
3. æ²¡æœ‰æ­»é”

## 7 åˆ†æç®—æ³•

### 7.1 ä¸å˜å¼åˆ†æ

**å®šä¹‰ 7.1 (S-ä¸å˜å¼)**
å‘é‡ $x : P \rightarrow \mathbb{Z}$ æ˜¯S-ä¸å˜å¼ï¼Œå¦‚æœå¯¹äºæ‰€æœ‰æ ‡è¯† $M \in R(M_0)$ï¼š
$$\sum_{p \in P} x(p) \cdot M(p) = \sum_{p \in P} x(p) \cdot M_0(p)$$

**å®šç† 7.1 (S-ä¸å˜å¼æ€§è´¨)**
S-ä¸å˜å¼æä¾›Petriç½‘çš„ç»“æ„æ€§è´¨ï¼š

1. æ‰˜è‚¯å®ˆæ’
2. æœ‰ç•Œæ€§æ¡ä»¶
3. å¯è¾¾æ€§çº¦æŸ

### 7.2 è¦†ç›–æ€§åˆ†æ

**å®šä¹‰ 7.2 (è¦†ç›–æ€§)**
æ ‡è¯† $M'$ è¦†ç›–æ ‡è¯† $M$ï¼Œè®°ä½œ $M \leq M'$ï¼Œå¦‚æœå¯¹äºæ‰€æœ‰ä½ç½® $p \in P$ï¼Œéƒ½æœ‰ $M(p) \leq M'(p)$ã€‚

-**ç®—æ³• 7.1 (è¦†ç›–æ€§æ£€æŸ¥)**

```haskell
covers :: Marking -> Marking -> Bool
covers m1 m2 = all (\p -> m1 p <= m2 p) places

findCovering :: PetriNet -> Marking -> [Marking]
findCovering net target = 
  filter (\m -> target `covers` m) (reachabilityAnalysis net)
```

## 8 ç»“è®º

Petriç½‘ç†è®ºä¸ºå¹¶å‘ç³»ç»Ÿå»ºæ¨¡å’Œåˆ†ææä¾›äº†å¼ºå¤§çš„å½¢å¼åŒ–å·¥å…·ï¼š

1. **å¹¶å‘å»ºæ¨¡**ï¼šç²¾ç¡®æè¿°å¹¶å‘è¡Œä¸ºå’ŒåŒæ­¥
2. **çŠ¶æ€åˆ†æ**ï¼šé€šè¿‡å¯è¾¾æ€§åˆ†æéªŒè¯ç³»ç»Ÿæ€§è´¨
3. **ç»“æ„åˆ†æ**ï¼šé€šè¿‡ä¸å˜å¼åˆ†æç³»ç»Ÿç»“æ„
4. **æ—¶é—´å»ºæ¨¡**ï¼šæ”¯æŒå®æ—¶å’Œå®šæ—¶ç³»ç»Ÿåˆ†æ

Petriç½‘åœ¨è½¯ä»¶å·¥ç¨‹ã€å·¥ä½œæµç®¡ç†ã€ç¡¬ä»¶è®¾è®¡ç­‰é¢†åŸŸå‘æŒ¥ç€å…³é”®ä½œç”¨ã€‚é€šè¿‡å½¢å¼åŒ–çš„Petriç½‘æ¨¡å‹ï¼Œæˆ‘ä»¬å¯ä»¥ï¼š

- éªŒè¯å¹¶å‘ç³»ç»Ÿçš„æ­£ç¡®æ€§
- æ£€æµ‹æ­»é”å’Œæ´»é”
- åˆ†æç³»ç»Ÿæ€§èƒ½
- ä¼˜åŒ–ç³»ç»Ÿè®¾è®¡
