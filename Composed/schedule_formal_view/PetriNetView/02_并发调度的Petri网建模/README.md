# 02 并发调度的Petri网建模

> **子主题编号**: 02
> **视角**: Petri网视角
> **最后更新**: 2025-12-02
> **文档状态**: ✅ 完成

---

## 📋 目录

- [02 并发调度的Petri网建模](#02-并发调度的petri网建模)
  - [📋 目录](#-目录)
  - [1 概述](#1-概述)
    - [1.1 核心洞察](#11-核心洞察)
    - [1.2 并发调度的Petri网独特性](#12-并发调度的petri网独特性)
  - [2 并发任务的Petri网表示](#2-并发任务的petri网表示)
    - [2.1 并发定义](#21-并发定义)
    - [2.2 并发度计算](#22-并发度计算)
  - [3 同步机制的Petri网建模](#3-同步机制的petri网建模)
    - [3.1 同步模式](#31-同步模式)
    - [3.2 会合同步](#32-会合同步)
    - [3.3 广播同步](#33-广播同步)
  - [4 冲突检测与解决](#4-冲突检测与解决)
    - [4.1 冲突定义](#41-冲突定义)
    - [4.2 冲突解决策略](#42-冲突解决策略)
  - [5 并发度分析与优化](#5-并发度分析与优化)
    - [5.1 并发度分析](#51-并发度分析)
    - [5.2 并发度优化](#52-并发度优化)
  - [6 关系属性与依赖分析](#6-关系属性与依赖分析)
    - [6.1 并发、同步、冲突的关系](#61-并发同步冲突的关系)
  - [7 跨视角链接](#7-跨视角链接)
    - [7.1 Petri网视角关联](#71-petri网视角关联)
    - [7.2 调度视角关联](#72-调度视角关联)

---

## 1 概述

### 1.1 核心洞察

**Petri网视角的并发优势**：传统状态机需要显式枚举所有并发状态组合（状态空间爆炸），而Petri网通过**多个库所和变迁的自然表示**，状态空间大小从O(2^n)降低到O(n)。

### 1.2 并发调度的Petri网独特性

**独特视角**：

- **并发度** = 可同时点火的变迁数量
- **同步点** = 共享库所
- **冲突** = 竞争同一标记的变迁
- **并发执行** = 多个变迁同时点火

---

## 2 并发任务的Petri网表示

### 2.1 并发定义

**定义 2.1**（并发任务）：

```text
两个任务T₁和T₂并发，当且仅当：
  1. 它们可以同时执行
  2. 它们不共享资源（或共享资源充足）

Petri网表示：
  t₁ ||_M t₂ ⟺ M[t₁⟩ ∧ M[t₂⟩ ∧ (•t₁ ∩ •t₂ = ∅)
```

**独特视角**：

- 并发不是"可能同时"，而是"**可以同时点火**"
- 并发判定是**结构性的**，不依赖于执行历史
- 并发度是**动态的**，取决于当前标记

### 2.2 并发度计算

**定义 2.2**（并发度）：

```text
标记M下的并发度：
  Concurrency(M) = max{|S| | S ⊆ T_enabled, ∀t₁, t₂ ∈ S. t₁ ||_M t₂}

算法：
  1. 找到所有使能的变迁T_enabled
  2. 构建并发图：节点=变迁，边=并发关系
  3. 找到最大团（Clique）
  4. 返回团的大小
```

**独特视角**：

- 并发度是**可达的**，不是假设的
- 可以通过**图论算法**精确计算
- 可以用于**性能优化**和**资源规划**

---

## 3 同步机制的Petri网建模

### 3.1 同步模式

**定义 3.1**（同步）：

```text
同步通过共享库所实现：
  多个变迁等待同一库所的标记
  当标记可用时，变迁可以并发执行

形式化：
  变迁t₁和t₂在库所p上同步，当且仅当：
    p ∈ •t₁ ∩ •t₂
```

**独特视角**：

- 同步不是"消息传递"，而是"**共享状态**"
- 同步点是**显式的**（共享库所）
- 同步语义是**自然的**（标记可用性）

### 3.2 会合同步

**模式**：多个任务必须同时开始

**Petri网表示**：

```text
p_sync →[t₁, t₂, t₃]→

结构：
  •t₁ = •t₂ = •t₃ = {p_sync}

语义：
  当p_sync有标记时，t₁, t₂, t₃可以同时点火
```

**独特视角**：

- 会合就是"**所有变迁等待同一标记**"
- 会合点是**结构性的**，不是逻辑性的
- 会合语义是**自动的**，无需额外机制

### 3.3 广播同步

**模式**：一个任务产生事件，多个任务响应

**Petri网表示**：

```text
t_broadcast →[p_event]→
p_event →[t₁]→
p_event →[t₂]→
p_event →[t₃]→

结构：
  t_broadcast• = {p_event}
  •t₁ = •t₂ = •t₃ = {p_event}
```

**独特视角**：

- 广播就是"**一个变迁产生，多个变迁消费**"
- 广播语义是**自然的**（标记复制）
- 响应任务是**并发的**（如果标记足够）

---

## 4 冲突检测与解决

### 4.1 冲突定义

**定义 4.1**（冲突）：

```text
两个变迁t₁和t₂在标记M下冲突，当且仅当：
  1. M[t₁⟩ 且 M[t₂⟩（都使能）
  2. •t₁ ∩ •t₂ ≠ ∅（共享输入库所）
  3. ∃p ∈ •t₁ ∩ •t₂. M(p) < W(p, t₁) + W(p, t₂)（标记不足）

形式化：
  t₁ #_M t₂ ⟺ M[t₁⟩ ∧ M[t₂⟩ ∧ (•t₁ ∩ •t₂ ≠ ∅) ∧
              (∃p ∈ •t₁ ∩ •t₂. M(p) < W(p, t₁) + W(p, t₂))
```

**独特视角**：

- 冲突是**自动检测的**，无需额外算法
- 冲突是**结构性的**，不依赖于执行历史
- 冲突是**局部的**，只涉及共享库所

### 4.2 冲突解决策略

**策略1：非确定性选择**

```text
随机选择一个变迁执行

Petri网语义：
  非确定性Petri网，冲突自动解决
```

**策略2：优先级选择**

```text
根据优先级选择变迁

Petri网表示（着色Petri网）：
  守卫函数：G(t_high) = priority(t_high) > priority(t_low)
```

**策略3：公平选择**

```text
公平地选择变迁，避免饥饿

Petri网表示：
  使用公平性约束：AG F (t点火)
```

**独特视角**：

- 冲突解决是**调度决策的核心**
- 不同策略对应**不同的Petri网扩展**
- 策略选择影响**系统性能**和**公平性**

---

## 5 并发度分析与优化

### 5.1 并发度分析

**定义 5.1**（并发度分析）：

```text
分析调度系统的并发度：

1. 计算每个可达标记的并发度
2. 找到最大并发度
3. 识别并发瓶颈
4. 提出优化建议
```

**独特视角**：

- 并发度是**可计算的**，不是估计的
- 并发瓶颈是**结构性的**，可以识别
- 优化建议是**基于分析的**，不是经验的

### 5.2 并发度优化

**优化策略**：

```text
1. 增加资源：
   - 增加库所标记数
   - 提高并发度上限

2. 减少依赖：
   - 减少共享库所
   - 增加并发机会

3. 重构任务：
   - 拆分大任务
   - 合并小任务
   - 平衡任务大小
```

**独特视角**：

- 优化是**结构性的**，不是参数性的
- 优化效果是**可验证的**，通过可达性分析
- 优化建议是**形式化的**，基于Petri网性质

---

## 6 关系属性与依赖分析

### 6.1 并发、同步、冲突的关系

**定理 6.1**（关系定理）：

```text
对于变迁t₁和t₂：
  1. 如果t₁ ||_M t₂，则t₁和t₂并发（无冲突）
  2. 如果t₁ #_M t₂，则t₁和t₂冲突（不能并发）
  3. 如果t₁和t₂在p上同步，则可能并发或冲突（取决于M(p))
```

**独特视角**：

- 关系是**结构性的**，不依赖于执行
- 关系是**可判定的**，通过标记检查
- 关系是**动态的**，随标记变化

---

## 7 跨视角链接

### 7.1 Petri网视角关联

- [调度系统的Petri网基础](../01_调度系统的Petri网基础/README.md) - 基础理论
- [资源调度的Petri网模型](../03_资源调度的Petri网模型/README.md) - 资源调度

### 7.2 调度视角关联

- [同步通信机制](../04_同步通信机制/) - 同步机制
- [并发系统](../../formal_lang_view/10_Petri网理论/10.6_Petri网与并发系统.md) - 并发系统

---

**返回**: [Petri网视角主索引](../README.md) | [调度视角主索引](../../README.md)
