# 03 资源调度的Petri网模型

> **子主题编号**: 03
> **视角**: Petri网视角
> **最后更新**: 2025-12-02
> **文档状态**: ✅ 完成

---

## 📋 目录

- [03 资源调度的Petri网模型](#03-资源调度的petri网模型)
  - [📋 目录](#-目录)
  - [1 概述](#1-概述)
    - [1.1 核心洞察](#11-核心洞察)
    - [1.2 独特视角](#12-独特视角)
  - [2 资源的Petri网表示](#2-资源的petri网表示)
    - [2.1 基本资源表示](#21-基本资源表示)
    - [2.2 资源类型表示](#22-资源类型表示)
  - [3 资源分配与释放的Petri网建模](#3-资源分配与释放的petri网建模)
    - [3.1 资源分配](#31-资源分配)
    - [3.2 资源释放](#32-资源释放)
    - [3.3 资源转移](#33-资源转移)
  - [4 资源竞争的Petri网分析](#4-资源竞争的petri网分析)
    - [4.1 竞争定义](#41-竞争定义)
    - [4.2 竞争分析](#42-竞争分析)
  - [5 死锁预防的Petri网方法](#5-死锁预防的petri网方法)
    - [5.1 死锁定义](#51-死锁定义)
    - [5.2 死锁预防策略](#52-死锁预防策略)
  - [6 关系属性与依赖分析](#6-关系属性与依赖分析)
    - [6.1 资源与任务的关系](#61-资源与任务的关系)
    - [6.2 资源竞争与死锁的关系](#62-资源竞争与死锁的关系)
  - [7 跨视角链接](#7-跨视角链接)
    - [7.1 Petri网视角关联](#71-petri网视角关联)
    - [7.2 调度视角关联](#72-调度视角关联)

---

## 1 概述

### 1.1 核心洞察

**Petri网视角的资源调度独特性**：资源不是抽象概念，而是**库所中的具体标记**。资源分配就是**标记的消耗**，资源释放就是**标记的产生**。这种表示使得资源调度问题变得**直观且可分析**。

### 1.2 独特视角

**资源 = 标记**：

- 资源数量 = 标记数量
- 资源类型 = 库所类型（着色Petri网中为颜色）
- 资源状态 = 标记分布

**资源操作 = 变迁操作**：

- 资源分配 = 变迁消耗标记
- 资源释放 = 变迁产生标记
- 资源转移 = 标记流动

---

## 2 资源的Petri网表示

### 2.1 基本资源表示

**定义 2.1**（资源-库所映射）：

```text
资源R = (id, capacity, type)映射到库所p_R：

  标记数：M(p_R) = available_amount(R)
  容量：capacity(p_R) = capacity
  类型：type(p_R) = type（着色Petri网中为颜色）
```

**独特视角**：

- 资源不是"抽象实体"，而是"**具体标记**"
- 资源状态变化就是"**标记数量变化**"
- 资源约束就是"**标记数量约束**"

### 2.2 资源类型表示

**着色Petri网中的资源类型**：

```text
资源类型映射到颜色：

  CPU资源 → color_CPU
  内存资源 → color_Memory
  网络资源 → color_Network

库所颜色：W(p_resource) = color_type
标记颜色：M(p_resource) ∈ Bag(color_type)
```

**独特视角**：

- 资源类型是"**结构性的**"，不是逻辑性的
- 类型检查是"**自动的**"，通过颜色系统
- 类型安全是"**可验证的**"，通过Petri网性质

---

## 3 资源分配与释放的Petri网建模

### 3.1 资源分配

**定义 3.1**（资源分配）：

```text
任务T分配资源R，映射到变迁t：

  输入：•t = {p_R}
  权重：W(p_R, t) = amount_required(T, R)

语义：
  变迁t点火消耗p_R中的标记
  消耗数量 = W(p_R, t)
```

**独特视角**：

- 资源分配是"**原子操作**"（变迁点火）
- 分配数量是"**精确的**"（权重函数）
- 分配约束是"**自动检查的**"（使能条件）

### 3.2 资源释放

**定义 3.2**（资源释放）：

```text
任务T释放资源R，映射到变迁t：

  输出：t• = {p_R}
  权重：W(t, p_R) = amount_released(T, R)

语义：
  变迁t点火产生p_R中的标记
  产生数量 = W(t, p_R)
```

**独特视角**：

- 资源释放是"**自动的**"（变迁点火后）
- 释放数量是"**确定的**"（权重函数）
- 释放时机是"**结构性的**"（变迁位置）

### 3.3 资源转移

**定义 3.3**（资源转移）：

```text
资源从R₁转移到R₂，映射到变迁t：

  输入：•t = {p_R₁}
  输出：t• = {p_R₂}

语义：
  变迁t点火消耗p_R₁的标记，产生p_R₂的标记
```

**独特视角**：

- 资源转移是"**标记流动**"
- 转移路径是"**显式的**"（弧连接）
- 转移数量是"**守恒的**"（如果权重相同）

---

## 4 资源竞争的Petri网分析

### 4.1 竞争定义

**定义 4.1**（资源竞争）：

```text
多个任务竞争同一资源R，映射到Petri网：

  p_R →[t₁]→
  p_R →[t₂]→
  p_R →[t₃]→

竞争条件：
  M(p_R) < W(p_R, t₁) + W(p_R, t₂) + W(p_R, t₃)
```

**独特视角**：

- 竞争是"**自动显现的**"（共享库所）
- 竞争程度是"**可量化的**"（标记不足程度）
- 竞争解决是"**调度决策**"（变迁选择）

### 4.2 竞争分析

**竞争度计算**：

```text
资源p的竞争度：
  Competition(p, M) = |{t | t ∈ T_enabled, p ∈ •t, M(p) < W(p, t)}|

即：需要资源p但资源不足的变迁数量
```

**独特视角**：

- 竞争度是"**可计算的**"
- 竞争瓶颈是"**可识别的**"（高竞争度资源）
- 竞争优化是"**可指导的**"（增加资源或减少需求）

---

## 5 死锁预防的Petri网方法

### 5.1 死锁定义

**定义 5.1**（死锁）：

```text
调度系统在标记M下死锁，当且仅当：
  1. M ≠ M_final（未达到最终状态）
  2. 不存在使能的变迁（无法继续）

Petri网表示：
  Deadlock(N, M) ⟺ (M ≠ M_final) ∧ (∀t ∈ T. ¬M[t⟩)
```

**独特视角**：

- 死锁是"**自动检测的**"（无使能变迁）
- 死锁原因是"**可分析的**"（资源竞争）
- 死锁预防是"**结构性的**"（资源排序）

### 5.2 死锁预防策略

**策略1：资源排序**

```text
对所有资源排序，按顺序请求资源

Petri网表示：
  如果资源R₁ < R₂，则：
    任务请求R₁的变迁必须在请求R₂的变迁之前
```

**策略2：超时机制**

```text
资源请求设置超时，超时后释放资源

时间Petri网表示：
  变迁t有超时约束：[0, timeout]
  超时后强制释放资源
```

**策略3：死锁检测与恢复**

```text
定期检测死锁，检测到后回滚

Petri网表示：
  1. 构造可达图
  2. 检测死锁标记
  3. 回滚到安全标记
```

**独特视角**：

- 预防策略是"**可形式化的**"
- 策略效果是"**可验证的**"（可达性分析）
- 策略选择是"**基于分析的**"

---

## 6 关系属性与依赖分析

### 6.1 资源与任务的关系

**定理 6.1**（资源-任务关系）：

```text
资源R和任务T的关系：

1. 如果T需要R，则存在从p_R到t_T的弧
2. 如果T释放R，则存在从t_T到p_R的弧
3. 如果T₁和T₂都需要R，则它们竞争R
```

### 6.2 资源竞争与死锁的关系

**定理 6.2**（竞争-死锁关系）：

```text
资源竞争可能导致死锁：

1. 如果存在循环等待，则可能死锁
2. 如果资源不足，则可能死锁
3. 如果调度不当，则可能死锁
```

---

## 7 跨视角链接

### 7.1 Petri网视角关联

- [并发调度的Petri网建模](../02_并发调度的Petri网建模/README.md) - 并发建模
- [工作流调度的Petri网分析](../04_工作流调度的Petri网分析/README.md) - 工作流分析

### 7.2 调度视角关联

- [资源管理](../07_性能优化与安全/) - 资源管理
- [死锁检测](../../formal_lang_view/10_Petri网理论/10.4_Petri网分析方法.md) - 死锁检测方法

---

**返回**: [Petri网视角主索引](../README.md) | [调度视角主索引](../../README.md)
