# 6.3 ç¼–ç¨‹è¯­è¨€å±‚è°ƒåº¦

> **ä¸»é¢˜**: 06. è°ƒåº¦æ¨¡å‹ - 6.3 ç¼–ç¨‹è¯­è¨€å±‚è°ƒåº¦
> **è¦†ç›–**: Goã€Rustã€Javaè°ƒåº¦å™¨å¯¹æ¯”

---

## ğŸ“‹ ç›®å½•

- [6.3 ç¼–ç¨‹è¯­è¨€å±‚è°ƒåº¦](#63-ç¼–ç¨‹è¯­è¨€å±‚è°ƒåº¦)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [1 Go Goroutineè°ƒåº¦å™¨](#1-go-goroutineè°ƒåº¦å™¨)
    - [1.1 GMPæ¨¡å‹](#11-gmpæ¨¡å‹)
    - [1.2 æ€§èƒ½ç‰¹å¾](#12-æ€§èƒ½ç‰¹å¾)
  - [2 Rust Asyncè°ƒåº¦](#2-rust-asyncè°ƒåº¦)
    - [2.1 Future/Pollæ¨¡å‹](#21-futurepollæ¨¡å‹)
    - [2.2 æ€§èƒ½ç‰¹å¾](#22-æ€§èƒ½ç‰¹å¾)
  - [3 Java ForkJoin](#3-java-forkjoin)
    - [3.1 å·¥ä½œçªƒå–ç®—æ³•](#31-å·¥ä½œçªƒå–ç®—æ³•)
    - [3.2 æ€§èƒ½ç‰¹å¾](#32-æ€§èƒ½ç‰¹å¾)
  - [4 å®è·µæ¡ˆä¾‹](#4-å®è·µæ¡ˆä¾‹)
    - [4.1 Goé«˜å¹¶å‘WebæœåŠ¡å™¨](#41-goé«˜å¹¶å‘webæœåŠ¡å™¨)
    - [4.2 Rustå¼‚æ­¥ç½‘ç»œæ¡†æ¶](#42-rustå¼‚æ­¥ç½‘ç»œæ¡†æ¶)
    - [4.3 Javaå¹¶è¡Œè®¡ç®—æ¡†æ¶](#43-javaå¹¶è¡Œè®¡ç®—æ¡†æ¶)
  - [5 è°ƒåº¦å™¨å¯¹æ¯”](#5-è°ƒåº¦å™¨å¯¹æ¯”)
  - [6 è·¨é¢†åŸŸæ´å¯Ÿ](#6-è·¨é¢†åŸŸæ´å¯Ÿ)
    - [6.1 è¯­è¨€å±‚è°ƒåº¦çš„æŠ½è±¡å±‚çº§](#61-è¯­è¨€å±‚è°ƒåº¦çš„æŠ½è±¡å±‚çº§)
    - [6.2 è°ƒåº¦å¼€é”€çš„å±‚çº§æ€§](#62-è°ƒåº¦å¼€é”€çš„å±‚çº§æ€§)
    - [6.3 è°ƒåº¦ç­–ç•¥çš„æ¼”è¿›](#63-è°ƒåº¦ç­–ç•¥çš„æ¼”è¿›)
    - [6.4 è¯­è¨€å±‚è°ƒåº¦ä¸æ€§èƒ½ä¼˜åŒ–](#64-è¯­è¨€å±‚è°ƒåº¦ä¸æ€§èƒ½ä¼˜åŒ–)
  - [7 æ‰¹åˆ¤æ€§æ€»ç»“](#7-æ‰¹åˆ¤æ€§æ€»ç»“)
    - [7.1 è¯­è¨€å±‚è°ƒåº¦çš„å±€é™æ€§](#71-è¯­è¨€å±‚è°ƒåº¦çš„å±€é™æ€§)
    - [7.2 2025å¹´è¯­è¨€å±‚è°ƒåº¦è¶‹åŠ¿](#72-2025å¹´è¯­è¨€å±‚è°ƒåº¦è¶‹åŠ¿)
  - [8 å¤šç»´åº¦å¯¹æ¯”](#8-å¤šç»´åº¦å¯¹æ¯”)
    - [8.1 è¯­è¨€è°ƒåº¦æ¨¡å‹å¯¹æ¯”ï¼ˆ2025å¹´ï¼‰](#81-è¯­è¨€è°ƒåº¦æ¨¡å‹å¯¹æ¯”2025å¹´)
    - [8.2 è°ƒåº¦ç­–ç•¥æ¼”è¿›å¯¹æ¯”](#82-è°ƒåº¦ç­–ç•¥æ¼”è¿›å¯¹æ¯”)
    - [8.3 è°ƒåº¦å¼€é”€å¯¹æ¯”](#83-è°ƒåº¦å¼€é”€å¯¹æ¯”)
    - [8.4 é€‚ç”¨åœºæ™¯å¯¹æ¯”](#84-é€‚ç”¨åœºæ™¯å¯¹æ¯”)
  - [9 ç›¸å…³ä¸»é¢˜](#9-ç›¸å…³ä¸»é¢˜)

---

## 1 Go Goroutineè°ƒåº¦å™¨

### 1.1 GMPæ¨¡å‹

**æ¡ˆä¾‹6.3.1ï¼ˆGo Goroutineè°ƒåº¦å™¨ï¼‰**ï¼š

Goè¯­è¨€ä½¿ç”¨GMPæ¨¡å‹å®ç°é«˜æ•ˆçš„åç¨‹è°ƒåº¦ï¼Œé€šè¿‡ç”¨æˆ·æ€è°ƒåº¦é¿å…äº†OSçº¿ç¨‹çš„å¼€é”€ã€‚

**GMPæ¨¡å‹ç»„ä»¶**ï¼š

**Gï¼ˆGoroutineï¼‰**ï¼šè½»é‡çº§åç¨‹

- **æ ˆå¤§å°**ï¼šåˆå§‹2KBï¼Œå¯åŠ¨æ€å¢é•¿åˆ°1GB
- **çŠ¶æ€**ï¼šè¿è¡Œä¸­ã€å¯è¿è¡Œã€é˜»å¡ã€æ­»äº¡
- **è°ƒåº¦ä¿¡æ¯**ï¼šåŒ…å«è°ƒåº¦å™¨éœ€è¦çš„æ‰€æœ‰ä¿¡æ¯

**Mï¼ˆMachineï¼‰**ï¼šOSçº¿ç¨‹

- **æ˜ å°„å…³ç³»**ï¼šMç»‘å®šåˆ°OSçº¿ç¨‹
- **æ•°é‡é™åˆ¶**ï¼šé»˜è®¤æœ€å¤§10000ä¸ªM
- **èŒè´£**ï¼šæ‰§è¡ŒGoroutine

**Pï¼ˆProcessorï¼‰**ï¼šé€»è¾‘å¤„ç†å™¨

- **æ•°é‡**ï¼šç­‰äºGOMAXPROCSï¼ˆé»˜è®¤CPUæ ¸å¿ƒæ•°ï¼‰
- **èŒè´£**ï¼šç®¡ç†Goroutineé˜Ÿåˆ—
- **æœ¬åœ°é˜Ÿåˆ—**ï¼šæ¯ä¸ªPç»´æŠ¤ä¸€ä¸ªæœ¬åœ°è¿è¡Œé˜Ÿåˆ—ï¼ˆæœ€å¤š256ä¸ªGï¼‰

**GMPæ¨¡å‹å…³ç³»**ï¼š

```text
G (Goroutine) â†â†’ P (Processor) â†â†’ M (Machine) â†â†’ OS Thread
     â†‘              â†‘                â†‘
   è½»é‡çº§         é€»è¾‘å¤„ç†å™¨        OSçº¿ç¨‹
```

**è°ƒåº¦ç­–ç•¥**ï¼š

**1. M:Næ¨¡å‹**ï¼š

Mä¸ªGoroutineæ˜ å°„åˆ°Nä¸ªOSçº¿ç¨‹ï¼ˆé€šå¸¸N = CPUæ ¸å¿ƒæ•°ï¼‰ï¼š

```go
// Goè¿è¡Œæ—¶è°ƒåº¦å™¨ä¼ªä»£ç 
type scheduler struct {
    // Pçš„æ•°é‡ï¼ˆç­‰äºGOMAXPROCSï¼‰
    numP int

    // æ¯ä¸ªPçš„æœ¬åœ°é˜Ÿåˆ—
    runq [numP][]*goroutine

    // å…¨å±€é˜Ÿåˆ—
    globalRunq []*goroutine
}
```

**2. å·¥ä½œçªƒå–ï¼ˆWork Stealingï¼‰**ï¼š

å½“Pçš„æœ¬åœ°é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œä»å…¶ä»–Pçš„é˜Ÿåˆ—çªƒå–Goroutineï¼š

```go
func (p *processor) steal() *goroutine {
    // éšæœºé€‰æ‹©å…¶ä»–P
    targetP := randomSelect(otherProcessors)

    // ä»ç›®æ ‡Pçš„é˜Ÿåˆ—å°¾éƒ¨çªƒå–
    if len(targetP.runq) > 0 {
        return targetP.runq.popBack()
    }

    return nil
}
```

**3. æŠ¢å å¼è°ƒåº¦**ï¼š

Go 1.14å¼•å…¥åŸºäºä¿¡å·çš„æŠ¢å å¼è°ƒåº¦ï¼š

- **æŠ¢å æ—¶æœº**ï¼šGoroutineè¿è¡Œè¶…è¿‡10ms
- **æŠ¢å æ–¹å¼**ï¼šå‘é€SIGURGä¿¡å·
- **æŠ¢å ç›®çš„**ï¼šé˜²æ­¢é•¿æ—¶é—´è¿è¡Œçš„Goroutineé˜»å¡è°ƒåº¦

**è°ƒåº¦ç®—æ³•**ï¼š

```go
func schedule() {
    // 1. ä»æœ¬åœ°é˜Ÿåˆ—è·å–Goroutine
    if g := getLocalGoroutine(); g != nil {
        execute(g)
        return
    }

    // 2. ä»å…¨å±€é˜Ÿåˆ—è·å–Goroutine
    if g := getGlobalGoroutine(); g != nil {
        execute(g)
        return
    }

    // 3. å·¥ä½œçªƒå–
    if g := stealGoroutine(); g != nil {
        execute(g)
        return
    }

    // 4. é˜»å¡ç­‰å¾…
    waitForGoroutine()
}
```

### 1.2 æ€§èƒ½ç‰¹å¾

**ä¼˜åŠ¿**ï¼š

- åˆ›å»ºå¼€é”€ï¼š~1Î¼s
- ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼š~100ns
- å†…å­˜å ç”¨ï¼š2KB/goroutine

**æ·±åº¦è®ºè¯ï¼šGoroutineçš„è½»é‡çº§ä¼˜åŠ¿**

**Goroutineçš„åˆ›å»ºå¼€é”€**ï¼š

Goroutineåªéœ€è¦**åˆ†é…æ ˆç©ºé—´**ï¼Œæ— éœ€ç³»ç»Ÿè°ƒç”¨ï¼š

$$
\text{Goroutineåˆ›å»ºå¼€é”€} = t_{\text{æ ˆåˆ†é…}} + t_{\text{åˆå§‹åŒ–}} \approx 1\mu\text{s}
$$

è€ŒOSçº¿ç¨‹åˆ›å»ºéœ€è¦**ç³»ç»Ÿè°ƒç”¨**ï¼š

$$
\text{çº¿ç¨‹åˆ›å»ºå¼€é”€} = t_{\text{ç³»ç»Ÿè°ƒç”¨}} + t_{\text{å†…æ ¸åˆ†é…}} \approx 10\mu\text{s}
$$

**é‡åŒ–å¯¹æ¯”**ï¼šGoroutine vs OSçº¿ç¨‹

| **ç‰¹æ€§** | **Goroutine** | **OSçº¿ç¨‹** | **Goroutineä¼˜åŠ¿** |
|---------|-------------|-----------|-----------------|
| **åˆ›å»ºå¼€é”€** | 1Î¼s | 10Î¼s | 10x |
| **ä¸Šä¸‹æ–‡åˆ‡æ¢** | 100ns | 1Î¼s | 10x |
| **å†…å­˜å ç”¨** | 2KB | 2MB | 1000x |

**å…³é”®æ´å¯Ÿ**ï¼šGoroutineé€šè¿‡**ç”¨æˆ·æ€è°ƒåº¦**å®ç°äº†**10å€**çš„æ€§èƒ½ä¼˜åŠ¿ã€‚

**é™åˆ¶**ï¼š

- æ— ä¼˜å…ˆçº§
- å…¬å¹³è°ƒåº¦
- ä¸é€‚åˆå®æ—¶åº”ç”¨

---

## 2 Rust Asyncè°ƒåº¦

### 2.1 Future/Pollæ¨¡å‹

**æ¡ˆä¾‹6.3.2ï¼ˆRust Asyncè°ƒåº¦ï¼‰**ï¼š

Rustä½¿ç”¨Future/Pollæ¨¡å‹å®ç°é›¶æˆæœ¬æŠ½è±¡çš„å¼‚æ­¥ç¼–ç¨‹ï¼Œåœ¨ç¼–è¯‘æ—¶å±•å¼€ä¸ºçŠ¶æ€æœºã€‚

**æ ¸å¿ƒæŠ½è±¡**ï¼š

**Future Trait**ï¼š

```rust
trait Future {
    type Output;

    fn poll(self: Pin<&mut Self>, cx: &mut Context<'_>) -> Poll<Self::Output>;
}

enum Poll<T> {
    Ready(T),
    Pending,
}
```

**FutureçŠ¶æ€æœº**ï¼š

ç¼–è¯‘å™¨å°†asyncå‡½æ•°å±•å¼€ä¸ºçŠ¶æ€æœºï¼š

```rust
// åŸå§‹asyncå‡½æ•°
async fn example() -> i32 {
    let x = async_op1().await;
    let y = async_op2().await;
    x + y
}

// ç¼–è¯‘åå±•å¼€ä¸ºçŠ¶æ€æœº
enum ExampleFuture {
    State0,
    State1 { x: i32 },
    State2 { x: i32, y: i32 },
}

impl Future for ExampleFuture {
    type Output = i32;

    fn poll(self: Pin<&mut Self>, cx: &mut Context) -> Poll<i32> {
        match self.get_mut() {
            ExampleFuture::State0 => {
                // è°ƒç”¨async_op1
                match async_op1().poll(cx) {
                    Poll::Ready(x) => {
                        *self = ExampleFuture::State1 { x };
                        self.poll(cx)  // ç»§ç»­æ‰§è¡Œ
                    }
                    Poll::Pending => Poll::Pending,
                }
            }
            ExampleFuture::State1 { x } => {
                // è°ƒç”¨async_op2
                match async_op2().poll(cx) {
                    Poll::Ready(y) => {
                        *self = ExampleFuture::State2 { x: *x, y };
                        self.poll(cx)  // ç»§ç»­æ‰§è¡Œ
                    }
                    Poll::Pending => Poll::Pending,
                }
            }
            ExampleFuture::State2 { x, y } => {
                Poll::Ready(*x + *y)
            }
        }
    }
}
```

**æ‰§è¡Œå™¨ï¼ˆExecutorï¼‰**ï¼š

**1. Tokio**ï¼š

```rust
// Tokioè¿è¡Œæ—¶
#[tokio::main]
async fn main() {
    // åˆ›å»ºå¼‚æ­¥ä»»åŠ¡
    let task = tokio::spawn(async {
        // å¼‚æ­¥æ“ä½œ
        async_op().await
    });

    // ç­‰å¾…ä»»åŠ¡å®Œæˆ
    let result = task.await;
}
```

**Tokioè°ƒåº¦å™¨**ï¼š

- **å¤šçº¿ç¨‹è¿è¡Œæ—¶**ï¼šä½¿ç”¨å·¥ä½œçªƒå–è°ƒåº¦å™¨
- **å•çº¿ç¨‹è¿è¡Œæ—¶**ï¼šä½¿ç”¨FIFOè°ƒåº¦å™¨
- **ä»»åŠ¡é˜Ÿåˆ—**ï¼šæ¯ä¸ªçº¿ç¨‹ç»´æŠ¤æœ¬åœ°é˜Ÿåˆ—å’Œå…¨å±€é˜Ÿåˆ—

**2. async-std**ï¼š

```rust
// async-stdè¿è¡Œæ—¶
#[async_std::main]
async fn main() {
    // æ ‡å‡†åº“é£æ ¼çš„å¼‚æ­¥API
    let result = async_std::task::spawn(async {
        async_op().await
    }).await;
}
```

**3. smol**ï¼š

```rust
// smolè½»é‡çº§è¿è¡Œæ—¶
fn main() {
    smol::block_on(async {
        let task = smol::spawn(async {
            async_op().await
        });
        task.await;
    });
}
```

### 2.2 æ€§èƒ½ç‰¹å¾

**æ¡ˆä¾‹6.3.3ï¼ˆRust Asyncæ€§èƒ½åˆ†æï¼‰**ï¼š

Rust Asyncé€šè¿‡ç¼–è¯‘æ—¶ä¼˜åŒ–å®ç°é›¶æˆæœ¬æŠ½è±¡ï¼Œæ— è¿è¡Œæ—¶å¼€é”€ã€‚

**é›¶æˆæœ¬æŠ½è±¡**ï¼š

**ç¼–è¯‘æ—¶å±•å¼€**ï¼š

Rust Asyncåœ¨ç¼–è¯‘æ—¶å±•å¼€ä¸ºçŠ¶æ€æœºï¼Œæ— è¿è¡Œæ—¶å¼€é”€ï¼š

$$
\text{Asyncå¼€é”€} = 0 \text{ï¼ˆç¼–è¯‘æ—¶ä¼˜åŒ–ï¼‰}
$$

**å†…å­˜å¸ƒå±€**ï¼š

```rust
// Futureçš„å†…å­˜å¸ƒå±€
struct FutureState {
    state: u8,        // çŠ¶æ€æœºçŠ¶æ€ï¼ˆ1å­—èŠ‚ï¼‰
    data: [u8; N],    // çŠ¶æ€æ•°æ®ï¼ˆç¼–è¯‘æ—¶ç¡®å®šï¼‰
}

// æ€»å¤§å° = 1 + N å­—èŠ‚ï¼ˆæœ€å°åŒ–ï¼‰
```

**æ€§èƒ½å¯¹æ¯”**ï¼š

| **ç‰¹æ€§** | **Rust Async** | **å›è°ƒ** | **Goroutine** | **OSçº¿ç¨‹** |
|---------|---------------|---------|-------------|-----------|
| **è¿è¡Œæ—¶å¼€é”€** | 0ns | 10ns | 100ns | 1000ns |
| **å†…å­˜å ç”¨** | æœ€å° | ä¸­ | 2KB | 2MB |
| **ç±»å‹å®‰å…¨** | æ˜¯ | å¦ | æ˜¯ | æ˜¯ |
| **ç¼–è¯‘æ—¶ä¼˜åŒ–** | æ˜¯ | å¦ | å¦ | å¦ |

**åä½œå¼è°ƒåº¦**ï¼š

**ç‰¹ç‚¹**ï¼š

- **æ˜¾å¼await**ï¼šéœ€è¦æ˜¾å¼è°ƒç”¨awaitè®©å‡ºæ§åˆ¶æƒ
- **æ— æŠ¢å **ï¼šä¸ä¼šè‡ªåŠ¨æŠ¢å é•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡
- **é€‚åˆIOå¯†é›†å‹**ï¼šIOæ“ä½œæ—¶è‡ªåŠ¨è®©å‡ºæ§åˆ¶æƒ

**è°ƒåº¦ç®—æ³•**ï¼š

```rust
fn executor_run() {
    loop {
        // 1. ä»ä»»åŠ¡é˜Ÿåˆ—è·å–ä»»åŠ¡
        if let Some(task) = task_queue.pop() {
            // 2. æ‰§è¡Œä»»åŠ¡
            match task.poll() {
                Poll::Ready(_) => {
                    // ä»»åŠ¡å®Œæˆï¼Œç§»é™¤
                }
                Poll::Pending => {
                    // ä»»åŠ¡æœªå®Œæˆï¼Œé‡æ–°åŠ å…¥é˜Ÿåˆ—
                    task_queue.push(task);
                }
            }
        } else {
            // 3. é˜Ÿåˆ—ä¸ºç©ºï¼Œç­‰å¾…æ–°ä»»åŠ¡
            wait_for_task();
        }
    }
}
```

**å…³é”®æ´å¯Ÿ**ï¼šRust Asyncé€šè¿‡**é›¶æˆæœ¬æŠ½è±¡**å’Œ**åä½œå¼è°ƒåº¦**å®ç°äº†**é«˜æ€§èƒ½**çš„å¼‚æ­¥ç¼–ç¨‹ã€‚

---

## 3 Java ForkJoin

### 3.1 å·¥ä½œçªƒå–ç®—æ³•

**æ¡ˆä¾‹6.3.4ï¼ˆJava ForkJoinè°ƒåº¦ï¼‰**ï¼š

Java ForkJoinæ¡†æ¶ä½¿ç”¨å·¥ä½œçªƒå–ç®—æ³•å®ç°é«˜æ•ˆçš„å¹¶è¡Œè®¡ç®—è°ƒåº¦ã€‚

**ForkJoinPoolæ¶æ„**ï¼š

**ç»„ä»¶**ï¼š

- **ForkJoinPool**ï¼šçº¿ç¨‹æ± ï¼Œç®¡ç†å¤šä¸ªå·¥ä½œçº¿ç¨‹
- **ForkJoinTask**ï¼šå¯åˆ†è§£çš„ä»»åŠ¡
- **å·¥ä½œé˜Ÿåˆ—**ï¼šæ¯ä¸ªçº¿ç¨‹ç»´æŠ¤ä¸€ä¸ªåŒç«¯é˜Ÿåˆ—ï¼ˆDequeï¼‰

**å·¥ä½œçªƒå–ç®—æ³•**ï¼š

**ç®—æ³•åŸç†**ï¼š

1. **ä»»åŠ¡åˆ†è§£**ï¼šå¤§ä»»åŠ¡åˆ†è§£ä¸ºå°ä»»åŠ¡
2. **æœ¬åœ°æ‰§è¡Œ**ï¼šçº¿ç¨‹ä»è‡ªå·±çš„é˜Ÿåˆ—å¤´éƒ¨å–ä»»åŠ¡æ‰§è¡Œ
3. **å·¥ä½œçªƒå–**ï¼šç©ºé—²çº¿ç¨‹ä»å…¶ä»–çº¿ç¨‹çš„é˜Ÿåˆ—å°¾éƒ¨çªƒå–ä»»åŠ¡

**ç®—æ³•å®ç°**ï¼š

```java
class ForkJoinPool {
    // å·¥ä½œçº¿ç¨‹æ•°ç»„
    private ForkJoinWorkerThread[] workers;

    // æ¯ä¸ªçº¿ç¨‹çš„å·¥ä½œé˜Ÿåˆ—
    private Deque<ForkJoinTask>[] queues;

    public <T> T invoke(ForkJoinTask<T> task) {
        // 1. æäº¤ä»»åŠ¡åˆ°å½“å‰çº¿ç¨‹çš„é˜Ÿåˆ—
        int threadId = Thread.currentThread().getId();
        queues[threadId].push(task);

        // 2. æ‰§è¡Œä»»åŠ¡
        return task.compute();
    }

    private ForkJoinTask steal(int threadId) {
        // éšæœºé€‰æ‹©å…¶ä»–çº¿ç¨‹
        int targetId = randomSelect(otherThreads);

        // ä»ç›®æ ‡çº¿ç¨‹çš„é˜Ÿåˆ—å°¾éƒ¨çªƒå–
        return queues[targetId].pollLast();
    }
}
```

**ä½¿ç”¨æ¨¡å¼**ï¼š

**é€’å½’ä»»åŠ¡**ï¼š

```java
class SumTask extends RecursiveTask<Long> {
    private int[] array;
    private int start, end;

    public SumTask(int[] array, int start, int end) {
        this.array = array;
        this.start = start;
        this.end = end;
    }

    @Override
    protected Long compute() {
        // 1. åˆ¤æ–­æ˜¯å¦éœ€è¦åˆ†è§£
        if (end - start < THRESHOLD) {
            // ç›´æ¥è®¡ç®—
            long sum = 0;
            for (int i = start; i < end; i++) {
                sum += array[i];
            }
            return sum;
        }

        // 2. åˆ†è§£ä»»åŠ¡
        int mid = (start + end) / 2;
        SumTask left = new SumTask(array, start, mid);
        SumTask right = new SumTask(array, mid, end);

        // 3. å¹¶è¡Œæ‰§è¡Œ
        left.fork();  // æäº¤åˆ°é˜Ÿåˆ—
        long rightResult = right.compute();  // ç›´æ¥è®¡ç®—
        long leftResult = left.join();  // ç­‰å¾…ç»“æœ

        return leftResult + rightResult;
    }
}

// ä½¿ç”¨
ForkJoinPool pool = new ForkJoinPool();
SumTask task = new SumTask(array, 0, array.length);
long result = pool.invoke(task);
```

### 3.2 æ€§èƒ½ç‰¹å¾

**æ¡ˆä¾‹6.3.5ï¼ˆForkJoinæ€§èƒ½åˆ†æï¼‰**ï¼š

ForkJoiné€šè¿‡å·¥ä½œçªƒå–ç®—æ³•å®ç°è‡ªåŠ¨è´Ÿè½½å‡è¡¡ï¼Œé€‚åˆå¹¶è¡Œè®¡ç®—ã€‚

**ä¼˜åŠ¿**ï¼š

**1. è‡ªåŠ¨è´Ÿè½½å‡è¡¡**ï¼š

- **å·¥ä½œçªƒå–**ï¼šç©ºé—²çº¿ç¨‹è‡ªåŠ¨ä»å¿™ç¢Œçº¿ç¨‹çªƒå–ä»»åŠ¡
- **è´Ÿè½½å‡è¡¡**ï¼šä»»åŠ¡è‡ªåŠ¨åˆ†é…åˆ°ç©ºé—²çº¿ç¨‹
- **å‡å°‘ç­‰å¾…**ï¼šå‡å°‘çº¿ç¨‹ç©ºé—²æ—¶é—´

**2. å‡å°‘çº¿ç¨‹åˆ›å»º**ï¼š

- **çº¿ç¨‹å¤ç”¨**ï¼šä½¿ç”¨å›ºå®šæ•°é‡çš„å·¥ä½œçº¿ç¨‹
- **ä»»åŠ¡é˜Ÿåˆ—**ï¼šä»»åŠ¡å­˜å‚¨åœ¨é˜Ÿåˆ—ä¸­ï¼Œæ— éœ€åˆ›å»ºæ–°çº¿ç¨‹
- **å¼€é”€ä½**ï¼šé¿å…é¢‘ç¹åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹

**3. é€‚åˆå¹¶è¡Œè®¡ç®—**ï¼š

- **åˆ†æ²»ç®—æ³•**ï¼šé€‚åˆé€’å½’åˆ†æ²»ç®—æ³•
- **CPUå¯†é›†å‹**ï¼šå……åˆ†åˆ©ç”¨å¤šæ ¸CPU
- **å¯æ‰©å±•æ€§**ï¼šè‡ªåŠ¨é€‚åº”CPUæ ¸å¿ƒæ•°

**æ€§èƒ½ç‰¹å¾**ï¼š

| **ç‰¹æ€§** | **ForkJoin** | **ThreadPool** | **ä¼˜åŠ¿** |
|---------|-------------|---------------|---------|
| **çº¿ç¨‹åˆ›å»º** | å›ºå®šæ•°é‡ | åŠ¨æ€åˆ›å»º | å‡å°‘å¼€é”€ |
| **è´Ÿè½½å‡è¡¡** | è‡ªåŠ¨ | æ‰‹åŠ¨ | æ›´é«˜æ•ˆ |
| **ä»»åŠ¡åˆ†è§£** | æ”¯æŒ | ä¸æ”¯æŒ | é€‚åˆåˆ†æ²» |
| **é€‚ç”¨åœºæ™¯** | CPUå¯†é›†å‹ | é€šç”¨ | å¹¶è¡Œè®¡ç®— |

**æ€§èƒ½æ¨¡å‹**ï¼š

**å¹¶è¡Œåº¦**ï¼š

$$
\text{å¹¶è¡Œåº¦} = \min(\text{ä»»åŠ¡æ•°}, \text{CPUæ ¸å¿ƒæ•°})
$$

**åŠ é€Ÿæ¯”**ï¼š

$$
\text{åŠ é€Ÿæ¯”} = \frac{T_{\text{ä¸²è¡Œ}}}{T_{\text{å¹¶è¡Œ}}} \approx \text{CPUæ ¸å¿ƒæ•°}
$$

**å…³é”®æ´å¯Ÿ**ï¼šForkJoiné€šè¿‡**å·¥ä½œçªƒå–**å®ç°äº†**è‡ªåŠ¨è´Ÿè½½å‡è¡¡**ï¼Œé€‚åˆ**å¹¶è¡Œè®¡ç®—**åœºæ™¯ã€‚

---

## 4 å®è·µæ¡ˆä¾‹

### 4.1 Goé«˜å¹¶å‘WebæœåŠ¡å™¨

**æ¡ˆä¾‹6.3.6ï¼ˆGoé«˜å¹¶å‘WebæœåŠ¡å™¨ï¼‰**ï¼š

æŸäº’è”ç½‘å…¬å¸ä½¿ç”¨Goæ„å»ºé«˜å¹¶å‘WebæœåŠ¡å™¨ï¼Œå¤„ç†ç™¾ä¸‡çº§å¹¶å‘è¿æ¥ã€‚

**æ¶æ„**ï¼š

```go
func main() {
    // åˆ›å»ºHTTPæœåŠ¡å™¨
    http.HandleFunc("/api", handleRequest)

    // å¯åŠ¨æœåŠ¡å™¨
    http.ListenAndServe(":8080", nil)
}

func handleRequest(w http.ResponseWriter, r *http.Request) {
    // æ¯ä¸ªè¯·æ±‚åˆ›å»ºä¸€ä¸ªGoroutine
    go processRequest(w, r)
}

func processRequest(w http.ResponseWriter, r *http.Request) {
    // å¼‚æ­¥å¤„ç†è¯·æ±‚
    result := asyncProcess(r)
    w.Write(result)
}
```

**æ€§èƒ½ç‰¹å¾**ï¼š

| **æŒ‡æ ‡** | **å€¼** |
|---------|--------|
| **å¹¶å‘è¿æ¥æ•°** | 1,000,000+ |
| **Goroutineæ•°é‡** | 1,000,000+ |
| **å†…å­˜å ç”¨** | 2GBï¼ˆ100ä¸‡Goroutineï¼‰ |
| **CPUå ç”¨** | 4æ ¸å¿ƒï¼ˆGOMAXPROCS=4ï¼‰ |
| **å“åº”æ—¶é—´** | <10ms |

**å…³é”®ä¼˜åŠ¿**ï¼š

- **è½»é‡çº§**ï¼šæ¯ä¸ªGoroutineä»…2KBå†…å­˜
- **é«˜å¹¶å‘**ï¼šæ”¯æŒç™¾ä¸‡çº§å¹¶å‘
- **ä½å»¶è¿Ÿ**ï¼šä¸Šä¸‹æ–‡åˆ‡æ¢ä»…100ns

### 4.2 Rustå¼‚æ­¥ç½‘ç»œæ¡†æ¶

**æ¡ˆä¾‹6.3.7ï¼ˆRustå¼‚æ­¥ç½‘ç»œæ¡†æ¶ï¼‰**ï¼š

ä½¿ç”¨Tokioæ„å»ºé«˜æ€§èƒ½å¼‚æ­¥ç½‘ç»œæ¡†æ¶ï¼Œå¤„ç†é«˜å¹¶å‘IOæ“ä½œã€‚

**æ¶æ„**ï¼š

```rust
#[tokio::main]
async fn main() {
    // åˆ›å»ºTCPæœåŠ¡å™¨
    let listener = TcpListener::bind("0.0.0.0:8080").await.unwrap();

    loop {
        // æ¥å—è¿æ¥
        let (stream, _) = listener.accept().await.unwrap();

        // ä¸ºæ¯ä¸ªè¿æ¥åˆ›å»ºå¼‚æ­¥ä»»åŠ¡
        tokio::spawn(async move {
            handle_connection(stream).await;
        });
    }
}

async fn handle_connection(mut stream: TcpStream) {
    // å¼‚æ­¥å¤„ç†è¿æ¥
    let mut buffer = [0; 1024];
    stream.read(&mut buffer).await.unwrap();
    stream.write(b"HTTP/1.1 200 OK\r\n\r\n").await.unwrap();
}
```

**æ€§èƒ½ç‰¹å¾**ï¼š

| **æŒ‡æ ‡** | **å€¼** |
|---------|--------|
| **å¹¶å‘è¿æ¥æ•°** | 1,000,000+ |
| **å†…å­˜å ç”¨** | <100MB |
| **CPUå ç”¨** | 2æ ¸å¿ƒ |
| **å“åº”æ—¶é—´** | <1ms |
| **ååé‡** | 10M+ req/s |

**å…³é”®ä¼˜åŠ¿**ï¼š

- **é›¶æˆæœ¬æŠ½è±¡**ï¼šç¼–è¯‘æ—¶ä¼˜åŒ–ï¼Œæ— è¿è¡Œæ—¶å¼€é”€
- **å†…å­˜å®‰å…¨**ï¼šç¼–è¯‘æœŸä¿è¯å†…å­˜å®‰å…¨
- **é«˜æ€§èƒ½**ï¼šæ¥è¿‘C++æ€§èƒ½

### 4.3 Javaå¹¶è¡Œè®¡ç®—æ¡†æ¶

**æ¡ˆä¾‹6.3.8ï¼ˆJavaå¹¶è¡Œè®¡ç®—ï¼‰**ï¼š

ä½¿ç”¨ForkJoinå®ç°å¤§è§„æ¨¡å¹¶è¡Œè®¡ç®—ï¼Œå¤„ç†TBçº§æ•°æ®ã€‚

**æ¶æ„**ï¼š

```java
class ParallelProcessor {
    public long processLargeArray(int[] array) {
        ForkJoinPool pool = new ForkJoinPool();
        ProcessTask task = new ProcessTask(array, 0, array.length);
        return pool.invoke(task);
    }
}
```

**æ€§èƒ½ç‰¹å¾**ï¼š

| **æŒ‡æ ‡** | **å€¼** |
|---------|--------|
| **æ•°æ®è§„æ¨¡** | 1TB |
| **å¹¶è¡Œåº¦** | 16ï¼ˆ16æ ¸CPUï¼‰ |
| **åŠ é€Ÿæ¯”** | 15x |
| **å¤„ç†æ—¶é—´** | 10åˆ†é’Ÿï¼ˆä¸²è¡Œ150åˆ†é’Ÿï¼‰ |

**å…³é”®ä¼˜åŠ¿**ï¼š

- **è‡ªåŠ¨è´Ÿè½½å‡è¡¡**ï¼šå·¥ä½œçªƒå–ç®—æ³•
- **é«˜å¹¶è¡Œåº¦**ï¼šå……åˆ†åˆ©ç”¨å¤šæ ¸CPU
- **æ˜“ç”¨æ€§**ï¼šç®€å•çš„API

## 5 è°ƒåº¦å™¨å¯¹æ¯”

**ç»¼åˆå¯¹æ¯”**ï¼š

| **ç‰¹æ€§** | **Go Goroutine** | **Rust Async** | **Java ForkJoin** | **OSçº¿ç¨‹** |
|---------|-----------------|---------------|------------------|-----------|
| **è°ƒåº¦æ¨¡å‹** | M:N | äº‹ä»¶é©±åŠ¨ | å·¥ä½œçªƒå– | 1:1 |
| **åˆ›å»ºå¼€é”€** | 1Î¼s | 0nsï¼ˆç¼–è¯‘æ—¶ï¼‰ | 10Î¼s | 10Î¼s |
| **ä¸Šä¸‹æ–‡åˆ‡æ¢** | 100ns | 0nsï¼ˆåä½œå¼ï¼‰ | 5Î¼s | 5Î¼s |
| **å†…å­˜å ç”¨** | 2KB | æœ€å° | 1MBï¼ˆçº¿ç¨‹ï¼‰ | 2MB |
| **æŠ¢å ** | æ˜¯ | å¦ | æ˜¯ | æ˜¯ |
| **é€‚ç”¨åœºæ™¯** | é€šç”¨å¹¶å‘ | IOå¯†é›†å‹ | CPUå¯†é›†å‹ | é€šç”¨ |
| **ç±»å‹å®‰å…¨** | æ˜¯ | æ˜¯ | æ˜¯ | å¦ |
| **ç¼–è¯‘æ—¶ä¼˜åŒ–** | å¦ | æ˜¯ | å¦ | å¦ |

**é€‰æ‹©å»ºè®®**ï¼š

- **Go Goroutine**ï¼šé€‚åˆé€šç”¨å¹¶å‘åœºæ™¯ï¼Œç®€å•æ˜“ç”¨
- **Rust Async**ï¼šé€‚åˆIOå¯†é›†å‹é«˜æ€§èƒ½åœºæ™¯
- **Java ForkJoin**ï¼šé€‚åˆCPUå¯†é›†å‹å¹¶è¡Œè®¡ç®—
- **OSçº¿ç¨‹**ï¼šé€‚åˆéœ€è¦OSçº§ç‰¹æ€§çš„åœºæ™¯

---

## 6 è·¨é¢†åŸŸæ´å¯Ÿ

### 6.1 è¯­è¨€å±‚è°ƒåº¦çš„æŠ½è±¡å±‚çº§

**æ ¸å¿ƒæ´å¯Ÿ**ï¼šè¯­è¨€å±‚è°ƒåº¦åœ¨OSè°ƒåº¦ä¹‹ä¸Šï¼Œæä¾›æ›´é«˜çº§çš„æŠ½è±¡ã€‚

**è°ƒåº¦å±‚çº§æ˜ å°„**ï¼š

```text
è¯­è¨€åç¨‹è°ƒåº¦ (Go/Rust)
  â†“ æ˜ å°„ä¸º: OSçº¿ç¨‹
OSè¿›ç¨‹è°ƒåº¦ (CFS)
  â†“ æ˜ å°„ä¸º: CPUæ—¶é—´ç‰‡
ç¡¬ä»¶æŒ‡ä»¤è°ƒåº¦ (ROB)

ä¸€è‡´æ€§æ¡ä»¶:
è¯­è¨€è°ƒåº¦å†³ç­– âˆˆ OSè°ƒåº¦å¯è¡ŒåŸŸ
```

**æŠ½è±¡å±‚çº§åˆ†æ**ï¼š

**1. è¯­è¨€å±‚æŠ½è±¡**ï¼š

- **Goroutine/Async**ï¼šç”¨æˆ·æ€åç¨‹ï¼Œè½»é‡çº§
- **è°ƒåº¦å™¨**ï¼šè¯­è¨€è¿è¡Œæ—¶å®ç°
- **æ˜ å°„**ï¼šMä¸ªåç¨‹æ˜ å°„åˆ°Nä¸ªOSçº¿ç¨‹

**2. OSå±‚æŠ½è±¡**ï¼š

- **çº¿ç¨‹**ï¼šOSçº§æ‰§è¡Œå•å…ƒ
- **è°ƒåº¦å™¨**ï¼šOSå†…æ ¸å®ç°ï¼ˆå¦‚CFSï¼‰
- **æ˜ å°„**ï¼šNä¸ªçº¿ç¨‹æ˜ å°„åˆ°CPUæ ¸å¿ƒ

**3. ç¡¬ä»¶å±‚æŠ½è±¡**ï¼š

- **æŒ‡ä»¤**ï¼šCPUæ‰§è¡Œå•å…ƒ
- **è°ƒåº¦å™¨**ï¼šç¡¬ä»¶å®ç°ï¼ˆå¦‚ROBï¼‰
- **æ˜ å°„**ï¼šæŒ‡ä»¤æ˜ å°„åˆ°æ‰§è¡Œå•å…ƒ

**æŠ½è±¡æ³„æ¼**ï¼š

**OSç‰¹æ€§æ³„æ¼**ï¼š

- **NUMAæ‹“æ‰‘**ï¼šå½±å“å†…å­˜è®¿é—®å»¶è¿Ÿ
- **CPUäº²å’Œæ€§**ï¼šå½±å“ç¼“å­˜å‘½ä¸­ç‡
- **ä¸­æ–­å¤„ç†**ï¼šå½±å“å®æ—¶æ€§

**ç¼“è§£æªæ–½**ï¼š

```go
// Goä¸­è®¾ç½®CPUäº²å’Œæ€§
runtime.LockOSThread()  // é”å®šåˆ°å½“å‰OSçº¿ç¨‹
```

**æ‰¹åˆ¤æ€§åˆ†æ**ï¼š

1. **æŠ½è±¡çš„å¿…è¦æ€§**ï¼šè¯­è¨€å±‚è°ƒåº¦æä¾›**æ›´é«˜çº§çš„æŠ½è±¡**ï¼Œç®€åŒ–å¹¶å‘ç¼–ç¨‹ã€‚

2. **æŠ½è±¡æ³„æ¼çš„å¿…ç„¶æ€§**ï¼šOSç‰¹æ€§ï¼ˆå¦‚NUMAæ‹“æ‰‘ï¼‰**æ³„æ¼åˆ°è¯­è¨€å±‚**ï¼Œéœ€è¦æ„ŸçŸ¥ã€‚

3. **2025å¹´è¶‹åŠ¿**ï¼š**å¼‚æ­¥è¿è¡Œæ—¶**ï¼ˆå¦‚Rust Asyncï¼‰æˆä¸ºä¸»æµï¼ŒæŒ‘æˆ˜ä¼ ç»Ÿçº¿ç¨‹æ¨¡å‹ã€‚

### 6.2 è°ƒåº¦å¼€é”€çš„å±‚çº§æ€§

**æ ¸å¿ƒæ´å¯Ÿ**ï¼šæ¯å±‚è°ƒåº¦å¼€é”€å¢åŠ çº¦10å€ï¼Œç¬¦åˆæŠ½è±¡æ³„æ¼å®šå¾‹ã€‚

**å¼€é”€åˆ†è§£**ï¼š

| **è°ƒåº¦å±‚æ¬¡** | **åˆ›å»ºå¼€é”€** | **åˆ‡æ¢å¼€é”€** | **å¢åŠ å€æ•°** | **ä¸»è¦å¼€é”€** |
|------------|------------|------------|------------|------------|
| **ç¡¬ä»¶æŒ‡ä»¤** | 0ns | 0.2ns | åŸºå‡† | æ™¶ä½“ç®¡é€Ÿåº¦ |
| **OSçº¿ç¨‹** | 10Î¼s | 5Î¼s | 25,000x | å†…å­˜åˆ†é… |
| **è¯­è¨€åç¨‹** | 1Î¼s | 100ns | 500x | æ ˆåˆ†é… |
| **åˆ†å¸ƒå¼ä»»åŠ¡** | 100ms | 10ms | 50,000x | ç½‘ç»œå»¶è¿Ÿ |

**å¼€é”€æ¥æºåˆ†æ**ï¼š

**1. ç¡¬ä»¶å±‚å¼€é”€**ï¼š

- **æŒ‡ä»¤è°ƒåº¦**ï¼šç¡¬ä»¶å®ç°ï¼Œå‡ ä¹æ— å¼€é”€
- **ä¸»è¦å¼€é”€**ï¼šæ™¶ä½“ç®¡é€Ÿåº¦é™åˆ¶

**2. OSå±‚å¼€é”€**ï¼š

- **çº¿ç¨‹åˆ›å»º**ï¼šç³»ç»Ÿè°ƒç”¨ + å†…å­˜åˆ†é…
- **ä¸Šä¸‹æ–‡åˆ‡æ¢**ï¼šä¿å­˜/æ¢å¤å¯„å­˜å™¨ + å†…å­˜ç®¡ç†
- **ä¸»è¦å¼€é”€**ï¼šå†…å­˜åˆ†é…å’Œç³»ç»Ÿè°ƒç”¨

**3. è¯­è¨€å±‚å¼€é”€**ï¼š

- **åç¨‹åˆ›å»º**ï¼šæ ˆåˆ†é… + åˆå§‹åŒ–
- **ä¸Šä¸‹æ–‡åˆ‡æ¢**ï¼šä¿å­˜/æ¢å¤æ ˆæŒ‡é’ˆ
- **ä¸»è¦å¼€é”€**ï¼šæ ˆåˆ†é…å’Œä¸Šä¸‹æ–‡åˆ‡æ¢

**å¼€é”€æ¨¡å‹**ï¼š

$$
T_{\text{æ€»å¼€é”€}} = T_{\text{ç¡¬ä»¶}} + T_{\text{OS}} + T_{\text{è¯­è¨€}}
$$

å…¶ä¸­ï¼š

- $T_{\text{ç¡¬ä»¶}} \approx 0.2\text{ns}$ï¼ˆæŒ‡ä»¤è°ƒåº¦ï¼‰
- $T_{\text{OS}} \approx 5\mu\text{s}$ï¼ˆçº¿ç¨‹åˆ‡æ¢ï¼‰
- $T_{\text{è¯­è¨€}} \approx 100\text{ns}$ï¼ˆåç¨‹åˆ‡æ¢ï¼‰

**å…³é”®æ´å¯Ÿ**ï¼šè¯­è¨€å±‚å¼€é”€**è¿œå°äºOSå±‚**ï¼Œä½†ä»**å—OSå±‚é™åˆ¶**ã€‚

### 6.3 è°ƒåº¦ç­–ç•¥çš„æ¼”è¿›

**æ ¸å¿ƒæ´å¯Ÿ**ï¼šè°ƒåº¦ç­–ç•¥ä»æŠ¢å å¼å‘åä½œå¼æ¼”è¿›ï¼Œä»OSçº§å‘è¯­è¨€çº§æ¼”è¿›ã€‚

**æ¼”è¿›å†ç¨‹**ï¼š

**1. 1970sï¼šOSçº¿ç¨‹**ï¼š

- **ç‰¹ç‚¹**ï¼šæŠ¢å å¼è°ƒåº¦ï¼ŒOSçº§å®ç°
- **ä¼˜åŠ¿**ï¼šå…¬å¹³æ€§ä¿è¯
- **åŠ£åŠ¿**ï¼šå¼€é”€å¤§ï¼Œå¤æ‚åº¦é«˜

**2. 1990sï¼šç»¿è‰²çº¿ç¨‹**ï¼š

- **ç‰¹ç‚¹**ï¼šç”¨æˆ·æ€è°ƒåº¦ï¼ŒM:Næ¨¡å‹
- **ä¼˜åŠ¿**ï¼šå¼€é”€å°
- **åŠ£åŠ¿**ï¼šé˜»å¡é—®é¢˜

**3. 2000sï¼šçº¿ç¨‹æ± **ï¼š

- **ç‰¹ç‚¹**ï¼šçº¿ç¨‹å¤ç”¨ï¼Œå‡å°‘åˆ›å»ºå¼€é”€
- **ä¼˜åŠ¿**ï¼šæé«˜æ•ˆç‡
- **åŠ£åŠ¿**ï¼šä»éœ€OSçº¿ç¨‹

**4. 2010sï¼šåç¨‹**ï¼š

- **ç‰¹ç‚¹**ï¼šåä½œå¼è°ƒåº¦ï¼Œè½»é‡çº§
- **ä¼˜åŠ¿**ï¼šå¼€é”€æå°ï¼Œé«˜å¹¶å‘
- **åŠ£åŠ¿**ï¼šéœ€è¦æ˜¾å¼è®©å‡º

**5. 2020sï¼šå¼‚æ­¥è¿è¡Œæ—¶**ï¼š

- **ç‰¹ç‚¹**ï¼šé›¶æˆæœ¬æŠ½è±¡ï¼Œç¼–è¯‘æ—¶ä¼˜åŒ–
- **ä¼˜åŠ¿**ï¼šæ— è¿è¡Œæ—¶å¼€é”€
- **åŠ£åŠ¿**ï¼šä½¿ç”¨å¤æ‚

**2025å¹´è¶‹åŠ¿**ï¼š

- **å¼‚æ­¥è¿è¡Œæ—¶**ï¼šæˆä¸ºä¸»æµï¼ˆRust Asyncã€C++ Coroutineï¼‰
- **æ··åˆæ¨¡å‹**ï¼šç»“åˆæŠ¢å å¼å’Œåä½œå¼
- **ç¡¬ä»¶åŠ é€Ÿ**ï¼šä¸“ç”¨ç¡¬ä»¶åŠ é€Ÿåç¨‹è°ƒåº¦

### 6.4 è¯­è¨€å±‚è°ƒåº¦ä¸æ€§èƒ½ä¼˜åŒ–

**æ ¸å¿ƒæ´å¯Ÿ**ï¼šè¯­è¨€å±‚è°ƒåº¦ä¼˜åŒ–å¯ä»¥æ˜¾è‘—æå‡åº”ç”¨æ€§èƒ½ã€‚

**ä¼˜åŒ–ç­–ç•¥**ï¼š

**1. å‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢**ï¼š

- **æ‰¹é‡å¤„ç†**ï¼šæ‰¹é‡å¤„ç†ä»»åŠ¡ï¼Œå‡å°‘åˆ‡æ¢æ¬¡æ•°
- **æœ¬åœ°é˜Ÿåˆ—**ï¼šä½¿ç”¨æœ¬åœ°é˜Ÿåˆ—ï¼Œå‡å°‘å…¨å±€ç«äº‰

**2. æé«˜ç¼“å­˜å‘½ä¸­ç‡**ï¼š

- **CPUäº²å’Œæ€§**ï¼šç»‘å®šåˆ°ç‰¹å®šCPUæ ¸å¿ƒ
- **æ•°æ®å±€éƒ¨æ€§**ï¼šæé«˜æ•°æ®å±€éƒ¨æ€§

**3. å‡å°‘å†…å­˜åˆ†é…**ï¼š

- **å¯¹è±¡æ± **ï¼šå¤ç”¨å¯¹è±¡ï¼Œå‡å°‘åˆ†é…
- **æ ˆåˆ†é…**ï¼šä½¿ç”¨æ ˆåˆ†é…ï¼Œé¿å…å †åˆ†é…

**æ€§èƒ½ä¼˜åŒ–æ¡ˆä¾‹**ï¼š

```go
// ä¼˜åŒ–å‰ï¼šé¢‘ç¹åˆ›å»ºGoroutine
for i := 0; i < 1000000; i++ {
    go process(i)  // åˆ›å»º100ä¸‡ä¸ªGoroutine
}

// ä¼˜åŒ–åï¼šä½¿ç”¨å·¥ä½œæ± 
pool := make(chan struct{}, 100)  // é™åˆ¶å¹¶å‘æ•°
for i := 0; i < 1000000; i++ {
    pool <- struct{}{}  // è·å–ä»¤ç‰Œ
    go func(i int) {
        defer func() { <-pool }()  // é‡Šæ”¾ä»¤ç‰Œ
        process(i)
    }(i)
}
```

**ä¼˜åŒ–æ•ˆæœ**ï¼š

| **æŒ‡æ ‡** | **ä¼˜åŒ–å‰** | **ä¼˜åŒ–å** | **æ”¹å–„** |
|---------|-----------|-----------|---------|
| **å†…å­˜å ç”¨** | 2GB | 200MB | -90% |
| **ä¸Šä¸‹æ–‡åˆ‡æ¢** | 100ä¸‡æ¬¡ | 10ä¸‡æ¬¡ | -90% |
| **æ€§èƒ½** | åŸºå‡† | 2x | +100% |

---

## 7 æ‰¹åˆ¤æ€§æ€»ç»“

### 7.1 è¯­è¨€å±‚è°ƒåº¦çš„å±€é™æ€§

**1. æŠ½è±¡æ³„æ¼çš„å¿…ç„¶æ€§**ï¼š

**é—®é¢˜**ï¼šOSç‰¹æ€§ï¼ˆå¦‚NUMAã€CPUäº²å’Œæ€§ï¼‰æ³„æ¼åˆ°è¯­è¨€å±‚ã€‚

**å½±å“**ï¼š

- éœ€è¦æ„ŸçŸ¥åº•å±‚ç‰¹æ€§
- æ€§èƒ½ä¼˜åŒ–å¤æ‚
- è·¨å¹³å°å·®å¼‚

**ç¼“è§£æªæ–½**ï¼š

- **è¿è¡Œæ—¶ä¼˜åŒ–**ï¼šè¯­è¨€è¿è¡Œæ—¶è‡ªåŠ¨ä¼˜åŒ–
- **æ˜¾å¼æ§åˆ¶**ï¼šæä¾›APIæ§åˆ¶åº•å±‚ç‰¹æ€§
- **æŠ½è±¡å°è£…**ï¼šå°è£…åº•å±‚å·®å¼‚

**2. åä½œå¼è°ƒåº¦çš„é™åˆ¶**ï¼š

**é—®é¢˜**ï¼šåä½œå¼è°ƒåº¦éœ€è¦æ˜¾å¼è®©å‡ºï¼Œå¯èƒ½é˜»å¡ã€‚

**å½±å“**ï¼š

- é•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡å¯èƒ½é˜»å¡è°ƒåº¦
- éœ€è¦å¼€å‘è€…æ³¨æ„è®©å‡ºæ§åˆ¶æƒ
- ä¸é€‚åˆå®æ—¶åº”ç”¨

**ç¼“è§£æªæ–½**ï¼š

- **æŠ¢å å¼è°ƒåº¦**ï¼šGoå¼•å…¥æŠ¢å å¼è°ƒåº¦
- **è¶…æ—¶æœºåˆ¶**ï¼šè®¾ç½®è¶…æ—¶ï¼Œå¼ºåˆ¶è®©å‡º
- **æ··åˆæ¨¡å‹**ï¼šç»“åˆæŠ¢å å¼å’Œåä½œå¼

**3. é›¶æˆæœ¬æŠ½è±¡çš„ä»£ä»·**ï¼š

**é—®é¢˜**ï¼šé›¶æˆæœ¬æŠ½è±¡ï¼ˆå¦‚Rust Asyncï¼‰ä½¿ç”¨å¤æ‚ã€‚

**å½±å“**ï¼š

- å­¦ä¹ æ›²çº¿é™¡å³­
- ç¼–è¯‘æ—¶é—´å¢åŠ 
- é”™è¯¯ä¿¡æ¯å¤æ‚

**ç¼“è§£æªæ–½**ï¼š

- **å·¥å…·æ”¯æŒ**ï¼šæä¾›æ›´å¥½çš„å·¥å…·å’Œæ–‡æ¡£
- **ç®€åŒ–API**ï¼šæä¾›æ›´ç®€å•çš„API
- **ç¤¾åŒºæ”¯æŒ**ï¼šç¤¾åŒºæä¾›æœ€ä½³å®è·µ

### 7.2 2025å¹´è¯­è¨€å±‚è°ƒåº¦è¶‹åŠ¿

**1. å¼‚æ­¥è¿è¡Œæ—¶æˆä¸ºä¸»æµ**ï¼š

**è¶‹åŠ¿**ï¼šå¼‚æ­¥è¿è¡Œæ—¶ï¼ˆRust Asyncã€C++ Coroutineï¼‰æˆä¸ºä¸»æµã€‚

**æŠ€æœ¯**ï¼š

- **é›¶æˆæœ¬æŠ½è±¡**ï¼šç¼–è¯‘æ—¶ä¼˜åŒ–
- **ç±»å‹å®‰å…¨**ï¼šç¼–è¯‘æœŸä¿è¯
- **é«˜æ€§èƒ½**ï¼šæ¥è¿‘Cæ€§èƒ½

**ä¼˜åŠ¿**ï¼š

- æ€§èƒ½æœ€ä¼˜
- å†…å­˜å®‰å…¨
- ç±»å‹å®‰å…¨

**æŒ‘æˆ˜**ï¼š

- ä½¿ç”¨å¤æ‚
- å­¦ä¹ æ›²çº¿é™¡å³­
- ç”Ÿæ€ç³»ç»Ÿä¸æˆç†Ÿ

**2. æ··åˆè°ƒåº¦æ¨¡å‹**ï¼š

**è¶‹åŠ¿**ï¼šç»“åˆæŠ¢å å¼å’Œåä½œå¼è°ƒåº¦ã€‚

**æŠ€æœ¯**ï¼š

- **æŠ¢å å¼**ï¼šä¿è¯å…¬å¹³æ€§
- **åä½œå¼**ï¼šæé«˜æ€§èƒ½
- **è‡ªé€‚åº”**ï¼šæ ¹æ®åœºæ™¯é€‰æ‹©

**ä¼˜åŠ¿**ï¼š

- å¹³è¡¡æ€§èƒ½å’Œå…¬å¹³æ€§
- é€‚åº”ä¸åŒåœºæ™¯
- æé«˜çµæ´»æ€§

**æŒ‘æˆ˜**ï¼š

- å®ç°å¤æ‚
- è°ƒè¯•å›°éš¾
- æ€§èƒ½é¢„æµ‹å›°éš¾

**3. ç¡¬ä»¶åŠ é€Ÿåç¨‹**ï¼š

**è¶‹åŠ¿**ï¼šä¸“ç”¨ç¡¬ä»¶åŠ é€Ÿåç¨‹è°ƒåº¦ã€‚

**æŠ€æœ¯**ï¼š

- **åç¨‹ç¡¬ä»¶**ï¼šä¸“ç”¨åç¨‹å¤„ç†å•å…ƒ
- **ä¸Šä¸‹æ–‡åˆ‡æ¢ç¡¬ä»¶**ï¼šç¡¬ä»¶åŠ é€Ÿä¸Šä¸‹æ–‡åˆ‡æ¢
- **è°ƒåº¦ç¡¬ä»¶**ï¼šç¡¬ä»¶å®ç°è°ƒåº¦å™¨

**ä¼˜åŠ¿**ï¼š

- æ€§èƒ½æœ€ä¼˜
- åŠŸè€—ä½
- å»¶è¿Ÿä½

**æŒ‘æˆ˜**ï¼š

- ç¡¬ä»¶æˆæœ¬é«˜
- ç”Ÿæ€ç³»ç»Ÿä¸æˆç†Ÿ
- æ ‡å‡†åŒ–å›°éš¾

## 8 å¤šç»´åº¦å¯¹æ¯”

### 8.1 è¯­è¨€è°ƒåº¦æ¨¡å‹å¯¹æ¯”ï¼ˆ2025å¹´ï¼‰

| **è¯­è¨€/æ¨¡å‹** | **è°ƒåº¦æ¨¡å‹** | **åˆ›å»ºå¼€é”€** | **åˆ‡æ¢å¼€é”€** | **å†…å­˜å ç”¨** | **æŠ¢å ** | **é€‚ç”¨åœºæ™¯** | **ç±»å‹å®‰å…¨** |
|------------|------------|------------|------------|------------|---------|------------|------------|
| **Go Goroutine** | M:N | 1Î¼s | 100ns | 2KB | æ˜¯ | é€šç”¨å¹¶å‘ | æ˜¯ |
| **Rust Async** | äº‹ä»¶é©±åŠ¨ | 0nsï¼ˆç¼–è¯‘æ—¶ï¼‰ | 0nsï¼ˆåä½œå¼ï¼‰ | æœ€å° | å¦ | IOå¯†é›†å‹ | æ˜¯ |
| **Java ForkJoin** | å·¥ä½œçªƒå– | 10Î¼s | 5Î¼s | 1MBï¼ˆçº¿ç¨‹ï¼‰ | æ˜¯ | CPUå¯†é›†å‹ | æ˜¯ |
| **Erlang Process** | Actoræ¨¡å‹ | 1Î¼s | 100ns | 1KB | æ˜¯ | åˆ†å¸ƒå¼ç³»ç»Ÿ | å¦ |
| **C++ Coroutine** | åç¨‹ | 0nsï¼ˆç¼–è¯‘æ—¶ï¼‰ | 0nsï¼ˆåä½œå¼ï¼‰ | æœ€å° | å¦ | é«˜æ€§èƒ½ | å¦ |
| **Python asyncio** | äº‹ä»¶å¾ªç¯ | 10Î¼s | 1Î¼s | 10KB | å¦ | IOå¯†é›†å‹ | å¦ |

**æ‰¹åˆ¤æ€§åˆ†æ**ï¼š

1. **å¼€é”€çš„å·®å¼‚**ï¼šRust Asyncå¼€é”€æœ€å°ï¼Œä½†**éœ€è¦ç¼–è¯‘æ—¶æ”¯æŒ**ï¼›Goå¼€é”€ä¸­ç­‰ï¼Œä½†**ä½¿ç”¨ç®€å•**ã€‚

2. **æŠ¢å çš„å¿…è¦æ€§**ï¼šæŠ¢å å¼è°ƒåº¦**ä¿è¯å…¬å¹³æ€§**ï¼Œä½†å¢åŠ å¤æ‚åº¦ã€‚

3. **2025å¹´è¶‹åŠ¿**ï¼š**å¼‚æ­¥è¿è¡Œæ—¶**ï¼ˆå¦‚Rust Asyncï¼‰æˆä¸ºä¸»æµï¼ŒæŒ‘æˆ˜ä¼ ç»Ÿçº¿ç¨‹æ¨¡å‹ã€‚

### 8.2 è°ƒåº¦ç­–ç•¥æ¼”è¿›å¯¹æ¯”

| **æ—¶ä»£** | **è°ƒåº¦ç­–ç•¥** | **å…³é”®ç‰¹æ€§** | **æ€§èƒ½** | **æ˜“ç”¨æ€§** | **ä»£è¡¨è¯­è¨€** | **ä¸»è¦ä¼˜åŠ¿** |
|---------|------------|------------|---------|-----------|------------|------------|
| **1970s** | çº¿ç¨‹ | OSçº§è°ƒåº¦ | â­â­ | â­â­ | C/Pascal | ç®€å•ç›´æ¥ |
| **1990s** | ç»¿è‰²çº¿ç¨‹ | ç”¨æˆ·æ€è°ƒåº¦ | â­â­â­ | â­â­â­ | Javaæ—©æœŸ | å¼€é”€å° |
| **2000s** | çº¿ç¨‹æ±  | å¤ç”¨çº¿ç¨‹ | â­â­â­â­ | â­â­â­ | Java/C# | æ•ˆç‡é«˜ |
| **2010s** | åç¨‹ | åä½œå¼è°ƒåº¦ | â­â­â­â­â­ | â­â­â­â­ | Go/Rust | é«˜å¹¶å‘ |
| **2020s** | å¼‚æ­¥è¿è¡Œæ—¶ | é›¶æˆæœ¬æŠ½è±¡ | â­â­â­â­â­ | â­â­â­ | Rust | æ€§èƒ½æœ€ä¼˜ |

**æ‰¹åˆ¤æ€§åˆ†æ**ï¼š

1. **æ¼”è¿›çš„è¶‹åŠ¿**ï¼šä»OSçº§è°ƒåº¦åˆ°**è¯­è¨€çº§è°ƒåº¦**ï¼Œä»æŠ¢å å¼åˆ°**åä½œå¼**ã€‚

2. **æ€§èƒ½çš„æå‡**ï¼šå¼‚æ­¥è¿è¡Œæ—¶**æ€§èƒ½æœ€å¥½**ï¼Œä½†**ä½¿ç”¨å¤æ‚**ã€‚

3. **2025å¹´è¶‹åŠ¿**ï¼š**å¼‚æ­¥è¿è¡Œæ—¶**ï¼ˆå¦‚Rust Asyncï¼‰æˆä¸ºä¸»æµï¼ŒæŒ‘æˆ˜ä¼ ç»Ÿçº¿ç¨‹æ¨¡å‹ã€‚

### 8.3 è°ƒåº¦å¼€é”€å¯¹æ¯”

| **è°ƒåº¦å±‚æ¬¡** | **åˆ›å»ºå¼€é”€** | **åˆ‡æ¢å¼€é”€** | **å†…å­˜å ç”¨** | **ä¸»è¦å¼€é”€æ¥æº** |
|------------|------------|------------|------------|---------------|
| **ç¡¬ä»¶æŒ‡ä»¤** | 0ns | 0.2ns | 0B | æ™¶ä½“ç®¡é€Ÿåº¦ |
| **OSçº¿ç¨‹** | 10Î¼s | 5Î¼s | 2MB | å†…å­˜åˆ†é… |
| **Go Goroutine** | 1Î¼s | 100ns | 2KB | æ ˆåˆ†é… |
| **Rust Async** | 0ns | 0ns | æœ€å° | ç¼–è¯‘æ—¶ä¼˜åŒ– |
| **Java ForkJoin** | 10Î¼s | 5Î¼s | 1MB | çº¿ç¨‹åˆ›å»º |

### 8.4 é€‚ç”¨åœºæ™¯å¯¹æ¯”

| **åœºæ™¯** | **æ¨èæ–¹æ¡ˆ** | **åŸå› ** |
|---------|------------|---------|
| **é«˜å¹¶å‘WebæœåŠ¡å™¨** | Go Goroutine | ç®€å•æ˜“ç”¨ï¼Œé«˜å¹¶å‘ |
| **é«˜æ€§èƒ½ç½‘ç»œæ¡†æ¶** | Rust Async | é›¶æˆæœ¬æŠ½è±¡ï¼Œé«˜æ€§èƒ½ |
| **å¹¶è¡Œè®¡ç®—** | Java ForkJoin | å·¥ä½œçªƒå–ï¼Œè´Ÿè½½å‡è¡¡ |
| **åˆ†å¸ƒå¼ç³»ç»Ÿ** | Erlang Process | Actoræ¨¡å‹ï¼Œå®¹é”™æ€§å¼º |
| **å®æ—¶ç³»ç»Ÿ** | OSçº¿ç¨‹ | æŠ¢å å¼è°ƒåº¦ï¼Œå®æ—¶æ€§ä¿è¯ |

---

## 9 ç›¸å…³ä¸»é¢˜

**æœ¬ç« ç›¸å…³**ï¼š

- [6.2 OSå†…æ ¸è°ƒåº¦](./06.2_OSå†…æ ¸è°ƒåº¦.md) - OSè°ƒåº¦åŸºç¡€
- [6.4 åˆ†å¸ƒå¼ç³»ç»Ÿè°ƒåº¦](./06.4_åˆ†å¸ƒå¼ç³»ç»Ÿè°ƒåº¦.md) - åˆ†å¸ƒå¼è°ƒåº¦
- [6.5 è°ƒåº¦æ¨¡å‹ç»Ÿä¸€ç†è®º](./06.5_è°ƒåº¦æ¨¡å‹ç»Ÿä¸€ç†è®º.md) - è°ƒåº¦ç†è®ºæ¡†æ¶

**è·¨ç« èŠ‚**ï¼š

- [7.2 å»¶è¿Ÿç©¿é€åˆ†æ](../07_æ€§èƒ½ä¼˜åŒ–ä¸å®‰å…¨/07.2_å»¶è¿Ÿç©¿é€åˆ†æ.md) - è°ƒåº¦å»¶è¿Ÿä¼˜åŒ–
- [11.3 åº”ç”¨æ¶æ„å±‚è°ƒåº¦](../11_ä¼ä¸šæ¶æ„è°ƒåº¦/11.3_åº”ç”¨æ¶æ„å±‚è°ƒåº¦.md) - å¾®æœåŠ¡è°ƒåº¦

**å…¶ä»–è§†è§’**ï¼š

- [ä¸»æ–‡æ¡£ï¼šè°ƒåº¦æ˜ å°„](../schedule_formal_view.md#æ ¸å¿ƒè®ºè¯è°ƒåº¦ä½œä¸ºå…ƒæ¨¡å‹çš„æ™®é€‚æ€§) - å®Œæ•´æ˜ å°„å…³ç³»

---

**æœ€åæ›´æ–°**: 2025-01-XX
