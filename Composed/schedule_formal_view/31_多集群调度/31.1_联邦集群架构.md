# 31.1 è”é‚¦é›†ç¾¤æ¶æ„

> **ä¸»é¢˜**: 31. å¤šé›†ç¾¤è°ƒåº¦ - 31.1 è”é‚¦é›†ç¾¤æ¶æ„
> **è¦†ç›–**: Kubernetes Federationã€KubeFedã€Karmadaã€è”é‚¦æ§åˆ¶å¹³é¢

---

## ğŸ“‹ ç›®å½•

- [31.1 è”é‚¦é›†ç¾¤æ¶æ„](#311-è”é‚¦é›†ç¾¤æ¶æ„)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [1 Kubernetes Federationæ¦‚è¿°](#1-kubernetes-federationæ¦‚è¿°)
    - [1.1 è”é‚¦é›†ç¾¤çš„æ¼”è¿›](#11-è”é‚¦é›†ç¾¤çš„æ¼”è¿›)
    - [1.2 æ ¸å¿ƒæ¶æ„](#12-æ ¸å¿ƒæ¶æ„)
  - [2 KubeFedæ¶æ„](#2-kubefedæ¶æ„)
    - [2.1 æ§åˆ¶å¹³é¢æ¶æ„](#21-æ§åˆ¶å¹³é¢æ¶æ„)
    - [2.2 èµ„æºè”é‚¦åŒ–](#22-èµ„æºè”é‚¦åŒ–)
    - [2.3 è°ƒåº¦ç­–ç•¥](#23-è°ƒåº¦ç­–ç•¥)
  - [3 Karmadaæ¶æ„](#3-karmadaæ¶æ„)
    - [3.1 æ¶æ„è®¾è®¡](#31-æ¶æ„è®¾è®¡)
    - [3.2 æ ¸å¿ƒç»„ä»¶](#32-æ ¸å¿ƒç»„ä»¶)
    - [3.3 è°ƒåº¦æµç¨‹](#33-è°ƒåº¦æµç¨‹)
  - [4 å½¢å¼åŒ–æ¨¡å‹](#4-å½¢å¼åŒ–æ¨¡å‹)
    - [4.1 è”é‚¦é›†ç¾¤æ¨¡å‹](#41-è”é‚¦é›†ç¾¤æ¨¡å‹)
    - [4.2 èµ„æºä¼ æ’­æ¨¡å‹](#42-èµ„æºä¼ æ’­æ¨¡å‹)
    - [4.3 ä¸€è‡´æ€§æ¨¡å‹](#43-ä¸€è‡´æ€§æ¨¡å‹)
  - [5 å®è·µæ¡ˆä¾‹](#5-å®è·µæ¡ˆä¾‹)
    - [5.1 KubeFedéƒ¨ç½²ç¤ºä¾‹](#51-kubefedéƒ¨ç½²ç¤ºä¾‹)
    - [5.2 Karmadaéƒ¨ç½²ç¤ºä¾‹](#52-karmadaéƒ¨ç½²ç¤ºä¾‹)
  - [6 è·¨è§†è§’é“¾æ¥](#6-è·¨è§†è§’é“¾æ¥)

---

## 1 Kubernetes Federationæ¦‚è¿°

### 1.1 è”é‚¦é›†ç¾¤çš„æ¼”è¿›

**Kubernetes Federationå‘å±•å†ç¨‹**ï¼š

```text
Federation v1 (2016-2018)
  â†“ [å¼ƒç”¨]
Federation v2 / KubeFed (2018-è‡³ä»Š)
  â†“ [å¹¶è¡Œ]
Karmada (2020-è‡³ä»Š)
  â†“ [å¹¶è¡Œ]
Clusternet (2021-è‡³ä»Š)
```

**æ ¸å¿ƒé—®é¢˜**ï¼š

- **Federation v1**ï¼šæ¶æ„å¤æ‚ï¼Œéš¾ä»¥ç»´æŠ¤ï¼Œå·²å¼ƒç”¨
- **KubeFedï¼ˆv2ï¼‰**ï¼šç®€åŒ–æ¶æ„ï¼ŒCRDé©±åŠ¨ï¼ŒCNCFé¡¹ç›®
- **Karmada**ï¼šåä¸ºå¼€æºï¼Œæ›´å¼ºå¤§çš„è°ƒåº¦ç­–ç•¥ï¼Œç”Ÿäº§çº§
- **Clusternet**ï¼šè…¾è®¯å¼€æºï¼Œæ³¨é‡å®‰å…¨æ€§å’Œéš”ç¦»æ€§

### 1.2 æ ¸å¿ƒæ¶æ„

**è”é‚¦é›†ç¾¤æ¶æ„æ¨¡å¼**ï¼š

```text
ä¸»é›†ç¾¤ï¼ˆHost Clusterï¼‰
â”œâ”€â”€ è”é‚¦æ§åˆ¶å¹³é¢ï¼ˆFederation Control Planeï¼‰
â”‚   â”œâ”€â”€ API Server
â”‚   â”œâ”€â”€ Controller Manager
â”‚   â””â”€â”€ Scheduler
â””â”€â”€ æˆå‘˜é›†ç¾¤è¿æ¥ï¼ˆMember Cluster Connectionsï¼‰
    â”œâ”€â”€ é›†ç¾¤1ï¼ˆCluster 1ï¼‰
    â”œâ”€â”€ é›†ç¾¤2ï¼ˆCluster 2ï¼‰
    â””â”€â”€ é›†ç¾¤Nï¼ˆCluster Nï¼‰
```

**å…³é”®ç‰¹å¾**ï¼š

- **ä¸»é›†ç¾¤**ï¼šè¿è¡Œè”é‚¦æ§åˆ¶å¹³é¢çš„é›†ç¾¤
- **æˆå‘˜é›†ç¾¤**ï¼šè¢«è”é‚¦ç®¡ç†çš„Kubernetesé›†ç¾¤
- **æ§åˆ¶å¹³é¢**ï¼šè´Ÿè´£è”é‚¦çº§åˆ«çš„èµ„æºç®¡ç†å’Œè°ƒåº¦
- **èµ„æºä¼ æ’­**ï¼šå°†è”é‚¦èµ„æºåˆ†å‘åˆ°æˆå‘˜é›†ç¾¤

---

## 2 KubeFedæ¶æ„

### 2.1 æ§åˆ¶å¹³é¢æ¶æ„

**KubeFedæ§åˆ¶å¹³é¢ç»„ä»¶**ï¼š

```yaml
apiVersion: v1
kind: Namespace
metadata:
  name: kube-federation-system
---
# KubeFed Controller Manager
apiVersion: apps/v1
kind: Deployment
metadata:
  name: kubefed-controller-manager
  namespace: kube-federation-system
spec:
  replicas: 2  # é«˜å¯ç”¨
  selector:
    matchLabels:
      control-plane: controller-manager
  template:
    metadata:
      labels:
        control-plane: controller-manager
    spec:
      containers:
      - name: controller-manager
        image: quay.io/kubernetes-multicluster/kubefed:v0.10.0
        command:
        - /hyperfed/controller-manager
        args:
        - --kubeconfig=/etc/kubefed/kubeconfig
```

**æ ¸å¿ƒç»„ä»¶**ï¼š

1. **KubeFed Controller Manager**ï¼š
   - ç®¡ç†è”é‚¦èµ„æºçš„ç”Ÿå‘½å‘¨æœŸ
   - å°†è”é‚¦èµ„æºä¼ æ’­åˆ°æˆå‘˜é›†ç¾¤
   - ç›‘æ§æˆå‘˜é›†ç¾¤çš„å¥åº·çŠ¶æ€

2. **KubeFed Admission Webhook**ï¼š
   - éªŒè¯è”é‚¦èµ„æºçš„åˆæ³•æ€§
   - æä¾›èµ„æºé»˜è®¤å€¼

### 2.2 èµ„æºè”é‚¦åŒ–

**å®šä¹‰31.11ï¼ˆè”é‚¦èµ„æºï¼‰**ï¼š

KubeFedé€šè¿‡ä»¥ä¸‹CRDå®ç°èµ„æºè”é‚¦åŒ–ï¼š

1. **FederatedTypeConfig**ï¼šå®šä¹‰å“ªäº›Kubernetesèµ„æºå¯ä»¥è¢«è”é‚¦åŒ–
2. **FederatedResource**ï¼šè”é‚¦èµ„æºçš„æ¨¡æ¿å®šä¹‰
3. **ReplicaSchedulingPreference**ï¼šå‰¯æœ¬è°ƒåº¦åå¥½

**ç¤ºä¾‹ï¼šè”é‚¦åŒ–Deployment**ï¼š

```yaml
apiVersion: types.kubefed.io/v1beta1
kind: FederatedDeployment
metadata:
  name: nginx-deployment
  namespace: default
spec:
  template:  # Deploymentæ¨¡æ¿
    metadata:
      labels:
        app: nginx
    spec:
      replicas: 6  # å…¨å±€å‰¯æœ¬æ•°
      selector:
        matchLabels:
          app: nginx
      template:
        metadata:
          labels:
            app: nginx
        spec:
          containers:
          - name: nginx
            image: nginx:1.21
            ports:
            - containerPort: 80
  placement:  # é›†ç¾¤é€‰æ‹©
    clusters:
    - name: cluster-1
    - name: cluster-2
    - name: cluster-3
  overrides:  # é›†ç¾¤ç‰¹å®šè¦†ç›–
  - clusterName: cluster-1
    clusterOverrides:
    - path: "/spec/replicas"
      value: 3
  - clusterName: cluster-2
    clusterOverrides:
    - path: "/spec/replicas"
      value: 2
  - clusterName: cluster-3
    clusterOverrides:
    - path: "/spec/replicas"
      value: 1
```

### 2.3 è°ƒåº¦ç­–ç•¥

**å®šç†31.11ï¼ˆKubeFedè°ƒåº¦ç­–ç•¥ï¼‰**ï¼š

KubeFedæ”¯æŒä»¥ä¸‹è°ƒåº¦ç­–ç•¥ï¼š

1. **é™æ€è°ƒåº¦ï¼ˆStatic Schedulingï¼‰**ï¼š

   ```yaml
   apiVersion: scheduling.kubefed.io/v1alpha1
   kind: ReplicaSchedulingPreference
   metadata:
     name: nginx-rsp
     namespace: default
   spec:
     targetKind: FederatedDeployment
     totalReplicas: 9
     clusters:
       cluster-1:
         weight: 3
       cluster-2:
         weight: 2
       cluster-3:
         weight: 1
   ```

2. **åŠ¨æ€è°ƒåº¦ï¼ˆDynamic Schedulingï¼‰**ï¼š

   ```yaml
   spec:
     rebalance: true  # å¯ç”¨åŠ¨æ€å†å¹³è¡¡
     clusters:
       cluster-1:
         minReplicas: 1
         maxReplicas: 5
         weight: 3
   ```

---

## 3 Karmadaæ¶æ„

### 3.1 æ¶æ„è®¾è®¡

**Karmadaæ¶æ„å›¾**ï¼š

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Karmada Control Plane                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ API Server   â”‚  â”‚  Scheduler   â”‚  â”‚  Controller  â”‚  â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚   Manager    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Webhook      â”‚  â”‚  ETCD        â”‚  â”‚  Agent       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚               â”‚               â”‚
    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
    â”‚ Cluster1 â”‚    â”‚ Cluster2 â”‚    â”‚ Cluster3 â”‚
    â”‚  (Push)  â”‚    â”‚  (Pull)  â”‚    â”‚  (Push)  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®ç‰¹æ€§**ï¼š

- **Pushæ¨¡å¼**ï¼šKarmadaç›´æ¥è®¿é—®æˆå‘˜é›†ç¾¤API Server
- **Pullæ¨¡å¼**ï¼šæˆå‘˜é›†ç¾¤ä¸»åŠ¨æ‹‰å–èµ„æºï¼ˆé€‚ç”¨äºç½‘ç»œéš”ç¦»åœºæ™¯ï¼‰
- **åŸç”ŸKubernetes API**ï¼šå®Œå…¨å…¼å®¹Kubernetes API

### 3.2 æ ¸å¿ƒç»„ä»¶

**Karmadaæ ¸å¿ƒç»„ä»¶**ï¼š

1. **Karmada API Server**ï¼š
   - æä¾›Kuberneteså…¼å®¹çš„API
   - èšåˆå¤šé›†ç¾¤èµ„æºè§†å›¾
   - å¤„ç†èµ„æºCRUDæ“ä½œ

2. **Karmada Scheduler**ï¼š
   - æ ¹æ®è°ƒåº¦ç­–ç•¥é€‰æ‹©é›†ç¾¤
   - æ”¯æŒå¤šç§è°ƒåº¦ç®—æ³•ï¼ˆè½®è¯¢ã€åŠ æƒã€äº²å’Œæ€§ï¼‰
   - åŠ¨æ€å†è°ƒåº¦

3. **Karmada Controller Manager**ï¼š
   - ç®¡ç†èµ„æºä¼ æ’­åˆ°æˆå‘˜é›†ç¾¤
   - ç›‘æ§èµ„æºçŠ¶æ€åŒæ­¥
   - å¤„ç†æ•…éšœè½¬ç§»

4. **Karmada Webhook**ï¼š
   - èµ„æºéªŒè¯
   - èµ„æºå˜å¼‚ï¼ˆæ·»åŠ é»˜è®¤å€¼ï¼‰
   - ç­–ç•¥æ‰§è¡Œ

### 3.3 è°ƒåº¦æµç¨‹

**å®šç†31.12ï¼ˆKarmadaè°ƒåº¦æµç¨‹ï¼‰**ï¼š

```text
ç”¨æˆ·æäº¤èµ„æº
  â†“ [WebhookéªŒè¯]
PropagationPolicyåŒ¹é…
  â†“ [è°ƒåº¦å™¨é€‰æ‹©é›†ç¾¤]
ç”ŸæˆResourceBinding
  â†“ [æ§åˆ¶å™¨ä¼ æ’­èµ„æº]
æˆå‘˜é›†ç¾¤åˆ›å»ºèµ„æº
  â†“ [çŠ¶æ€æ”¶é›†]
çŠ¶æ€èšåˆåˆ°ä¸»é›†ç¾¤
```

**è°ƒåº¦ç­–ç•¥ç¤ºä¾‹**ï¼š

```yaml
apiVersion: policy.karmada.io/v1alpha1
kind: PropagationPolicy
metadata:
  name: nginx-propagation
spec:
  resourceSelectors:
  - apiVersion: apps/v1
    kind: Deployment
    name: nginx
    namespace: default
  placement:
    clusterAffinity:
      clusterNames:
      - cluster-1
      - cluster-2
    replicaScheduling:
      replicaDivisionPreference: Weighted
      replicaSchedulingType: Divided
      weightPreference:
        staticWeightList:
        - targetCluster:
            clusterNames:
            - cluster-1
          weight: 2
        - targetCluster:
            clusterNames:
            - cluster-2
          weight: 1
```

---

## 4 å½¢å¼åŒ–æ¨¡å‹

### 4.1 è”é‚¦é›†ç¾¤æ¨¡å‹

**å®šä¹‰31.13ï¼ˆè”é‚¦é›†ç¾¤æ¨¡å‹ï¼‰**ï¼š

$$
\text{Federation} = (H, M, CP, P, S)
$$

å…¶ä¸­ï¼š

- $H$ï¼šä¸»é›†ç¾¤ï¼ˆHost Clusterï¼‰
- $M = \{m_1, m_2, \ldots, m_n\}$ï¼šæˆå‘˜é›†ç¾¤é›†åˆ
- $CP$ï¼šæ§åˆ¶å¹³é¢ï¼ˆControl Planeï¼‰
- $P$ï¼šèµ„æºä¼ æ’­å‡½æ•° $P: R_{fed} \to 2^{R_{member}}$
- $S$ï¼šè°ƒåº¦ç­–ç•¥ $S: W \to 2^M$

### 4.2 èµ„æºä¼ æ’­æ¨¡å‹

**å®šä¹‰31.14ï¼ˆèµ„æºä¼ æ’­ï¼‰**ï¼š

ç»™å®šè”é‚¦èµ„æº $r_{fed}$ å’Œè°ƒåº¦å†³ç­– $d = S(r_{fed})$ï¼Œèµ„æºä¼ æ’­å‡½æ•°å®šä¹‰ä¸ºï¼š

$$
P(r_{fed}, d) = \{(m_i, r_{m_i}) \mid m_i \in d\}
$$

å…¶ä¸­ $r_{m_i}$ æ˜¯ä¼ æ’­åˆ°æˆå‘˜é›†ç¾¤ $m_i$ çš„èµ„æºå®ä¾‹ã€‚

**å®šç†31.15ï¼ˆä¼ æ’­ä¸€è‡´æ€§ï¼‰**ï¼š

å¯¹äºæ‰€æœ‰æˆå‘˜é›†ç¾¤ $m_i \in d$ï¼Œå­˜åœ¨ä»¥ä¸‹ä¸€è‡´æ€§ä¿è¯ï¼š

$$
\text{Spec}(r_{m_i}) = \text{Override}(\text{Spec}(r_{fed}), m_i)
$$

å…¶ä¸­ $\text{Override}$ å‡½æ•°åº”ç”¨é›†ç¾¤ç‰¹å®šçš„è¦†ç›–è§„åˆ™ã€‚

### 4.3 ä¸€è‡´æ€§æ¨¡å‹

**å®šä¹‰31.16ï¼ˆæœ€ç»ˆä¸€è‡´æ€§ï¼‰**ï¼š

è”é‚¦ç³»ç»Ÿæ»¡è¶³æœ€ç»ˆä¸€è‡´æ€§ï¼š

$$
\forall t_0, \exists t_1 > t_0: \text{State}(r_{fed}, t_1) = \bigcup_{m_i \in M} \text{State}(r_{m_i}, t_1)
$$

å³åœ¨æœ‰é™æ—¶é—´åï¼Œè”é‚¦èµ„æºçŠ¶æ€ä¸æ‰€æœ‰æˆå‘˜é›†ç¾¤èµ„æºçŠ¶æ€è¾¾åˆ°ä¸€è‡´ã€‚

**CAPå®šç†åº”ç”¨**ï¼š

åœ¨å¤šé›†ç¾¤ç¯å¢ƒä¸­ï¼Œç”±äºç½‘ç»œåˆ†åŒºä¸å¯é¿å…ï¼ˆPï¼‰ï¼Œè”é‚¦ç³»ç»Ÿé€šå¸¸é€‰æ‹©å¯ç”¨æ€§ï¼ˆAï¼‰è€Œéå¼ºä¸€è‡´æ€§ï¼ˆCï¼‰ï¼Œå³é‡‡ç”¨APæ¨¡å¼ã€‚

---

## 5 å®è·µæ¡ˆä¾‹

### 5.1 KubeFedéƒ¨ç½²ç¤ºä¾‹

**æ­¥éª¤1ï¼šå®‰è£…KubeFed**

```bash
# å®‰è£…KubeFed Operator
kubectl create namespace kube-federation-system
helm repo add kubefed-charts https://raw.githubusercontent.com/kubernetes-sigs/kubefed/master/charts
helm install kubefed kubefed-charts/kubefed --namespace kube-federation-system
```

**æ­¥éª¤2ï¼šæ³¨å†Œæˆå‘˜é›†ç¾¤**

```bash
# æ³¨å†Œcluster-1
kubefedctl join cluster-1 \
  --cluster-context cluster-1 \
  --host-cluster-context host-cluster \
  --v=2

# æ³¨å†Œcluster-2
kubefedctl join cluster-2 \
  --cluster-context cluster-2 \
  --host-cluster-context host-cluster \
  --v=2
```

**æ­¥éª¤3ï¼šå¯ç”¨èµ„æºè”é‚¦åŒ–**

```bash
# å¯ç”¨Deploymentè”é‚¦åŒ–
kubefedctl enable deployments
```

### 5.2 Karmadaéƒ¨ç½²ç¤ºä¾‹

**æ­¥éª¤1ï¼šå®‰è£…Karmada**

```bash
# ä½¿ç”¨Helmå®‰è£…
helm repo add karmada https://raw.githubusercontent.com/karmada-io/karmada/master/charts
helm install karmada karmada/karmada --namespace karmada-system --create-namespace

# æˆ–è€…ä½¿ç”¨karmadactl
karmadactl init
```

**æ­¥éª¤2ï¼šæ³¨å†Œæˆå‘˜é›†ç¾¤**

```bash
# Pushæ¨¡å¼æ³¨å†Œï¼ˆKarmadaç›´æ¥è®¿é—®æˆå‘˜é›†ç¾¤ï¼‰
karmadactl join cluster-1 --cluster-kubeconfig=/path/to/cluster-1.kubeconfig

# Pullæ¨¡å¼æ³¨å†Œï¼ˆé€‚ç”¨äºç½‘ç»œéš”ç¦»åœºæ™¯ï¼‰
karmadactl register cluster-2 --cluster-kubeconfig=/path/to/cluster-2.kubeconfig
```

**æ­¥éª¤3ï¼šéƒ¨ç½²åº”ç”¨**

```yaml
# 1. åˆ›å»ºDeployment
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx
  namespace: default
spec:
  replicas: 6
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx
        image: nginx:1.21
---
# 2. åˆ›å»ºPropagationPolicy
apiVersion: policy.karmada.io/v1alpha1
kind: PropagationPolicy
metadata:
  name: nginx-propagation
  namespace: default
spec:
  resourceSelectors:
  - apiVersion: apps/v1
    kind: Deployment
    name: nginx
  placement:
    clusterAffinity:
      clusterNames:
      - cluster-1
      - cluster-2
    replicaScheduling:
      replicaSchedulingType: Divided
      replicaDivisionPreference: Weighted
      weightPreference:
        staticWeightList:
        - targetCluster:
            clusterNames:
            - cluster-1
          weight: 2
        - targetCluster:
            clusterNames:
            - cluster-2
          weight: 1
```

**éªŒè¯éƒ¨ç½²**ï¼š

```bash
# æŸ¥çœ‹ResourceBinding
kubectl get resourcebinding -n default

# æŸ¥çœ‹å„é›†ç¾¤ä¸­çš„Deployment
kubectl --context cluster-1 get deployment nginx
kubectl --context cluster-2 get deployment nginx
```

---

## 6 è·¨è§†è§’é“¾æ¥

**å½¢å¼è¯­è¨€è§†è§’**ï¼š

- [09.4 åº”ç”¨èŒƒç•´è®º](../../formal_lang_view/09_å½¢å¼åŒ–ç†è®º/09.4_åº”ç”¨èŒƒç•´è®º.md) - è”é‚¦é›†ç¾¤çš„èŒƒç•´è®ºå»ºæ¨¡

**è°ƒåº¦è§†è§’**ï¼š

- [06.4 åˆ†å¸ƒå¼ç³»ç»Ÿè°ƒåº¦](../06_è°ƒåº¦æ¨¡å‹/06.4_åˆ†å¸ƒå¼ç³»ç»Ÿè°ƒåº¦.md) - åˆ†å¸ƒå¼è°ƒåº¦ç†è®º
- [11.4 æŠ€æœ¯æ¶æ„å±‚è°ƒåº¦](../11_ä¼ä¸šæ¶æ„è°ƒåº¦/11.4_æŠ€æœ¯æ¶æ„å±‚è°ƒåº¦.md) - è·¨äº‘è°ƒåº¦å®è·µ

**Petriç½‘è§†è§’**ï¼š

- [PetriNetView/08 è·¨å±‚æ¬¡è°ƒåº¦](../PetriNetView/08_è·¨å±‚æ¬¡è°ƒåº¦çš„Petriç½‘ç»Ÿä¸€æ¨¡å‹/README.md) - è”é‚¦è°ƒåº¦çš„Petriç½‘å»ºæ¨¡

---

**è¿”å›**: [31 å¤šé›†ç¾¤è°ƒåº¦](README.md)
