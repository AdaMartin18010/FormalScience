# 04.1 状态转移系统

> **所属主题**: 04_动态交互模型
> **最后更新**: 2025-01-27

## 📋 目录

- [04.1 状态转移系统](#041-状态转移系统)
  - [📋 目录](#-目录)
  - [1. 统一状态机](#1-统一状态机)
  - [2. 状态转移定义](#2-状态转移定义)
  - [3. 三层系统状态映射](#3-三层系统状态映射)
  - [4. 相关文档](#4-相关文档)

---

## 1. 统一状态机

```python
# 统一状态机
class UnifiedStateMachine:
    def __init__(self):
        self.states = {INIT, PENDING, RUNNING, SUSPENDED, TERMINATED}
        self.transitions = {
            (INIT, PENDING):   "create_entity",
            (PENDING, RUNNING): "scheduler_activate",
            (RUNNING, SUSPENDED): "preempt_or_migrate",
            (ANY, TERMINATED):  "release_resources"
        }

    def step(self, event):
        # 马尔可夫决策过程
        # P(s'|s, a) = transition_prob(state, action)
        return self.policy.select_action(self.current_state)
```

---

## 2. 状态转移定义

**状态集合**：
- `INIT`: 初始状态
- `PENDING`: 等待状态
- `RUNNING`: 运行状态
- `SUSPENDED`: 挂起状态
- `TERMINATED`: 终止状态

**转移操作**：
- `create_entity`: 创建实体 (INIT → PENDING)
- `scheduler_activate`: 调度器激活 (PENDING → RUNNING)
- `preempt_or_migrate`: 抢占或迁移 (RUNNING → SUSPENDED)
- `release_resources`: 释放资源 (ANY → TERMINATED)

---

## 3. 三层系统状态映射

| 状态 | OS层 | VM层 | 容器层 |
|------|------|------|--------|
| INIT | 进程创建前 | VM定义 | Pod定义 |
| PENDING | TASK_INTERRUPTIBLE | VM关机 | Pod Pending |
| RUNNING | TASK_RUNNING | VM运行 | Pod Running |
| SUSPENDED | TASK_STOPPED | VM暂停 | Pod Suspended |
| TERMINATED | 进程退出 | VM删除 | Pod Terminated |

---

## 4. 相关文档

- [返回 FormalModel 目录](../README.md)
- [04_动态交互模型 README](README.md)
- [04.3_马尔可夫决策过程](04.3_马尔可夫决策过程.md)
- [01_基础形式化框架](../01_基础形式化框架/README.md)

---

**最后更新**: 2025-01-27

