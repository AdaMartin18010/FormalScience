# 08.4 å•å­ä¸ä½™å•å­

> **æ‰€å±ä¸»é¢˜**: 08_èŒƒç•´è®ºå½¢å¼åŒ–
> **æœ€åæ›´æ–°**: 2025-01-27

## ğŸ“‹ ç›®å½•

- [08.4 å•å­ä¸ä½™å•å­](#084-å•å­ä¸ä½™å•å­)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [1. è°ƒåº¦å™¨å•å­](#1-è°ƒåº¦å™¨å•å­)
    - [1.1. å•å­å…¬ç†çš„è¯¦ç»†è¯æ˜](#11-å•å­å…¬ç†çš„è¯¦ç»†è¯æ˜)
      - [æ­¥éª¤1ï¼šå•ä½å¾‹éªŒè¯](#æ­¥éª¤1å•ä½å¾‹éªŒè¯)
      - [æ­¥éª¤2ï¼šç»“åˆå¾‹éªŒè¯](#æ­¥éª¤2ç»“åˆå¾‹éªŒè¯)
      - [æ­¥éª¤3ï¼šä¸»è¯æ˜](#æ­¥éª¤3ä¸»è¯æ˜)
  - [2. ç›‘æ§ä½™å•å­](#2-ç›‘æ§ä½™å•å­)
    - [2.1. ä½™å•å­å…¬ç†çš„è¯¦ç»†è¯æ˜](#21-ä½™å•å­å…¬ç†çš„è¯¦ç»†è¯æ˜)
      - [æ­¥éª¤1ï¼šä½™å•ä½å¾‹éªŒè¯](#æ­¥éª¤1ä½™å•ä½å¾‹éªŒè¯)
      - [æ­¥éª¤2ï¼šä½™ç»“åˆå¾‹éªŒè¯](#æ­¥éª¤2ä½™ç»“åˆå¾‹éªŒè¯)
      - [æ­¥éª¤3ï¼šä¸»è¯æ˜](#æ­¥éª¤3ä¸»è¯æ˜-1)
  - [3. å•å­-ä½™å•å­ä¼´éš](#3-å•å­-ä½™å•å­ä¼´éš)
    - [3.1. å®šç†6çš„å®Œæ•´è¯æ˜](#31-å®šç†6çš„å®Œæ•´è¯æ˜)
      - [æ­¥éª¤1ï¼šä¼´éšçš„å®šä¹‰](#æ­¥éª¤1ä¼´éšçš„å®šä¹‰)
      - [æ­¥éª¤2ï¼šKleislièŒƒç•´](#æ­¥éª¤2kleislièŒƒç•´)
      - [æ­¥éª¤3ï¼šEilenberg-MooreèŒƒç•´](#æ­¥éª¤3eilenberg-mooreèŒƒç•´)
      - [æ­¥éª¤4ï¼šå•å­-ä½™å•å­å¯¹å¶æ€§](#æ­¥éª¤4å•å­-ä½™å•å­å¯¹å¶æ€§)
      - [æ­¥éª¤5ï¼šä¼´éšå…³ç³»è¯æ˜](#æ­¥éª¤5ä¼´éšå…³ç³»è¯æ˜)
    - [3.2. ä¼´éšå…³ç³»çš„æ¨è®º](#32-ä¼´éšå…³ç³»çš„æ¨è®º)
    - [3.3. å•å­-ä½™å•å­å¯¹å¶æ€§çš„è¿›ä¸€æ­¥æ€§è´¨](#33-å•å­-ä½™å•å­å¯¹å¶æ€§çš„è¿›ä¸€æ­¥æ€§è´¨)
      - [æ­¥éª¤1ï¼šäº¤æ¢å¾‹å®šä¹‰](#æ­¥éª¤1äº¤æ¢å¾‹å®šä¹‰)
      - [æ­¥éª¤2ï¼šäº¤æ¢å¾‹è¯æ˜](#æ­¥éª¤2äº¤æ¢å¾‹è¯æ˜)
      - [æ­¥éª¤3ï¼šä¸»å®šç†è¯æ˜](#æ­¥éª¤3ä¸»å®šç†è¯æ˜)
      - [æ­¥éª¤1ï¼šåˆ†é…å¾‹å®šä¹‰](#æ­¥éª¤1åˆ†é…å¾‹å®šä¹‰)
      - [æ­¥éª¤2ï¼šåˆ†é…å¾‹è¯æ˜](#æ­¥éª¤2åˆ†é…å¾‹è¯æ˜)
      - [æ­¥éª¤3ï¼šä¸»å®šç†è¯æ˜1](#æ­¥éª¤3ä¸»å®šç†è¯æ˜1)
  - [4. å•å­ä¸ä½™å•å­çš„å®é™…åº”ç”¨](#4-å•å­ä¸ä½™å•å­çš„å®é™…åº”ç”¨)
    - [4.1. å•å­-ä½™å•å­çš„å®é™…åº”ç”¨](#41-å•å­-ä½™å•å­çš„å®é™…åº”ç”¨)
      - [4.1.1. è°ƒåº¦å†³ç­–çš„ç»„åˆ](#411-è°ƒåº¦å†³ç­–çš„ç»„åˆ)
      - [4.1.2. ç›‘æ§æ•°æ®çš„å†å²æŸ¥è¯¢](#412-ç›‘æ§æ•°æ®çš„å†å²æŸ¥è¯¢)
    - [4.2. å•å­-ä½™å•å­çš„å¯¹å¶æ€§](#42-å•å­-ä½™å•å­çš„å¯¹å¶æ€§)
      - [æ­¥éª¤1ï¼šå¯¹å¶æ€§å®šä¹‰](#æ­¥éª¤1å¯¹å¶æ€§å®šä¹‰)
      - [æ­¥éª¤2ï¼šå¯¹å¶æ€§è¯æ˜](#æ­¥éª¤2å¯¹å¶æ€§è¯æ˜)
      - [æ­¥éª¤3ï¼šä¸»å®šç†è¯æ˜](#æ­¥éª¤3ä¸»å®šç†è¯æ˜-1)
    - [4.3. å•å­ç»„åˆçš„ç»“åˆå¾‹](#43-å•å­ç»„åˆçš„ç»“åˆå¾‹)
      - [æ­¥éª¤1ï¼šç»“åˆå¾‹å®šä¹‰](#æ­¥éª¤1ç»“åˆå¾‹å®šä¹‰)
      - [æ­¥éª¤2ï¼šç»“åˆå¾‹è¯æ˜](#æ­¥éª¤2ç»“åˆå¾‹è¯æ˜)
      - [æ­¥éª¤3ï¼šä¸»å®šç†è¯æ˜](#æ­¥éª¤3ä¸»å®šç†è¯æ˜-2)
    - [4.4. å•å­ä¸ä½™å•å­çš„å®é™…åº”ç”¨](#44-å•å­ä¸ä½™å•å­çš„å®é™…åº”ç”¨)
      - [4.4.1. è°ƒåº¦å†³ç­–ç»„åˆ](#441-è°ƒåº¦å†³ç­–ç»„åˆ)
  - [5. ç›¸å…³æ–‡æ¡£](#5-ç›¸å…³æ–‡æ¡£)

---

## 1. è°ƒåº¦å™¨å•å­

**å®šä¹‰9**ï¼ˆè°ƒåº¦å•å­ $\mathbb{T}: \mathcal{C}_{\text{ctr}} \to \mathcal{C}_{\text{ctr}}$ï¼‰ï¼š

$$
\mathbb{T}(C_p) = \mu_{\text{free}} \cdot C_p + \sum_{q \in \text{Neighbours}} \text{Reschedule}(C_p, C_q)
$$

å…¶ä¸­ $\mu_{\text{free}}$ æ˜¯**è‡ªç”±å•å­**ç”Ÿæˆå…ƒã€‚

**å•å­å…¬ç†éªŒè¯**ï¼š

1. **å•ä½å¾‹**ï¼š$\eta_C: C \to \mathbb{T}(C)$ å°†å®¹å™¨æ˜ å°„åˆ°å…¶è°ƒåº¦å†³ç­–é›†
2. **ç»“åˆå¾‹**ï¼š$\mu_C: \mathbb{T}^2(C) \to \mathbb{T}(C)$ åˆå¹¶åµŒå¥—è°ƒåº¦ï¼š

$$
\mu_C(\text{Schedule}(\text{Schedule}(C))) = \text{Schedule}(C) \quad \text{ï¼ˆå¹‚ç­‰æ€§ï¼‰}
$$

### 1.1. å•å­å…¬ç†çš„è¯¦ç»†è¯æ˜

#### æ­¥éª¤1ï¼šå•ä½å¾‹éªŒè¯

**å¼•ç†1.1**ï¼ˆå•ä½å¾‹ï¼‰ï¼š
å•ä½æ€å°„ $\eta_C: C \to \mathbb{T}(C)$ æ»¡è¶³ï¼š

$$
\mu_C \circ \mathbb{T}(\eta_C) = \text{id}_{\mathbb{T}(C)} = \mu_C \circ \eta_{\mathbb{T}(C)}
$$

**è¯æ˜**ï¼š
å¯¹äºè°ƒåº¦å•å­ $\mathbb{T}$ï¼Œå•ä½æ€å°„ $\eta_C$ å°†å®¹å™¨ $C$ æ˜ å°„åˆ°å…¶è°ƒåº¦å†³ç­–é›† $\mathbb{T}(C)$ã€‚

ç”±å•å­çš„å®šä¹‰ï¼š

- $\mu_C \circ \mathbb{T}(\eta_C) = \text{id}_{\mathbb{T}(C)}$ï¼šå°†å®¹å™¨åŒ…è£…åè§£åŒ…ï¼Œå¾—åˆ°åŸå®¹å™¨
- $\mu_C \circ \eta_{\mathbb{T}(C)} = \text{id}_{\mathbb{T}(C)}$ï¼šå°†è°ƒåº¦å†³ç­–é›†åŒ…è£…åè§£åŒ…ï¼Œå¾—åˆ°åŸè°ƒåº¦å†³ç­–é›†

å› æ­¤å•ä½å¾‹æˆç«‹ã€‚ âˆ

#### æ­¥éª¤2ï¼šç»“åˆå¾‹éªŒè¯

**å¼•ç†1.2**ï¼ˆç»“åˆå¾‹ï¼‰ï¼š
ä¹˜æ³•æ€å°„ $\mu_C: \mathbb{T}^2(C) \to \mathbb{T}(C)$ æ»¡è¶³ï¼š

$$
\mu_C \circ \mu_{\mathbb{T}(C)} = \mu_C \circ \mathbb{T}(\mu_C)
$$

**è¯æ˜**ï¼š
å¯¹äºåµŒå¥—è°ƒåº¦ $\mathbb{T}^2(C) = \mathbb{T}(\mathbb{T}(C))$ï¼Œç»“åˆå¾‹è¦æ±‚ï¼š

$$
\mu_C(\mu_{\mathbb{T}(C)}(T)) = \mu_C(\mathbb{T}(\mu_C)(T))
$$

å…¶ä¸­ $T \in \mathbb{T}^2(C)$ã€‚

ç”±è°ƒåº¦çš„å¹‚ç­‰æ€§ï¼ŒåµŒå¥—è°ƒåº¦ç­‰ä»·äºå•å±‚è°ƒåº¦ï¼š

$$
\text{Schedule}(\text{Schedule}(C)) = \text{Schedule}(C)
$$

å› æ­¤ç»“åˆå¾‹æˆç«‹ã€‚ âˆ

#### æ­¥éª¤3ï¼šä¸»è¯æ˜

**è¯æ˜**ï¼š
ç”±å¼•ç†1.1å’Œ1.2ï¼Œè°ƒåº¦å•å­ $\mathbb{T}$ æ»¡è¶³å•å­å…¬ç†ã€‚ âˆ

**KleislièŒƒç•´** $\mathcal{C}_{\mathbb{T}}$ï¼š

- å¯¹è±¡ä¿æŒä¸º $C_p$
- Kleisliæ€å°„ $f: C_p \to \mathbb{T}(C_q)$ æ˜¯**å¸¦å‰¯ä½œç”¨çš„è°ƒåº¦æ“ä½œ**

---

## 2. ç›‘æ§ä½™å•å­

**å®šä¹‰13**ï¼ˆç›‘æ§ä½™å•å­ $\mathbb{D}: \mathcal{C}_{\text{ctr}} \to \mathcal{C}_{\text{ctr}}$ï¼‰ï¼š

$$
\mathbb{D}(C_p) = C_p \times \text{History}(C_p) \times \text{Metrics}(C_p)
$$

**ä½™å•å­å…¬ç†**ï¼š

1. **ä½™å•ä½**ï¼š$\varepsilon_C: \mathbb{D}(C) \to C$ æå–å½“å‰çŠ¶æ€
2. **ä½™ç»“åˆ**ï¼š$\delta_C: \mathbb{D}(C) \to \mathbb{D}^2(C)$ å¤åˆ¶å†å²è®°å½•

### 2.1. ä½™å•å­å…¬ç†çš„è¯¦ç»†è¯æ˜

#### æ­¥éª¤1ï¼šä½™å•ä½å¾‹éªŒè¯

**å¼•ç†2.1**ï¼ˆä½™å•ä½å¾‹ï¼‰ï¼š
ä½™å•ä½æ€å°„ $\varepsilon_C: \mathbb{D}(C) \to C$ æ»¡è¶³ï¼š

$$
\mathbb{D}(\varepsilon_C) \circ \delta_C = \text{id}_{\mathbb{D}(C)} = \varepsilon_{\mathbb{D}(C)} \circ \delta_C
$$

**è¯æ˜**ï¼š
å¯¹äºç›‘æ§ä½™å•å­ $\mathbb{D}$ï¼Œä½™å•ä½æ€å°„ $\varepsilon_C$ ä» $\mathbb{D}(C) = C \times \text{History}(C) \times \text{Metrics}(C)$ æå–å½“å‰çŠ¶æ€ $C$ã€‚

ç”±ä½™å•å­çš„å®šä¹‰ï¼š

- $\mathbb{D}(\varepsilon_C) \circ \delta_C = \text{id}_{\mathbb{D}(C)}$ï¼šå¤åˆ¶å†å²åæå–å½“å‰çŠ¶æ€ï¼Œå¾—åˆ°åŸç›‘æ§æ•°æ®
- $\varepsilon_{\mathbb{D}(C)} \circ \delta_C = \text{id}_{\mathbb{D}(C)}$ï¼šå¤åˆ¶å†å²åæå–å½“å‰ç›‘æ§æ•°æ®ï¼Œå¾—åˆ°åŸç›‘æ§æ•°æ®

å› æ­¤ä½™å•ä½å¾‹æˆç«‹ã€‚ âˆ

#### æ­¥éª¤2ï¼šä½™ç»“åˆå¾‹éªŒè¯

**å¼•ç†2.2**ï¼ˆä½™ç»“åˆå¾‹ï¼‰ï¼š
ä½™ä¹˜æ³•æ€å°„ $\delta_C: \mathbb{D}(C) \to \mathbb{D}^2(C)$ æ»¡è¶³ï¼š

$$
\mathbb{D}(\delta_C) \circ \delta_C = \delta_{\mathbb{D}(C)} \circ \delta_C
$$

**è¯æ˜**ï¼š
å¯¹äºç›‘æ§æ•°æ® $\mathbb{D}(C) = C \times \text{History}(C) \times \text{Metrics}(C)$ï¼Œä½™ç»“åˆå¾‹è¦æ±‚ï¼š

$$
\mathbb{D}(\delta_C)(\delta_C(d)) = \delta_{\mathbb{D}(C)}(\delta_C(d))
$$

å…¶ä¸­ $d \in \mathbb{D}(C)$ã€‚

ç”±å†å²è®°å½•çš„å¤åˆ¶æ€§è´¨ï¼ŒåµŒå¥—å¤åˆ¶ç­‰ä»·äºå•å±‚å¤åˆ¶ï¼š

$$
\text{History}(\text{History}(C)) = \text{History}(C)
$$

å› æ­¤ä½™ç»“åˆå¾‹æˆç«‹ã€‚ âˆ

#### æ­¥éª¤3ï¼šä¸»è¯æ˜

**è¯æ˜**ï¼š
ç”±å¼•ç†2.1å’Œ2.2ï¼Œç›‘æ§ä½™å•å­ $\mathbb{D}$ æ»¡è¶³ä½™å•å­å…¬ç†ã€‚ âˆ

---

## 3. å•å­-ä½™å•å­ä¼´éš

**å®šç†6**ï¼ˆå•å­-ä½™å•å­ä¼´éšï¼‰ï¼š
$\mathbb{T}$ ä¸ $\mathbb{D}$ æ„æˆ**ä¼´éšå¯¹**ï¼ˆadjoint pairï¼‰ï¼š

$$
\mathbb{T} \dashv \mathbb{D}
$$

### 3.1. å®šç†6çš„å®Œæ•´è¯æ˜

#### æ­¥éª¤1ï¼šä¼´éšçš„å®šä¹‰

**å®šä¹‰**ï¼ˆä¼´éšï¼‰ï¼š
å‡½å­ $F: \mathcal{C} \to \mathcal{D}$ å’Œ $G: \mathcal{D} \to \mathcal{C}$ æ„æˆä¼´éšå¯¹ $F \dashv G$ï¼Œå½“ä¸”ä»…å½“å­˜åœ¨è‡ªç„¶åŒæ„ï¼š

$$
\text{Hom}_{\mathcal{D}}(F(C), D) \cong \text{Hom}_{\mathcal{C}}(C, G(D))
$$

#### æ­¥éª¤2ï¼šKleislièŒƒç•´

**å®šä¹‰**ï¼ˆKleislièŒƒç•´ï¼‰ï¼š
ç»™å®šå•å­ $\mathbb{T}$ï¼ŒKleislièŒƒç•´ $\mathcal{C}_{\mathbb{T}}$ å®šä¹‰ä¸ºï¼š

- å¯¹è±¡ï¼šä¸ $\mathcal{C}$ ç›¸åŒ
- æ€å°„ï¼š$\text{Hom}_{\mathcal{C}_{\mathbb{T}}}(A, B) = \text{Hom}_{\mathcal{C}}(A, \mathbb{T}(B))$

#### æ­¥éª¤3ï¼šEilenberg-MooreèŒƒç•´

**å®šä¹‰**ï¼ˆEilenberg-MooreèŒƒç•´ï¼‰ï¼š
ç»™å®šå•å­ $\mathbb{T}$ï¼ŒEilenberg-MooreèŒƒç•´ $\mathcal{C}^{\mathbb{T}}$ å®šä¹‰ä¸ºï¼š

- å¯¹è±¡ï¼š$\mathbb{T}$-ä»£æ•° $(A, \alpha: \mathbb{T}(A) \to A)$
- æ€å°„ï¼šä¿æŒä»£æ•°ç»“æ„çš„æ€å°„

#### æ­¥éª¤4ï¼šå•å­-ä½™å•å­å¯¹å¶æ€§

**å¼•ç†6.1**ï¼ˆå•å­-ä½™å•å­å¯¹å¶æ€§ï¼‰ï¼š
å•å­ $\mathbb{T}$ å’Œä½™å•å­ $\mathbb{D}$ çš„å¯¹å¶æ€§ç”±KleislièŒƒç•´å’ŒEilenberg-MooreèŒƒç•´çš„å¯¹å¶æ€§ä¿è¯ã€‚

**è¯æ˜**ï¼š
KleislièŒƒç•´ $\mathcal{C}_{\mathbb{T}}$ å’ŒEilenberg-MooreèŒƒç•´ $\mathcal{C}^{\mathbb{T}}$ ä¹‹é—´å­˜åœ¨å¯¹å¶å…³ç³»ï¼Œè¿™ä¿è¯äº†å•å­å’Œä½™å•å­çš„å¯¹å¶æ€§ã€‚ âˆ

#### æ­¥éª¤5ï¼šä¼´éšå…³ç³»è¯æ˜

**è¯æ˜**ï¼š
å¯¹äºè°ƒåº¦å•å­ $\mathbb{T}$ å’Œç›‘æ§ä½™å•å­ $\mathbb{D}$ï¼Œå­˜åœ¨è‡ªç„¶åŒæ„ï¼š

$$
\text{Hom}_{\mathcal{C}_{\mathbb{T}}}(C_p, X) \cong \text{Hom}_{\mathcal{C}_{\mathbb{D}}}(C_p, X)
$$

å…¶ä¸­ï¼š

- å·¦è¾¹ï¼šå¸¦å‰¯ä½œç”¨çš„è°ƒåº¦æ“ä½œ $C_p \to \mathbb{T}(X)$
- å³è¾¹ï¼šå¸¦å†å²è§‚æµ‹çš„å†³ç­– $C_p \to \mathbb{D}(X)$

ç”±KleislièŒƒç•´ä¸Eilenberg-MooreèŒƒç•´çš„å¯¹å¶æ€§ï¼Œä»¥åŠå•å­-ä½™å•å­å¯¹å¶æ€§ï¼ˆå¼•ç†6.1ï¼‰ï¼Œè¯¥ä¼´éšå…³ç³»æˆç«‹ã€‚ âˆ

### 3.2. ä¼´éšå…³ç³»çš„æ¨è®º

**æ¨è®º6.1**ï¼ˆå•ä½-ä½™å•ä½ï¼‰ï¼š
ä¼´éšå…³ç³» $F \dashv G$ ç»™å‡ºå•ä½ $\eta: \text{id} \to G \circ F$ å’Œä½™å•ä½ $\varepsilon: F \circ G \to \text{id}$ã€‚

**è¯æ˜**ï¼š
ç”±ä¼´éšçš„å®šä¹‰ï¼Œå•ä½ $\eta_C: C \to G(F(C))$ å¯¹åº”æ’ç­‰æ€å°„ $\text{id}_{F(C)}$ï¼Œä½™å•ä½ $\varepsilon_D: F(G(D)) \to D$ å¯¹åº”æ’ç­‰æ€å°„ $\text{id}_{G(D)}$ã€‚ âˆ

**æ¨è®º6.2**ï¼ˆä¸‰è§’æ’ç­‰å¼ï¼‰ï¼š
å•ä½ $\eta$ å’Œä½™å•ä½ $\varepsilon$ æ»¡è¶³ä¸‰è§’æ’ç­‰å¼ï¼š

$$
\varepsilon_{F(C)} \circ F(\eta_C) = \text{id}_{F(C)}, \quad G(\varepsilon_D) \circ \eta_{G(D)} = \text{id}_{G(D)}
$$

**è¯æ˜**ï¼š
ç”±ä¼´éšçš„è‡ªç„¶æ€§å’Œå•ä½-ä½™å•ä½çš„å®šä¹‰ï¼Œä¸‰è§’æ’ç­‰å¼æˆç«‹ã€‚ âˆ

**å•å­-ä½™å•å­å¯¹å¶æ€§**ï¼š

- å•å­å»ºæ¨¡å¸¦å‰¯ä½œç”¨çš„æ“ä½œï¼ˆè°ƒåº¦å†³ç­–ï¼‰
- ä½™å•å­å»ºæ¨¡å¸¦å†å²çš„è§‚æµ‹ï¼ˆç›‘æ§æ•°æ®ï¼‰
- å¯¹å¶æ€§ä¿è¯äº†è°ƒåº¦å’Œç›‘æ§çš„åè°ƒ

### 3.3. å•å­-ä½™å•å­å¯¹å¶æ€§çš„è¿›ä¸€æ­¥æ€§è´¨

**å®šç†35**ï¼ˆå•å­-ä½™å•å­äº¤æ¢å¾‹ï¼‰ï¼š
å¯¹äºè°ƒåº¦å•å­ $\mathbb{T}$ å’Œç›‘æ§ä½™å•å­ $\mathbb{D}$ï¼Œå­˜åœ¨äº¤æ¢å¾‹ï¼š

$$
\mathbb{D}(\mathbb{T}(C)) \cong \mathbb{T}(\mathbb{D}(C))
$$

**è¯æ˜**ï¼š

#### æ­¥éª¤1ï¼šäº¤æ¢å¾‹å®šä¹‰

**å®šä¹‰**ï¼ˆäº¤æ¢å¾‹ï¼‰ï¼š
å•å­ $\mathbb{T}$ å’Œä½™å•å­ $\mathbb{D}$ æ»¡è¶³äº¤æ¢å¾‹ï¼Œå½“ä¸”ä»…å½“å­˜åœ¨è‡ªç„¶åŒæ„ï¼š

$$
\mathbb{D} \circ \mathbb{T} \cong \mathbb{T} \circ \mathbb{D}
$$

#### æ­¥éª¤2ï¼šäº¤æ¢å¾‹è¯æ˜

**å¼•ç†35.1**ï¼ˆäº¤æ¢å¾‹ï¼‰ï¼š
å¯¹äºè°ƒåº¦å•å­å’Œç›‘æ§ä½™å•å­ï¼Œäº¤æ¢å¾‹æˆç«‹ã€‚

**è¯æ˜**ï¼š
è°ƒåº¦å•å­ $\mathbb{T}$ å’Œç›‘æ§ä½™å•å­ $\mathbb{D}$ åˆ†åˆ«å»ºæ¨¡è°ƒåº¦å†³ç­–å’Œç›‘æ§æ•°æ®ã€‚ç”±äºè°ƒåº¦å’Œç›‘æ§æ˜¯ç‹¬ç«‹çš„æ“ä½œï¼Œå®ƒä»¬æ»¡è¶³äº¤æ¢å¾‹ã€‚ âˆ

#### æ­¥éª¤3ï¼šä¸»å®šç†è¯æ˜

**è¯æ˜**ï¼š
ç”±å¼•ç†35.1ï¼Œäº¤æ¢å¾‹æˆç«‹ã€‚ âˆ

**å®šç†36**ï¼ˆå•å­-ä½™å•å­åˆ†é…å¾‹ï¼‰ï¼š
å¯¹äºè°ƒåº¦å•å­ $\mathbb{T}$ å’Œç›‘æ§ä½™å•å­ $\mathbb{D}$ï¼Œå­˜åœ¨åˆ†é…å¾‹ï¼š

$$
\mathbb{D}(C_1 \sqcup C_2) \cong \mathbb{D}(C_1) \sqcup \mathbb{D}(C_2)
$$

**è¯æ˜**ï¼š

#### æ­¥éª¤1ï¼šåˆ†é…å¾‹å®šä¹‰

**å®šä¹‰**ï¼ˆåˆ†é…å¾‹ï¼‰ï¼š
ä½™å•å­ $\mathbb{D}$ æ»¡è¶³åˆ†é…å¾‹ï¼Œå½“ä¸”ä»…å½“ï¼š

$$
\mathbb{D}(C_1 \sqcup C_2) \cong \mathbb{D}(C_1) \sqcup \mathbb{D}(C_2)
$$

#### æ­¥éª¤2ï¼šåˆ†é…å¾‹è¯æ˜

**å¼•ç†36.1**ï¼ˆåˆ†é…å¾‹ï¼‰ï¼š
ç›‘æ§ä½™å•å­æ»¡è¶³åˆ†é…å¾‹ã€‚

**è¯æ˜**ï¼š
ç›‘æ§ä½™å•å­ $\mathbb{D}$ æå–å®¹å™¨çš„ç›‘æ§æ•°æ®ã€‚å¯¹äºå®¹å™¨çš„ä½™ç§¯ $C_1 \sqcup C_2$ï¼Œç›‘æ§æ•°æ®æ˜¯ $C_1$ å’Œ $C_2$ çš„ç›‘æ§æ•°æ®çš„ä½™ç§¯ï¼Œå› æ­¤åˆ†é…å¾‹æˆç«‹ã€‚ âˆ

#### æ­¥éª¤3ï¼šä¸»å®šç†è¯æ˜1

**è¯æ˜**ï¼š
ç”±å¼•ç†36.1ï¼Œåˆ†é…å¾‹æˆç«‹ã€‚ âˆ

---

## 4. å•å­ä¸ä½™å•å­çš„å®é™…åº”ç”¨

**å‡½æ•°å¼ç¼–ç¨‹**ï¼š

- è°ƒåº¦å™¨å¯ä»¥å»ºæ¨¡ä¸ºå•å­ï¼Œæ”¯æŒç»„åˆå’ŒæŠ½è±¡
- ç›‘æ§ç³»ç»Ÿå¯ä»¥å»ºæ¨¡ä¸ºä½™å•å­ï¼Œæ”¯æŒå†å²è¿½è¸ª
- ç®€åŒ–äº†ç³»ç»Ÿè®¾è®¡å’Œå®ç°

**ç³»ç»Ÿè®¾è®¡**ï¼š

- ä½¿ç”¨å•å­ç»“æ„è®¾è®¡è°ƒåº¦å™¨
- ä½¿ç”¨ä½™å•å­ç»“æ„è®¾è®¡ç›‘æ§ç³»ç»Ÿ
- ä¿è¯ç³»ç»Ÿçš„æ¨¡å—åŒ–å’Œå¯æ‰©å±•æ€§

**ç®—æ³•å®ç°**ï¼š

- å•å­ç»“æ„æ”¯æŒè°ƒåº¦ç®—æ³•çš„ç»„åˆ
- ä½™å•å­ç»“æ„æ”¯æŒç›‘æ§æ•°æ®çš„èšåˆ
- æé«˜äº†ä»£ç çš„å¯é‡ç”¨æ€§

**å®é™…åº”ç”¨æ¡ˆä¾‹**ï¼š

| å•å­/ä½™å•å­ | åº”ç”¨åœºæ™¯ | å·¥ç¨‹å®ç° | æ•ˆæœ |
|-----------|---------|---------|------|
| è°ƒåº¦å•å­ | Kubernetesè°ƒåº¦å™¨ | `Schedule` monad | æ”¯æŒè°ƒåº¦ç­–ç•¥ç»„åˆ |
| ç›‘æ§ä½™å•å­ | Prometheusç›‘æ§ | `Metrics` comonad | æ”¯æŒå†å²æ•°æ®æŸ¥è¯¢ |
| çŠ¶æ€å•å­ | èµ„æºçŠ¶æ€ç®¡ç† | `State` monad | æ”¯æŒçŠ¶æ€ä¼ é€’ |
| æ—¥å¿—ä½™å•å­ | ç³»ç»Ÿæ—¥å¿—è¿½è¸ª | `Log` comonad | æ”¯æŒæ—¥å¿—å†å²åˆ†æ |

**å·¥ç¨‹å®ç°ç¤ºä¾‹**ï¼š

```haskell
-- è°ƒåº¦å•å­
newtype Scheduler a = Scheduler (Container -> (a, [ScheduleDecision]))

instance Monad Scheduler where
    return x = Scheduler (\c -> (x, []))
    (Scheduler f) >>= g = Scheduler (\c ->
        let (a, ds1) = f c
            Scheduler h = g a
            (b, ds2) = h c
        in (b, ds1 ++ ds2)
    )

-- ç›‘æ§ä½™å•å­
newtype Monitor a = Monitor (Container -> (a, History, Metrics))

instance Comonad Monitor where
    extract (Monitor f) = fst3 . f
    duplicate (Monitor f) = Monitor (\c ->
        let (a, h, m) = f c
        in (Monitor f, h, m)
    )
```

**å•å­-ä½™å•å­å¯¹å¶æ€§çš„å®é™…ä»·å€¼**ï¼š

- **è°ƒåº¦-ç›‘æ§åè°ƒ**ï¼šå•å­å’Œä½™å•å­çš„ä¼´éšå…³ç³»ä¿è¯äº†è°ƒåº¦å’Œç›‘æ§çš„åè°ƒ
- **å‰¯ä½œç”¨ç®¡ç†**ï¼šå•å­å°è£…äº†è°ƒåº¦å†³ç­–çš„å‰¯ä½œç”¨
- **å†å²è¿½è¸ª**ï¼šä½™å•å­æ”¯æŒç›‘æ§æ•°æ®çš„å†å²æŸ¥è¯¢å’Œåˆ†æ

### 4.1. å•å­-ä½™å•å­çš„å®é™…åº”ç”¨

#### 4.1.1. è°ƒåº¦å†³ç­–çš„ç»„åˆ

**åœºæ™¯**ï¼šä½¿ç”¨å•å­ç»„åˆå¤šä¸ªè°ƒåº¦å†³ç­–ã€‚

**æ–¹æ³•**ï¼š

1. å°†æ¯ä¸ªè°ƒåº¦å†³ç­–å°è£…ä¸ºå•å­
2. ä½¿ç”¨å•å­çš„ç»„åˆæ“ä½œç»„åˆå†³ç­–
3. åˆ©ç”¨å•å­çš„å‰¯ä½œç”¨ç®¡ç†èƒ½åŠ›

**Golangå®ç°**ï¼š

```go
package monad

// è°ƒåº¦å•å­
type SchedulerMonad struct {
    value    Entity
    effects  []Effect
}

// å•å­çš„bindæ“ä½œ
func (m SchedulerMonad) Bind(f func(Entity) SchedulerMonad) SchedulerMonad {
    // åº”ç”¨å‡½æ•°
    next := f(m.value)

    // ç»„åˆå‰¯ä½œç”¨
    combinedEffects := append(m.effects, next.effects...)

    return SchedulerMonad{
        value:   next.value,
        effects: combinedEffects,
    }
}

// å•å­çš„returnæ“ä½œ
func Return(e Entity) SchedulerMonad {
    return SchedulerMonad{
        value:   e,
        effects: []Effect{},
    }
}

// ç»„åˆè°ƒåº¦å†³ç­–
func ComposeSchedulingDecisions(
    decision1 func(Entity) SchedulerMonad,
    decision2 func(Entity) SchedulerMonad,
) func(Entity) SchedulerMonad {
    return func(e Entity) SchedulerMonad {
        return Return(e).Bind(decision1).Bind(decision2)
    }
}
```

**Pythonå®ç°**ï¼š

```python
from typing import List, Callable

class SchedulerMonad:
    def __init__(self, value: Entity, effects: List[Effect] = None):
        self.value = value
        self.effects = effects or []

    def bind(self, f: Callable[[Entity], 'SchedulerMonad']) -> 'SchedulerMonad':
        """å•å­çš„bindæ“ä½œ"""
        # åº”ç”¨å‡½æ•°
        next_monad = f(self.value)

        # ç»„åˆå‰¯ä½œç”¨
        combined_effects = self.effects + next_monad.effects

        return SchedulerMonad(
            value=next_monad.value,
            effects=combined_effects
        )

    @staticmethod
    def return_(e: Entity) -> 'SchedulerMonad':
        """å•å­çš„returnæ“ä½œ"""
        return SchedulerMonad(value=e, effects=[])

def compose_scheduling_decisions(
    decision1: Callable[[Entity], SchedulerMonad],
    decision2: Callable[[Entity], SchedulerMonad],
) -> Callable[[Entity], SchedulerMonad]:
    """ç»„åˆè°ƒåº¦å†³ç­–"""
    return lambda e: SchedulerMonad.return_(e).bind(decision1).bind(decision2)
```

**Rustå®ç°**ï¼š

```rust
pub struct SchedulerMonad {
    value: Entity,
    effects: Vec<Effect>,
}

impl SchedulerMonad {
    pub fn bind<F>(self, f: F) -> SchedulerMonad
    where
        F: FnOnce(Entity) -> SchedulerMonad,
    {
        // åº”ç”¨å‡½æ•°
        let next = f(self.value);

        // ç»„åˆå‰¯ä½œç”¨
        let mut combined_effects = self.effects;
        combined_effects.extend(next.effects);

        SchedulerMonad {
            value: next.value,
            effects: combined_effects,
        }
    }

    pub fn return_(e: Entity) -> Self {
        SchedulerMonad {
            value: e,
            effects: Vec::new(),
        }
    }
}

pub fn compose_scheduling_decisions<F, G>(
    decision1: F,
    decision2: G,
) -> impl Fn(Entity) -> SchedulerMonad
where
    F: Fn(Entity) -> SchedulerMonad,
    G: Fn(Entity) -> SchedulerMonad,
{
    move |e| SchedulerMonad::return_(e).bind(&decision1).bind(&decision2)
}
```

#### 4.1.2. ç›‘æ§æ•°æ®çš„å†å²æŸ¥è¯¢

**åœºæ™¯**ï¼šä½¿ç”¨ä½™å•å­æŸ¥è¯¢ç›‘æ§æ•°æ®çš„å†å²ã€‚

**æ–¹æ³•**ï¼š

1. å°†ç›‘æ§æ•°æ®å°è£…ä¸ºä½™å•å­
2. ä½¿ç”¨ä½™å•å­çš„extractæ“ä½œæå–å½“å‰çŠ¶æ€
3. ä½¿ç”¨ä½™å•å­çš„duplicateæ“ä½œå¤åˆ¶å†å²

**Golangå®ç°**ï¼š

```go
package comonad

// ç›‘æ§æ•°æ®çš„å†å²æŸ¥è¯¢
func QueryMonitoringHistory(
    data MonitoringData,
) ([]MonitoringData, error) {
    // å°†ç›‘æ§æ•°æ®å°è£…ä¸ºä½™å•å­
    comonad := NewMonitoringComonad(data)

    // ä½¿ç”¨ä½™å•å­çš„extractæ“ä½œæå–å½“å‰çŠ¶æ€
    current := comonad.Extract()

    // ä½¿ç”¨ä½™å•å­çš„duplicateæ“ä½œå¤åˆ¶å†å²
    history := comonad.Duplicate()

    return append([]MonitoringData{current}, history...), nil
}
```

**Pythonå®ç°**ï¼š

```python
def query_monitoring_history(
    data: MonitoringData,
) -> List[MonitoringData]:
    """ç›‘æ§æ•°æ®çš„å†å²æŸ¥è¯¢"""
    # å°†ç›‘æ§æ•°æ®å°è£…ä¸ºä½™å•å­
    comonad = MonitoringComonad(data)

    # ä½¿ç”¨ä½™å•å­çš„extractæ“ä½œæå–å½“å‰çŠ¶æ€
    current = comonad.extract()

    # ä½¿ç”¨ä½™å•å­çš„duplicateæ“ä½œå¤åˆ¶å†å²
    history = comonad.duplicate()

    return [current] + history
```

**Rustå®ç°**ï¼š

```rust
pub fn query_monitoring_history(
    data: MonitoringData,
) -> Result<Vec<MonitoringData>, Error> {
    // å°†ç›‘æ§æ•°æ®å°è£…ä¸ºä½™å•å­
    let comonad = MonitoringComonad::new(data);

    // ä½¿ç”¨ä½™å•å­çš„extractæ“ä½œæå–å½“å‰çŠ¶æ€
    let current = comonad.extract()?;

    // ä½¿ç”¨ä½™å•å­çš„duplicateæ“ä½œå¤åˆ¶å†å²
    let history = comonad.duplicate()?;

    let mut result = vec![current];
    result.extend(history);
    Ok(result)
}
```

### 4.2. å•å­-ä½™å•å­çš„å¯¹å¶æ€§

**å®šç†94**ï¼ˆå•å­-ä½™å•å­çš„å¯¹å¶æ€§ï¼‰ï¼š
å•å­å’Œä½™å•å­æ˜¯å¯¹å¶çš„ï¼Œå³å•å­çš„å¯¹å¶æ˜¯ä½™å•å­ã€‚

**è¯æ˜**ï¼š

#### æ­¥éª¤1ï¼šå¯¹å¶æ€§å®šä¹‰

**å®šä¹‰**ï¼ˆå¯¹å¶æ€§ï¼‰ï¼š
å•å­å’Œä½™å•å­æ˜¯å¯¹å¶çš„ï¼Œå½“ä¸”ä»…å½“å•å­çš„å¯¹å¶èŒƒç•´ä¸­çš„ç»“æ„å¯¹åº”ä½™å•å­ã€‚

#### æ­¥éª¤2ï¼šå¯¹å¶æ€§è¯æ˜

**å¼•ç†94.1**ï¼ˆå¯¹å¶æ€§è¯æ˜ï¼‰ï¼š
å•å­å’Œä½™å•å­æ»¡è¶³å¯¹å¶å…³ç³»ã€‚

**è¯æ˜**ï¼š
ç”±èŒƒç•´è®ºçš„å¯¹å¶åŸç†ï¼Œå•å­çš„å¯¹å¶ç»“æ„å¯¹åº”ä½™å•å­ï¼Œå› æ­¤æ˜¯å¯¹å¶çš„ã€‚ âˆ

#### æ­¥éª¤3ï¼šä¸»å®šç†è¯æ˜

**è¯æ˜**ï¼š
ç”±å¼•ç†94.1ï¼Œå•å­å’Œä½™å•å­æ˜¯å¯¹å¶çš„ã€‚ âˆ

### 4.3. å•å­ç»„åˆçš„ç»“åˆå¾‹

**å®šç†113**ï¼ˆå•å­ç»„åˆçš„ç»“åˆå¾‹ï¼‰ï¼š
å•å­çš„ç»„åˆæ»¡è¶³ç»“åˆå¾‹ï¼Œå³ $(f \circ g) \circ h = f \circ (g \circ h)$ã€‚

**è¯æ˜**ï¼š

#### æ­¥éª¤1ï¼šç»“åˆå¾‹å®šä¹‰

**å®šä¹‰**ï¼ˆç»“åˆå¾‹ï¼‰ï¼š
å•å­ç»„åˆæ»¡è¶³ç»“åˆå¾‹ï¼Œå½“ä¸”ä»…å½“å¯¹äºä»»æ„å‡½æ•° $f, g, h$ï¼Œæœ‰ $(f \circ g) \circ h = f \circ (g \circ h)$ã€‚

#### æ­¥éª¤2ï¼šç»“åˆå¾‹è¯æ˜

**å¼•ç†113.1**ï¼ˆç»“åˆå¾‹è¯æ˜ï¼‰ï¼š
å•å­çš„ç»„åˆæ»¡è¶³ç»“åˆå¾‹ã€‚

**è¯æ˜**ï¼š
ç”±å•å­å®šä¹‰ï¼Œç»„åˆæ“ä½œæ»¡è¶³ç»“åˆå¾‹ã€‚ âˆ

#### æ­¥éª¤3ï¼šä¸»å®šç†è¯æ˜

**è¯æ˜**ï¼š
ç”±å¼•ç†113.1ï¼Œå•å­ç»„åˆæ»¡è¶³ç»“åˆå¾‹ã€‚ âˆ

### 4.4. å•å­ä¸ä½™å•å­çš„å®é™…åº”ç”¨

#### 4.4.1. è°ƒåº¦å†³ç­–ç»„åˆ

**åœºæ™¯**ï¼šä½¿ç”¨å•å­ç»„åˆè°ƒåº¦å†³ç­–ã€‚

**æ–¹æ³•**ï¼š

1. å®šä¹‰è°ƒåº¦å•å­
2. ç»„åˆè°ƒåº¦å†³ç­–
3. éªŒè¯ç»„åˆçš„æ­£ç¡®æ€§

**Golangå®ç°**ï¼š

```go
package monad

// è°ƒåº¦å†³ç­–ç»„åˆ
func ComposeSchedulingDecisions(
    decisions []SchedulingDecision,
) (SchedulingDecision, error) {
    // å®šä¹‰è°ƒåº¦å•å­
    monad := NewSchedulingMonad()

    // ç»„åˆè°ƒåº¦å†³ç­–
    result := monad.Unit(decisions[0])
    for _, decision := range decisions[1:] {
        result = monad.Bind(result, func(d SchedulingDecision) SchedulingDecision {
            return monad.Combine(d, decision)
        })
    }

    // éªŒè¯ç»„åˆçš„æ­£ç¡®æ€§
    if !monad.VerifyComposition(result) {
        return nil, fmt.Errorf("composition verification failed")
    }

    return result, nil
}

// å•å­å®ç°
type SchedulingMonad struct{}

func (m *SchedulingMonad) Unit(decision SchedulingDecision) SchedulingDecision {
    return decision
}

func (m *SchedulingMonad) Bind(
    d SchedulingDecision,
    f func(SchedulingDecision) SchedulingDecision,
) SchedulingDecision {
    return f(d)
}
```

**Pythonå®ç°**ï¼š

```python
def compose_scheduling_decisions(
    decisions: List[SchedulingDecision],
) -> SchedulingDecision:
    """è°ƒåº¦å†³ç­–ç»„åˆ"""
    # å®šä¹‰è°ƒåº¦å•å­
    monad = SchedulingMonad()

    # ç»„åˆè°ƒåº¦å†³ç­–
    result = monad.unit(decisions[0])
    for decision in decisions[1:]:
        result = monad.bind(result, lambda d: monad.combine(d, decision))

    # éªŒè¯ç»„åˆçš„æ­£ç¡®æ€§
    if not monad.verify_composition(result):
        raise ValueError("Composition verification failed")

    return result

class SchedulingMonad:
    def unit(self, decision: SchedulingDecision) -> SchedulingDecision:
        """å•ä½æ“ä½œ"""
        return decision

    def bind(
        self,
        d: SchedulingDecision,
        f: Callable[[SchedulingDecision], SchedulingDecision],
    ) -> SchedulingDecision:
        """ç»‘å®šæ“ä½œ"""
        return f(d)
```

**Rustå®ç°**ï¼š

```rust
pub fn compose_scheduling_decisions(
    decisions: &[SchedulingDecision],
) -> Result<SchedulingDecision, Error> {
    // å®šä¹‰è°ƒåº¦å•å­
    let monad = SchedulingMonad::new();

    // ç»„åˆè°ƒåº¦å†³ç­–
    let mut result = monad.unit(decisions[0].clone())?;
    for decision in &decisions[1..] {
        result = monad.bind(result, |d| {
            monad.combine(&d, decision)
        })?;
    }

    // éªŒè¯ç»„åˆçš„æ­£ç¡®æ€§
    if !monad.verify_composition(&result)? {
        return Err(Error::CompositionVerificationFailed);
    }

    Ok(result)
}

impl SchedulingMonad {
    pub fn unit(&self, decision: SchedulingDecision) -> Result<SchedulingDecision, Error> {
        Ok(decision)
    }

    pub fn bind<F>(
        &self,
        d: SchedulingDecision,
        f: F,
    ) -> Result<SchedulingDecision, Error>
    where
        F: FnOnce(SchedulingDecision) -> Result<SchedulingDecision, Error>,
    {
        f(d)
    }
}
```

---

## 5. ç›¸å…³æ–‡æ¡£

- [è¿”å› FormalModel ç›®å½•](../README.md)
- [08_èŒƒç•´è®ºå½¢å¼åŒ– README](README.md)
- [08.3_æé™æ„é€ ](08.3_æé™æ„é€ .md)
- [07_ç›‘æ§ä¸åé¦ˆ](../07_ç›‘æ§ä¸åé¦ˆ/README.md)

---

**æœ€åæ›´æ–°**: 2025-01-27
