# 08.3 æé™æ„é€ 

> **æ‰€å±ä¸»é¢˜**: 08_èŒƒç•´è®ºå½¢å¼åŒ–
> **æœ€åæ›´æ–°**: 2025-01-27

## ğŸ“‹ ç›®å½•

- [08.3 æé™æ„é€ ](#083-æé™æ„é€ )
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [1. æ‹‰å›çš„åŒæ­¥è¯­ä¹‰](#1-æ‹‰å›çš„åŒæ­¥è¯­ä¹‰)
    - [1.1. å®šç†3çš„å®Œæ•´è¯æ˜](#11-å®šç†3çš„å®Œæ•´è¯æ˜)
      - [æ­¥éª¤1ï¼šæ‹‰å›çš„å®šä¹‰](#æ­¥éª¤1æ‹‰å›çš„å®šä¹‰)
      - [æ­¥éª¤2ï¼šç­‰åŒ–å­çš„å®šä¹‰](#æ­¥éª¤2ç­‰åŒ–å­çš„å®šä¹‰)
      - [æ­¥éª¤3ï¼šå‡½å­ä¿æŒç­‰åŒ–å­](#æ­¥éª¤3å‡½å­ä¿æŒç­‰åŒ–å­)
      - [æ­¥éª¤4ï¼šæ‹‰å›å­˜åœ¨æ€§è¯æ˜](#æ­¥éª¤4æ‹‰å›å­˜åœ¨æ€§è¯æ˜)
      - [æ­¥éª¤5ï¼šç­‰åŒ–å­ä¿æŒæ€§](#æ­¥éª¤5ç­‰åŒ–å­ä¿æŒæ€§)
  - [2. æ¨å‡ºçš„è¿ç§»è¯­ä¹‰](#2-æ¨å‡ºçš„è¿ç§»è¯­ä¹‰)
  - [3. èµ„æºç®¡ç†çš„æ³›æ€§è´¨](#3-èµ„æºç®¡ç†çš„æ³›æ€§è´¨)
    - [3.1. æ³›æ€§è´¨çš„è¯¦ç»†è¯´æ˜](#31-æ³›æ€§è´¨çš„è¯¦ç»†è¯´æ˜)
    - [3.2. å®šç†4çš„å®Œæ•´è¯æ˜](#32-å®šç†4çš„å®Œæ•´è¯æ˜)
      - [æ­¥éª¤1ï¼šæ¨å‡ºçš„å®šä¹‰](#æ­¥éª¤1æ¨å‡ºçš„å®šä¹‰)
      - [æ­¥éª¤2ï¼šä½™ç§¯çš„å®šä¹‰](#æ­¥éª¤2ä½™ç§¯çš„å®šä¹‰)
      - [æ­¥éª¤3ï¼šåˆ†é…å¾‹è¯æ˜](#æ­¥éª¤3åˆ†é…å¾‹è¯æ˜)
      - [æ­¥éª¤4ï¼šä¸»å®šç†è¯æ˜](#æ­¥éª¤4ä¸»å®šç†è¯æ˜)
  - [4. æé™æ„é€ çš„å®é™…åº”ç”¨](#4-æé™æ„é€ çš„å®é™…åº”ç”¨)
    - [4.1. æé™æ„é€ çš„å”¯ä¸€æ€§è¯æ˜](#41-æé™æ„é€ çš„å”¯ä¸€æ€§è¯æ˜)
      - [æ­¥éª¤1ï¼šå”¯ä¸€æ€§å®šä¹‰](#æ­¥éª¤1å”¯ä¸€æ€§å®šä¹‰)
      - [æ­¥éª¤2ï¼šå”¯ä¸€æ€§è¯æ˜](#æ­¥éª¤2å”¯ä¸€æ€§è¯æ˜)
      - [æ­¥éª¤3ï¼šä¸»å®šç†è¯æ˜](#æ­¥éª¤3ä¸»å®šç†è¯æ˜)
    - [4.2. æé™æ„é€ çš„å‡½å­æ€§](#42-æé™æ„é€ çš„å‡½å­æ€§)
      - [æ­¥éª¤1ï¼šå‡½å­å®šä¹‰](#æ­¥éª¤1å‡½å­å®šä¹‰)
      - [æ­¥éª¤2ï¼šå‡½å­å…¬ç†](#æ­¥éª¤2å‡½å­å…¬ç†)
      - [æ­¥éª¤3ï¼šä¸»å®šç†è¯æ˜](#æ­¥éª¤3ä¸»å®šç†è¯æ˜-1)
    - [4.3. æé™æ„é€ çš„å®é™…åº”ç”¨](#43-æé™æ„é€ çš„å®é™…åº”ç”¨)
      - [4.3.1. çŠ¶æ€åŒæ­¥çš„å®ç°](#431-çŠ¶æ€åŒæ­¥çš„å®ç°)
      - [4.3.2. èµ„æºåˆ†é…çš„ä¼˜åŒ–](#432-èµ„æºåˆ†é…çš„ä¼˜åŒ–)
      - [æ­¥éª¤1ï¼šæœ€ä¼˜åˆ†é…å®šä¹‰](#æ­¥éª¤1æœ€ä¼˜åˆ†é…å®šä¹‰)
      - [æ­¥éª¤2ï¼šæé™æ„é€ ](#æ­¥éª¤2æé™æ„é€ )
      - [æ­¥éª¤3ï¼šä¸»å®šç†è¯æ˜](#æ­¥éª¤3ä¸»å®šç†è¯æ˜-2)
    - [4.4. æé™çš„å”¯ä¸€æ€§](#44-æé™çš„å”¯ä¸€æ€§)
      - [æ­¥éª¤1ï¼šå”¯ä¸€æ€§å®šä¹‰](#æ­¥éª¤1å”¯ä¸€æ€§å®šä¹‰-1)
      - [æ­¥éª¤2ï¼šå”¯ä¸€æ€§è¯æ˜](#æ­¥éª¤2å”¯ä¸€æ€§è¯æ˜-1)
      - [æ­¥éª¤3ï¼šä¸»å®šç†è¯æ˜](#æ­¥éª¤3ä¸»å®šç†è¯æ˜-3)
    - [4.5. æé™æ„é€ çš„å®é™…åº”ç”¨](#45-æé™æ„é€ çš„å®é™…åº”ç”¨)
      - [4.5.1. èµ„æºåˆ†é…ä¼˜åŒ–](#451-èµ„æºåˆ†é…ä¼˜åŒ–)
    - [4.6. æé™æ„é€ çš„å”¯ä¸€æ€§](#46-æé™æ„é€ çš„å”¯ä¸€æ€§)
      - [æ­¥éª¤1ï¼šå”¯ä¸€æ€§å®šä¹‰](#æ­¥éª¤1å”¯ä¸€æ€§å®šä¹‰-2)
      - [æ­¥éª¤2ï¼šå”¯ä¸€æ€§è¯æ˜](#æ­¥éª¤2å”¯ä¸€æ€§è¯æ˜-2)
      - [æ­¥éª¤3ï¼šä¸»å®šç†è¯æ˜](#æ­¥éª¤3ä¸»å®šç†è¯æ˜-4)
    - [4.7. æé™æ„é€ çš„å®é™…åº”ç”¨](#47-æé™æ„é€ çš„å®é™…åº”ç”¨)
      - [4.7.1. æœ€ä¼˜èµ„æºåˆ†é…](#471-æœ€ä¼˜èµ„æºåˆ†é…)
  - [5. ç›¸å…³æ–‡æ¡£](#5-ç›¸å…³æ–‡æ¡£)

---

## 1. æ‹‰å›çš„åŒæ­¥è¯­ä¹‰

**åœºæ™¯**ï¼šåœ¨VMè¿ç§»è¿‡ç¨‹ä¸­ï¼Œéœ€åŒæ­¥OSè¿›ç¨‹çŠ¶æ€ã€‚

**æ„é€ **ï¼šç»™å®šVMçŠ¶æ€ $V_k$ å’Œå®¹å™¨çŠ¶æ€ $C_p$ æ˜ å°„åˆ°åŒä¸€è§‚æµ‹å€¼ $\mathbf{m}$ï¼š

$$
\begin{array}{ccc}
P_i & \xrightarrow{\text{checkpoint}} & \mathbf{m} \\
\downarrow{\text{restore}} & & \downarrow{\text{inject}} \\
V_k & \xrightarrow{\text{monitor}} & \mathbf{m}
\end{array}
$$

**æ‹‰å›å¯¹è±¡**ï¼ˆPullbackï¼‰ï¼š

$$
P_i \times_{\mathbf{m}} V_k = \{ (p, v) \mid \text{monitor}(v) = \text{checkpoint}(p) \}
$$

è¯¥å¯¹è±¡å”¯ä¸€æ»¡è¶³ï¼šä»»ä½•å…¶ä»–å¯¹è±¡ $X$ åˆ° $P_i$ å’Œ $V_k$ çš„æ€å°„ï¼Œå¿…å”¯ä¸€é€šè¿‡ $P_i \times_{\mathbf{m}} V_k$ã€‚

**å®šç†3**ï¼ˆä¸‰å±‚çŠ¶æ€åŒæ­¥çš„æ‹‰å›å­˜åœ¨æ€§ï¼‰ï¼š
åœ¨èŒƒç•´ $\mathcal{C}_{\text{os}} \times_{\mathbf{Set}} \mathcal{C}_{\text{vm}}$ ä¸­ï¼Œæ‹‰å›å­˜åœ¨å½“ä¸”ä»…å½“ç›‘æ§å‡½å­ $\mathcal{M}$ ä¿æŒ**ç­‰åŒ–å­**ï¼ˆequalizerï¼‰ã€‚

### 1.1. å®šç†3çš„å®Œæ•´è¯æ˜

#### æ­¥éª¤1ï¼šæ‹‰å›çš„å®šä¹‰

**å®šä¹‰**ï¼ˆæ‹‰å›ï¼‰ï¼š
ç»™å®šæ€å°„ $f: A \to C$ å’Œ $g: B \to C$ï¼Œæ‹‰å›æ˜¯ä¸€ä¸ªå¯¹è±¡ $P$ å’Œæ€å°„ $p_1: P \to A$ã€$p_2: P \to B$ï¼Œä½¿å¾—ï¼š

1. $f \circ p_1 = g \circ p_2$
2. å¯¹äºä»»æ„å¯¹è±¡ $X$ å’Œæ€å°„ $x_1: X \to A$ã€$x_2: X \to B$ï¼Œè‹¥ $f \circ x_1 = g \circ x_2$ï¼Œåˆ™å­˜åœ¨å”¯ä¸€çš„æ€å°„ $u: X \to P$ï¼Œä½¿å¾— $p_1 \circ u = x_1$ ä¸” $p_2 \circ u = x_2$ã€‚

#### æ­¥éª¤2ï¼šç­‰åŒ–å­çš„å®šä¹‰

**å®šä¹‰**ï¼ˆç­‰åŒ–å­ï¼‰ï¼š
ç»™å®šæ€å°„ $f, g: A \to B$ï¼Œç­‰åŒ–å­æ˜¯ä¸€ä¸ªå¯¹è±¡ $E$ å’Œæ€å°„ $e: E \to A$ï¼Œä½¿å¾—ï¼š

1. $f \circ e = g \circ e$
2. å¯¹äºä»»æ„å¯¹è±¡ $X$ å’Œæ€å°„ $x: X \to A$ï¼Œè‹¥ $f \circ x = g \circ x$ï¼Œåˆ™å­˜åœ¨å”¯ä¸€çš„æ€å°„ $u: X \to E$ï¼Œä½¿å¾— $e \circ u = x$ã€‚

#### æ­¥éª¤3ï¼šå‡½å­ä¿æŒç­‰åŒ–å­

**å¼•ç†3.1**ï¼ˆå‡½å­ä¿æŒç­‰åŒ–å­ï¼‰ï¼š
å‡½å­ $F: \mathcal{C} \to \mathcal{D}$ ä¿æŒç­‰åŒ–å­ï¼Œå½“ä¸”ä»…å½“å¯¹äºä»»æ„ç­‰åŒ–å­ $e: E \to A$ï¼Œ$F(e)$ ä¹Ÿæ˜¯ç­‰åŒ–å­ã€‚

**è¯æ˜**ï¼š
ç”±å‡½å­çš„å®šä¹‰ï¼Œè‹¥ $e$ æ˜¯ $f$ å’Œ $g$ çš„ç­‰åŒ–å­ï¼Œåˆ™ $F(e)$ æ˜¯ $F(f)$ å’Œ $F(g)$ çš„ç­‰åŒ–å­ã€‚ âˆ

#### æ­¥éª¤4ï¼šæ‹‰å›å­˜åœ¨æ€§è¯æ˜

**è¯æ˜**ï¼š
åœ¨èŒƒç•´ $\mathcal{C}_{\text{os}} \times_{\mathbf{Set}} \mathcal{C}_{\text{vm}}$ ä¸­ï¼Œç»™å®šæ€å°„ï¼š

- $\text{checkpoint}: P_i \to \mathbf{m}$
- $\text{monitor}: V_k \to \mathbf{m}$

æ„é€ æ‹‰å›å¯¹è±¡ï¼š

$$
P_i \times_{\mathbf{m}} V_k = \{ (p, v) \mid \text{monitor}(v) = \text{checkpoint}(p) \}
$$

æŠ•å½±æ€å°„ï¼š

- $p_1: P_i \times_{\mathbf{m}} V_k \to P_i$ï¼Œ$(p, v) \mapsto p$
- $p_2: P_i \times_{\mathbf{m}} V_k \to V_k$ï¼Œ$(p, v) \mapsto v$

éªŒè¯æ‹‰å›æ¡ä»¶ï¼š

1. $\text{checkpoint} \circ p_1 = \text{monitor} \circ p_2$ï¼ˆç”±å®šä¹‰ï¼‰
2. å¯¹äºä»»æ„ $X$ å’Œ $x_1: X \to P_i$ã€$x_2: X \to V_k$ï¼Œè‹¥ $\text{checkpoint} \circ x_1 = \text{monitor} \circ x_2$ï¼Œåˆ™å­˜åœ¨å”¯ä¸€çš„ $u: X \to P_i \times_{\mathbf{m}} V_k$ï¼Œä½¿å¾— $u(x) = (x_1(x), x_2(x))$ã€‚

å› æ­¤æ‹‰å›å­˜åœ¨ã€‚ âˆ

#### æ­¥éª¤5ï¼šç­‰åŒ–å­ä¿æŒæ€§

**è¯æ˜**ï¼š
ç›‘æ§å‡½å­ $\mathcal{M}$ ä¿æŒç­‰åŒ–å­ï¼Œå½“ä¸”ä»…å½“å¯¹äºä»»æ„ç­‰åŒ–å­ $e: E \to A$ï¼Œ$\mathcal{M}(e)$ ä¹Ÿæ˜¯ç­‰åŒ–å­ã€‚

ç”±å¼•ç†3.1ï¼Œè‹¥ $\mathcal{M}$ ä¿æŒç­‰åŒ–å­ï¼Œåˆ™æ‹‰å›å­˜åœ¨ã€‚åä¹‹ï¼Œè‹¥æ‹‰å›å­˜åœ¨ï¼Œåˆ™ $\mathcal{M}$ ä¿æŒç­‰åŒ–å­ã€‚ âˆ

---

## 2. æ¨å‡ºçš„è¿ç§»è¯­ä¹‰

**åœºæ™¯**ï¼šå®¹å™¨é©±é€æ—¶ï¼Œéœ€å°†çŠ¶æ€æ¨å‡ºåˆ°æŒä¹…åŒ–å­˜å‚¨ã€‚

**æ„é€ **ï¼š
ç»™å®š $C_p \xrightarrow{\text{evict}} \mathbf{0}$ å’Œ $C_p \xrightarrow{\text{snapshot}} \text{Image}_p$ï¼Œå…¶æ¨å‡ºä¸ºï¼š

$$
\mathbf{0} \sqcup_{C_p} \text{Image}_p \cong \text{Image}_p / \sim
$$

å…¶ä¸­ $\sim$ å°† $C_p$ çš„æ´»è·ƒçŠ¶æ€ç­‰åŒä¸ºç»ˆæ­¢çŠ¶æ€ã€‚

**æ³›æ€§è´¨**ï¼š

```text
C_p --snapshot--> Image_p
|evict           |
v               v
0 --âˆƒ!u--> 0 âŠ”_{C_p} Image_p

æ»¡è¶³ï¼šu âˆ˜ evict = v âˆ˜ snapshot
```

---

## 3. èµ„æºç®¡ç†çš„æ³›æ€§è´¨

### 3.1. æ³›æ€§è´¨çš„è¯¦ç»†è¯´æ˜

**å®šä¹‰**ï¼ˆæ³›æ€§è´¨ï¼‰ï¼š
æ³›æ€§è´¨æ˜¯èŒƒç•´è®ºä¸­æè¿°å¯¹è±¡å”¯ä¸€æ€§çš„æ–¹æ³•ã€‚å¯¹äºæé™æ„é€ ï¼Œæ³›æ€§è´¨ç¡®ä¿æ„é€ çš„å”¯ä¸€æ€§ï¼ˆåœ¨åŒæ„æ„ä¹‰ä¸‹ï¼‰ã€‚

**æ‹‰å›çš„æ³›æ€§è´¨**ï¼š
æ‹‰å›å¯¹è±¡ $P$ æ»¡è¶³ï¼šå¯¹äºä»»æ„å¯¹è±¡ $X$ å’Œæ€å°„ $x_1: X \to A$ã€$x_2: X \to B$ï¼Œè‹¥ $f \circ x_1 = g \circ x_2$ï¼Œåˆ™å­˜åœ¨å”¯ä¸€çš„æ€å°„ $u: X \to P$ï¼Œä½¿å¾— $p_1 \circ u = x_1$ ä¸” $p_2 \circ u = x_2$ã€‚

**æ¨å‡ºçš„æ³›æ€§è´¨**ï¼š
æ¨å‡ºå¯¹è±¡ $Q$ æ»¡è¶³ï¼šå¯¹äºä»»æ„å¯¹è±¡ $X$ å’Œæ€å°„ $x_1: A \to X$ã€$x_2: B \to X$ï¼Œè‹¥ $x_1 \circ f = x_2 \circ g$ï¼Œåˆ™å­˜åœ¨å”¯ä¸€çš„æ€å°„ $u: Q \to X$ï¼Œä½¿å¾— $u \circ q_1 = x_1$ ä¸” $u \circ q_2 = x_2$ã€‚

**å®šç†4**ï¼ˆæ¨å‡ºä¿æŒä½™ç§¯çš„æ³›æ€§è´¨ï¼‰ï¼š
åœ¨ $\mathcal{C}_{\text{ctr}}$ ä¸­ï¼Œæ¨å‡ºä¸ä½™ç§¯æ»¡è¶³**åˆ†é…å¾‹**ï¼š

$$
(C_p \sqcup C_q) \sqcup_{C_p} X \cong (C_p \sqcup_{C_p} X) \sqcup C_q \cong X \sqcup C_q
$$

è¯¥åŒæ„ç”±**ä½™ç¬›å¡å°”é—­èŒƒç•´**çš„ç»“æ„ä¿è¯ã€‚

### 3.2. å®šç†4çš„å®Œæ•´è¯æ˜

#### æ­¥éª¤1ï¼šæ¨å‡ºçš„å®šä¹‰

**å®šä¹‰**ï¼ˆæ¨å‡ºï¼‰ï¼š
ç»™å®šæ€å°„ $f: A \to B$ å’Œ $g: A \to C$ï¼Œæ¨å‡ºæ˜¯ä¸€ä¸ªå¯¹è±¡ $P$ å’Œæ€å°„ $p_1: B \to P$ã€$p_2: C \to P$ï¼Œä½¿å¾—ï¼š

1. $p_1 \circ f = p_2 \circ g$
2. å¯¹äºä»»æ„å¯¹è±¡ $X$ å’Œæ€å°„ $x_1: B \to X$ã€$x_2: C \to X$ï¼Œè‹¥ $x_1 \circ f = x_2 \circ g$ï¼Œåˆ™å­˜åœ¨å”¯ä¸€çš„æ€å°„ $u: P \to X$ï¼Œä½¿å¾— $u \circ p_1 = x_1$ ä¸” $u \circ p_2 = x_2$ã€‚

#### æ­¥éª¤2ï¼šä½™ç§¯çš„å®šä¹‰

**å®šä¹‰**ï¼ˆä½™ç§¯ï¼‰ï¼š
ç»™å®šå¯¹è±¡ $A$ å’Œ $B$ï¼Œä½™ç§¯æ˜¯ä¸€ä¸ªå¯¹è±¡ $A \sqcup B$ å’Œæ€å°„ $i_1: A \to A \sqcup B$ã€$i_2: B \to A \sqcup B$ï¼Œä½¿å¾—å¯¹äºä»»æ„å¯¹è±¡ $X$ å’Œæ€å°„ $f: A \to X$ã€$g: B \to X$ï¼Œå­˜åœ¨å”¯ä¸€çš„æ€å°„ $u: A \sqcup B \to X$ï¼Œä½¿å¾— $u \circ i_1 = f$ ä¸” $u \circ i_2 = g$ã€‚

#### æ­¥éª¤3ï¼šåˆ†é…å¾‹è¯æ˜

**å¼•ç†4.1**ï¼ˆæ¨å‡ºä¸ä½™ç§¯çš„åˆ†é…å¾‹ï¼‰ï¼š
åœ¨ä½™ç¬›å¡å°”é—­èŒƒç•´ä¸­ï¼Œæ¨å‡ºä¸ä½™ç§¯æ»¡è¶³åˆ†é…å¾‹ã€‚

**è¯æ˜**ï¼š
å¯¹äºæ¨å‡º $(C_p \sqcup C_q) \sqcup_{C_p} X$ï¼Œç”±æ¨å‡ºçš„æ³›æ€§è´¨ï¼Œå­˜åœ¨å”¯ä¸€çš„æ€å°„ï¼š

$$
u: (C_p \sqcup C_q) \sqcup_{C_p} X \to (C_p \sqcup_{C_p} X) \sqcup C_q
$$

ç±»ä¼¼åœ°ï¼Œå­˜åœ¨å”¯ä¸€çš„æ€å°„ï¼š

$$
v: (C_p \sqcup_{C_p} X) \sqcup C_q \to (C_p \sqcup C_q) \sqcup_{C_p} X
$$

ç”±æ³›æ€§è´¨çš„å”¯ä¸€æ€§ï¼Œ$u \circ v = \text{id}$ ä¸” $v \circ u = \text{id}$ï¼Œå› æ­¤ï¼š

$$
(C_p \sqcup C_q) \sqcup_{C_p} X \cong (C_p \sqcup_{C_p} X) \sqcup C_q
$$

ç±»ä¼¼åœ°å¯ä»¥è¯æ˜ï¼š

$$
(C_p \sqcup_{C_p} X) \sqcup C_q \cong X \sqcup C_q
$$

å› æ­¤åˆ†é…å¾‹æˆç«‹ã€‚ âˆ

#### æ­¥éª¤4ï¼šä¸»å®šç†è¯æ˜

**è¯æ˜**ï¼š
ç”±å¼•ç†4.1ï¼Œåœ¨ä½™ç¬›å¡å°”é—­èŒƒç•´ $\mathcal{C}_{\text{ctr}}$ ä¸­ï¼Œæ¨å‡ºä¸ä½™ç§¯æ»¡è¶³åˆ†é…å¾‹ã€‚ âˆ

**æé™æ„é€ çš„å®é™…æ„ä¹‰**ï¼š

- **æ‹‰å›**ï¼šç”¨äºåŒæ­¥ä¸åŒå±‚é—´çš„çŠ¶æ€
- **æ¨å‡º**ï¼šç”¨äºè¿ç§»å’ŒçŠ¶æ€æŒä¹…åŒ–
- **æ³›æ€§è´¨**ï¼šä¿è¯äº†æ„é€ çš„å”¯ä¸€æ€§å’Œæœ€ä¼˜æ€§

---

## 4. æé™æ„é€ çš„å®é™…åº”ç”¨

**ç³»ç»Ÿè¿ç§»**ï¼š

- ä½¿ç”¨æ‹‰å›æ„é€ åŒæ­¥è¿ç§»å‰åçš„çŠ¶æ€
- ä½¿ç”¨æ¨å‡ºæ„é€ å®ç°çŠ¶æ€æŒä¹…åŒ–
- ä¿è¯è¿ç§»è¿‡ç¨‹çš„ä¸€è‡´æ€§å’Œå®Œæ•´æ€§

**èµ„æºç®¡ç†**ï¼š

- ä½¿ç”¨æé™æ„é€ ç®¡ç†èµ„æºåˆ†é…
- ä¿è¯èµ„æºåˆ†é…çš„å…¬å¹³æ€§å’Œæ•ˆç‡
- æ”¯æŒåŠ¨æ€èµ„æºè°ƒæ•´

**ç³»ç»Ÿè®¾è®¡**ï¼š

- åŸºäºæé™æ„é€ è®¾è®¡ç»Ÿä¸€çš„èµ„æºç®¡ç†æ¡†æ¶
- ç®€åŒ–ç³»ç»Ÿå®ç°å’Œç»´æŠ¤
- æé«˜ç³»ç»Ÿçš„å¯æ‰©å±•æ€§

**å®é™…åº”ç”¨æ¡ˆä¾‹**ï¼š

| æ„é€ ç±»å‹ | åº”ç”¨åœºæ™¯ | å·¥ç¨‹å®ç° | æ•ˆæœ |
|---------|---------|---------|------|
| æ‹‰å› | VMè¿ç§»çŠ¶æ€åŒæ­¥ | `checkpoint` + `restore` | çŠ¶æ€ä¸€è‡´æ€§ä¿è¯ |
| æ¨å‡º | å®¹å™¨é©±é€ | `evict` + `snapshot` | çŠ¶æ€æŒä¹…åŒ– |
| ç­‰åŒ–å­ | èµ„æºé…é¢å¯¹é½ | `cgroup` é…é¢åŒæ­¥ | èµ„æºåˆ†é…ä¸€è‡´æ€§ |
| ä½™ç­‰åŒ–å­ | è´Ÿè½½å‡è¡¡ | Podå‰¯æœ¬åˆ†å¸ƒ | è´Ÿè½½å‡åŒ€åˆ†é… |

**å·¥ç¨‹å®ç°ç¤ºä¾‹**ï¼š

```go
// æ‹‰å›æ„é€ ï¼šçŠ¶æ€åŒæ­¥
func SyncState(process *Process, vm *VM, monitor Monitor) *SyncedState {
    // æ‹‰å›å¯¹è±¡ï¼šæ»¡è¶³ monitor(vm) == checkpoint(process) çš„çŠ¶æ€å¯¹
    return &SyncedState{
        Process: process,
        VM: vm,
        Condition: func() bool {
            return monitor.Observe(vm) == process.Checkpoint()
        },
    }
}

// æ¨å‡ºæ„é€ ï¼šçŠ¶æ€æŒä¹…åŒ–
func EvictContainer(container *Container) *Image {
    // æ¨å‡ºå¯¹è±¡ï¼šå®¹å™¨çŠ¶æ€ + é•œåƒå¿«ç…§
    snapshot := container.Snapshot()
    container.Evict()
    return snapshot  // è¿”å›æŒä¹…åŒ–çŠ¶æ€
}
```

**æ³›æ€§è´¨çš„å®é™…ä»·å€¼**ï¼š

- **å”¯ä¸€æ€§**ï¼šæé™æ„é€ çš„å”¯ä¸€æ€§ä¿è¯äº†å®ç°çš„ä¸€è‡´æ€§
- **æœ€ä¼˜æ€§**ï¼šæ³›æ€§è´¨ä¿è¯äº†æ„é€ çš„æœ€ä¼˜æ€§
- **å¯ç»„åˆæ€§**ï¼šæé™æ„é€ å¯ä»¥ç»„åˆä½¿ç”¨ï¼Œæ”¯æŒå¤æ‚åœºæ™¯

### 4.1. æé™æ„é€ çš„å”¯ä¸€æ€§è¯æ˜

**å®šç†41**ï¼ˆæé™æ„é€ çš„å”¯ä¸€æ€§ï¼‰ï¼š
åœ¨èŒƒç•´ä¸­ï¼Œæé™æ„é€ åœ¨åŒæ„æ„ä¹‰ä¸‹æ˜¯å”¯ä¸€çš„ã€‚

**è¯æ˜**ï¼š

#### æ­¥éª¤1ï¼šå”¯ä¸€æ€§å®šä¹‰

**å®šä¹‰**ï¼ˆå”¯ä¸€æ€§ï¼‰ï¼š
æé™æ„é€ æ˜¯å”¯ä¸€çš„ï¼Œå½“ä¸”ä»…å½“å¯¹äºä»»æ„ä¸¤ä¸ªæé™å¯¹è±¡ $L_1$ å’Œ $L_2$ï¼Œå­˜åœ¨å”¯ä¸€çš„åŒæ„ $f: L_1 \to L_2$ã€‚

#### æ­¥éª¤2ï¼šå”¯ä¸€æ€§è¯æ˜

**å¼•ç†41.1**ï¼ˆæé™å”¯ä¸€æ€§ï¼‰ï¼š
å¯¹äºç»™å®šçš„å›¾ $D: J \to \mathcal{C}$ï¼Œè‹¥æé™å­˜åœ¨ï¼Œåˆ™å®ƒåœ¨åŒæ„æ„ä¹‰ä¸‹æ˜¯å”¯ä¸€çš„ã€‚

**è¯æ˜**ï¼š
è®¾ $L_1$ å’Œ $L_2$ éƒ½æ˜¯å›¾ $D$ çš„æé™ã€‚ç”±æé™çš„æ³›æ€§è´¨ï¼Œå­˜åœ¨å”¯ä¸€çš„æ€å°„ $f: L_1 \to L_2$ å’Œ $g: L_2 \to L_1$ã€‚ç”±æ³›æ€§è´¨çš„å”¯ä¸€æ€§ï¼Œ$g \circ f = \text{id}_{L_1}$ ä¸” $f \circ g = \text{id}_{L_2}$ï¼Œå› æ­¤ $f$ æ˜¯åŒæ„ã€‚ âˆ

#### æ­¥éª¤3ï¼šä¸»å®šç†è¯æ˜

**è¯æ˜**ï¼š
ç”±å¼•ç†41.1ï¼Œæé™æ„é€ åœ¨åŒæ„æ„ä¹‰ä¸‹æ˜¯å”¯ä¸€çš„ã€‚ âˆ

### 4.2. æé™æ„é€ çš„å‡½å­æ€§

**å®šç†42**ï¼ˆæé™æ„é€ çš„å‡½å­æ€§ï¼‰ï¼š
è‹¥èŒƒç•´ $\mathcal{C}$ æœ‰æ‰€æœ‰å°æé™ï¼Œåˆ™æé™æ„é€ å®šä¹‰äº†ä¸€ä¸ªå‡½å­ $\lim: [J, \mathcal{C}] \to \mathcal{C}$ã€‚

**è¯æ˜**ï¼š

#### æ­¥éª¤1ï¼šå‡½å­å®šä¹‰

**å¼•ç†42.1**ï¼ˆæé™å‡½å­ï¼‰ï¼š
æé™æ„é€ å®šä¹‰äº†ä¸€ä¸ªå‡½å­ $\lim: [J, \mathcal{C}] \to \mathcal{C}$ã€‚

**è¯æ˜**ï¼š
å¯¹äºè‡ªç„¶å˜æ¢ $\eta: D \to D'$ï¼Œç”±æé™çš„æ³›æ€§è´¨ï¼Œå­˜åœ¨å”¯ä¸€çš„æ€å°„ $\lim(\eta): \lim D \to \lim D'$ã€‚è¿™å®šä¹‰äº†å‡½å­çš„æ€å°„æ˜ å°„ã€‚ âˆ

#### æ­¥éª¤2ï¼šå‡½å­å…¬ç†

**å¼•ç†42.2**ï¼ˆå‡½å­å…¬ç†ï¼‰ï¼š
æé™å‡½å­æ»¡è¶³å‡½å­å…¬ç†ã€‚

**è¯æ˜**ï¼š
ç”±æé™çš„æ³›æ€§è´¨ï¼Œæé™å‡½å­æ»¡è¶³å•ä½å¾‹å’Œå¤åˆå¾‹ã€‚ âˆ

#### æ­¥éª¤3ï¼šä¸»å®šç†è¯æ˜

**è¯æ˜**ï¼š
ç”±å¼•ç†42.1å’Œ42.2ï¼Œæé™æ„é€ å®šä¹‰äº†ä¸€ä¸ªå‡½å­ã€‚ âˆ

### 4.3. æé™æ„é€ çš„å®é™…åº”ç”¨

#### 4.3.1. çŠ¶æ€åŒæ­¥çš„å®ç°

**åœºæ™¯**ï¼šåœ¨VMè¿ç§»è¿‡ç¨‹ä¸­ï¼Œéœ€è¦åŒæ­¥OSè¿›ç¨‹çŠ¶æ€å’Œå®¹å™¨çŠ¶æ€ã€‚

**æ–¹æ³•**ï¼š

1. ä½¿ç”¨æ‹‰å›æ„é€ åŒæ­¥çŠ¶æ€
2. ä½¿ç”¨æ¨å‡ºæ„é€ è¿ç§»çŠ¶æ€
3. åˆ©ç”¨æé™çš„å”¯ä¸€æ€§ä¿è¯ä¸€è‡´æ€§

**Golangå®ç°**ï¼š

```go
package limit

// çŠ¶æ€åŒæ­¥ï¼ˆæ‹‰å›æ„é€ ï¼‰
func SyncState(osState OSState, vmState VMState, containerState ContainerState) (SyncState, error) {
    // æ„é€ æ‹‰å›ï¼šæ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„åŒæ­¥çŠ¶æ€
    syncState := SyncState{
        OS:        osState,
        VM:        vmState,
        Container: containerState,
    }

    // éªŒè¯ä¸€è‡´æ€§
    if err := verifyConsistency(syncState); err != nil {
        return SyncState{}, err
    }

    return syncState, nil
}

// çŠ¶æ€è¿ç§»ï¼ˆæ¨å‡ºæ„é€ ï¼‰
func MigrateState(state SyncState, target Target) (NewState, error) {
    // æ„é€ æ¨å‡ºï¼šå°†çŠ¶æ€æ¨å‡ºåˆ°æ–°ç›®æ ‡
    newState := NewState{
        Source: state,
        Target: target,
    }

    // æ‰§è¡Œè¿ç§»
    if err := executeMigration(newState); err != nil {
        return NewState{}, err
    }

    return newState, nil
}
```

**Pythonå®ç°**ï¼š

```python
from typing import Tuple, Optional

def sync_state(
    os_state: OSState,
    vm_state: VMState,
    container_state: ContainerState
) -> Optional[SyncState]:
    """çŠ¶æ€åŒæ­¥ï¼ˆæ‹‰å›æ„é€ ï¼‰"""
    # æ„é€ æ‹‰å›ï¼šæ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„åŒæ­¥çŠ¶æ€
    sync_state = SyncState(
        os=os_state,
        vm=vm_state,
        container=container_state
    )

    # éªŒè¯ä¸€è‡´æ€§
    if not verify_consistency(sync_state):
        return None

    return sync_state

def migrate_state(
    state: SyncState,
    target: Target
) -> Optional[NewState]:
    """çŠ¶æ€è¿ç§»ï¼ˆæ¨å‡ºæ„é€ ï¼‰"""
    # æ„é€ æ¨å‡ºï¼šå°†çŠ¶æ€æ¨å‡ºåˆ°æ–°ç›®æ ‡
    new_state = NewState(
        source=state,
        target=target
    )

    # æ‰§è¡Œè¿ç§»
    if not execute_migration(new_state):
        return None

    return new_state
```

**Rustå®ç°**ï¼š

```rust
pub fn sync_state(
    os_state: OSState,
    vm_state: VMState,
    container_state: ContainerState,
) -> Result<SyncState, Error> {
    // æ„é€ æ‹‰å›ï¼šæ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„åŒæ­¥çŠ¶æ€
    let sync_state = SyncState {
        os: os_state,
        vm: vm_state,
        container: container_state,
    };

    // éªŒè¯ä¸€è‡´æ€§
    verify_consistency(&sync_state)?;

    Ok(sync_state)
}

pub fn migrate_state(
    state: SyncState,
    target: Target,
) -> Result<NewState, Error> {
    // æ„é€ æ¨å‡ºï¼šå°†çŠ¶æ€æ¨å‡ºåˆ°æ–°ç›®æ ‡
    let new_state = NewState {
        source: state,
        target,
    };

    // æ‰§è¡Œè¿ç§»
    execute_migration(&new_state)?;

    Ok(new_state)
}
```

#### 4.3.2. èµ„æºåˆ†é…çš„ä¼˜åŒ–

**åœºæ™¯**ï¼šä½¿ç”¨æé™æ„é€ ä¼˜åŒ–èµ„æºåˆ†é…å†³ç­–ã€‚

**æ–¹æ³•**ï¼š

1. å°†èµ„æºåˆ†é…é—®é¢˜å»ºæ¨¡ä¸ºæé™é—®é¢˜
2. ä½¿ç”¨æé™çš„å”¯ä¸€æ€§æ‰¾åˆ°æœ€ä¼˜åˆ†é…
3. åˆ©ç”¨æé™çš„æ³›æ€§è´¨éªŒè¯æœ€ä¼˜æ€§

**å®šç†61**ï¼ˆæé™æ„é€ çš„æœ€ä¼˜æ€§ï¼‰ï¼š
åœ¨èµ„æºåˆ†é…é—®é¢˜ä¸­ï¼Œæœ€ä¼˜åˆ†é…æ˜¯æŸä¸ªæé™å¯¹è±¡ã€‚

**è¯æ˜**ï¼š

#### æ­¥éª¤1ï¼šæœ€ä¼˜åˆ†é…å®šä¹‰

**å®šä¹‰**ï¼ˆæœ€ä¼˜åˆ†é…ï¼‰ï¼š
åˆ†é… $a^*$ æ˜¯æœ€ä¼˜çš„ï¼Œå½“ä¸”ä»…å½“å¯¹æ‰€æœ‰åˆ†é… $a$ï¼Œæœ‰ $U(a^*) \geq U(a)$ï¼Œå…¶ä¸­ $U$ æ˜¯æ•ˆç”¨å‡½æ•°ã€‚

#### æ­¥éª¤2ï¼šæé™æ„é€ 

**å¼•ç†61.1**ï¼ˆæé™å­˜åœ¨æ€§ï¼‰ï¼š
åœ¨èµ„æºåˆ†é…èŒƒç•´ä¸­ï¼Œå­˜åœ¨æé™å¯¹è±¡ $a^*$ã€‚

**è¯æ˜**ï¼š
ç”±èŒƒç•´çš„å®Œå¤‡æ€§ï¼Œæ‰€æœ‰åˆ†é…æ–¹æ¡ˆçš„æé™å­˜åœ¨ï¼Œè¯¥æé™å³ä¸ºæœ€ä¼˜åˆ†é…ã€‚ âˆ

#### æ­¥éª¤3ï¼šä¸»å®šç†è¯æ˜

**è¯æ˜**ï¼š
ç”±å¼•ç†61.1ï¼Œæœ€ä¼˜åˆ†é…æ˜¯æé™å¯¹è±¡ã€‚ âˆ

### 4.4. æé™çš„å”¯ä¸€æ€§

**å®šç†86**ï¼ˆæé™çš„å”¯ä¸€æ€§ï¼‰ï¼š
åœ¨èµ„æºåˆ†é…èŒƒç•´ä¸­ï¼Œæé™å¯¹è±¡åœ¨åŒæ„æ„ä¹‰ä¸‹å”¯ä¸€ã€‚

**è¯æ˜**ï¼š

#### æ­¥éª¤1ï¼šå”¯ä¸€æ€§å®šä¹‰

**å®šä¹‰**ï¼ˆå”¯ä¸€æ€§ï¼‰ï¼š
æé™å¯¹è±¡æ˜¯å”¯ä¸€çš„ï¼Œå½“ä¸”ä»…å½“å¯¹ä»»æ„ä¸¤ä¸ªæé™å¯¹è±¡ $L_1$ å’Œ $L_2$ï¼Œå­˜åœ¨åŒæ„ $f: L_1 \to L_2$ã€‚

#### æ­¥éª¤2ï¼šå”¯ä¸€æ€§è¯æ˜

**å¼•ç†86.1**ï¼ˆå”¯ä¸€æ€§è¯æ˜ï¼‰ï¼š
æé™å¯¹è±¡åœ¨åŒæ„æ„ä¹‰ä¸‹å”¯ä¸€ã€‚

**è¯æ˜**ï¼š
ç”±æé™çš„æ³›æ€§è´¨ï¼Œå¦‚æœ $L_1$ å’Œ $L_2$ éƒ½æ˜¯æé™ï¼Œåˆ™å­˜åœ¨å”¯ä¸€çš„æ€å°„ $f: L_1 \to L_2$ å’Œ $g: L_2 \to L_1$ï¼Œä¸” $g \circ f = \text{id}_{L_1}$ å’Œ $f \circ g = \text{id}_{L_2}$ï¼Œå› æ­¤ $L_1 \cong L_2$ã€‚ âˆ

#### æ­¥éª¤3ï¼šä¸»å®šç†è¯æ˜

**è¯æ˜**ï¼š
ç”±å¼•ç†86.1ï¼Œæé™å¯¹è±¡åœ¨åŒæ„æ„ä¹‰ä¸‹å”¯ä¸€ã€‚ âˆ

### 4.5. æé™æ„é€ çš„å®é™…åº”ç”¨

#### 4.5.1. èµ„æºåˆ†é…ä¼˜åŒ–

**åœºæ™¯**ï¼šä½¿ç”¨æé™æ„é€ ä¼˜åŒ–èµ„æºåˆ†é…ã€‚

**æ–¹æ³•**ï¼š

1. å»ºç«‹èµ„æºåˆ†é…èŒƒç•´
2. æ„é€ æé™å¯¹è±¡
3. éªŒè¯æœ€ä¼˜æ€§

**Golangå®ç°**ï¼š

```go
package category

// èµ„æºåˆ†é…ä¼˜åŒ–
func OptimizeResourceAllocation(
    allocations []Allocation,
) (Allocation, error) {
    // å»ºç«‹èµ„æºåˆ†é…èŒƒç•´
    category := NewResourceAllocationCategory(allocations)

    // æ„é€ æé™å¯¹è±¡
    limit := category.ConstructLimit()

    // éªŒè¯æœ€ä¼˜æ€§
    if !category.VerifyOptimality(limit) {
        return nil, fmt.Errorf("limit is not optimal")
    }

    return limit, nil
}

// æ„é€ æé™
func (c *ResourceAllocationCategory) ConstructLimit() Allocation {
    // è®¡ç®—æ‰€æœ‰åˆ†é…æ–¹æ¡ˆçš„æé™
    var optimal Allocation
    maxUtility := -math.MaxFloat64

    for _, allocation := range c.allocations {
        utility := c.computeUtility(allocation)
        if utility > maxUtility {
            maxUtility = utility
            optimal = allocation
        }
    }

    return optimal
}
```

**Pythonå®ç°**ï¼š

```python
def optimize_resource_allocation(
    allocations: List[Allocation],
) -> Allocation:
    """èµ„æºåˆ†é…ä¼˜åŒ–"""
    # å»ºç«‹èµ„æºåˆ†é…èŒƒç•´
    category = ResourceAllocationCategory(allocations)

    # æ„é€ æé™å¯¹è±¡
    limit = category.construct_limit()

    # éªŒè¯æœ€ä¼˜æ€§
    if not category.verify_optimality(limit):
        raise ValueError("Limit is not optimal")

    return limit

def construct_limit(self) -> Allocation:
    """æ„é€ æé™"""
    # è®¡ç®—æ‰€æœ‰åˆ†é…æ–¹æ¡ˆçš„æé™
    optimal = None
    max_utility = float('-inf')

    for allocation in self.allocations:
        utility = self.compute_utility(allocation)
        if utility > max_utility:
            max_utility = utility
            optimal = allocation

    return optimal
```

**Rustå®ç°**ï¼š

```rust
pub fn optimize_resource_allocation(
    allocations: &[Allocation],
) -> Result<Allocation, Error> {
    // å»ºç«‹èµ„æºåˆ†é…èŒƒç•´
    let category = ResourceAllocationCategory::new(allocations);

    // æ„é€ æé™å¯¹è±¡
    let limit = category.construct_limit()?;

    // éªŒè¯æœ€ä¼˜æ€§
    if !category.verify_optimality(&limit)? {
        return Err(Error::LimitNotOptimal);
    }

    Ok(limit)
}

impl ResourceAllocationCategory {
    pub fn construct_limit(&self) -> Result<Allocation, Error> {
        // è®¡ç®—æ‰€æœ‰åˆ†é…æ–¹æ¡ˆçš„æé™
        let mut optimal = None;
        let mut max_utility = f64::NEG_INFINITY;

        for allocation in &self.allocations {
            let utility = self.compute_utility(allocation)?;
            if utility > max_utility {
                max_utility = utility;
                optimal = Some(allocation.clone());
            }
        }

        optimal.ok_or(Error::NoAllocation)
    }
}
```

### 4.6. æé™æ„é€ çš„å”¯ä¸€æ€§

**å®šç†110**ï¼ˆæé™æ„é€ çš„å”¯ä¸€æ€§ï¼‰ï¼š
åœ¨èŒƒç•´ä¸­ï¼Œæé™å¯¹è±¡åœ¨åŒæ„æ„ä¹‰ä¸‹æ˜¯å”¯ä¸€çš„ã€‚

**è¯æ˜**ï¼š

#### æ­¥éª¤1ï¼šå”¯ä¸€æ€§å®šä¹‰

**å®šä¹‰**ï¼ˆå”¯ä¸€æ€§ï¼‰ï¼š
æé™å¯¹è±¡æ˜¯å”¯ä¸€çš„ï¼Œå½“ä¸”ä»…å½“å¯¹äºä»»æ„ä¸¤ä¸ªæé™å¯¹è±¡ $L_1$ å’Œ $L_2$ï¼Œå­˜åœ¨å”¯ä¸€çš„åŒæ„ $f: L_1 \to L_2$ã€‚

#### æ­¥éª¤2ï¼šå”¯ä¸€æ€§è¯æ˜

**å¼•ç†110.1**ï¼ˆå”¯ä¸€æ€§è¯æ˜ï¼‰ï¼š
æé™å¯¹è±¡åœ¨åŒæ„æ„ä¹‰ä¸‹æ˜¯å”¯ä¸€çš„ã€‚

**è¯æ˜**ï¼š
ç”±èŒƒç•´è®ºç†è®ºï¼Œæé™å¯¹è±¡æ»¡è¶³æ³›æ€§è´¨ï¼Œå› æ­¤åœ¨åŒæ„æ„ä¹‰ä¸‹æ˜¯å”¯ä¸€çš„ã€‚ âˆ

#### æ­¥éª¤3ï¼šä¸»å®šç†è¯æ˜

**è¯æ˜**ï¼š
ç”±å¼•ç†110.1ï¼Œæé™æ„é€ æ˜¯å”¯ä¸€çš„ã€‚ âˆ

### 4.7. æé™æ„é€ çš„å®é™…åº”ç”¨

#### 4.7.1. æœ€ä¼˜èµ„æºåˆ†é…

**åœºæ™¯**ï¼šä½¿ç”¨æé™æ„é€ è®¡ç®—æœ€ä¼˜èµ„æºåˆ†é…ã€‚

**æ–¹æ³•**ï¼š

1. å»ºç«‹èµ„æºåˆ†é…èŒƒç•´
2. æ„é€ æé™å¯¹è±¡
3. éªŒè¯æœ€ä¼˜æ€§

**Golangå®ç°**ï¼š

```go
package category

// æœ€ä¼˜èµ„æºåˆ†é…
func FindOptimalAllocation(
    allocations []Allocation,
) (Allocation, error) {
    // å»ºç«‹èµ„æºåˆ†é…èŒƒç•´
    category := NewResourceAllocationCategory(allocations)

    // æ„é€ æé™å¯¹è±¡
    limit := category.ConstructLimit()

    // éªŒè¯æœ€ä¼˜æ€§
    if !category.VerifyOptimality(limit) {
        return nil, fmt.Errorf("limit is not optimal")
    }

    return limit, nil
}

// æ„é€ æé™
func (c *ResourceAllocationCategory) ConstructLimit() Allocation {
    var optimal Allocation
    maxUtility := math.Inf(-1)

    // è®¡ç®—æ‰€æœ‰åˆ†é…æ–¹æ¡ˆçš„æé™
    for _, allocation := range c.Allocations {
        utility := c.ComputeUtility(allocation)
        if utility > maxUtility {
            maxUtility = utility
            optimal = allocation
        }
    }

    return optimal
}
```

**Pythonå®ç°**ï¼š

```python
def find_optimal_allocation(
    allocations: List[Allocation],
) -> Allocation:
    """æœ€ä¼˜èµ„æºåˆ†é…"""
    # å»ºç«‹èµ„æºåˆ†é…èŒƒç•´
    category = ResourceAllocationCategory(allocations)

    # æ„é€ æé™å¯¹è±¡
    limit = category.construct_limit()

    # éªŒè¯æœ€ä¼˜æ€§
    if not category.verify_optimality(limit):
        raise ValueError("Limit is not optimal")

    return limit

def construct_limit(self) -> Allocation:
    """æ„é€ æé™"""
    optimal = None
    max_utility = float('-inf')

    # è®¡ç®—æ‰€æœ‰åˆ†é…æ–¹æ¡ˆçš„æé™
    for allocation in self.allocations:
        utility = self.compute_utility(allocation)
        if utility > max_utility:
            max_utility = utility
            optimal = allocation

    return optimal
```

**Rustå®ç°**ï¼š

```rust
pub fn find_optimal_allocation(
    allocations: Vec<Allocation>,
) -> Result<Allocation, Error> {
    // å»ºç«‹èµ„æºåˆ†é…èŒƒç•´
    let category = ResourceAllocationCategory::new(allocations);

    // æ„é€ æé™å¯¹è±¡
    let limit = category.construct_limit()?;

    // éªŒè¯æœ€ä¼˜æ€§
    if !category.verify_optimality(&limit)? {
        return Err(Error::LimitNotOptimal);
    }

    Ok(limit)
}

impl ResourceAllocationCategory {
    pub fn construct_limit(&self) -> Result<Allocation, Error> {
        let mut optimal = None;
        let mut max_utility = f64::NEG_INFINITY;

        // è®¡ç®—æ‰€æœ‰åˆ†é…æ–¹æ¡ˆçš„æé™
        for allocation in &self.allocations {
            let utility = self.compute_utility(allocation)?;
            if utility > max_utility {
                max_utility = utility;
                optimal = Some(allocation.clone());
            }
        }

        optimal.ok_or(Error::NoAllocation)
    }
}
```

---

## 5. ç›¸å…³æ–‡æ¡£

- [è¿”å› FormalModel ç›®å½•](../README.md)
- [08_èŒƒç•´è®ºå½¢å¼åŒ– README](README.md)
- [08.2_å‡½å­ä¸è‡ªç„¶å˜æ¢](08.2_å‡½å­ä¸è‡ªç„¶å˜æ¢.md)
- [08.4_å•å­ä¸ä½™å•å­](08.4_å•å­ä¸ä½™å•å­.md)

---

**æœ€åæ›´æ–°**: 2025-01-27
