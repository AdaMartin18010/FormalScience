# 03.1 èµ„æºå»ºæ¨¡çš„é«˜çº§æ–¹æ³•

> **å­ä¸»é¢˜**: 03.1
> **æ‰€å±ä¸»é¢˜**: 03 èµ„æºè°ƒåº¦çš„Petriç½‘æ¨¡å‹
> **æœ€åæ›´æ–°**: 2025-12-02

---

## ğŸ“‹ ç›®å½•

- [03.1 èµ„æºå»ºæ¨¡çš„é«˜çº§æ–¹æ³•](#031-èµ„æºå»ºæ¨¡çš„é«˜çº§æ–¹æ³•)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [1 èµ„æºåˆ†ç±»ä¸å»ºæ¨¡ç­–ç•¥](#1-èµ„æºåˆ†ç±»ä¸å»ºæ¨¡ç­–ç•¥)
  - [2 å¯å†ç”Ÿèµ„æºvs.æ¶ˆè€—æ€§èµ„æº](#2-å¯å†ç”Ÿèµ„æºvsæ¶ˆè€—æ€§èµ„æº)
  - [3 å…±äº«èµ„æºvs.ç‹¬å èµ„æº](#3-å…±äº«èµ„æºvsç‹¬å èµ„æº)
  - [4 ç€è‰²Petriç½‘å»ºæ¨¡èµ„æºç±»å‹](#4-ç€è‰²petriç½‘å»ºæ¨¡èµ„æºç±»å‹)
  - [5 å®é™…æ¡ˆä¾‹ï¼šäº‘è®¡ç®—èµ„æºæ± ](#5-å®é™…æ¡ˆä¾‹äº‘è®¡ç®—èµ„æºæ± )

---

## 1 èµ„æºåˆ†ç±»ä¸å»ºæ¨¡ç­–ç•¥

**èµ„æºç±»å‹çŸ©é˜µ**ï¼š

| èµ„æºç±»å‹ | Petriç½‘å»ºæ¨¡ | ç‰¹å¾ | ç¤ºä¾‹ |
|---------|------------|------|------|
| å¯å†ç”Ÿèµ„æº | å¾ªç¯åº“æ‰€ | ä½¿ç”¨åå½’è¿˜ | CPUã€å†…å­˜ |
| æ¶ˆè€—æ€§èµ„æº | å•å‘åº“æ‰€ | ä½¿ç”¨åä¸å½’è¿˜ | ç”µé‡ã€ç‡ƒæ–™ |
| å…±äº«èµ„æº | å¤šå¼§åº“æ‰€ | å¤šä»»åŠ¡å…±äº« | å…±äº«å†…å­˜ |
| ç‹¬å èµ„æº | 1-æœ‰ç•Œåº“æ‰€ | äº’æ–¥è®¿é—® | æ‰“å°æœºã€é” |
| èµ„æºæ±  | ç€è‰²åº“æ‰€ | ç±»å‹åŒ–èµ„æº | GPUå‹å· |

---

## 2 å¯å†ç”Ÿèµ„æºvs.æ¶ˆè€—æ€§èµ„æº

**å¯å†ç”Ÿèµ„æºå»ºæ¨¡**ï¼š

```python
def model_renewable_resource(name, capacity):
    """å¯å†ç”Ÿèµ„æºï¼ˆä½¿ç”¨åå½’è¿˜ï¼‰"""
    pn = PetriNet()
    pn.add_place(f'p_{name}_available', tokens=capacity)
    pn.add_place(f'p_{name}_in_use', tokens=0)

    # è·å–èµ„æº
    pn.add_transition(f't_acquire_{name}')
    pn.add_arc(f'p_{name}_available', f't_acquire_{name}')
    pn.add_arc(f't_acquire_{name}', f'p_{name}_in_use')

    # é‡Šæ”¾èµ„æºï¼ˆå¾ªç¯ï¼‰
    pn.add_transition(f't_release_{name}')
    pn.add_arc(f'p_{name}_in_use', f't_release_{name}')
    pn.add_arc(f't_release_{name}', f'p_{name}_available')

    return pn
```

**æ¶ˆè€—æ€§èµ„æºå»ºæ¨¡**ï¼š

```python
def model_consumable_resource(name, initial_amount):
    """æ¶ˆè€—æ€§èµ„æºï¼ˆä½¿ç”¨åä¸å½’è¿˜ï¼‰"""
    pn = PetriNet()
    pn.add_place(f'p_{name}_remaining', tokens=initial_amount)
    pn.add_place(f'p_{name}_consumed', tokens=0)

    # æ¶ˆè€—èµ„æºï¼ˆå•å‘ï¼‰
    pn.add_transition(f't_consume_{name}')
    pn.add_arc(f'p_{name}_remaining', f't_consume_{name}')
    pn.add_arc(f't_consume_{name}', f'p_{name}_consumed')

    return pn
```

---

## 3 å…±äº«èµ„æºvs.ç‹¬å èµ„æº

**å…±äº«èµ„æºï¼ˆä¿¡å·é‡ï¼‰**ï¼š

```python
def model_shared_resource(name, max_users):
    """å…±äº«èµ„æºï¼ˆæœ‰é™å¹¶å‘è®¿é—®ï¼‰"""
    pn = PetriNet()
    pn.add_place(f'p_{name}_permits', tokens=max_users)

    # Pæ“ä½œï¼ˆè·å–è®¸å¯ï¼‰
    pn.add_transition(f't_P_{name}')
    pn.add_arc(f'p_{name}_permits', f't_P_{name}')

    # ä¸´ç•ŒåŒº
    pn.add_place(f'p_{name}_critical', tokens=0)
    pn.add_arc(f't_P_{name}', f'p_{name}_critical')

    # Væ“ä½œï¼ˆé‡Šæ”¾è®¸å¯ï¼‰
    pn.add_transition(f't_V_{name}')
    pn.add_arc(f'p_{name}_critical', f't_V_{name}')
    pn.add_arc(f't_V_{name}', f'p_{name}_permits')

    return pn

# ç¤ºä¾‹ï¼š10ä¸ªæ•°æ®åº“è¿æ¥æ± 
db_pool = model_shared_resource('database', max_users=10)
```

**ç‹¬å èµ„æºï¼ˆäº’æ–¥é”ï¼‰**ï¼š

```python
def model_exclusive_resource(name):
    """ç‹¬å èµ„æºï¼ˆäº’æ–¥è®¿é—®ï¼‰"""
    return model_shared_resource(name, max_users=1)

# ç¤ºä¾‹ï¼šæ‰“å°æœºé”
printer_lock = model_exclusive_resource('printer')
```

---

## 4 ç€è‰²Petriç½‘å»ºæ¨¡èµ„æºç±»å‹

**CPNè¡¨ç¤ºèµ„æºç±»å‹**ï¼š

```python
# æ¦‚å¿µæ€§Pythonï¼ˆå®é™…ç”¨CPN Toolsï¼‰
class ColoredResourceModel:
    """ç€è‰²Petriç½‘èµ„æºæ¨¡å‹"""

    def __init__(self):
        # é¢œè‰²é›†å®šä¹‰
        self.ResourceType = ['CPU', 'GPU', 'Memory', 'Disk']
        self.ResourceAmount = range(0, 100)

    def create_typed_resource_pool(self):
        """ç±»å‹åŒ–èµ„æºæ± """
        # åº“æ‰€ï¼šèµ„æºæ± ï¼ˆå¸¦ç±»å‹å’Œæ•°é‡ï¼‰
        # p_resource_pool: (type, amount)

        # åˆå§‹æ ‡è®°ç¤ºä¾‹ï¼š
        # [('CPU', 16), ('GPU', 4), ('Memory', 64), ('Disk', 1000)]
        pass
```

**CPN MLä»£ç **ï¼š

```sml
(* ç€è‰²Petriç½‘èµ„æºå»ºæ¨¡ *)
colset ResourceType = with CPU | GPU | Memory | Disk;
colset Amount = int;
colset Resource = product ResourceType * Amount;

(* èµ„æºæ± åº“æ‰€ *)
place ResourcePool : Resource;

(* åˆå§‹æ ‡è®° *)
init ResourcePool: 1`(CPU, 16) ++ 1`(GPU, 4) ++ 1`(Memory, 64);

(* èµ„æºè¯·æ±‚å˜è¿ *)
var rtype : ResourceType;
var amt : Amount;

trans RequestResource
  in   ResourcePool 1`(rtype, amt)
  out  AllocatedResources 1`(rtype, amt)
  guard amt > 0;
```

---

## 5 å®é™…æ¡ˆä¾‹ï¼šäº‘è®¡ç®—èµ„æºæ± 

**åœºæ™¯**ï¼šOpenStackèµ„æºè°ƒåº¦

```python
def create_openstack_resource_model():
    """
    OpenStackèµ„æºè°ƒåº¦Petriç½‘æ¨¡å‹

    èµ„æºç±»å‹ï¼š
    - vCPUï¼š64æ ¸
    - å†…å­˜ï¼š256GB
    - å­˜å‚¨ï¼š10TB
    """
    pn = PetriNet()

    # èµ„æºæ± 
    pn.add_place('p_vcpu', tokens=64)
    pn.add_place('p_memory', tokens=256)
    pn.add_place('p_storage', tokens=10240)  # GB

    # VMè§„æ ¼
    vm_flavors = {
        'small': {'vcpu': 2, 'memory': 4, 'storage': 20},
        'medium': {'vcpu': 4, 'memory': 8, 'storage': 40},
        'large': {'vcpu': 8, 'memory': 16, 'storage': 80}
    }

    for flavor, resources in vm_flavors.items():
        # åˆ›å»ºVMå˜è¿
        pn.add_transition(f't_create_{flavor}_vm')
        pn.add_arc('p_vcpu', f't_create_{flavor}_vm', weight=resources['vcpu'])
        pn.add_arc('p_memory', f't_create_{flavor}_vm', weight=resources['memory'])
        pn.add_arc('p_storage', f't_create_{flavor}_vm', weight=resources['storage'])

        # VMè¿è¡Œåº“æ‰€
        pn.add_place(f'p_{flavor}_vm_running', tokens=0)
        pn.add_arc(f't_create_{flavor}_vm', f'p_{flavor}_vm_running')

        # åˆ é™¤VMå˜è¿ï¼ˆèµ„æºå½’è¿˜ï¼‰
        pn.add_transition(f't_delete_{flavor}_vm')
        pn.add_arc(f'p_{flavor}_vm_running', f't_delete_{flavor}_vm')
        pn.add_arc(f't_delete_{flavor}_vm', 'p_vcpu', weight=resources['vcpu'])
        pn.add_arc(f't_delete_{flavor}_vm', 'p_memory', weight=resources['memory'])
        pn.add_arc(f't_delete_{flavor}_vm', 'p_storage', weight=resources['storage'])

    return pn

# æ¨¡æ‹Ÿ
openstack_pn = create_openstack_resource_model()
print("OpenStackèµ„æºæ± ï¼š")
print(f"  vCPU: {openstack_pn.marking['p_vcpu']}")
print(f"  å†…å­˜: {openstack_pn.marking['p_memory']} GB")
print(f"  å­˜å‚¨: {openstack_pn.marking['p_storage']} GB")

# åˆ›å»ºVMs
openstack_pn.fire('t_create_large_vm')
openstack_pn.fire('t_create_medium_vm')
print(f"\nåˆ›å»º2ä¸ªVMåï¼š")
print(f"  å‰©ä½™vCPU: {openstack_pn.marking['p_vcpu']}")
print(f"  å‰©ä½™å†…å­˜: {openstack_pn.marking['p_memory']} GB")
```

---

**è¿”å›**: [03 èµ„æºè°ƒåº¦çš„Petriç½‘æ¨¡å‹](README.md)
