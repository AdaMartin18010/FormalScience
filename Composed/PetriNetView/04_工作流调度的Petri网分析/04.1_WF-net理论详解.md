# 04.1 WF-netç†è®ºè¯¦è§£

> **å­ä¸»é¢˜**: 04.1
> **æ‰€å±ä¸»é¢˜**: 04 å·¥ä½œæµè°ƒåº¦çš„Petriç½‘åˆ†æ
> **æœ€åæ›´æ–°**: 2025-12-02

---

## ğŸ“‹ ç›®å½•

- [04.1 WF-netç†è®ºè¯¦è§£](#041-wf-netç†è®ºè¯¦è§£)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [1 WF-netçš„å½¢å¼åŒ–å®šä¹‰](#1-wf-netçš„å½¢å¼åŒ–å®šä¹‰)
  - [2 å¥å…¨æ€§ï¼ˆSoundnessï¼‰å®šä¹‰](#2-å¥å…¨æ€§soundnesså®šä¹‰)
  - [3 å¥å…¨æ€§åˆ¤å®šç®—æ³•](#3-å¥å…¨æ€§åˆ¤å®šç®—æ³•)
  - [4 å¥å…¨æ€§å˜ç§](#4-å¥å…¨æ€§å˜ç§)
  - [5 å®é™…æ¡ˆä¾‹ï¼šè´·æ¬¾å®¡æ‰¹æµç¨‹](#5-å®é™…æ¡ˆä¾‹è´·æ¬¾å®¡æ‰¹æµç¨‹)

---

## 1 WF-netçš„å½¢å¼åŒ–å®šä¹‰

**å®šä¹‰4.11ï¼ˆå·¥ä½œæµç½‘WF-netï¼‰**ï¼š

Petriç½‘ $PN = (P, T, F, W)$ æ˜¯**å·¥ä½œæµç½‘**ï¼Œå¦‚æœï¼š

1. å­˜åœ¨å”¯ä¸€çš„**æºåº“æ‰€** $i \in P$ï¼š$\bullet i = \emptyset$
2. å­˜åœ¨å”¯ä¸€çš„**æ±‡åº“æ‰€** $o \in P$ï¼š$o\bullet = \emptyset$
3. æ‰€æœ‰èŠ‚ç‚¹éƒ½åœ¨ä» $i$ åˆ° $o$ çš„è·¯å¾„ä¸Š

$$
\forall x \in P \cup T: (i, x) \in F^* \land (x, o) \in F^*
$$

å…¶ä¸­ $F^*$ æ˜¯å¼§å…³ç³»çš„ä¼ é€’é—­åŒ…ã€‚

---

## 2 å¥å…¨æ€§ï¼ˆSoundnessï¼‰å®šä¹‰

**å®šä¹‰4.12ï¼ˆå¥å…¨æ€§ï¼‰**ï¼š

WF-net $(PN, i, o)$ æ˜¯**å¥å…¨çš„**ï¼Œå¦‚æœï¼š

1. **é€‰é¡¹å¯å®Œæˆæ€§**ï¼šä»æ ‡è®° $[i]$ æ€»èƒ½åˆ°è¾¾æ ‡è®° $[o]$
   $$\forall M \in R([i]): [o] \in R(M)$$

2. **æ­£ç¡®å®Œæˆ**ï¼šæ ‡è®° $[o]$ æ˜¯å”¯ä¸€çš„æœ€ç»ˆæ ‡è®°
   $$\forall M \in R([i]): M(o) = 1 \Rightarrow M = [o]$$

3. **æ— æ­»ä»»åŠ¡**ï¼šæ¯ä¸ªå˜è¿éƒ½å¯æ‰§è¡Œ
   $$\forall t \in T, \exists M \in R([i]): M[t\rangle$$

**å¥å…¨æ€§çš„ç­‰ä»·æ¡ä»¶**ï¼š

**å®šç†4.11**ï¼šWF-netå¥å…¨å½“ä¸”ä»…å½“æ‰©å±•ç½‘ $\overline{PN}$ æ˜¯æ´»çš„ä¸”æœ‰ç•Œçš„ã€‚

æ‰©å±•ç½‘ï¼šæ·»åŠ å˜è¿ $t^*: o \to i$

---

## 3 å¥å…¨æ€§åˆ¤å®šç®—æ³•

**ç®—æ³•3.1ï¼ˆå¥å…¨æ€§æ£€æŸ¥ï¼‰**ï¼š

```python
def check_soundness(wf_net, source, sink):
    """
    æ£€æŸ¥WF-netå¥å…¨æ€§

    Args:
        wf_net: å·¥ä½œæµç½‘
        source: æºåº“æ‰€
        sink: æ±‡åº“æ‰€

    Returns:
        (is_sound, violations)
    """
    violations = []

    # 1. æ„é€ æ‰©å±•ç½‘ï¼ˆæ·»åŠ t*: o -> iï¼‰
    extended_pn = wf_net.copy()
    extended_pn.add_transition('t_star')
    extended_pn.add_arc(sink, 't_star')
    extended_pn.add_arc('t_star', source)

    # 2. æ£€æŸ¥æ‰©å±•ç½‘çš„æ´»æ€§
    initial_marking = {source: 1}
    RG = construct_reachability_graph(extended_pn, initial_marking)

    # æ£€æŸ¥æ‰€æœ‰å˜è¿æ˜¯å¦æ´»
    for t in extended_pn.transitions:
        is_live = False
        for M in RG.nodes():
            if can_eventually_fire(extended_pn, RG, M, t):
                is_live = True
                break

        if not is_live:
            violations.append(f"Dead transition: {t}")

    # 3. æ£€æŸ¥æ‰©å±•ç½‘çš„æœ‰ç•Œæ€§
    for p in extended_pn.places:
        max_tokens = max(M[p] for M in RG.nodes())
        if max_tokens == float('inf'):
            violations.append(f"Unbounded place: {p}")

    is_sound = len(violations) == 0

    return is_sound, violations

# ä½¿ç”¨ç¤ºä¾‹
is_sound, violations = check_soundness(workflow_net, 'i', 'o')

if is_sound:
    print("âœ“ å·¥ä½œæµå¥å…¨")
else:
    print(f"âœ— å·¥ä½œæµä¸å¥å…¨ï¼Œå‘ç°{len(violations)}ä¸ªé—®é¢˜ï¼š")
    for v in violations:
        print(f"  - {v}")
```

---

## 4 å¥å…¨æ€§å˜ç§

**å¼±å¥å…¨æ€§ã€æ‡’å¥å…¨æ€§**ï¼š

| ç±»å‹ | å®šä¹‰ | åº”ç”¨åœºæ™¯ |
|------|------|---------|
| å¥å…¨æ€§ | æ ‡å‡†å®šä¹‰ | æ ‡å‡†å·¥ä½œæµ |
| å¼±å¥å…¨æ€§ | å…è®¸æ®‹ç•™æ ‡è®° | æœ‰æ¸…ç†é˜¶æ®µçš„æµç¨‹ |
| æ‡’å¥å…¨æ€§ | å…è®¸æ­»ä»»åŠ¡ | å¯é€‰è·¯å¾„çš„æµç¨‹ |

---

## 5 å®é™…æ¡ˆä¾‹ï¼šè´·æ¬¾å®¡æ‰¹æµç¨‹

```python
def create_loan_approval_workflow():
    """è´·æ¬¾å®¡æ‰¹å·¥ä½œæµWF-net"""
    pn = PetriNet()

    # æºåº“æ‰€
    pn.add_place('i', tokens=1)

    # æäº¤ç”³è¯·
    pn.add_transition('t_submit')
    pn.add_arc('i', 't_submit')
    pn.add_place('p_submitted', tokens=0)
    pn.add_arc('t_submit', 'p_submitted')

    # å¹¶è¡Œå®¡æ ¸
    pn.add_transition('t_fork')
    pn.add_arc('p_submitted', 't_fork')

    reviews = ['CreditCheck', 'IncomeVerify', 'AssetCheck']
    for review in reviews:
        pn.add_place(f'p_{review}_ready', tokens=0)
        pn.add_arc('t_fork', f'p_{review}_ready')

        pn.add_transition(f't_{review}')
        pn.add_arc(f'p_{review}_ready', f't_{review}')

        pn.add_place(f'p_{review}_done', tokens=0)
        pn.add_arc(f't_{review}', f'p_{review}_done')

    # æ±‡æ€»å®¡æ ¸ç»“æœ
    pn.add_transition('t_join')
    for review in reviews:
        pn.add_arc(f'p_{review}_done', 't_join')

    pn.add_place('p_reviewed', tokens=0)
    pn.add_arc('t_join', 'p_reviewed')

    # å†³ç­–ï¼šæ‰¹å‡†æˆ–æ‹’ç»
    pn.add_transition('t_approve')
    pn.add_arc('p_reviewed', 't_approve')

    pn.add_transition('t_reject')
    pn.add_arc('p_reviewed', 't_reject')

    # æ±‡åº“æ‰€
    pn.add_place('o', tokens=0)
    pn.add_arc('t_approve', 'o')
    pn.add_arc('t_reject', 'o')

    return pn

# éªŒè¯å¥å…¨æ€§
loan_wf = create_loan_approval_workflow()
is_sound, violations = check_soundness(loan_wf, 'i', 'o')

print(f"è´·æ¬¾å®¡æ‰¹æµç¨‹å¥å…¨æ€§: {'âœ“ å¥å…¨' if is_sound else 'âœ— ä¸å¥å…¨'}")
if violations:
    print(f"é—®é¢˜ï¼š{violations}")
```

---

**è¿”å›**: [04 å·¥ä½œæµè°ƒåº¦çš„Petriç½‘åˆ†æ](README.md)

**å‚è€ƒæ–‡çŒ®**ï¼š

1. van der Aalst, W.M.P. (1998). "The Application of Petri Nets to Workflow Management"
2. van der Aalst, W.M.P. (2016). "Process Mining: Data Science in Action"
