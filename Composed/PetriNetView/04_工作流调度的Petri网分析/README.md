# 04 工作流调度的Petri网分析

> **子主题编号**: 04
> **视角**: Petri网视角
> **最后更新**: 2025-12-02
> **文档状态**: ✅ 完成

---

## 📋 目录

- [04 工作流调度的Petri网分析](#04-工作流调度的petri网分析)
  - [📋 目录](#-目录)
  - [1 概述](#1-概述)
    - [1.1 核心洞察](#11-核心洞察)
    - [1.2 独特视角](#12-独特视角)
  - [2 工作流的WF-net模型](#2-工作流的wf-net模型)
    - [2.1 WF-net定义](#21-wf-net定义)
    - [2.2 扩展WF-net](#22-扩展wf-net)
  - [3 工作流模式的Petri网表示](#3-工作流模式的petri网表示)
    - [3.1 控制流模式](#31-控制流模式)
  - [4 工作流健全性验证](#4-工作流健全性验证)
    - [4.1 健全性定义](#41-健全性定义)
    - [4.2 验证方法](#42-验证方法)
  - [5 工作流性能分析](#5-工作流性能分析)
    - [5.1 性能指标](#51-性能指标)
  - [6 关系属性与依赖分析](#6-关系属性与依赖分析)
    - [6.1 工作流模式之间的关系](#61-工作流模式之间的关系)
    - [6.2 健全性与性能的关系](#62-健全性与性能的关系)
  - [7 跨视角链接](#7-跨视角链接)
    - [7.1 Petri网视角关联](#71-petri网视角关联)
    - [7.2 调度视角关联](#72-调度视角关联)

---

## 1 概述

### 1.1 核心洞察

**Petri网视角的工作流独特性**：工作流不是"任务序列"，而是"**特殊的Petri网（WF-net）**"。工作流的健全性就是"**Petri网的活性+有界性**"。这种表示使得工作流分析变得**严格且可验证**。

### 1.2 独特视角

**工作流 = WF-net**：

- 工作流是Petri网的特化
- 具有唯一的起始和结束库所
- 所有节点都在从起始到结束的路径上

**工作流性质 = Petri网性质**：

- 健全性 = 活性 + 有界性
- 可终止性 = 可达性
- 无死任务 = 活性

---

## 2 工作流的WF-net模型

### 2.1 WF-net定义

**定义 2.1**（工作流网，WF-net）：

```text
Petri网N = (P, T, F, W, M₀)是工作流网，当且仅当：

1. 单一源库所：存在唯一的i ∈ P，使得•i = ∅
2. 单一汇库所：存在唯一的o ∈ P，使得o• = ∅
3. 强连通性：所有节点都在从i到o的路径上
```

**独特视角**：

- 工作流是"**有向无环图**"（DAG）的Petri网表示
- 起始和结束是"**结构性的**"，不是逻辑性的
- 完整性是"**可验证的**"（强连通性）

### 2.2 扩展WF-net

**定义 2.2**（扩展WF-net）：

```text
扩展WF-net N* = (P ∪ {o'}, T ∪ {t_end}, F', W, M₀)：

  添加虚拟库所o'和变迁t_end
  t_end的输入是o，输出是o'

用于分析：
  健全性 ⟺ N*是活的和有界的
```

**独特视角**：

- 扩展是"**分析工具**"，不是实际工作流
- 扩展使得"**循环分析**"成为可能
- 扩展保持了"**原始语义**"

---

## 3 工作流模式的Petri网表示

### 3.1 控制流模式

**模式1：顺序（Sequence）**

```text
A → B → C

Petri网：
  p_A →[t_B]→ p_B →[t_C]→ p_C
```

**模式2：并行分支（Parallel Split）**

```text
A → (B || C)

Petri网：
  p_A →[t_split]→ p_B, p_C
  t_split• = {p_B, p_C}
```

**模式3：同步合并（Synchronization）**

```text
(B || C) → D

Petri网：
  p_B, p_C →[t_merge]→ p_D
  •t_merge = {p_B, p_C}
```

**模式4：排他选择（Exclusive Choice）**

```text
A → (B | C)

Petri网：
  p_A →[t_B]→ p_B
  p_A →[t_C]→ p_C

冲突：M(p_A) < W(p_A, t_B) + W(p_A, t_C)
```

**独特视角**：

- 模式是"**结构性的**"，不是逻辑性的
- 模式组合是"**自然的**"（Petri网组合）
- 模式验证是"**自动的**"（Petri网性质）

---

## 4 工作流健全性验证

### 4.1 健全性定义

**定义 4.1**（工作流健全性）：

```text
工作流WF-net是健全的，当且仅当：

1. 可终止性：从[i]总能到达[o]
2. 适当完成：当o有标记时，其他库所为空
3. 无死任务：所有变迁最终都能被触发
```

**独特视角**：

- 健全性是"**可验证的**"（可达性分析）
- 健全性等价于"**扩展网的活性+有界性**"
- 健全性问题是"**可判定的**"（有界Petri网）

### 4.2 验证方法

**方法1：可达性分析**

```text
构造可达图，检查：
  1. 是否存在从[i]到[o]的路径
  2. 是否所有到达[o]的标记都是[o]
  3. 是否所有变迁都在某些路径上
```

**方法2：不变性分析**

```text
计算P-不变量和T-不变量：
  1. P-不变量验证标记守恒
  2. T-不变量验证循环行为
  3. 不变量验证无死任务
```

**方法3：模型检查**

```text
使用CTL/LTL公式：
  1. 可终止性：EF (M[o] > 0)
  2. 适当完成：AG (M[o] > 0 → M = [o])
  3. 无死任务：AG EF (M[t⟩) 对所有t
```

**独特视角**：

- 验证方法是"**形式化的**"
- 验证结果是"**确定的**"（是或否）
- 验证过程是"**自动的**"（工具支持）

---

## 5 工作流性能分析

### 5.1 性能指标

**定义 5.1**（工作流性能指标）：

```text
1. 完成时间：从[i]到[o]的时间
2. 吞吐量：完成工作流实例数/时间
3. 资源利用率：资源使用时间/总时间
```

**Petri网计算**：

```text
随机Petri网（SPN）：
  完成时间 = E[从[i]到[o]的时间]
  吞吐量 = Throughput(t_end)
  资源利用率 = Utilization(p_resource)
```

**独特视角**：

- 性能指标是"**可计算的**"（随机Petri网）
- 性能分析是"**精确的**"（数学方法）
- 性能优化是"**可指导的**"（瓶颈识别）

---

## 6 关系属性与依赖分析

### 6.1 工作流模式之间的关系

**模式组合**：

```text
复杂工作流 = 基本模式的组合

例如：
  并行-顺序 = 并行模式 + 顺序模式
  选择-循环 = 选择模式 + 循环模式
```

### 6.2 健全性与性能的关系

**定理 6.1**（健全性-性能关系）：

```text
健全性是性能的前提：

1. 如果工作流不健全，则性能无意义
2. 如果工作流健全，则性能可优化
3. 性能优化不应破坏健全性
```

---

## 7 跨视角链接

### 7.1 Petri网视角关联

- [工作流调度的Petri网分析](../04_工作流调度的Petri网分析/README.md) - 本主题
- [性能分析的Petri网方法](../05_性能分析的Petri网方法/README.md) - 性能分析

### 7.2 调度视角关联

- [工作流调度](../../30_工作流调度/) - 工作流调度主题
- [工作流Petri网模型](../../30_工作流调度/30.1_工作流Petri网模型.md) - WF-net模型

---

**返回**: [Petri网视角主索引](../README.md) | [调度视角主索引](../../README.md)
