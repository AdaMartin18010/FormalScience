# 04.2 å·¥ä½œæµæ¨¡å¼çš„Petriç½‘è¡¨ç¤ºåº“

> **å­ä¸»é¢˜**: 04.2
> **æ‰€å±ä¸»é¢˜**: 04 å·¥ä½œæµè°ƒåº¦çš„Petriç½‘åˆ†æ
> **æœ€åæ›´æ–°**: 2025-12-02

---

## ğŸ“‹ ç›®å½•

- [04.2 å·¥ä½œæµæ¨¡å¼çš„Petriç½‘è¡¨ç¤ºåº“](#042-å·¥ä½œæµæ¨¡å¼çš„petriç½‘è¡¨ç¤ºåº“)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [1 å·¥ä½œæµæ¨¡å¼æ¦‚è¿°](#1-å·¥ä½œæµæ¨¡å¼æ¦‚è¿°)
  - [2 åŸºæœ¬æ§åˆ¶æµæ¨¡å¼ï¼ˆ1-5ï¼‰](#2-åŸºæœ¬æ§åˆ¶æµæ¨¡å¼1-5)
    - [æ¨¡å¼1ï¼šé¡ºåºï¼ˆSequenceï¼‰](#æ¨¡å¼1é¡ºåºsequence)
    - [æ¨¡å¼2ï¼šå¹¶è¡Œåˆ†æ”¯ï¼ˆParallel Split, AND-Splitï¼‰](#æ¨¡å¼2å¹¶è¡Œåˆ†æ”¯parallel-split-and-split)
    - [æ¨¡å¼3ï¼šåŒæ­¥ï¼ˆSynchronization, AND-Joinï¼‰](#æ¨¡å¼3åŒæ­¥synchronization-and-join)
    - [æ¨¡å¼4ï¼šé€‰æ‹©ï¼ˆExclusive Choice, XOR-Splitï¼‰](#æ¨¡å¼4é€‰æ‹©exclusive-choice-xor-split)
    - [æ¨¡å¼5ï¼šç®€å•åˆå¹¶ï¼ˆSimple Merge, XOR-Joinï¼‰](#æ¨¡å¼5ç®€å•åˆå¹¶simple-merge-xor-join)
  - [3 é«˜çº§åˆ†æ”¯åˆå¹¶æ¨¡å¼ï¼ˆ6-9ï¼‰](#3-é«˜çº§åˆ†æ”¯åˆå¹¶æ¨¡å¼6-9)
    - [æ¨¡å¼6ï¼šå¤šé€‰ï¼ˆMulti-Choice, OR-Splitï¼‰](#æ¨¡å¼6å¤šé€‰multi-choice-or-split)
    - [æ¨¡å¼7ï¼šåŒæ­¥åˆå¹¶ï¼ˆSynchronizing Mergeï¼‰](#æ¨¡å¼7åŒæ­¥åˆå¹¶synchronizing-merge)
  - [4 ç»“æ„åŒ–æ¨¡å¼ï¼ˆ10-11ï¼‰](#4-ç»“æ„åŒ–æ¨¡å¼10-11)
    - [æ¨¡å¼10ï¼šä»»æ„å¾ªç¯ï¼ˆArbitrary Cyclesï¼‰](#æ¨¡å¼10ä»»æ„å¾ªç¯arbitrary-cycles)
  - [5 å¤šå®ä¾‹æ¨¡å¼ï¼ˆ12-15ï¼‰](#5-å¤šå®ä¾‹æ¨¡å¼12-15)
    - [æ¨¡å¼12ï¼šæ— åŒæ­¥çš„å¤šå®ä¾‹ï¼ˆMI Without Synchronizationï¼‰](#æ¨¡å¼12æ— åŒæ­¥çš„å¤šå®ä¾‹mi-without-synchronization)
    - [æ¨¡å¼13ï¼šå¸¦åŒæ­¥çš„å¤šå®ä¾‹ï¼ˆMI With a Priori Design Time Knowledgeï¼‰](#æ¨¡å¼13å¸¦åŒæ­¥çš„å¤šå®ä¾‹mi-with-a-priori-design-time-knowledge)
  - [6 çŠ¶æ€æ¨¡å¼ï¼ˆ16-18ï¼‰](#6-çŠ¶æ€æ¨¡å¼16-18)
    - [æ¨¡å¼16ï¼šå»¶è¿Ÿé€‰æ‹©ï¼ˆDeferred Choiceï¼‰](#æ¨¡å¼16å»¶è¿Ÿé€‰æ‹©deferred-choice)
  - [7 å–æ¶ˆæ¨¡å¼ï¼ˆ19-20ï¼‰](#7-å–æ¶ˆæ¨¡å¼19-20)
    - [æ¨¡å¼19ï¼šå–æ¶ˆä»»åŠ¡ï¼ˆCancel Taskï¼‰](#æ¨¡å¼19å–æ¶ˆä»»åŠ¡cancel-task)


---

## 1 å·¥ä½œæµæ¨¡å¼æ¦‚è¿°

**å·¥ä½œæµæ¨¡å¼**ï¼ˆWorkflow Patternsï¼‰æ˜¯å·¥ä½œæµç³»ç»Ÿä¸­å¸¸è§çš„æ§åˆ¶æµç»“æ„ï¼Œç”±van der Aalstç­‰äººæ€»ç»“çš„20ä¸ªåŸºæœ¬æ¨¡å¼ã€‚

**åˆ†ç±»**ï¼š

1. **åŸºæœ¬æ§åˆ¶æµ**ï¼šé¡ºåºã€å¹¶è¡Œåˆ†æ”¯ã€åŒæ­¥ã€é€‰æ‹©ã€ç®€å•åˆå¹¶
2. **é«˜çº§åˆ†æ”¯åˆå¹¶**ï¼šå¤šé€‰ã€åŒæ­¥åˆå¹¶ã€åˆ¤åˆ«å™¨ã€Né€‰M
3. **ç»“æ„åŒ–**ï¼šä»»æ„å¾ªç¯ã€éšå¼ç»ˆæ­¢
4. **å¤šå®ä¾‹**ï¼šæ— åŒæ­¥ã€å¸¦åŒæ­¥ã€åŠ¨æ€
5. **çŠ¶æ€**ï¼šå»¶è¿Ÿé€‰æ‹©ã€äº¤é”™å¹¶è¡Œã€é‡Œç¨‹ç¢‘
6. **å–æ¶ˆ**ï¼šå–æ¶ˆä»»åŠ¡ã€å–æ¶ˆåŒºåŸŸ

---

## 2 åŸºæœ¬æ§åˆ¶æµæ¨¡å¼ï¼ˆ1-5ï¼‰

### æ¨¡å¼1ï¼šé¡ºåºï¼ˆSequenceï¼‰

```python
def pattern1_sequence():
    """æ¨¡å¼1ï¼šé¡ºåºæ‰§è¡Œ A -> B"""
    pn = PetriNet()
    pn.add_place('p1', tokens=1)
    pn.add_transition('t_A')
    pn.add_arc('p1', 't_A')
    pn.add_place('p2', tokens=0)
    pn.add_arc('t_A', 'p2')
    pn.add_transition('t_B')
    pn.add_arc('p2', 't_B')
    pn.add_place('p3', tokens=0)
    pn.add_arc('t_B', 'p3')
    return pn
```

### æ¨¡å¼2ï¼šå¹¶è¡Œåˆ†æ”¯ï¼ˆParallel Split, AND-Splitï¼‰

```python
def pattern2_parallel_split():
    """æ¨¡å¼2ï¼šå¹¶è¡Œåˆ†æ”¯ A -> (B âˆ¥ C)"""
    pn = PetriNet()
    pn.add_place('p1', tokens=1)
    pn.add_transition('t_A')
    pn.add_arc('p1', 't_A')

    # Forkåˆ°Bå’ŒC
    pn.add_place('p_B', tokens=0)
    pn.add_place('p_C', tokens=0)
    pn.add_arc('t_A', 'p_B')
    pn.add_arc('t_A', 'p_C')

    return pn
```

### æ¨¡å¼3ï¼šåŒæ­¥ï¼ˆSynchronization, AND-Joinï¼‰

```python
def pattern3_synchronization():
    """æ¨¡å¼3ï¼šåŒæ­¥ (B âˆ¥ C) -> D"""
    pn = PetriNet()

    pn.add_place('p_B', tokens=1)
    pn.add_place('p_C', tokens=1)

    # åŒæ­¥å˜è¿ï¼ˆéœ€è¦Bå’ŒCéƒ½å®Œæˆï¼‰
    pn.add_transition('t_D')
    pn.add_arc('p_B', 't_D')
    pn.add_arc('p_C', 't_D')

    pn.add_place('p_after_D', tokens=0)
    pn.add_arc('t_D', 'p_after_D')

    return pn
```

### æ¨¡å¼4ï¼šé€‰æ‹©ï¼ˆExclusive Choice, XOR-Splitï¼‰

```python
def pattern4_exclusive_choice():
    """æ¨¡å¼4ï¼šäº’æ–¥é€‰æ‹© A -> (B âŠ• C)"""
    pn = PetriNet()

    pn.add_place('p1', tokens=1)

    # ä¸¤ä¸ªäº’æ–¥çš„é€‰æ‹©
    pn.add_transition('t_B')
    pn.add_arc('p1', 't_B')
    pn.add_place('p_after_B', tokens=0)
    pn.add_arc('t_B', 'p_after_B')

    pn.add_transition('t_C')
    pn.add_arc('p1', 't_C')
    pn.add_place('p_after_C', tokens=0)
    pn.add_arc('t_C', 'p_after_C')

    return pn
```

### æ¨¡å¼5ï¼šç®€å•åˆå¹¶ï¼ˆSimple Merge, XOR-Joinï¼‰

```python
def pattern5_simple_merge():
    """æ¨¡å¼5ï¼šç®€å•åˆå¹¶ (B + C) -> D"""
    pn = PetriNet()

    pn.add_place('p_B', tokens=0)
    pn.add_place('p_C', tokens=0)

    # åˆå¹¶åº“æ‰€
    pn.add_place('p_merge', tokens=0)

    pn.add_transition('t_B')
    pn.add_arc('p_B', 't_B')
    pn.add_arc('t_B', 'p_merge')

    pn.add_transition('t_C')
    pn.add_arc('p_C', 't_C')
    pn.add_arc('t_C', 'p_merge')

    # Dä»»åŠ¡
    pn.add_transition('t_D')
    pn.add_arc('p_merge', 't_D')

    return pn
```

---

## 3 é«˜çº§åˆ†æ”¯åˆå¹¶æ¨¡å¼ï¼ˆ6-9ï¼‰

### æ¨¡å¼6ï¼šå¤šé€‰ï¼ˆMulti-Choice, OR-Splitï¼‰

```python
def pattern6_multi_choice():
    """æ¨¡å¼6ï¼šå¤šé€‰ A -> {B, C, D}ä¸­çš„1ä¸ªæˆ–å¤šä¸ª"""
    pn = PetriNet()

    pn.add_place('p_before', tokens=1)

    # å¯ä»¥é€‰æ‹©Bã€Cã€Dçš„ä»»æ„ç»„åˆ
    pn.add_transition('t_choose_B')
    pn.add_arc('p_before', 't_choose_B', weight=0)  # ä¸æ¶ˆè€—
    pn.add_place('p_B', tokens=0)
    pn.add_arc('t_choose_B', 'p_B')

    pn.add_transition('t_choose_C')
    pn.add_arc('p_before', 't_choose_C', weight=0)
    pn.add_place('p_C', tokens=0)
    pn.add_arc('t_choose_C', 'p_C')

    # å®Œæˆé€‰æ‹©
    pn.add_transition('t_confirm_choice')
    pn.add_arc('p_before', 't_confirm_choice')

    return pn
```

### æ¨¡å¼7ï¼šåŒæ­¥åˆå¹¶ï¼ˆSynchronizing Mergeï¼‰

```python
def pattern7_synchronizing_merge():
    """æ¨¡å¼7ï¼šåŒæ­¥åˆå¹¶ï¼ˆç­‰å¾…æ‰€æœ‰æ¿€æ´»çš„åˆ†æ”¯ï¼‰"""
    pn = PetriNet()

    # ä½¿ç”¨ç€è‰²Petriç½‘æˆ–è®¡æ•°æœºåˆ¶
    # ï¼ˆç®€åŒ–å®ç°ï¼‰
    pn.add_place('p_branches', tokens=3)  # å‡è®¾3ä¸ªåˆ†æ”¯

    pn.add_transition('t_merge')
    pn.add_arc('p_branches', 't_merge', weight=3)  # ç­‰å¾…æ‰€æœ‰åˆ†æ”¯

    pn.add_place('p_after_merge', tokens=0)
    pn.add_arc('t_merge', 'p_after_merge')

    return pn
```

---

## 4 ç»“æ„åŒ–æ¨¡å¼ï¼ˆ10-11ï¼‰

### æ¨¡å¼10ï¼šä»»æ„å¾ªç¯ï¼ˆArbitrary Cyclesï¼‰

```python
def pattern10_arbitrary_cycles():
    """æ¨¡å¼10ï¼šä»»æ„å¾ªç¯ç»“æ„"""
    pn = PetriNet()

    pn.add_place('p_loop_entry', tokens=1)

    # å¾ªç¯ä½“
    pn.add_transition('t_body')
    pn.add_arc('p_loop_entry', 't_body')
    pn.add_place('p_loop_exit', tokens=0)
    pn.add_arc('t_body', 'p_loop_exit')

    # å¾ªç¯æ¡ä»¶
    pn.add_transition('t_continue')  # ç»§ç»­å¾ªç¯
    pn.add_arc('p_loop_exit', 't_continue')
    pn.add_arc('t_continue', 'p_loop_entry')

    pn.add_transition('t_exit')  # é€€å‡ºå¾ªç¯
    pn.add_arc('p_loop_exit', 't_exit')
    pn.add_place('p_end', tokens=0)
    pn.add_arc('t_exit', 'p_end')

    return pn
```

---

## 5 å¤šå®ä¾‹æ¨¡å¼ï¼ˆ12-15ï¼‰

### æ¨¡å¼12ï¼šæ— åŒæ­¥çš„å¤šå®ä¾‹ï¼ˆMI Without Synchronizationï¼‰

```python
def pattern12_mi_without_sync(n_instances):
    """æ¨¡å¼12ï¼šå¤šå®ä¾‹æ— éœ€åŒæ­¥"""
    pn = PetriNet()

    pn.add_place('p_start', tokens=1)
    pn.add_transition('t_fork')
    pn.add_arc('p_start', 't_fork')

    # åˆ›å»ºnä¸ªå®ä¾‹
    for i in range(n_instances):
        pn.add_place(f'p_instance_{i}', tokens=0)
        pn.add_arc('t_fork', f'p_instance_{i}')

        pn.add_transition(f't_instance_{i}')
        pn.add_arc(f'p_instance_{i}', f't_instance_{i}')

        # å„è‡ªå®Œæˆï¼Œæ— éœ€åŒæ­¥
        pn.add_place(f'p_done_{i}', tokens=0)
        pn.add_arc(f't_instance_{i}', f'p_done_{i}')

    return pn
```

### æ¨¡å¼13ï¼šå¸¦åŒæ­¥çš„å¤šå®ä¾‹ï¼ˆMI With a Priori Design Time Knowledgeï¼‰

```python
def pattern13_mi_with_sync(n_instances):
    """æ¨¡å¼13ï¼šå¤šå®ä¾‹éœ€è¦åŒæ­¥"""
    pn = PetriNet()

    pn.add_place('p_start', tokens=1)
    pn.add_transition('t_fork')
    pn.add_arc('p_start', 't_fork')

    # åˆ›å»ºnä¸ªå®ä¾‹
    for i in range(n_instances):
        pn.add_place(f'p_instance_{i}', tokens=0)
        pn.add_arc('t_fork', f'p_instance_{i}')

        pn.add_transition(f't_instance_{i}')
        pn.add_arc(f'p_instance_{i}', f't_instance_{i}')

        pn.add_place(f'p_done_{i}', tokens=0)
        pn.add_arc(f't_instance_{i}', f'p_done_{i}')

    # åŒæ­¥Join
    pn.add_transition('t_join')
    for i in range(n_instances):
        pn.add_arc(f'p_done_{i}', 't_join')

    pn.add_place('p_all_done', tokens=0)
    pn.add_arc('t_join', 'p_all_done')

    return pn
```

---

## 6 çŠ¶æ€æ¨¡å¼ï¼ˆ16-18ï¼‰

### æ¨¡å¼16ï¼šå»¶è¿Ÿé€‰æ‹©ï¼ˆDeferred Choiceï¼‰

```python
def pattern16_deferred_choice():
    """æ¨¡å¼16ï¼šå»¶è¿Ÿé€‰æ‹©ï¼ˆç”±ç¯å¢ƒå†³å®šï¼‰"""
    pn = PetriNet()

    pn.add_place('p_waiting', tokens=1)

    # ä¸¤ä¸ªé€‰æ‹©ï¼Œç”±å¤–éƒ¨äº‹ä»¶è§¦å‘
    pn.add_transition('t_choice_A')
    pn.add_arc('p_waiting', 't_choice_A')
    pn.add_place('p_A_executing', tokens=0)
    pn.add_arc('t_choice_A', 'p_A_executing')

    pn.add_transition('t_choice_B')
    pn.add_arc('p_waiting', 't_choice_B')
    pn.add_place('p_B_executing', tokens=0)
    pn.add_arc('t_choice_B', 'p_B_executing')

    return pn
```

---

## 7 å–æ¶ˆæ¨¡å¼ï¼ˆ19-20ï¼‰

### æ¨¡å¼19ï¼šå–æ¶ˆä»»åŠ¡ï¼ˆCancel Taskï¼‰

```python
def pattern19_cancel_task():
    """æ¨¡å¼19ï¼šå–æ¶ˆå•ä¸ªä»»åŠ¡"""
    pn = PetriNet()

    pn.add_place('p_task_active', tokens=1)

    # æ­£å¸¸å®Œæˆ
    pn.add_transition('t_complete')
    pn.add_arc('p_task_active', 't_complete')
    pn.add_place('p_completed', tokens=0)
    pn.add_arc('t_complete', 'p_completed')

    # å–æ¶ˆä»»åŠ¡
    pn.add_transition('t_cancel')
    pn.add_arc('p_task_active', 't_cancel')
    pn.add_place('p_cancelled', tokens=0)
    pn.add_arc('t_cancel', 'p_cancelled')

    return pn
```

---

**è¿”å›**: [04 å·¥ä½œæµè°ƒåº¦çš„Petriç½‘åˆ†æ](README.md)

**å‚è€ƒæ–‡çŒ®**ï¼š

1. van der Aalst, W.M.P., et al. (2003). "Workflow Patterns"
2. Russell, N., et al. (2006). "Workflow Control-Flow Patterns: A Revised View"
