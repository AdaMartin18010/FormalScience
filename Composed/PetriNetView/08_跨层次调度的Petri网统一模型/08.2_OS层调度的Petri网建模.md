# 08.2 OSå±‚è°ƒåº¦çš„Petriç½‘å»ºæ¨¡

> **å­ä¸»é¢˜**: 08.2
> **æ‰€å±žä¸»é¢˜**: 08 è·¨å±‚æ¬¡è°ƒåº¦çš„Petriç½‘ç»Ÿä¸€æ¨¡åž‹
> **æœ€åŽæ›´æ–°**: 2025-12-02

---

## ðŸ“‹ ç›®å½•

- [08.2 OSå±‚è°ƒåº¦çš„Petriç½‘å»ºæ¨¡](#082-oså±‚è°ƒåº¦çš„petriç½‘å»ºæ¨¡)
  - [ðŸ“‹ ç›®å½•](#-ç›®å½•)
  - [1 è¿›ç¨‹è°ƒåº¦çš„Petriç½‘æ¨¡åž‹ï¼ˆCFSï¼‰](#1-è¿›ç¨‹è°ƒåº¦çš„petriç½‘æ¨¡åž‹cfs)
  - [2 å†…å­˜ç®¡ç†](#2-å†…å­˜ç®¡ç†)
  - [3 I/Oè°ƒåº¦](#3-ioè°ƒåº¦)
  - [4 å®žé™…æ¡ˆä¾‹ï¼šLinuxè°ƒåº¦å™¨](#4-å®žé™…æ¡ˆä¾‹linuxè°ƒåº¦å™¨)

---

## 1 è¿›ç¨‹è°ƒåº¦çš„Petriç½‘æ¨¡åž‹ï¼ˆCFSï¼‰

**Linux CFSè°ƒåº¦å™¨**ï¼š

```python
def create_linux_cfs_scheduler():
    """Linux CFSè°ƒåº¦å™¨Petriç½‘æ¨¡åž‹"""
    pn = PetriNet()

    # CPUæ ¸å¿ƒ
    pn.add_place('p_cpu', tokens=4)

    # è¿›ç¨‹çŠ¶æ€
    processes = ['P1', 'P2', 'P3', 'P4', 'P5']

    for proc in processes:
        # TASK_RUNNING
        pn.add_place(f'p_{proc}_runnable', tokens=1)

        # è°ƒåº¦åˆ°CPU
        pn.add_transition(f't_{proc}_schedule')
        pn.add_arc(f'p_{proc}_runnable', f't_{proc}_schedule')
        pn.add_arc('p_cpu', f't_{proc}_schedule')

        # RUNNINGçŠ¶æ€
        pn.add_place(f'p_{proc}_running', tokens=0)
        pn.add_arc(f't_{proc}_schedule', f'p_{proc}_running')

        # æ—¶é—´ç‰‡ç”¨å®Œ
        pn.add_transition(f't_{proc}_timeslice_expire')
        pn.add_arc(f'p_{proc}_running', f't_{proc}_timeslice_expire')
        pn.add_arc(f't_{proc}_timeslice_expire', f'p_{proc}_runnable')
        pn.add_arc(f't_{proc}_timeslice_expire', 'p_cpu')  # é‡Šæ”¾CPU

    return pn
```

---

## 2 å†…å­˜ç®¡ç†

**é¡µé¢ç½®æ¢LRUç®—æ³•**ï¼š

```python
def create_lru_page_replacement():
    """LRUé¡µé¢ç½®æ¢Petriç½‘æ¨¡åž‹"""
    pn = PetriNet()

    # ç‰©ç†é¡µæ¡†ï¼ˆ4ä¸ªï¼‰
    pn.add_place('p_free_frames', tokens=4)

    # é¡µé¢è¯·æ±‚
    pn.add_transition('t_page_request')

    # ç¼ºé¡µå¤„ç†
    pn.add_transition('t_page_fault')
    pn.add_arc('p_free_frames', 't_page_fault')
    pn.add_place('p_loaded_pages', tokens=0)
    pn.add_arc('t_page_fault', 'p_loaded_pages')

    # é¡µé¢ç½®æ¢
    pn.add_transition('t_lru_replace')
    pn.add_arc('p_loaded_pages', 't_lru_replace')
    pn.add_arc('t_lru_replace', 'p_free_frames')

    return pn
```

---

## 3 I/Oè°ƒåº¦

**I/Oè¯·æ±‚é˜Ÿåˆ—è°ƒåº¦**ï¼š

```python
def create_io_scheduler():
    """I/Oè°ƒåº¦å™¨Petriç½‘æ¨¡åž‹ï¼ˆCFQï¼‰"""
    pn = PetriNet()

    # I/Oè¯·æ±‚é˜Ÿåˆ—
    pn.add_place('p_io_queue', tokens=10)

    # I/Oè®¾å¤‡ï¼ˆç£ç›˜ï¼‰
    pn.add_place('p_disk', tokens=1)

    # è°ƒåº¦I/Oè¯·æ±‚
    pn.add_transition('t_issue_io')
    pn.add_arc('p_io_queue', 't_issue_io')
    pn.add_arc('p_disk', 't_issue_io')

    # I/Oæ‰§è¡Œ
    pn.add_place('p_io_executing', tokens=0)
    pn.add_arc('t_issue_io', 'p_io_executing')

    # I/Oå®Œæˆ
    pn.add_transition('t_io_complete')
    pn.add_arc('p_io_executing', 't_io_complete')
    pn.add_arc('t_io_complete', 'p_disk')

    return pn
```

---

## 4 å®žé™…æ¡ˆä¾‹ï¼šLinuxè°ƒåº¦å™¨

**å®Œæ•´çš„Linuxè¿›ç¨‹çŠ¶æ€è½¬æ¢**ï¼š

```python
def create_linux_process_state_machine():
    """Linuxè¿›ç¨‹çŠ¶æ€æœºPetriç½‘"""
    pn = PetriNet()

    # è¿›ç¨‹çŠ¶æ€
    states = ['TASK_RUNNING', 'TASK_INTERRUPTIBLE',
              'TASK_UNINTERRUPTIBLE', 'TASK_STOPPED', 'TASK_ZOMBIE']

    for state in states:
        pn.add_place(f'p_{state}', tokens=0)

    pn.marking['p_TASK_RUNNING'] = 1

    # çŠ¶æ€è½¬æ¢
    # RUNNING -> INTERRUPTIBLE (sleep)
    pn.add_transition('t_sleep')
    pn.add_arc('p_TASK_RUNNING', 't_sleep')
    pn.add_arc('t_sleep', 'p_TASK_INTERRUPTIBLE')

    # INTERRUPTIBLE -> RUNNING (wake up)
    pn.add_transition('t_wakeup')
    pn.add_arc('p_TASK_INTERRUPTIBLE', 't_wakeup')
    pn.add_arc('t_wakeup', 'p_TASK_RUNNING')

    # RUNNING -> ZOMBIE (exit)
    pn.add_transition('t_exit')
    pn.add_arc('p_TASK_RUNNING', 't_exit')
    pn.add_arc('t_exit', 'p_TASK_ZOMBIE')

    return pn
```

---

**è¿”å›ž**: [08 è·¨å±‚æ¬¡è°ƒåº¦çš„Petriç½‘ç»Ÿä¸€æ¨¡åž‹](README.md)
