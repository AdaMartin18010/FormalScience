# 07.1 ç€è‰²Petriç½‘CPNè¯¦è§£

> **å­ä¸»é¢˜**: 07.1
> **æ‰€å±ä¸»é¢˜**: 07 é«˜çº§Petriç½‘åœ¨è°ƒåº¦ä¸­çš„åº”ç”¨
> **æœ€åæ›´æ–°**: 2025-12-02

---

## ğŸ“‹ ç›®å½•

- [07.1 ç€è‰²Petriç½‘CPNè¯¦è§£](#071-ç€è‰²petriç½‘cpnè¯¦è§£)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [1 CPNå½¢å¼åŒ–å®šä¹‰](#1-cpnå½¢å¼åŒ–å®šä¹‰)
  - [2 é¢œè‰²é›†ã€é¢œè‰²å‡½æ•°ã€å®ˆå«](#2-é¢œè‰²é›†é¢œè‰²å‡½æ•°å®ˆå«)
  - [3 CPNä¸æ™®é€šPetriç½‘çš„å…³ç³»](#3-cpnä¸æ™®é€špetriç½‘çš„å…³ç³»)
  - [4 å®é™…æ¡ˆä¾‹ï¼šå¤šç±»å‹ä»»åŠ¡è°ƒåº¦](#4-å®é™…æ¡ˆä¾‹å¤šç±»å‹ä»»åŠ¡è°ƒåº¦)

---

## 1 CPNå½¢å¼åŒ–å®šä¹‰

**å®šä¹‰7.11ï¼ˆç€è‰²Petriç½‘ï¼‰**ï¼š

$$
CPN = (P, T, F, \Sigma, V, C, G, E, I)
$$

å…¶ä¸­ï¼š

- $\Sigma$ï¼šé¢œè‰²é›†åˆ
- $V$ï¼šå˜é‡é›†åˆ
- $C: P \to \Sigma$ï¼šåº“æ‰€é¢œè‰²é›†å‡½æ•°
- $G: T \to \text{Expr}$ï¼šå®ˆå«è¡¨è¾¾å¼
- $E: F \to \text{Expr}$ï¼šå¼§è¡¨è¾¾å¼
- $I: P \to \text{Expr}$ï¼šåˆå§‹æ ‡è®°è¡¨è¾¾å¼

---

## 2 é¢œè‰²é›†ã€é¢œè‰²å‡½æ•°ã€å®ˆå«

**CPN MLç¤ºä¾‹**ï¼š

```sml
(* ä»»åŠ¡è°ƒåº¦CPNæ¨¡å‹ *)
colset TaskType = with CPU_Task | IO_Task | GPU_Task;
colset Priority = int;
colset Task = product TaskType * Priority;

(* ä»»åŠ¡é˜Ÿåˆ—åº“æ‰€ *)
place TaskQueue : Task;

(* èµ„æºåº“æ‰€ *)
place CPU : INT;
place GPU : INT;

(* åˆå§‹æ ‡è®° *)
init TaskQueue: 1`(CPU_Task, 5) ++ 1`(IO_Task, 3) ++ 1`(GPU_Task, 7);
init CPU: 1`4;  (* 4ä¸ªCPUæ ¸å¿ƒ *)
init GPU: 1`2;  (* 2ä¸ªGPU *)

(* è°ƒåº¦å˜è¿ï¼ˆå¸¦å®ˆå«ï¼‰ *)
var ttype : TaskType;
var prio : Priority;

trans ScheduleCPUTask
  in   TaskQueue 1`(CPU_Task, prio) @@ CPU 1`n
  out  RunningTasks 1`(CPU_Task, prio) @@ CPU 1`(n-1)
  guard prio > 3 andalso n > 0;  (* åªè°ƒåº¦é«˜ä¼˜å…ˆçº§ä»»åŠ¡ *)
```

---

## 3 CPNä¸æ™®é€šPetriç½‘çš„å…³ç³»

**å®šç†7.11ï¼ˆå±•å¼€å®šç†ï¼‰**ï¼š

æ¯ä¸ªCPNéƒ½å¯ä»¥**å±•å¼€ï¼ˆUnfoldï¼‰**ä¸ºç­‰ä»·çš„æ™®é€šPetriç½‘ã€‚

$$
\text{Unfold}(CPN) = PN
$$

---

## 4 å®é™…æ¡ˆä¾‹ï¼šå¤šç±»å‹ä»»åŠ¡è°ƒåº¦

```python
# æ¦‚å¿µæ€§å®ç°ï¼ˆå®é™…ç”¨CPN Toolsï¼‰
class ColoredTaskScheduler:
    """ç€è‰²Petriç½‘ä»»åŠ¡è°ƒåº¦æ¨¡å‹"""

    def __init__(self):
        # é¢œè‰²é›†
        self.TaskType = ['CPU', 'GPU', 'IO']
        self.Priority = range(1, 11)

    def create_cpn_model(self):
        """åˆ›å»ºCPNæ¨¡å‹"""
        # ä»»åŠ¡é˜Ÿåˆ—ï¼š(TaskType, Priority)
        task_queue = [
            ('CPU', 8),
            ('GPU', 9),
            ('IO', 5),
            ('CPU', 6)
        ]

        # å®ˆå«æ¡ä»¶ï¼šåªè°ƒåº¦ä¼˜å…ˆçº§>5çš„ä»»åŠ¡
        def guard(task):
            return task[1] > 5

        # ç­›é€‰å¯è°ƒåº¦ä»»åŠ¡
        schedulable = [t for t in task_queue if guard(t)]

        print(f"å¯è°ƒåº¦ä»»åŠ¡: {schedulable}")

        return schedulable

scheduler = ColoredTaskScheduler()
tasks = scheduler.create_cpn_model()
```

---

**è¿”å›**: [07 é«˜çº§Petriç½‘åœ¨è°ƒåº¦ä¸­çš„åº”ç”¨](README.md)

**å‚è€ƒæ–‡çŒ®**ï¼š

1. Jensen, K., & Kristensen, L.M. (2009). "Coloured Petri Nets: Modelling and Validation"
