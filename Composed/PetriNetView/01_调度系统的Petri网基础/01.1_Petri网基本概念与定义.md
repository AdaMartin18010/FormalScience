# 01.1 Petriç½‘åŸºæœ¬æ¦‚å¿µä¸å®šä¹‰

> **å­ä¸»é¢˜**: 01.1
> **æ‰€å±ä¸»é¢˜**: 01 è°ƒåº¦ç³»ç»Ÿçš„Petriç½‘åŸºç¡€
> **æœ€åæ›´æ–°**: 2025-12-02
> **æ–‡æ¡£çŠ¶æ€**: âœ… æ–°å¢

---

## ğŸ“‹ ç›®å½•

- [01.1 Petriç½‘åŸºæœ¬æ¦‚å¿µä¸å®šä¹‰](#011-petriç½‘åŸºæœ¬æ¦‚å¿µä¸å®šä¹‰)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [1 Petriç½‘çš„å†å²ä¸åŠ¨æœº](#1-petriç½‘çš„å†å²ä¸åŠ¨æœº)
  - [2 Petriç½‘çš„å½¢å¼åŒ–å®šä¹‰](#2-petriç½‘çš„å½¢å¼åŒ–å®šä¹‰)
    - [2.1 åŸºæœ¬å®šä¹‰](#21-åŸºæœ¬å®šä¹‰)
    - [2.2 æ ‡è®°ä¸ä½¿èƒ½](#22-æ ‡è®°ä¸ä½¿èƒ½)
    - [2.3 å˜è¿ç‚¹ç«](#23-å˜è¿ç‚¹ç«)
  - [3 Petriç½‘çš„å›¾å½¢è¡¨ç¤º](#3-petriç½‘çš„å›¾å½¢è¡¨ç¤º)
  - [4 Petriç½‘çš„åŸºæœ¬æ€§è´¨](#4-petriç½‘çš„åŸºæœ¬æ€§è´¨)
    - [4.1 æœ‰ç•Œæ€§ï¼ˆBoundednessï¼‰](#41-æœ‰ç•Œæ€§boundedness)
    - [4.2 å®‰å…¨æ€§ï¼ˆSafenessï¼‰](#42-å®‰å…¨æ€§safeness)
    - [4.3 æ´»æ€§ï¼ˆLivenessï¼‰](#43-æ´»æ€§liveness)
    - [4.4 å¯è¾¾æ€§ï¼ˆReachabilityï¼‰](#44-å¯è¾¾æ€§reachability)
    - [4.5 å¯é€†æ€§ï¼ˆReversibilityï¼‰](#45-å¯é€†æ€§reversibility)
  - [5 å¯è¾¾æ€§å›¾ä¸çŠ¶æ€ç©ºé—´](#5-å¯è¾¾æ€§å›¾ä¸çŠ¶æ€ç©ºé—´)
  - [6 Pythonå®ç°ï¼šåŸºç¡€Petriç½‘å»ºæ¨¡](#6-pythonå®ç°åŸºç¡€petriç½‘å»ºæ¨¡)
    - [6.1 ä½¿ç”¨NetworkX](#61-ä½¿ç”¨networkx)
    - [6.2 ä½¿ç”¨SNAKESåº“](#62-ä½¿ç”¨snakesåº“)
  - [7 å®é™…æ¡ˆä¾‹ï¼šç”Ÿäº§è€…-æ¶ˆè´¹è€…ç³»ç»Ÿ](#7-å®é™…æ¡ˆä¾‹ç”Ÿäº§è€…-æ¶ˆè´¹è€…ç³»ç»Ÿ)
  - [8 è·¨è§†è§’é“¾æ¥](#8-è·¨è§†è§’é“¾æ¥)

---

## 1 Petriç½‘çš„å†å²ä¸åŠ¨æœº

**Petriç½‘**ç”±å¾·å›½æ•°å­¦å®¶Carl Adam Petriäº1962å¹´åœ¨å…¶åšå£«è®ºæ–‡ä¸­é¦–æ¬¡æå‡ºï¼Œç”¨äºå»ºæ¨¡å’Œåˆ†æå¹¶å‘ç³»ç»Ÿã€‚

**æ ¸å¿ƒåŠ¨æœº**ï¼š

1. **å¹¶å‘æ€§éš¾é¢˜**ï¼šä¼ ç»Ÿçš„çŠ¶æ€æœºéš¾ä»¥è‡ªç„¶è¡¨ç¤ºå¹¶å‘è¡Œä¸º
   - çŠ¶æ€ç©ºé—´çˆ†ç‚¸ï¼šnä¸ªå¹¶å‘è¿›ç¨‹éœ€è¦2^nä¸ªçŠ¶æ€
   - åŒæ­¥å¤æ‚ï¼šéœ€è¦å¤æ‚çš„åŒæ­¥åŸè¯­

2. **Petriç½‘çš„ä¼˜åŠ¿**ï¼š
   - **è‡ªç„¶è¡¨ç¤ºå¹¶å‘**ï¼šå¤šä¸ªå˜è¿å¯ä»¥åŒæ—¶ä½¿èƒ½
   - **ç›´è§‚å›¾å½¢åŒ–**ï¼šåº“æ‰€-å˜è¿å›¾ç›´è§‚æ˜“æ‡‚
   - **å½¢å¼åŒ–åŸºç¡€**ï¼šä¸¥æ ¼çš„æ•°å­¦å®šä¹‰ï¼Œæ”¯æŒå½¢å¼åŒ–åˆ†æ

**å†å²é‡Œç¨‹ç¢‘**ï¼š

```text
1962 - Carl Petriåšå£«è®ºæ–‡ï¼Œæå‡ºPetriç½‘
1972 - ç€è‰²Petriç½‘ï¼ˆColored Petri Nets, CPNï¼‰
1980 - æ—¶é—´Petriç½‘ï¼ˆTimed Petri Nets, TPNï¼‰
1984 - éšæœºPetriç½‘ï¼ˆStochastic Petri Nets, SPNï¼‰
1990 - å·¥ä½œæµç½‘ï¼ˆWorkflow Nets, WF-netï¼‰
2000+ - Petriç½‘åœ¨å·¥ä¸šç•Œå¹¿æ³›åº”ç”¨
2020+ - Petriç½‘ä¸AIç»“åˆï¼ˆPetriRLï¼‰
```

---

## 2 Petriç½‘çš„å½¢å¼åŒ–å®šä¹‰

### 2.1 åŸºæœ¬å®šä¹‰

**å®šä¹‰1.1ï¼ˆPetriç½‘ï¼‰**ï¼š

ä¸€ä¸ªPetriç½‘æ˜¯ä¸€ä¸ªäº”å…ƒç»„ï¼š

$$
PN = (P, T, F, W, M_0)
$$

å…¶ä¸­ï¼š

- $P = \{p_1, p_2, \ldots, p_m\}$ æ˜¯**åº“æ‰€ï¼ˆPlacesï¼‰**çš„æœ‰é™é›†åˆ
- $T = \{t_1, t_2, \ldots, t_n\}$ æ˜¯**å˜è¿ï¼ˆTransitionsï¼‰**çš„æœ‰é™é›†åˆ
- $F \subseteq (P \times T) \cup (T \times P)$ æ˜¯**å¼§ï¼ˆArcsï¼‰**çš„é›†åˆ
- $W: F \to \mathbb{N}^+$ æ˜¯**æƒé‡å‡½æ•°**ï¼ˆå¦‚æœæœªæŒ‡å®šï¼Œé»˜è®¤ä¸º1ï¼‰
- $M_0: P \to \mathbb{N}$ æ˜¯**åˆå§‹æ ‡è®°ï¼ˆInitial Markingï¼‰**

**çº¦æŸæ¡ä»¶**ï¼š

1. $P \cap T = \emptyset$ ï¼ˆåº“æ‰€å’Œå˜è¿äº’ä¸ç›¸äº¤ï¼‰
2. $P \cup T \neq \emptyset$ ï¼ˆè‡³å°‘æœ‰ä¸€ä¸ªåº“æ‰€æˆ–å˜è¿ï¼‰
3. å¼§åªèƒ½è¿æ¥åº“æ‰€å’Œå˜è¿ï¼Œä¸èƒ½è¿æ¥åŒç±»èŠ‚ç‚¹

**è®°å·è¯´æ˜**ï¼š

- $\bullet t = \{p \in P \mid (p, t) \in F\}$ ï¼šå˜è¿ $t$ çš„**è¾“å…¥åº“æ‰€**
- $t\bullet = \{p \in P \mid (t, p) \in F\}$ ï¼šå˜è¿ $t$ çš„**è¾“å‡ºåº“æ‰€**
- $\bullet p = \{t \in T \mid (t, p) \in F\}$ ï¼šåº“æ‰€ $p$ çš„**è¾“å…¥å˜è¿**
- $p\bullet = \{t \in T \mid (p, t) \in F\}$ ï¼šåº“æ‰€ $p$ çš„**è¾“å‡ºå˜è¿**

### 2.2 æ ‡è®°ä¸ä½¿èƒ½

**å®šä¹‰1.2ï¼ˆæ ‡è®°ï¼‰**ï¼š

æ ‡è®° $M: P \to \mathbb{N}$ æ˜¯ä»åº“æ‰€åˆ°éè´Ÿæ•´æ•°çš„å‡½æ•°ï¼Œ$M(p)$ è¡¨ç¤ºåº“æ‰€ $p$ ä¸­çš„**æ ‡è®°æ•°é‡**ï¼ˆtokensï¼‰ã€‚

**å®šä¹‰1.3ï¼ˆä½¿èƒ½ï¼‰**ï¼š

å˜è¿ $t \in T$ åœ¨æ ‡è®° $M$ ä¸‹**ä½¿èƒ½ï¼ˆEnabledï¼‰**ï¼Œè®°ä¸º $M[t\rangle$ï¼Œå½“ä¸”ä»…å½“ï¼š

$$
\forall p \in \bullet t: M(p) \geq W(p, t)
$$

å³ï¼šæ‰€æœ‰è¾“å…¥åº“æ‰€çš„æ ‡è®°æ•°é‡éƒ½å¤§äºç­‰äºç›¸åº”å¼§çš„æƒé‡ã€‚

**ç›´è§‚ç†è§£**ï¼šå˜è¿ä½¿èƒ½æ„å‘³ç€å®ƒå…·å¤‡äº†"ç‚¹ç«"çš„æ¡ä»¶ï¼Œå°±åƒè°ƒåº¦ç³»ç»Ÿä¸­ä»»åŠ¡æ»¡è¶³äº†æ‰§è¡Œçš„èµ„æºéœ€æ±‚ã€‚

### 2.3 å˜è¿ç‚¹ç«

**å®šä¹‰1.4ï¼ˆç‚¹ç«ï¼‰**ï¼š

å¦‚æœå˜è¿ $t$ åœ¨æ ‡è®° $M$ ä¸‹ä½¿èƒ½ï¼Œé‚£ä¹ˆ $t$ å¯ä»¥**ç‚¹ç«ï¼ˆFireï¼‰**ï¼Œäº§ç”Ÿæ–°æ ‡è®° $M'$ï¼Œè®°ä¸º $M[t\rangle M'$ï¼Œå…¶ä¸­ï¼š

$$
M'(p) = \begin{cases}
M(p) - W(p, t) + W(t, p) & \text{if } p \in \bullet t \cup t\bullet \\
M(p) & \text{otherwise}
\end{cases}
$$

**ç‚¹ç«è§„åˆ™çš„ç®€æ´è¡¨ç¤º**ï¼š

$$
M'(p) = M(p) - W(p, t) + W(t, p)
$$

å…¶ä¸­æœªå®šä¹‰çš„æƒé‡é»˜è®¤ä¸º0ã€‚

**æ€§è´¨1.1ï¼ˆç‚¹ç«çš„åŸå­æ€§ï¼‰**ï¼š

å˜è¿ç‚¹ç«æ˜¯**åŸå­æ“ä½œ**ï¼Œä¸å¯ä¸­æ–­ï¼Œè¦ä¹ˆå®Œå…¨æ‰§è¡Œï¼Œè¦ä¹ˆä¸æ‰§è¡Œã€‚

---

## 3 Petriç½‘çš„å›¾å½¢è¡¨ç¤º

Petriç½‘æœ‰æ ‡å‡†çš„å›¾å½¢è¡¨ç¤ºæ³•ï¼š

```text
å›¾å½¢å…ƒç´ ï¼š
- åº“æ‰€ï¼ˆPlaceï¼‰ï¼š   â—‹ åœ†åœˆ
- å˜è¿ï¼ˆTransitionï¼‰ï¼šâ–¯ çŸ©å½¢æˆ–ç«–çº¿
- å¼§ï¼ˆArcï¼‰ï¼š        â†’ æœ‰å‘ç®­å¤´
- æ ‡è®°ï¼ˆTokenï¼‰ï¼š    â— é»‘ç‚¹ï¼ˆåœ¨åº“æ‰€å†…ï¼‰
- æƒé‡ï¼š            æ•°å­—ï¼ˆåœ¨å¼§æ—è¾¹ï¼Œé»˜è®¤ä¸º1ï¼‰
```

**ç¤ºä¾‹ï¼šç®€å•çš„ç”Ÿäº§è€…-æ¶ˆè´¹è€…ç³»ç»Ÿ**

```text
    [p_buffer]
       â—â—â—
      â†—   â†˜
  [t_produce]  [t_consume]
      â†‘           â†“
   [p_producer] [p_consumer]
      â—           â—
```

**å¯¹åº”å½¢å¼åŒ–è¡¨ç¤º**ï¼š

```text
P = {p_producer, p_buffer, p_consumer}
T = {t_produce, t_consume}
F = {(p_producer, t_produce), (t_produce, p_buffer),
     (p_buffer, t_consume), (t_consume, p_consumer)}
W = æ‰€æœ‰å¼§æƒé‡ä¸º1ï¼ˆé»˜è®¤ï¼‰
M_0 = {p_producer: 1, p_buffer: 3, p_consumer: 1}
```

---

## 4 Petriç½‘çš„åŸºæœ¬æ€§è´¨

### 4.1 æœ‰ç•Œæ€§ï¼ˆBoundednessï¼‰

**å®šä¹‰1.5ï¼ˆk-æœ‰ç•Œï¼‰**ï¼š

Petriç½‘ $(PN, M_0)$ æ˜¯**k-æœ‰ç•Œ**çš„ï¼Œå¦‚æœå¯¹äºæ‰€æœ‰å¯è¾¾æ ‡è®° $M \in R(M_0)$ å’Œæ‰€æœ‰åº“æ‰€ $p \in P$ï¼š

$$
M(p) \leq k
$$

**å®šä¹‰1.6ï¼ˆæœ‰ç•Œï¼‰**ï¼š

å¦‚æœå­˜åœ¨ $k \in \mathbb{N}$ ä½¿å¾—Petriç½‘æ˜¯k-æœ‰ç•Œçš„ï¼Œåˆ™ç§°å…¶ä¸º**æœ‰ç•Œçš„**ã€‚

**è°ƒåº¦ç³»ç»Ÿæ„ä¹‰**ï¼šæœ‰ç•Œæ€§ä¿è¯èµ„æºæ•°é‡æœ‰é™ï¼Œä¸ä¼šæ— é™å¢é•¿ã€‚

### 4.2 å®‰å…¨æ€§ï¼ˆSafenessï¼‰

**å®šä¹‰1.7ï¼ˆå®‰å…¨ï¼‰**ï¼š

Petriç½‘æ˜¯**å®‰å…¨çš„**ï¼Œå¦‚æœå®ƒæ˜¯1-æœ‰ç•Œçš„ï¼Œå³ï¼š

$$
\forall M \in R(M_0), \forall p \in P: M(p) \leq 1
$$

**è°ƒåº¦ç³»ç»Ÿæ„ä¹‰**ï¼šå®‰å…¨æ€§ä¿è¯æ¯ä¸ªåº“æ‰€æœ€å¤šä¸€ä¸ªæ ‡è®°ï¼Œé€‚åˆå»ºæ¨¡äºŒå€¼çŠ¶æ€ï¼ˆå¦‚äº’æ–¥é”ï¼‰ã€‚

### 4.3 æ´»æ€§ï¼ˆLivenessï¼‰

**å®šä¹‰1.8ï¼ˆæ­»å˜è¿ï¼‰**ï¼š

å˜è¿ $t$ åœ¨ $(PN, M_0)$ ä¸­æ˜¯**æ­»çš„**ï¼Œå¦‚æœä¸å­˜åœ¨å¯è¾¾æ ‡è®°ä½¿å…¶ä½¿èƒ½ï¼š

$$
\not\exists M \in R(M_0): M[t\rangle
$$

**å®šä¹‰1.9ï¼ˆL4-æ´»æ€§ï¼‰**ï¼š

å˜è¿ $t$ æ˜¯**L4-æ´»ï¼ˆLiveï¼‰**çš„ï¼Œå¦‚æœå¯¹äºæ‰€æœ‰å¯è¾¾æ ‡è®° $M \in R(M_0)$ï¼Œå­˜åœ¨ $M' \in R(M)$ ä½¿å¾— $t$ åœ¨ $M'$ ä¸‹ä½¿èƒ½ï¼š

$$
\forall M \in R(M_0), \exists M' \in R(M): M'[t\rangle
$$

**Petriç½‘çš„æ´»æ€§**ï¼šå¦‚æœæ‰€æœ‰å˜è¿éƒ½æ˜¯L4-æ´»çš„ï¼Œåˆ™Petriç½‘æ˜¯æ´»çš„ã€‚

**è°ƒåº¦ç³»ç»Ÿæ„ä¹‰**ï¼šæ´»æ€§ä¿è¯ç³»ç»Ÿæ— æ­»é”ï¼Œæ‰€æœ‰ä»»åŠ¡æœ€ç»ˆéƒ½æœ‰æœºä¼šæ‰§è¡Œã€‚

### 4.4 å¯è¾¾æ€§ï¼ˆReachabilityï¼‰

**å®šä¹‰1.10ï¼ˆå¯è¾¾æ ‡è®°é›†ï¼‰**ï¼š

ä»åˆå§‹æ ‡è®° $M_0$ **å¯è¾¾çš„æ ‡è®°é›†**å®šä¹‰ä¸ºï¼š

$$
R(M_0) = \{M \mid \exists \sigma \in T^*: M_0[\sigma\rangle M\}
$$

å…¶ä¸­ $\sigma$ æ˜¯å˜è¿ç‚¹ç«åºåˆ—ã€‚

**å¯è¾¾æ€§é—®é¢˜**ï¼šç»™å®šæ ‡è®° $M$ï¼Œåˆ¤æ–­ $M \in R(M_0)$ï¼Ÿ

**å¤æ‚åº¦**ï¼šå¯è¾¾æ€§é—®é¢˜æ˜¯**EXPSPACE-å®Œå…¨**çš„ï¼ˆLipton, 1976ï¼‰ã€‚

### 4.5 å¯é€†æ€§ï¼ˆReversibilityï¼‰

**å®šä¹‰1.11ï¼ˆå¯é€†ï¼‰**ï¼š

Petriç½‘ $(PN, M_0)$ æ˜¯**å¯é€†çš„**ï¼Œå¦‚æœå¯¹äºæ‰€æœ‰å¯è¾¾æ ‡è®° $M \in R(M_0)$ï¼Œåˆå§‹æ ‡è®° $M_0$ ä¹Ÿæ˜¯ä» $M$ å¯è¾¾çš„ï¼š

$$
\forall M \in R(M_0): M_0 \in R(M)
$$

**è°ƒåº¦ç³»ç»Ÿæ„ä¹‰**ï¼šå¯é€†æ€§ä¿è¯ç³»ç»Ÿå¯ä»¥å›åˆ°åˆå§‹çŠ¶æ€ï¼Œé€‚åˆå¾ªç¯è°ƒåº¦ç³»ç»Ÿã€‚

---

## 5 å¯è¾¾æ€§å›¾ä¸çŠ¶æ€ç©ºé—´

**å®šä¹‰1.12ï¼ˆå¯è¾¾æ€§å›¾ï¼‰**ï¼š

å¯è¾¾æ€§å›¾ï¼ˆReachability Graphï¼‰æ˜¯ä¸€ä¸ªæœ‰å‘å›¾ $RG = (V, E)$ï¼Œå…¶ä¸­ï¼š

- $V = R(M_0)$ ï¼šå¯è¾¾æ ‡è®°é›†
- $E = \{(M, M') \mid \exists t \in T: M[t\rangle M'\}$ ï¼šæ ‡è®°è½¬æ¢

**æ„é€ ç®—æ³•**ï¼š

```python
def construct_reachability_graph(PN, M0):
    """
    æ„é€ å¯è¾¾æ€§å›¾ï¼ˆå¹¿åº¦ä¼˜å…ˆæœç´¢ï¼‰
    """
    RG = nx.DiGraph()  # æœ‰å‘å›¾
    queue = [M0]
    visited = {M0}
    RG.add_node(M0)

    while queue:
        M = queue.pop(0)

        # æ£€æŸ¥æ‰€æœ‰å˜è¿
        for t in PN.transitions:
            if is_enabled(PN, M, t):
                M_new = fire_transition(PN, M, t)

                if M_new not in visited:
                    visited.add(M_new)
                    queue.append(M_new)
                    RG.add_node(M_new)

                RG.add_edge(M, M_new, label=t)

    return RG
```

**çŠ¶æ€ç©ºé—´çˆ†ç‚¸é—®é¢˜**ï¼š

- å¯è¾¾æ ‡è®°æ•°å¯èƒ½æŒ‡æ•°çº§å¢é•¿
- è§£å†³æ–¹æ³•ï¼š
  1. æœ‰ç•Œæ€§åˆ†æï¼ˆé™åˆ¶çŠ¶æ€ç©ºé—´ï¼‰
  2. ç¬¦å·åŒ–æ–¹æ³•ï¼ˆBDDï¼‰
  3. å±€éƒ¨åˆ†æï¼ˆä¸å˜é‡åˆ†æï¼‰

---

## 6 Pythonå®ç°ï¼šåŸºç¡€Petriç½‘å»ºæ¨¡

### 6.1 ä½¿ç”¨NetworkX

```python
import networkx as nx
import matplotlib.pyplot as plt
from collections import defaultdict

class PetriNet:
    """åŸºç¡€Petriç½‘å®ç°"""

    def __init__(self):
        self.places = set()
        self.transitions = set()
        self.arcs = {}  # (source, target) -> weight
        self.marking = defaultdict(int)

    def add_place(self, name, tokens=0):
        """æ·»åŠ åº“æ‰€"""
        self.places.add(name)
        self.marking[name] = tokens

    def add_transition(self, name):
        """æ·»åŠ å˜è¿"""
        self.transitions.add(name)

    def add_arc(self, source, target, weight=1):
        """æ·»åŠ å¼§"""
        self.arcs[(source, target)] = weight

    def is_enabled(self, transition):
        """æ£€æŸ¥å˜è¿æ˜¯å¦ä½¿èƒ½"""
        for place in self.places:
            if (place, transition) in self.arcs:
                required = self.arcs[(place, transition)]
                if self.marking[place] < required:
                    return False
        return True

    def fire(self, transition):
        """ç‚¹ç«å˜è¿"""
        if not self.is_enabled(transition):
            raise ValueError(f"Transition {transition} is not enabled")

        # æ¶ˆè€—è¾“å…¥åº“æ‰€çš„æ ‡è®°
        for place in self.places:
            if (place, transition) in self.arcs:
                weight = self.arcs[(place, transition)]
                self.marking[place] -= weight

        # äº§ç”Ÿè¾“å‡ºåº“æ‰€çš„æ ‡è®°
        for place in self.places:
            if (transition, place) in self.arcs:
                weight = self.arcs[(transition, place)]
                self.marking[place] += weight

    def visualize(self):
        """å¯è§†åŒ–Petriç½‘"""
        G = nx.DiGraph()

        # æ·»åŠ èŠ‚ç‚¹
        for p in self.places:
            G.add_node(p, node_type='place', tokens=self.marking[p])
        for t in self.transitions:
            G.add_node(t, node_type='transition')

        # æ·»åŠ è¾¹
        for (source, target), weight in self.arcs.items():
            G.add_edge(source, target, weight=weight)

        # å¸ƒå±€
        pos = nx.spring_layout(G)

        # ç»˜åˆ¶åº“æ‰€ï¼ˆåœ†å½¢ï¼‰
        place_nodes = [n for n, d in G.nodes(data=True) if d['node_type'] == 'place']
        nx.draw_networkx_nodes(G, pos, nodelist=place_nodes,
                                node_color='lightblue', node_shape='o', node_size=800)

        # ç»˜åˆ¶å˜è¿ï¼ˆæ–¹å½¢ï¼‰
        trans_nodes = [n for n, d in G.nodes(data=True) if d['node_type'] == 'transition']
        nx.draw_networkx_nodes(G, pos, nodelist=trans_nodes,
                                node_color='lightgreen', node_shape='s', node_size=800)

        # ç»˜åˆ¶è¾¹
        nx.draw_networkx_edges(G, pos, arrowsize=20)
        nx.draw_networkx_labels(G, pos)

        # æ˜¾ç¤ºæ ‡è®°æ•°
        for p in place_nodes:
            tokens = G.nodes[p]['tokens']
            plt.text(pos[p][0], pos[p][1]-0.1, f"â—"*tokens,
                     ha='center', fontsize=10, color='red')

        plt.axis('off')
        plt.show()

# ç¤ºä¾‹ï¼šç”Ÿäº§è€…-æ¶ˆè´¹è€…ç³»ç»Ÿ
pn = PetriNet()

# æ·»åŠ åº“æ‰€
pn.add_place('p_producer', tokens=1)
pn.add_place('p_buffer', tokens=3)
pn.add_place('p_consumer', tokens=1)

# æ·»åŠ å˜è¿
pn.add_transition('t_produce')
pn.add_transition('t_consume')

# æ·»åŠ å¼§
pn.add_arc('p_producer', 't_produce')
pn.add_arc('t_produce', 'p_buffer')
pn.add_arc('p_buffer', 't_consume')
pn.add_arc('t_consume', 'p_consumer')

# å¯è§†åŒ–
pn.visualize()

# æ¨¡æ‹Ÿæ‰§è¡Œ
print(f"Initial marking: {dict(pn.marking)}")
pn.fire('t_produce')
print(f"After t_produce: {dict(pn.marking)}")
pn.fire('t_consume')
print(f"After t_consume: {dict(pn.marking)}")
```

### 6.2 ä½¿ç”¨SNAKESåº“

```python
import snakes.plugins
snakes.plugins.load('gv', 'snakes.nets', 'nets')
from nets import *

# åˆ›å»ºPetriç½‘
net = PetriNet('Producer-Consumer')

# æ·»åŠ åº“æ‰€
net.add_place(Place('p_producer', [1]))  # åˆå§‹1ä¸ªæ ‡è®°
net.add_place(Place('p_buffer', [1, 2, 3]))  # åˆå§‹3ä¸ªæ ‡è®°
net.add_place(Place('p_consumer', [1]))

# æ·»åŠ å˜è¿
net.add_transition(Transition('t_produce'))
net.add_transition(Transition('t_consume'))

# æ·»åŠ å¼§
net.add_input('p_producer', 't_produce', Variable('x'))
net.add_output('p_buffer', 't_produce', Variable('x'))
net.add_input('p_buffer', 't_consume', Variable('y'))
net.add_output('p_consumer', 't_consume', Variable('y'))

# å¯è§†åŒ–
net.draw('producer_consumer.png')

# æ¨¡æ‹Ÿæ‰§è¡Œ
print(f"Initial marking: {net.get_marking()}")
trans = net.transition('t_produce')
if trans.enabled(net.get_marking()):
    net.set_marking(trans.fire(Substitution()))
    print(f"After t_produce: {net.get_marking()}")
```

---

## 7 å®é™…æ¡ˆä¾‹ï¼šç”Ÿäº§è€…-æ¶ˆè´¹è€…ç³»ç»Ÿ

**ç³»ç»Ÿæè¿°**ï¼š

- ç”Ÿäº§è€…äº§ç”Ÿæ•°æ®æ”¾å…¥ç¼“å†²åŒº
- æ¶ˆè´¹è€…ä»ç¼“å†²åŒºå–å‡ºæ•°æ®æ¶ˆè´¹
- ç¼“å†²åŒºå®¹é‡æœ‰é™ï¼ˆä¾‹å¦‚ï¼š5ä¸ªä½ç½®ï¼‰

**Petriç½‘å»ºæ¨¡**ï¼š

```python
def producer_consumer_petri_net(buffer_size=5):
    """
    ç”Ÿäº§è€…-æ¶ˆè´¹è€…ç³»ç»Ÿçš„Petriç½‘æ¨¡å‹
    """
    pn = PetriNet()

    # åº“æ‰€
    pn.add_place('p_producer_ready', tokens=1)  # ç”Ÿäº§è€…å‡†å¤‡å°±ç»ª
    pn.add_place('p_empty_slots', tokens=buffer_size)  # ç©ºæ§½ä½
    pn.add_place('p_full_slots', tokens=0)  # æ»¡æ§½ä½
    pn.add_place('p_consumer_ready', tokens=1)  # æ¶ˆè´¹è€…å‡†å¤‡å°±ç»ª

    # å˜è¿
    pn.add_transition('t_produce')  # ç”Ÿäº§
    pn.add_transition('t_consume')  # æ¶ˆè´¹

    # å¼§ï¼ˆç”Ÿäº§ï¼‰
    pn.add_arc('p_producer_ready', 't_produce')
    pn.add_arc('t_produce', 'p_producer_ready')  # å¾ªç¯
    pn.add_arc('p_empty_slots', 't_produce')
    pn.add_arc('t_produce', 'p_full_slots')

    # å¼§ï¼ˆæ¶ˆè´¹ï¼‰
    pn.add_arc('p_consumer_ready', 't_consume')
    pn.add_arc('t_consume', 'p_consumer_ready')  # å¾ªç¯
    pn.add_arc('p_full_slots', 't_consume')
    pn.add_arc('t_consume', 'p_empty_slots')

    return pn

# è¿è¡Œæ¨¡æ‹Ÿ
pn = producer_consumer_petri_net(buffer_size=5)
pn.visualize()

# æ¨¡æ‹Ÿç”Ÿäº§-æ¶ˆè´¹å¾ªç¯
for i in range(10):
    if pn.is_enabled('t_produce'):
        pn.fire('t_produce')
        print(f"Step {i+1}: Produced. Buffer: {pn.marking['p_full_slots']}/{pn.marking['p_empty_slots']+pn.marking['p_full_slots']}")

    if pn.is_enabled('t_consume') and i % 2 == 0:  # æ¯ä¸¤æ­¥æ¶ˆè´¹ä¸€æ¬¡
        pn.fire('t_consume')
        print(f"Step {i+1}: Consumed. Buffer: {pn.marking['p_full_slots']}/{pn.marking['p_empty_slots']+pn.marking['p_full_slots']}")
```

**åˆ†æ**ï¼š

1. **æœ‰ç•Œæ€§**ï¼šç¼“å†²åŒºå¤§å°å›ºå®šï¼Œç³»ç»Ÿæ˜¯æœ‰ç•Œçš„
2. **æ´»æ€§**ï¼šç”Ÿäº§å’Œæ¶ˆè´¹å¯ä»¥æŒç»­è¿›è¡Œï¼Œç³»ç»Ÿæ˜¯æ´»çš„
3. **æ­»é”è‡ªç”±**ï¼šè®¾è®¡ä¿è¯ä¸ä¼šæ­»é”

---

## 8 è·¨è§†è§’é“¾æ¥

**Petriç½‘ç†è®ºåŸºç¡€**ï¼š

- [10_Petriç½‘ç†è®º/10.1 Petriç½‘åŸºç¡€ç†è®º](../../../formal_lang_view/10_Petriç½‘ç†è®º/10.1_Petriç½‘åŸºç¡€ç†è®º.md)

**è°ƒåº¦ç³»ç»Ÿåº”ç”¨**ï¼š

- [01 è°ƒåº¦ç³»ç»Ÿçš„Petriç½‘åŸºç¡€](README.md)
- [02 å¹¶å‘è°ƒåº¦çš„Petriç½‘å»ºæ¨¡](../02_å¹¶å‘è°ƒåº¦çš„Petriç½‘å»ºæ¨¡/README.md)

**å½¢å¼åŒ–éªŒè¯**ï¼š

- [06 éªŒè¯ä¸ä¼˜åŒ–çš„Petriç½‘å·¥å…·](../06_éªŒè¯ä¸ä¼˜åŒ–çš„Petriç½‘å·¥å…·/README.md)

---

**è¿”å›**: [01 è°ƒåº¦ç³»ç»Ÿçš„Petriç½‘åŸºç¡€](README.md)

**å‚è€ƒæ–‡çŒ®**ï¼š

1. Petri, C. A. (1962). "Kommunikation mit Automaten" (PhD thesis)
2. Reisig, W. (2013). "Understanding Petri Nets: Modeling Techniques, Analysis Methods, Case Studies"
3. Murata, T. (1989). "Petri nets: Properties, analysis and applications" (IEEE Proceedings)

---

**æœ€åæ›´æ–°**: 2025-12-02
**æ–‡æ¡£çŠ¶æ€**: âœ… å®Œæˆ
