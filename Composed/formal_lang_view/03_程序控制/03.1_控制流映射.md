# 3.1 æ§åˆ¶æµæ˜ å°„

> **å­ä¸»é¢˜ç¼–å·**: 03.1
> **ä¸»é¢˜**: ç¨‹åºæ§åˆ¶
> **æœ€åæ›´æ–°**: 2025-01-XX

---

## ğŸ“‹ æ¦‚è¿°

ç¼–ç¨‹è¯­è¨€ä¸­çš„æ§åˆ¶æµç»“æ„å¯¹åº”åˆ°åŸºç¡€è®¾æ–½çš„å£°æ˜å¼é…ç½®ï¼ŒåŒ…æ‹¬æ¡ä»¶åˆ¤æ–­ã€å¾ªç¯ã€å¼‚å¸¸å¤„ç†ç­‰æ§åˆ¶ç»“æ„çš„æ˜ å°„ã€‚

---

## ğŸ“‘ ç›®å½•

- [3.1 æ§åˆ¶æµæ˜ å°„](#31-æ§åˆ¶æµæ˜ å°„)
  - [ğŸ“‹ æ¦‚è¿°](#-æ¦‚è¿°)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [ğŸ”‘ æ ¸å¿ƒæ¦‚å¿µ](#-æ ¸å¿ƒæ¦‚å¿µ)
    - [æ§åˆ¶æµç»“æ„æ˜ å°„](#æ§åˆ¶æµç»“æ„æ˜ å°„)
    - [æ¡ä»¶åˆ¤æ–­æ˜ å°„](#æ¡ä»¶åˆ¤æ–­æ˜ å°„)
    - [å¾ªç¯ç»“æ„æ˜ å°„](#å¾ªç¯ç»“æ„æ˜ å°„)
    - [å¼‚å¸¸å¤„ç†æ˜ å°„](#å¼‚å¸¸å¤„ç†æ˜ å°„)
  - [ğŸ“Š æ§åˆ¶æµæ˜ å°„è¡¨](#-æ§åˆ¶æµæ˜ å°„è¡¨)
  - [ğŸ” æŠ€æœ¯ç»†èŠ‚](#-æŠ€æœ¯ç»†èŠ‚)
    - [HPAè§„åˆ™ä½œä¸ºä¾èµ–ç±»å‹](#hpaè§„åˆ™ä½œä¸ºä¾èµ–ç±»å‹)
    - [ReplicaSetä½œä¸ºé€’å½’å‡½æ•°](#replicasetä½œä¸ºé€’å½’å‡½æ•°)
    - [PodDisruptionBudgetä½œä¸ºæ•ˆåº”ç³»ç»Ÿ](#poddisruptionbudgetä½œä¸ºæ•ˆåº”ç³»ç»Ÿ)
  - [ğŸ’¡ å®é™…åº”ç”¨](#-å®é™…åº”ç”¨)
    - [HPAè‡ªåŠ¨æ‰©ç¼©å®¹](#hpaè‡ªåŠ¨æ‰©ç¼©å®¹)
    - [ReplicaSetå‰¯æœ¬ç®¡ç†](#replicasetå‰¯æœ¬ç®¡ç†)
    - [PodDisruptionBudgetå®¹é”™](#poddisruptionbudgetå®¹é”™)
  - [ğŸ”— ç›¸å…³æ¦‚å¿µ](#-ç›¸å…³æ¦‚å¿µ)

---

## ğŸ”‘ æ ¸å¿ƒæ¦‚å¿µ

### æ§åˆ¶æµç»“æ„æ˜ å°„

ç¼–ç¨‹è¯­è¨€ä¸­çš„æ§åˆ¶æµç»“æ„å¯¹åº”åˆ°åŸºç¡€è®¾æ–½çš„å£°æ˜å¼é…ç½®ï¼š

| ç¼–ç¨‹æ¦‚å¿µ | åŸºç¡€è®¾æ–½å®ç° | ç±»å‹è®ºå¯¹åº” |
|---------|-------------|-----------|
| `if`æ¡ä»¶ | **HPAè§„åˆ™**ï¼ˆCPU>80% â†’ scaleï¼‰ | ä¾èµ–ç±»å‹ï¼ˆDependent Typeï¼‰|
| `for`å¾ªç¯ | **ReplicaSet**ï¼ˆç»´æŒNä¸ªå‰¯æœ¬ï¼‰ | é€’å½’å‡½æ•°ï¼ˆRecursionï¼‰|
| `try/catch` | **PodDisruptionBudget** + **é‡è¯•ç­–ç•¥** | æ•ˆåº”ç³»ç»Ÿï¼ˆEffect Systemï¼‰|
| `goto` | **preStopé’©å­**å¼ºåˆ¶è·³è½¬ | ä¸å—æ§è·³è½¬ï¼ˆUnstructuredï¼‰ |

### æ¡ä»¶åˆ¤æ–­æ˜ å°„

**HPAè§„åˆ™**ä½œä¸ºä¾èµ–ç±»å‹ï¼š

```yaml
# HPAè§„åˆ™ï¼šCPU>80% â†’ scale
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
spec:
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 80  # ä¾èµ–ç±»å‹ï¼šç±»å‹ä¾èµ–è¿è¡Œæ—¶å€¼
```

### å¾ªç¯ç»“æ„æ˜ å°„

**ReplicaSet**ä½œä¸ºé€’å½’å‡½æ•°ï¼š

```yaml
# ReplicaSetï¼šç»´æŒNä¸ªå‰¯æœ¬
apiVersion: apps/v1
kind: ReplicaSet
spec:
  replicas: 3  # é€’å½’å‡½æ•°ï¼šf(n) = f(n-1) + 1
  template:
    spec:
      containers:
      - name: app
        image: app:1.0
```

### å¼‚å¸¸å¤„ç†æ˜ å°„

**PodDisruptionBudget**ä½œä¸ºæ•ˆåº”ç³»ç»Ÿï¼š

```yaml
# PodDisruptionBudgetï¼šå®¹é”™å¤„ç†
apiVersion: policy/v1
kind: PodDisruptionBudget
spec:
  minAvailable: 2  # æ•ˆåº”ç³»ç»Ÿï¼šä¿è¯æœ€å°å¯ç”¨å‰¯æœ¬æ•°
  selector:
    matchLabels:
      app: myapp
```

---

## ğŸ“Š æ§åˆ¶æµæ˜ å°„è¡¨

| ç¼–ç¨‹æ¦‚å¿µ | åŸºç¡€è®¾æ–½å®ç° | ç±»å‹è®ºå¯¹åº” | ç¤ºä¾‹ |
|---------|-------------|-----------|------|
| `if`æ¡ä»¶ | HPAè§„åˆ™ | ä¾èµ–ç±»å‹ | CPU>80% â†’ scale |
| `for`å¾ªç¯ | ReplicaSet | é€’å½’å‡½æ•° | ç»´æŒNä¸ªå‰¯æœ¬ |
| `try/catch` | PodDisruptionBudget | æ•ˆåº”ç³»ç»Ÿ | å®¹é”™å¤„ç† |
| `goto` | preStopé’©å­ | ä¸å—æ§è·³è½¬ | å¼ºåˆ¶è·³è½¬ |

---

## ğŸ” æŠ€æœ¯ç»†èŠ‚

### HPAè§„åˆ™ä½œä¸ºä¾èµ–ç±»å‹

```yaml
# ä¾èµ–ç±»å‹ï¼šç±»å‹ä¾èµ–è¿è¡Œæ—¶å€¼
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
spec:
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 80
  # ç±»å‹ï¼šReplicas(n) where n: â„•
```

### ReplicaSetä½œä¸ºé€’å½’å‡½æ•°

```yaml
# é€’å½’å‡½æ•°ï¼šf(n) = f(n-1) + 1
apiVersion: apps/v1
kind: ReplicaSet
spec:
  replicas: 3
  template:
    spec:
      containers:
      - name: app
        image: app:1.0
  # é€’å½’ï¼šç»´æŒNä¸ªå‰¯æœ¬
```

### PodDisruptionBudgetä½œä¸ºæ•ˆåº”ç³»ç»Ÿ

```yaml
# æ•ˆåº”ç³»ç»Ÿï¼šä¿è¯æœ€å°å¯ç”¨å‰¯æœ¬æ•°
apiVersion: policy/v1
kind: PodDisruptionBudget
spec:
  minAvailable: 2
  selector:
    matchLabels:
      app: myapp
  # æ•ˆåº”ï¼šå®¹é”™å¤„ç†
```

---

## ğŸ’¡ å®é™…åº”ç”¨

### HPAè‡ªåŠ¨æ‰©ç¼©å®¹

```text
1. ç›‘æ§CPUä½¿ç”¨ç‡
2. åˆ¤æ–­æ˜¯å¦è¶…è¿‡é˜ˆå€¼
3. è‡ªåŠ¨æ‰©å®¹æˆ–ç¼©å®¹
4. ç»´æŒç›®æ ‡å‰¯æœ¬æ•°
```

### ReplicaSetå‰¯æœ¬ç®¡ç†

```text
1. å®šä¹‰ç›®æ ‡å‰¯æœ¬æ•°
2. æŒç»­ç›‘æ§å®é™…å‰¯æœ¬æ•°
3. è‡ªåŠ¨åˆ›å»ºæˆ–åˆ é™¤Pod
4. ç»´æŒç›®æ ‡çŠ¶æ€
```

### PodDisruptionBudgetå®¹é”™

```text
1. å®šä¹‰æœ€å°å¯ç”¨å‰¯æœ¬æ•°
2. é˜»æ­¢å¯èƒ½å¯¼è‡´ä¸­æ–­çš„æ“ä½œ
3. ä¿è¯æœåŠ¡å¯ç”¨æ€§
4. å®¹é”™å¤„ç†
```

---

## ğŸ”— ç›¸å…³æ¦‚å¿µ

- [3.2 å˜é‡ä½œç”¨åŸŸä¸ç”Ÿå‘½å‘¨æœŸ](./03.2_å˜é‡ä½œç”¨åŸŸä¸ç”Ÿå‘½å‘¨æœŸ.md)
- [3.3 å¤šç§Ÿæˆ·ï¼šé«˜é˜¶ç±»å‹](./03.3_å¤šç§Ÿæˆ·é«˜é˜¶ç±»å‹.md)
- [04.1 ç¼–è¯‘æœŸæ£€æŸ¥](../04_ç±»å‹æ£€æŸ¥ä¸éªŒè¯/04.1_ç¼–è¯‘æœŸæ£€æŸ¥.md)

---

**è¿”å›**: [03. ç¨‹åºæ§åˆ¶](./README.md) | [ä¸»é¢˜ç´¢å¼•](../README.md)
