# 5.2 ç±»å‹ç±»ï¼ˆType Classesï¼‰

> **å­ä¸»é¢˜ç¼–å·**: 05.2
> **ä¸»é¢˜**: é«˜çº§ç±»å‹ç‰¹æ€§
> **æœ€åæ›´æ–°**: 2025-01-XX

---

## ğŸ“‹ æ¦‚è¿°

ç±»å‹ç±»ï¼ˆType Classesï¼‰å®šä¹‰äº†ä¸€ç»„ç±»å‹å¿…é¡»å®ç°çš„æ¥å£ï¼Œåœ¨åŸºç¡€è®¾æ–½ä¸­ï¼Œ**CNIæ¥å£**ã€**CSIæ¥å£**å’Œ**Operatoræ¨¡å¼**éƒ½ä½“ç°äº†ç±»å‹ç±»çš„æ¦‚å¿µã€‚

---

## ğŸ“‘ ç›®å½•

- [5.2 ç±»å‹ç±»ï¼ˆType Classesï¼‰](#52-ç±»å‹ç±»type-classes)
  - [ğŸ“‹ æ¦‚è¿°](#-æ¦‚è¿°)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [ğŸ”‘ æ ¸å¿ƒæ¦‚å¿µ](#-æ ¸å¿ƒæ¦‚å¿µ)
    - [CNIæ¥å£ä½œä¸ºç±»å‹ç±»](#cniæ¥å£ä½œä¸ºç±»å‹ç±»)
    - [CSIæ¥å£ä½œä¸ºç±»å‹ç±»](#csiæ¥å£ä½œä¸ºç±»å‹ç±»)
    - [Operatoræ¨¡å¼ä½œä¸ºç±»å‹ç±»](#operatoræ¨¡å¼ä½œä¸ºç±»å‹ç±»)
  - [ğŸ“Š ç±»å‹ç±»æ˜ å°„è¡¨](#-ç±»å‹ç±»æ˜ å°„è¡¨)
  - [ğŸ” æŠ€æœ¯ç»†èŠ‚](#-æŠ€æœ¯ç»†èŠ‚)
    - [CNIæ¥å£å®ç°](#cniæ¥å£å®ç°)
    - [CSIæ¥å£å®ç°](#csiæ¥å£å®ç°)
    - [Operatoræ¨¡å¼å®ç°](#operatoræ¨¡å¼å®ç°)
  - [ğŸ’¡ å®é™…åº”ç”¨](#-å®é™…åº”ç”¨)
    - [ç½‘ç»œæ’ä»¶å¼€å‘](#ç½‘ç»œæ’ä»¶å¼€å‘)
    - [å­˜å‚¨æ’ä»¶å¼€å‘](#å­˜å‚¨æ’ä»¶å¼€å‘)
    - [Operatorå¼€å‘](#operatorå¼€å‘)
  - [ğŸ”— ç›¸å…³æ¦‚å¿µ](#-ç›¸å…³æ¦‚å¿µ)

---

## ğŸ”‘ æ ¸å¿ƒæ¦‚å¿µ

### CNIæ¥å£ä½œä¸ºç±»å‹ç±»

- **CNIæ¥å£**ï¼šæ‰€æœ‰ç½‘ç»œæ’ä»¶ï¼ˆCalico/Ciliumï¼‰å®ç°ç›¸åŒçš„**ç±»å‹ç±»çº¦æŸ**
- **ç±»å‹ç±»** â†” **æ¥å£è§„èŒƒ**ï¼šå®šä¹‰ä¸€ç»„ç±»å‹å¿…é¡»å®ç°çš„æ¥å£
- **ç±»å‹ç±»çº¦æŸ** â†” **æ¥å£å®ç°**ï¼šç¡®ä¿ç±»å‹ç¬¦åˆè§„èŒƒ

### CSIæ¥å£ä½œä¸ºç±»å‹ç±»

- **CSIæ¥å£**ï¼šå­˜å‚¨æ’ä»¶éµå¾ª`CreateVolume/AttachVolume`å¥‘çº¦ â‰ˆ HasVolumeOperations Typeclass
- **ç±»å‹ç±»** â†” **å­˜å‚¨æ¥å£**ï¼šå®šä¹‰å­˜å‚¨æ“ä½œçš„æ¥å£è§„èŒƒ
- **æ¥å£å®ç°** â†” **æ’ä»¶å¼€å‘**ï¼šå®ç°å­˜å‚¨æ’ä»¶

### Operatoræ¨¡å¼ä½œä¸ºç±»å‹ç±»

- **Operatoræ¨¡å¼**ï¼šæ§åˆ¶å™¨å®ç°`Reconcile`æ¥å£ â‰ˆ Reconcilable Typeclass
- **ç±»å‹ç±»** â†” **æ§åˆ¶å™¨æ¥å£**ï¼šå®šä¹‰æ§åˆ¶å™¨çš„æ¥å£è§„èŒƒ
- **æ¥å£å®ç°** â†” **Operatorå¼€å‘**ï¼šå®ç°è‡ªå®šä¹‰Operator

---

## ğŸ“Š ç±»å‹ç±»æ˜ å°„è¡¨

| ç¼–ç¨‹æ¦‚å¿µ | åŸºç¡€è®¾æ–½å®ç° | ç±»å‹è®ºå¯¹åº” | ç¤ºä¾‹ |
|---------|-------------|-----------|------|
| ç±»å‹ç±» | CNI/CSIæ¥å£ | æ¥å£è§„èŒƒ | ç½‘ç»œ/å­˜å‚¨æ’ä»¶ |
| ç±»å‹ç±»çº¦æŸ | æ¥å£å®ç° | æ¥å£å®ç° | æ’ä»¶å¼€å‘ |
| ç±»å‹ç±»å®ä¾‹ | å…·ä½“æ’ä»¶ | æ¥å£å®ç° | Calico/Cilium |

---

## ğŸ” æŠ€æœ¯ç»†èŠ‚

### CNIæ¥å£å®ç°

```go
// CNIæ¥å£ï¼šç±»å‹ç±»
type CNI interface {
    Add(netconf []byte, netns string) (types.Result, error)
    Del(netconf []byte, netns string) error
    Check(netconf []byte, netns string) error
}

// Calicoï¼šç±»å‹ç±»å®ä¾‹
type CalicoCNI struct {
    // å®ç°CNIæ¥å£
}

func (c *CalicoCNI) Add(netconf []byte, netns string) (types.Result, error) {
    // å®ç°Addæ–¹æ³•
}
```

### CSIæ¥å£å®ç°

```go
// CSIæ¥å£ï¼šç±»å‹ç±»
type CSIDriver interface {
    CreateVolume(ctx context.Context, req *csi.CreateVolumeRequest) (*csi.CreateVolumeResponse, error)
    DeleteVolume(ctx context.Context, req *csi.DeleteVolumeRequest) (*csi.DeleteVolumeResponse, error)
    AttachVolume(ctx context.Context, req *csi.ControllerPublishVolumeRequest) (*csi.ControllerPublishVolumeResponse, error)
}

// å­˜å‚¨æ’ä»¶ï¼šç±»å‹ç±»å®ä¾‹
type EBSDriver struct {
    // å®ç°CSIæ¥å£
}
```

### Operatoræ¨¡å¼å®ç°

```go
// Operatoræ¨¡å¼ï¼šç±»å‹ç±»
type Reconciler interface {
    Reconcile(ctx context.Context, req ctrl.Request) (ctrl.Result, error)
}

// è‡ªå®šä¹‰Operatorï¼šç±»å‹ç±»å®ä¾‹
type MyOperator struct {
    Client client.Client
}

func (r *MyOperator) Reconcile(ctx context.Context, req ctrl.Request) (ctrl.Result, error) {
    // å®ç°Reconcileæ–¹æ³•
}
```

---

## ğŸ’¡ å®é™…åº”ç”¨

### ç½‘ç»œæ’ä»¶å¼€å‘

```text
1. å®ç°CNIæ¥å£
2. å¼€å‘ç½‘ç»œæ’ä»¶
3. æ³¨å†Œåˆ°Kubernetes
4. æä¾›ç½‘ç»œåŠŸèƒ½
```

### å­˜å‚¨æ’ä»¶å¼€å‘

```text
1. å®ç°CSIæ¥å£
2. å¼€å‘å­˜å‚¨æ’ä»¶
3. æ³¨å†Œåˆ°Kubernetes
4. æä¾›å­˜å‚¨åŠŸèƒ½
```

### Operatorå¼€å‘

```text
1. å®ç°Reconcileæ¥å£
2. å¼€å‘è‡ªå®šä¹‰Operator
3. æ³¨å†Œåˆ°Kubernetes
4. ç®¡ç†è‡ªå®šä¹‰èµ„æº
```

---

## ğŸ”— ç›¸å…³æ¦‚å¿µ

- [5.1 æ³›å‹](./05.1_æ³›å‹.md)
- [5.3 ä¾èµ–ç±»å‹](./05.3_ä¾èµ–ç±»å‹.md)
- [08.1 ç±»å‹é©±åŠ¨è®¾è®¡](../08_å®è·µå¯ç¤º/08.1_ç±»å‹é©±åŠ¨è®¾è®¡.md)

---

**è¿”å›**: [05. é«˜çº§ç±»å‹ç‰¹æ€§](./README.md) | [ä¸»é¢˜ç´¢å¼•](../README.md)
