# 10.3 高级Petri网

> **子主题编号**: 10.3
> **主题**: Petri网理论
> **最后更新**: 2025-12-02
> **文档状态**: ✅ 完成

---

## 📋 目录

- [10.3 高级Petri网](#103-高级petri网)
  - [📋 目录](#-目录)
  - [1 概述](#1-概述)
    - [1.1 核心洞察](#11-核心洞察)
    - [1.2 扩展动机](#12-扩展动机)
  - [2 着色Petri网](#2-着色petri网)
    - [2.1 定义](#21-定义)
    - [2.2 核心概念精确定义](#22-核心概念精确定义)
      - [2.2.1 颜色集合](#221-颜色集合)
      - [2.2.2 标记多集](#222-标记多集)
      - [2.2.3 守卫函数](#223-守卫函数)
    - [2.3 类型系统对应](#23-类型系统对应)
    - [2.4 设计原理与动机](#24-设计原理与动机)
  - [3 时间Petri网](#3-时间petri网)
    - [3.1 定义](#31-定义)
    - [3.2 核心概念精确定义](#32-核心概念精确定义)
      - [3.2.1 时间间隔](#321-时间间隔)
      - [3.2.2 时间标记](#322-时间标记)
    - [3.3 调度系统对应](#33-调度系统对应)
    - [3.4 设计原理与动机](#34-设计原理与动机)
  - [4 随机Petri网](#4-随机petri网)
    - [4.1 定义](#41-定义)
    - [4.2 核心概念精确定义](#42-核心概念精确定义)
      - [4.2.1 指数分布](#421-指数分布)
      - [4.2.2 连续时间马尔可夫链](#422-连续时间马尔可夫链)
    - [4.3 性能分析应用](#43-性能分析应用)
    - [4.4 设计原理与动机](#44-设计原理与动机)
  - [5 层次Petri网](#5-层次petri网)
    - [5.1 定义](#51-定义)
    - [5.2 核心概念精确定义](#52-核心概念精确定义)
      - [5.2.1 子网替换](#521-子网替换)
      - [5.2.2 层次抽象](#522-层次抽象)
    - [5.3 设计原理与动机](#53-设计原理与动机)
  - [6 自修改Petri网](#6-自修改petri网)
    - [6.1 定义](#61-定义)
    - [6.2 核心概念精确定义](#62-核心概念精确定义)
      - [6.2.1 结构修改](#621-结构修改)
    - [6.3 设计原理与动机](#63-设计原理与动机)
  - [7 时间Petri网](#7-时间petri网)
    - [3.1 定义](#31-定义-1)
    - [3.2 调度系统对应](#32-调度系统对应)
  - [8 随机Petri网](#8-随机petri网)
    - [4.1 定义](#41-定义-1)
    - [4.2 性能分析应用](#42-性能分析应用)
  - [9 层次Petri网](#9-层次petri网)
    - [5.1 定义](#51-定义-1)
  - [10 自修改Petri网](#10-自修改petri网)
    - [6.1 定义](#61-定义-1)
  - [11 关系属性与依赖分析](#11-关系属性与依赖分析)
    - [7.1 高级Petri网之间的关系](#71-高级petri网之间的关系)
  - [12 跨视角链接](#12-跨视角链接)
    - [8.1 形式语言视角关联](#81-形式语言视角关联)
    - [8.2 调度视角关联](#82-调度视角关联)

---

## 1 概述

### 1.1 核心洞察

高级Petri网扩展了基本Petri网，增加了**数据类型、时间、概率、层次结构**等特性，使其能够建模更复杂的系统。这些扩展保持了Petri网的核心语义，同时增强了表达能力。

### 1.2 扩展动机

**为什么需要高级Petri网？**

1. **数据类型需求**：基本Petri网只能表示标记数量，无法区分标记的类型
2. **时间约束需求**：实时系统需要时间约束
3. **概率建模需求**：随机系统需要概率模型
4. **模块化需求**：复杂系统需要层次化建模

---

## 2 着色Petri网

### 2.1 定义

**定义 2.1**（着色Petri网）：

```text
着色Petri网CPN = (P, T, F, C, W, G, E, M₀)

其中：
  P: 库所集合
  T: 变迁集合
  F: 流关系
  C: 颜色集合（数据类型集合）
  W: 颜色函数 W: P → C（每个库所有颜色类型）
  G: 守卫函数 G: T → Bool（变迁条件）
  E: 弧表达式函数 E: F → Expr（弧上的表达式）
  M₀: 初始标记 M₀: P → Bag(C)（多集，带颜色的标记）
```

### 2.2 核心概念精确定义

#### 2.2.1 颜色集合

**定义 2.2**（颜色集合）：

```text
颜色集合C是数据类型的集合：
  C = {Int, Bool, String, Product, ...}

每个库所p有颜色类型W(p) ∈ C：
  标记必须是类型W(p)的值
```

#### 2.2.2 标记多集

**定义 2.3**（标记多集）：

```text
标记多集Bag(C)是颜色的多重集合：
  Bag(C) = {c₁, c₂, ..., cₙ | cᵢ ∈ C}

库所p中的标记：
  M(p) ∈ Bag(W(p))
```

#### 2.2.3 守卫函数

**定义 2.4**（守卫函数）：

```text
守卫函数G: T → Bool：
  G(t)是变迁t的点火条件

变迁t在标记M下使能，当且仅当：
  1. 输入库所的标记满足弧表达式
  2. G(t) = true
```

### 2.3 类型系统对应

**映射关系**：

```text
类型系统         着色Petri网
─────────────────────────────
类型T           ↔ 颜色C
值v: T          ↔ 标记c ∈ C
类型环境Γ       ↔ 标记M
类型检查        ↔ 守卫函数G
类型转换        ↔ 变迁点火
```

**定理 2.1**（类型安全对应）：

```text
着色Petri网的类型安全对应类型系统的类型安全：
  TypeSafe(CPN) ⟺ ∀p ∈ P. M(p) ∈ Bag(W(p))
```

### 2.4 设计原理与动机

**为什么着色Petri网重要？**

1. **表达能力增强**：可以区分不同类型的标记
2. **类型安全**：通过颜色类型保证类型安全
3. **模型简化**：一个着色Petri网可以表示多个基本Petri网

---

## 3 时间Petri网

### 3.1 定义

**定义 3.1**（时间Petri网）：

```text
时间Petri网TPN = (P, T, F, W, M₀, I)

其中：
  I: T → (Time, Time) 是时间间隔函数
  I(t) = [a, b] 表示变迁t必须在时间[a, b]内点火

时间语义：
  - 变迁t在时间τ使能
  - 必须在时间[τ+a, τ+b]内点火
  - 如果超过时间b仍未点火，则失效
```

### 3.2 核心概念精确定义

#### 3.2.1 时间间隔

**定义 3.2**（时间间隔）：

```text
时间间隔[a, b]：
  - a是最小延迟（earliest firing time）
  - b是最大延迟（latest firing time）
  - 变迁必须在[a, b]内点火
```

#### 3.2.2 时间标记

**定义 3.3**（时间标记）：

```text
时间标记(M, τ)：
  - M是空间标记（库所中的标记）
  - τ是时间标记（标记的年龄）

标记年龄：
  - 标记产生时的年龄为0
  - 随时间增长
```

### 3.3 调度系统对应

**映射关系**：

```text
调度系统         时间Petri网
─────────────────────────────
任务T            ↔ 变迁t
执行时间窗口     ↔ 时间间隔[a, b]
任务调度         ↔ 变迁点火
截止时间        ↔ 最大延迟b
```

**定理 3.1**（调度对应）：

```text
时间Petri网可以建模任务调度：
  - 变迁对应任务
  - 时间间隔对应执行时间窗口
  - 可达性对应调度可行性
```

### 3.4 设计原理与动机

**为什么时间Petri网重要？**

1. **实时系统建模**：可以建模实时约束
2. **调度优化**：可以优化任务调度
3. **性能分析**：可以分析系统性能

---

## 4 随机Petri网

### 4.1 定义

**定义 4.1**（随机Petri网）：

```text
随机Petri网SPN = (P, T, F, W, M₀, Λ)

其中：
  Λ: T → ℝ⁺ 是指数分布参数
  变迁t的点火时间服从指数分布Exp(Λ(t))

点火时间：
  - 变迁t在使能后，等待时间τ ~ Exp(Λ(t))
  - 平均等待时间 = 1/Λ(t)
```

### 4.2 核心概念精确定义

#### 4.2.1 指数分布

**定义 4.2**（指数分布）：

```text
指数分布Exp(λ)：
  - 概率密度函数：f(τ) = λe^{-λτ}
  - 累积分布函数：F(τ) = 1 - e^{-λτ}
  - 期望：E[τ] = 1/λ
  - 方差：Var[τ] = 1/λ²
```

#### 4.2.2 连续时间马尔可夫链

**定义 4.3**（CTMC对应）：

```text
随机Petri网对应连续时间马尔可夫链：
  - 状态：标记M
  - 转移率：变迁的点火率
  - 稳态分布：系统长期行为
```

### 4.3 性能分析应用

**性能指标**：

1. **吞吐量**：

   ```text
   Throughput(t) = Λ(t) × P(t使能)
   ```

2. **平均延迟**：

   ```text
   Latency = E[从M₀到M_final的时间]
   ```

3. **资源利用率**：

   ```text
   Utilization(p) = P(M(p) > 0)
   ```

### 4.4 设计原理与动机

**为什么随机Petri网重要？**

1. **性能分析**：可以分析系统性能
2. **可靠性分析**：可以分析系统可靠性
3. **优化设计**：可以优化系统设计

---

## 5 层次Petri网

### 5.1 定义

**定义 5.1**（层次Petri网）：

```text
层次Petri网通过模块化和层次化简化复杂系统建模。

结构：
  - 子网可以替换变迁
  - 支持模块化设计
  - 支持层次抽象

形式化：
  HPN = (N₁, N₂, ..., Nₖ, Substitution)

其中：
  Nᵢ是子网
  Substitution是替换关系
```

### 5.2 核心概念精确定义

#### 5.2.1 子网替换

**定义 5.2**（子网替换）：

```text
子网替换：
  - 变迁t可以被子网N替换
  - 子网的输入/输出接口对应变迁的输入/输出库所
  - 保持语义等价
```

#### 5.2.2 层次抽象

**定义 5.3**（层次抽象）：

```text
层次抽象：
  - 高层：抽象模型
  - 低层：详细模型
  - 通过替换关系连接
```

### 5.3 设计原理与动机

**为什么层次Petri网重要？**

1. **模块化**：可以模块化设计
2. **可扩展性**：可以扩展系统
3. **可维护性**：可以维护系统

---

## 6 自修改Petri网

### 6.1 定义

**定义 6.1**（自修改Petri网）：

```text
自修改Petri网允许结构动态变化：
  - 可以动态添加/删除库所和变迁
  - 可以修改弧的权重
  - 适用于自适应系统

形式化：
  SMPN = (P, T, F, W, M₀, Modify)

其中：
  Modify: T → (P, T, F, W) → (P, T, F, W)
  是结构修改函数
```

### 6.2 核心概念精确定义

#### 6.2.1 结构修改

**定义 6.2**（结构修改）：

```text
结构修改操作：
  - AddPlace(p): 添加库所p
  - RemovePlace(p): 删除库所p
  - AddTransition(t): 添加变迁t
  - RemoveTransition(t): 删除变迁t
  - ModifyWeight(f, w): 修改弧权重
```

### 6.3 设计原理与动机

**为什么自修改Petri网重要？**

1. **自适应系统**：可以建模自适应系统
2. **动态重构**：可以动态重构系统
3. **灵活性**：提供更大的灵活性

---

## 7 时间Petri网

### 3.1 定义

**定义 3.1**（时间Petri网）：

```text
时间Petri网TPN = (P, T, F, W, M₀, I)

其中：
  I: T → (Time, Time) 是时间间隔函数
  I(t) = [a, b] 表示变迁t必须在时间[a, b]内点火
```

### 3.2 调度系统对应

- **时间间隔** ↔ **调度时间窗口**：变迁对应任务调度
- **时间约束** ↔ **截止时间**：时间间隔对应任务截止时间

---

## 8 随机Petri网

### 4.1 定义

**定义 4.1**（随机Petri网）：

```text
随机Petri网SPN = (P, T, F, W, M₀, Λ)

其中：
  Λ: T → ℝ⁺ 是指数分布参数
  变迁t的点火时间服从指数分布Exp(Λ(t))
```

### 4.2 性能分析应用

- **吞吐量分析**：计算系统吞吐量
- **延迟分析**：计算平均延迟
- **资源利用率**：计算资源利用率

---

## 9 层次Petri网

### 5.1 定义

**定义 5.1**（层次Petri网）：

```text
层次Petri网通过模块化和层次化简化复杂系统建模。

特点：
  - 子网可以替换变迁
  - 支持模块化设计
  - 支持层次抽象
```

---

## 10 自修改Petri网

### 6.1 定义

**定义 6.1**（自修改Petri网）：

```text
自修改Petri网允许结构动态变化：
  - 可以动态添加/删除库所和变迁
  - 可以修改弧的权重
  - 适用于自适应系统
```

---

## 11 关系属性与依赖分析

### 7.1 高级Petri网之间的关系

**关系图**：

```text
基本Petri网
  ├─ 着色Petri网（添加数据类型）
  ├─ 时间Petri网（添加时间约束）
  ├─ 随机Petri网（添加概率）
  ├─ 层次Petri网（添加层次结构）
  └─ 自修改Petri网（添加动态结构）

组合：
  - 着色时间Petri网
  - 随机时间Petri网
  - 层次着色Petri网
```

---

## 12 跨视角链接

### 8.1 形式语言视角关联

- [Petri网基础理论](./10.1_Petri网基础理论.md) - 基础理论
- [类型系统](../01_核心概念映射/) - 着色Petri网与类型系统

### 8.2 调度视角关联

- [工作流调度](../../schedule_formal_view/30_工作流调度/) - 时间Petri网在工作流中的应用

---

**返回**: [Petri网理论主索引](./README.md) | [形式语言视角主索引](../README.md)
