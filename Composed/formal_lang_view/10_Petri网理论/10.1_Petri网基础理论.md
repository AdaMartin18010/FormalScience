# 10.1 Petri网基础理论

> **子主题编号**: 10.1
> **主题**: Petri网理论
> **最后更新**: 2025-12-02
> **文档状态**: ✅ 完成

---

## 📋 目录

- [10.1 Petri网基础理论](#101-petri网基础理论)
  - [📋 目录](#-目录)
  - [1 概述](#1-概述)
    - [1.1 核心洞察](#11-核心洞察)
    - [1.2 核心概念精确定义](#12-核心概念精确定义)
      - [1.2.1 库所（Place）](#121-库所place)
      - [1.2.2 变迁（Transition）](#122-变迁transition)
      - [1.2.3 标记（Marking）](#123-标记marking)
    - [1.3 设计原理与动机](#13-设计原理与动机)
      - [1.3.1 为什么Petri网适合并发系统？](#131-为什么petri网适合并发系统)
      - [1.3.2 Petri网的历史发展](#132-petri网的历史发展)
  - [2 基本Petri网](#2-基本petri网)
    - [2.1 形式化定义](#21-形式化定义)
    - [2.2 图形表示](#22-图形表示)
    - [2.3 基本结构](#23-基本结构)
      - [2.3.1 顺序结构](#231-顺序结构)
      - [2.3.2 并发结构](#232-并发结构)
      - [2.3.3 选择结构](#233-选择结构)
  - [3 标记与变迁规则](#3-标记与变迁规则)
    - [3.1 标记定义](#31-标记定义)
    - [3.2 变迁使能](#32-变迁使能)
    - [3.3 变迁点火](#33-变迁点火)
    - [3.4 点火规则正确性](#34-点火规则正确性)
  - [4 Petri网基本性质](#4-petri网基本性质)
    - [4.1 可达性](#41-可达性)
    - [4.2 活性](#42-活性)
    - [4.3 有界性](#43-有界性)
    - [4.4 安全性](#44-安全性)
  - [5 关系属性与依赖分析](#5-关系属性与依赖分析)
    - [5.1 性质之间的关系](#51-性质之间的关系)
      - [5.1.1 性质依赖关系](#511-性质依赖关系)
      - [5.1.2 性质冲突](#512-性质冲突)
    - [5.2 Petri网结构关系](#52-petri网结构关系)
      - [5.2.1 结构模式](#521-结构模式)
      - [5.2.2 结构性质](#522-结构性质)
  - [6 跨视角链接](#6-跨视角链接)
    - [6.1 形式语言视角关联](#61-形式语言视角关联)
    - [6.2 调度视角关联](#62-调度视角关联)

---

## 1 概述

### 1.1 核心洞察

Petri网是一种**数学建模工具**，用于描述和分析**并发系统**。它通过**库所**（状态）、**变迁**（事件）和**标记**（资源）的自然表示，提供了并发系统建模的直观方法。

### 1.2 核心概念精确定义

#### 1.2.1 库所（Place）

**定义 1.1**：库所是Petri网中的**状态容器**，用于表示系统的状态或条件。

**形式化表述**：

```text
库所p ∈ P是一个状态变量，其值由标记（token）数量表示：
  M(p) ∈ ℕ 表示库所p中的标记数

库所集合：
  P = {p₁, p₂, ..., pₙ} 是有限集合
```

**类型系统对应**：

- **库所** ↔ **类型**：库所表示状态类型
- **标记** ↔ **值**：标记表示类型的具体值
- **标记数** ↔ **值的数量**：多个值可以共享同一类型

**调度系统对应**：

- **库所** ↔ **资源状态**：库所表示资源的可用性
- **标记** ↔ **资源单位**：标记表示资源的数量
- **标记数** ↔ **资源容量**：标记数表示可用资源量

#### 1.2.2 变迁（Transition）

**定义 1.2**：变迁是Petri网中的**状态转换操作**，表示系统从一种状态转换到另一种状态。

**形式化表述**：

```text
变迁t ∈ T是一个状态转换函数：
  t: M → M'

其中：
  •t = {p | (p, t) ∈ F} 是t的输入库所集合（前集）
  t• = {p | (t, p) ∈ F} 是t的输出库所集合（后集）

变迁集合：
  T = {t₁, t₂, ..., tₘ} 是有限集合
  P ∩ T = ∅（库所和变迁不相交）
```

**类型系统对应**：

- **变迁** ↔ **函数**：变迁表示类型转换函数
- **输入库所** ↔ **函数参数类型**：输入库所对应函数参数
- **输出库所** ↔ **函数返回类型**：输出库所对应返回值

**调度系统对应**：

- **变迁** ↔ **调度动作**：变迁表示资源分配或释放
- **输入库所** ↔ **资源需求**：输入库所对应所需资源
- **输出库所** ↔ **资源释放**：输出库所对应释放的资源

#### 1.2.3 标记（Marking）

**定义 1.3**：标记是Petri网在某个时刻的状态，由所有库所中的标记数组成。

**形式化表述**：

```text
标记M: P → ℕ 是一个函数，将每个库所映射到其标记数。

标记的向量表示：
  M = [M(p₁), M(p₂), ..., M(pₙ)]

其中n = |P|是库所数量。

初始标记：
  M₀: P → ℕ 是系统的初始状态
```

**标记空间**：

```text
所有可能的标记集合：
  M = {M | M: P → ℕ}

可达标记集合：
  R(N, M₀) = {M | M₀ →* M}

其中→*表示通过一系列变迁可达。
```

### 1.3 设计原理与动机

#### 1.3.1 为什么Petri网适合并发系统？

**核心优势**：

1. **自然并发表示**：

   ```text
   传统状态机：需要显式枚举所有并发状态组合
   Petri网：通过多个库所和变迁自然表示并发

   优势：状态空间大小从O(2^n)降低到O(n)
   ```

2. **同步机制直观**：

   ```text
   同步通过共享库所实现：
     多个变迁等待同一库所的标记
     当标记可用时，变迁可以并发执行
   ```

3. **冲突检测自动**：

   ```text
   冲突自动显现：
     如果多个变迁竞争同一标记，形成冲突
     可以通过分析自动检测死锁和活锁
   ```

#### 1.3.2 Petri网的历史发展

**发展时间线**：

```text
1962: Carl Adam Petri提出Petri网
1970s: 基本理论建立
1980s: 着色Petri网、时间Petri网
1990s: 随机Petri网、层次Petri网
2000s: 工具发展（CPN Tools、PIPE）
2010s: 工作流应用、过程挖掘
2020s: 与AI/ML结合、实时系统应用
```

---

## 2 基本Petri网

### 2.1 形式化定义

**定义 2.1**（基本Petri网）：

```text
基本Petri网是一个三元组 N = (P, T, F)，其中：

  P: 库所集合，P ≠ ∅
  T: 变迁集合，T ≠ ∅
  P ∩ T = ∅（库所和变迁不相交）
  F ⊆ (P × T) ∪ (T × P) 是流关系

带权重的Petri网：
  N = (P, T, F, W)，其中W: F → ℕ⁺是权重函数

带初始标记的Petri网：
  N = (P, T, F, W, M₀)，其中M₀: P → ℕ是初始标记
```

**完整性条件**：

```text
Petri网N是完整的，当且仅当：
  1. 每个库所至少连接一个变迁
  2. 每个变迁至少连接一个库所
  3. 不存在孤立节点
```

### 2.2 图形表示

**图形元素**：

- **库所**：圆圈 ○ 或 双圆圈 ◎（如果有标记）
- **变迁**：方框 □ 或 竖线 |
- **弧**：箭头 →，可以标注权重
- **标记**：库所中的黑点 ●

**示例**：

```text
简单顺序Petri网：
  P = {p₁, p₂, p₃}
  T = {t₁, t₂}
  F = {(p₁, t₁), (t₁, p₂), (p₂, t₂), (t₂, p₃)}
  M₀ = [1, 0, 0]

  图形表示：
    ● →[t₁]→ ○ →[t₂]→ ○
    p₁        p₂        p₃
```

### 2.3 基本结构

#### 2.3.1 顺序结构

**定义 2.2**（顺序Petri网）：

```text
顺序Petri网：变迁按顺序执行
  p₁ →[t₁]→ p₂ →[t₂]→ p₃ → ... → pₙ
```

**性质**：

- 每个库所最多一个输入变迁和一个输出变迁
- 执行顺序完全确定
- 无并发，无冲突

#### 2.3.2 并发结构

**定义 2.3**（并发Petri网）：

```text
并发Petri网：多个变迁可以并行执行
  p₁ →[t₁]→ p₂
  p₁ →[t₂]→ p₃
  p₁ →[t₃]→ p₄
```

**性质**：

- 多个变迁共享输入库所
- 可以并发执行（如果标记足够）
- 可能存在资源竞争

#### 2.3.3 选择结构

**定义 2.4**（选择Petri网）：

```text
选择Petri网：根据条件选择执行路径
  p₁ →[t₁]→ p₂
  p₁ →[t₂]→ p₃
  p₁ →[t₃]→ p₄
```

**性质**：

- 多个变迁竞争同一标记
- 只能选择一个变迁执行
- 形成冲突（conflict）

---

## 3 标记与变迁规则

### 3.1 标记定义

**定义 3.1**（标记）：

```text
标记M: P → ℕ 是一个函数，将每个库所映射到非负整数。

标记的向量表示：
  M = [M(p₁), M(p₂), ..., M(pₙ)]

其中n = |P|是库所数量。

标记比较：
  M₁ ≤ M₂ ⟺ ∀p ∈ P. M₁(p) ≤ M₂(p)
  M₁ < M₂ ⟺ M₁ ≤ M₂ ∧ M₁ ≠ M₂
```

**标记操作**：

```text
标记加法：
  (M₁ + M₂)(p) = M₁(p) + M₂(p)

标记减法：
  (M₁ - M₂)(p) = M₁(p) - M₂(p)  （如果M₁ ≥ M₂）

标记乘法：
  (k·M)(p) = k·M(p)  （k ∈ ℕ）
```

### 3.2 变迁使能

**定义 3.2**（变迁使能）：

```text
变迁t在标记M下使能，记作M[t⟩，当且仅当：
  ∀p ∈ •t: M(p) ≥ W(p, t)

其中W(p, t)是弧(p, t)的权重（默认为1）。

使能条件：
  M[t⟩ ⟺ M ≥ W(•t, t)

其中W(•t, t)是输入库所的权重向量。
```

**定理 3.1**（使能判定）：

```text
变迁使能判定可以在O(|•t|)时间内完成。

证明：需要检查每个输入库所的标记数是否足够。
```

### 3.3 变迁点火

**定义 3.3**（变迁点火）：

```text
如果M[t⟩，则变迁t可以点火，产生新标记M'：
  M[t⟩M'

标记更新规则：
  M'(p) = M(p) - W(p, t) + W(t, p)

其中：
  W(p, t)是输入弧权重（从p到t）
  W(t, p)是输出弧权重（从t到p）
```

**形式化表述**：

```text
点火后的标记：
  M' = M - W(•t, t) + W(t, t•)

其中：
  W(•t, t)是输入权重向量
  W(t, t•)是输出权重向量
```

### 3.4 点火规则正确性

**定理 3.2**（点火规则正确性）：

```text
点火规则保证标记守恒性：
  Σ_{p∈P} M'(p) = Σ_{p∈P} M(p) + (Σ_{p∈t•} W(t,p) - Σ_{p∈•t} W(p,t))

如果所有弧权重为1，且|•t| = |t•|，则：
  Σ_{p∈P} M'(p) = Σ_{p∈P} M(p)  （标记守恒）
```

**证明**：

```text
由定义：
  M'(p) = M(p) - W(p, t) + W(t, p)

对所有库所求和：
  Σ_{p∈P} M'(p) = Σ_{p∈P} M(p) - Σ_{p∈•t} W(p, t) + Σ_{p∈t•} W(t, p)

如果|•t| = |t•|且权重为1，则：
  Σ_{p∈•t} W(p, t) = |•t|
  Σ_{p∈t•} W(t, p) = |t•|

因此标记总数不变。
```

---

## 4 Petri网基本性质

### 4.1 可达性

**定义 4.1**（可达性）：

```text
标记M'从M可达，记作M →* M'，当且仅当：
  存在变迁序列σ = t₁t₂...tₙ，使得：
    M[t₁⟩M₁[t₂⟩M₂...M_{n-1}[tₙ⟩M'
```

**可达性问题**：

```text
给定Petri网N和标记M, M'，判断M'是否从M可达。

复杂度：
  - 一般情况：EXPSPACE-complete
  - 有界Petri网：PSPACE-complete
  - 1-有界Petri网：NP-complete
```

**可达图**：

```text
可达图G(N, M₀) = (V, E)：
  - 节点V = R(N, M₀)（所有可达标记）
  - 边E = {(M, M') | ∃t. M[t⟩M'}
```

### 4.2 活性

**定义 4.2**（活性）：

```text
变迁t在标记M下是活的，当且仅当：
  从M可达的任何标记M'，都存在从M'可达的标记M''，使得M''[t⟩

Petri网N是活的，当且仅当：
  所有变迁在所有可达标记下都是活的
```

**活性级别**：

```text
L0: 死变迁（永远不能点火）
L1: 可能点火（存在可达标记使能）
L2: 可能重复点火（存在无限序列包含t）
L3: 最终可重复点火（从任何可达标记，t最终可重复点火）
L4: 活变迁（在任何可达标记下，t最终可点火）
```

**定理 4.1**（活性判定）：

```text
对于有界Petri网，活性判定是PSPACE-complete。

对于无界Petri网，活性判定是EXPSPACE-complete。
```

### 4.3 有界性

**定义 4.3**（有界性）：

```text
库所p是k-有界的，当且仅当：
  在所有可达标记中，M(p) ≤ k

Petri网N是k-有界的，当且仅当：
  所有库所都是k-有界的

Petri网N是有界的，当且仅当：
  存在k使得N是k-有界的
```

**有界性意义**：

- **1-有界**：库所最多1个标记（安全Petri网）
- **k-有界**：库所最多k个标记（资源限制）
- **无界**：标记数可以无限增长（可能表示无限资源）

**定理 4.2**（有界性判定）：

```text
对于Petri网N，有界性判定是EXPSPACE-complete。

对于1-有界性（安全性）判定是PSPACE-complete。
```

### 4.4 安全性

**定义 4.4**（安全性）：

```text
Petri网N是安全的，当且仅当：
  N是1-有界的，即所有库所在所有可达标记中最多有1个标记
```

**安全性意义**：

- 保证资源不会无限累积
- 简化可达性分析
- 适用于互斥、信号量等场景

---

## 5 关系属性与依赖分析

### 5.1 性质之间的关系

#### 5.1.1 性质依赖关系

**定理 5.1**（性质依赖）：

```text
对于有界Petri网：
  活性 ⟹ 无死锁
  有界性 ⟹ 可达性可判定
  安全性 ⟹ 有界性（k=1）
```

**证明思路**：

- 如果Petri网是活的，则不存在死锁状态
- 如果有界，则状态空间有限，可达性可判定
- 如果安全（1-有界），则显然有界

#### 5.1.2 性质冲突

**定理 5.2**（性质冲突）：

```text
某些性质不能同时满足：

1. 无界性与安全性冲突：
   如果Petri网无界，则不可能安全

2. 完全活性与有界性可能冲突：
   某些无界Petri网才能实现完全活性
```

### 5.2 Petri网结构关系

#### 5.2.1 结构模式

**定义 5.1**（结构模式）：

```text
Petri网结构模式：

1. 顺序模式：p₁ →[t₁]→ p₂ →[t₂]→ p₃
2. 并发模式：p₁ →[t₁]→ p₂, p₁ →[t₂]→ p₃
3. 选择模式：p₁ →[t₁]→ p₂, p₁ →[t₂]→ p₃（冲突）
4. 同步模式：p₂ →[t]→ p₄, p₃ →[t]→ p₄（合并）
```

#### 5.2.2 结构性质

**定义 5.2**（结构性质）：

```text
Petri网的结构性质：

1. 强连通性：所有节点在强连通分量中
2. 自由选择：冲突和并发分离
3. 扩展自由选择：允许某些冲突和并发混合
```

---

## 6 跨视角链接

### 6.1 形式语言视角关联

- [类型系统](../01_核心概念映射/01.1_基本类型单元.md) - 类型-库所映射
- [效应系统](../07_效应系统/) - 变迁-效应映射
- [程序控制](../03_程序控制/) - 控制流建模

### 6.2 调度视角关联

- [工作流调度](../../schedule_formal_view/30_工作流调度/) - Petri网在工作流中的应用
- [调度模型](../../schedule_formal_view/06_调度模型/) - 调度系统的Petri网建模

---

**返回**: [Petri网理论主索引](./README.md) | [形式语言视角主索引](../README.md)
