# 1.2 复合类型与组合运算符

> **子主题编号**: 01.2
> **主题**: 核心概念映射
> **最后更新**: 2025-01-XX

---

## 📋 目录

- [1 概述](#1-概述)
- [2 核心概念](#2-核心概念)
  - [2.1 编程语言中的复合类型](#21-编程语言中的复合类型)
  - [2.2 基础设施中的对应](#22-基础设施中的对应)
- [3 组合运算符映射](#3-组合运算符映射)
- [4 技术细节](#4-技术细节)
  - [4.1 Pod作为乘积类型](#41-pod作为乘积类型)
  - [4.2 Deployment作为和类型](#42-deployment作为和类型)
  - [4.3 Service作为函数类型](#43-service作为函数类型)
- [5 实际应用](#5-实际应用)
  - [5.1 Sidecar模式积类型](#51-sidecar模式积类型)
  - [5.2 蓝绿部署和类型](#52-蓝绿部署和类型)
  - [5.3 服务调用函数类型](#53-服务调用函数类型)
- [6 相关概念](#6-相关概念)
- [7 延伸阅读](#7-延伸阅读)

---

## 1 概述

复合类型通过组合运算符构建复杂类型，在基础设施中，**Pod**是容器的乘积类型，**Deployment**是Pod的Σ类型，体现了类型组合的多种形式。

---

## 📑 目录

- [1.2 复合类型与组合运算符](#12-复合类型与组合运算符)
  - [📋 概述](#-概述)
  - [📑 目录](#-目录)
  - [🔑 核心概念](#-核心概念)
    - [编程语言中的复合类型](#编程语言中的复合类型)
    - [基础设施中的对应](#基础设施中的对应)
  - [📊 组合运算符映射](#-组合运算符映射)
  - [🔍 技术细节](#-技术细节)
    - [Pod作为乘积类型](#pod作为乘积类型)
    - [Deployment作为和类型](#deployment作为和类型)
    - [Service作为函数类型](#service作为函数类型)
  - [💡 实际应用](#-实际应用)
    - [Sidecar模式（积类型）](#sidecar模式积类型)
    - [蓝绿部署（和类型）](#蓝绿部署和类型)
    - [服务调用（函数类型）](#服务调用函数类型)
  - [🔗 相关概念](#-相关概念)
  - [📚 延伸阅读](#-延伸阅读)

---

## 2 核心概念

### 2.1 编程语言中的复合类型

- **乘积类型** (`struct`): `struct { a: int; b: string }`
- **和类型** (`enum`): `enum { A, B }`
- **函数类型**: `A → B`

### 2.2 基础设施中的对应

- **Pod**: 容器的乘积类型（共享网络命名空间）
- **Deployment**: Pod的Σ类型（多个副本的或然选择）
- **Service**: 服务调用的函数类型

---

## 3 组合运算符映射

| 运算符 | 类型论含义 | 基础设施实现 | 示例 |
|-------|-----------|-------------|------|
| `+` | 和类型 | 服务多版本共存 | 蓝绿部署 |
| `×` | 积类型 | Sidecar模式 | 主容器 × 代理容器 × 日志容器 |
| `→` | 函数类型 | 服务调用 | Service A → Service B |

---

## 4 技术细节

### 4.1 Pod作为乘积类型

```yaml
# Pod = Container₁ × Container₂ × ... × Containerₙ
apiVersion: v1
kind: Pod
spec:
  containers:
  - name: app      # Container₁
    image: app:1.0
  - name: proxy    # Container₂
    image: proxy:1.0
  - name: logger   # Container₃
    image: logger:1.0
```

### 4.2 Deployment作为和类型

```yaml
# Deployment = Pod₁ + Pod₂ + ... + Podₙ
apiVersion: apps/v1
kind: Deployment
spec:
  replicas: 3  # 3个Pod副本的或然选择
  template:
    spec:
      containers:
      - name: app
        image: app:1.0
```

### 4.3 Service作为函数类型

```yaml
# Service: Pod → Endpoint
apiVersion: v1
kind: Service
spec:
  selector:
    app: myapp
  ports:
  - port: 80
    targetPort: 8080
```

---

## 5 实际应用

### 5.1 Sidecar模式积类型

```text
Pod = AppContainer × ProxyContainer × LogContainer
```

每个容器共享网络命名空间，形成乘积关系。

### 5.2 蓝绿部署和类型

```text
Deployment = BluePod + GreenPod
```

两个版本的Pod可以同时存在，通过Service选择。

### 5.3 服务调用函数类型

```text
Service: Pod → Endpoint
```

Service将Pod的选择映射到网络端点。

---

## 6 相关概念

- [1.1 基本类型单元](./01.1_基本类型单元.md)
- [1.3 类型层级与继承](./01.3_类型层级与继承.md)
- [03.1 控制流映射](../03_程序控制/03.1_控制流映射.md)

---

## 7 延伸阅读

- Kubernetes Pod Specification
- Sidecar Pattern
- Blue-Green Deployment

---

**返回**: [01. 核心概念映射](./README.md) | [主题索引](../README.md)
