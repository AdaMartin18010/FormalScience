# 9.8 èŒƒç•´è®ºæ·±å±‚ç»“æ„ï¼šMonadä¸æ•ˆåº”

> **å­ä¸»é¢˜ç¼–å·**: 09.8
> **ä¸»é¢˜**: å½¢å¼åŒ–ç†è®º
> **æœ€åæ›´æ–°**: 2025-01-XX

---

## ğŸ“‹ æ¦‚è¿°

èŒƒç•´è®ºæ·±å±‚ç»“æ„æ¢è®¨**Monadä¸æ•ˆåº”**åœ¨åŸºç¡€è®¾æ–½ä¸­çš„åº”ç”¨ï¼ŒåŒ…æ‹¬**èµ„æºç®¡ç†Monad**å’Œ**Reader Monadï¼šé…ç½®å³ç¯å¢ƒ**ã€‚

---

## ğŸ“‘ ç›®å½•

- [9.8 èŒƒç•´è®ºæ·±å±‚ç»“æ„ï¼šMonadä¸æ•ˆåº”](#98-èŒƒç•´è®ºæ·±å±‚ç»“æ„monadä¸æ•ˆåº”)
  - [ğŸ“‹ æ¦‚è¿°](#-æ¦‚è¿°)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [ğŸ”‘ æ ¸å¿ƒæ¦‚å¿µ](#-æ ¸å¿ƒæ¦‚å¿µ)
    - [èµ„æºç®¡ç†Monad](#èµ„æºç®¡ç†monad)
    - [Reader Monadï¼šé…ç½®å³ç¯å¢ƒ](#reader-monadé…ç½®å³ç¯å¢ƒ)
    - [Monadicè®¡ç®—æ¨¡å¼](#monadicè®¡ç®—æ¨¡å¼)
  - [ğŸ“Š Monadæ˜ å°„è¡¨](#-monadæ˜ å°„è¡¨)
  - [ğŸ” æŠ€æœ¯ç»†èŠ‚](#-æŠ€æœ¯ç»†èŠ‚)
    - [èµ„æºç®¡ç†Monadå®ç°](#èµ„æºç®¡ç†monadå®ç°)
    - [Reader Monadå®ç°](#reader-monadå®ç°)
    - [Monadicè®¡ç®—ç»„åˆ](#monadicè®¡ç®—ç»„åˆ)
  - [ğŸ’¡ å®é™…åº”ç”¨](#-å®é™…åº”ç”¨)
    - [èµ„æºç®¡ç†åº”ç”¨](#èµ„æºç®¡ç†åº”ç”¨)
    - [é…ç½®ç®¡ç†åº”ç”¨](#é…ç½®ç®¡ç†åº”ç”¨)
  - [ğŸ”— ç›¸å…³æ¦‚å¿µ](#-ç›¸å…³æ¦‚å¿µ)

---

## ğŸ”‘ æ ¸å¿ƒæ¦‚å¿µ

### èµ„æºç®¡ç†Monad

```haskell
-- å®¹å™¨ç”Ÿå‘½å‘¨æœŸæ˜¯çŠ¶æ€Monad
data ContainerM a = ContainerM { run :: State -> (a, State) }

instance Monad ContainerM where
  return x = ContainerM (\s -> (x, s))
  m >>= f  = ContainerM (\s -> let (a, s') = run m s in run (f a) s')
```

**å®ä¾‹åŒ–**ï¼š

- `createPod` :: `ContainerM PodStatus`
- `deletePod` :: `ContainerM ()`
- **ç»„åˆ**å½¢æˆ**å›æ”¾æ—¥å¿—**ï¼š`createPod >>= watch >>= restartPolicy`

### Reader Monadï¼šé…ç½®å³ç¯å¢ƒ

```haskell
type K8sConfig = ReaderT KubeConfig IO
```

æ‰€æœ‰K8sæ“ä½œè¯»å–åŒä¸€`kubeconfig`ï¼Œä¿æŒ**å¼•ç”¨é€æ˜æ€§**ï¼Œç­‰ä»·äºå‡½æ•°å¼ç¼–ç¨‹çš„**çº¯å‡½æ•°**ã€‚

### Monadicè®¡ç®—æ¨¡å¼

- **Monadicè®¡ç®—** â†” **èµ„æºç®¡ç†**ï¼šé€šè¿‡Monadç®¡ç†èµ„æºç”Ÿå‘½å‘¨æœŸ
- **State Monad** â†” **StatefulSet**ï¼šé€šè¿‡State Monadç®¡ç†çŠ¶æ€
- **Reader Monad** â†” **ConfigMap**ï¼šé€šè¿‡Reader Monadä¼ é€’é…ç½®

---

## ğŸ“Š Monadæ˜ å°„è¡¨

| ç¼–ç¨‹æ¦‚å¿µ | åŸºç¡€è®¾æ–½å®ç° | ç±»å‹è®ºå¯¹åº” | ç¤ºä¾‹ |
|---------|-------------|-----------|------|
| State Monad | StatefulSet | çŠ¶æ€ç®¡ç† | æœ‰çŠ¶æ€åº”ç”¨ |
| IO Monad | PersistentVolume | æŒä¹…åŒ–å­˜å‚¨ | æ•°æ®æŒä¹…åŒ– |
| Reader Monad | ConfigMap | é…ç½®ä¼ é€’ | ç¯å¢ƒé…ç½® |

---

## ğŸ” æŠ€æœ¯ç»†èŠ‚

### èµ„æºç®¡ç†Monadå®ç°

```haskell
-- èµ„æºç®¡ç†Monadï¼šState Monad
data ResourceState = ResourceState {
    pods :: [Pod],
    nodes :: [Node],
    resources :: ResourceMap
}

type ResourceMonad = State ResourceState

-- StatefulSetï¼šState Monad
manageStatefulSet :: ResourceMonad Pod
manageStatefulSet = do
    state <- get
    let pod = createPod state
    put (updateState state pod)
    return pod
```

### Reader Monadå®ç°

```haskell
-- Reader Monadï¼šé…ç½®å³ç¯å¢ƒ
type Config = Map String String
type ConfigReader = Reader Config

-- ConfigMapï¼šReader Monad
getConfig :: String -> ConfigReader String
getConfig key = do
    config <- ask
    return (config ! key)
```

### Monadicè®¡ç®—ç»„åˆ

```haskell
-- Monadicè®¡ç®—ç»„åˆï¼šå›æ”¾æ—¥å¿—
createPod >>= watch >>= restartPolicy

-- ç­‰ä»·äºï¼š
do
  pod <- createPod
  status <- watch pod
  restartPolicy status
```

---

## ğŸ’¡ å®é™…åº”ç”¨

### èµ„æºç®¡ç†åº”ç”¨

```text
1. å®šä¹‰èµ„æºç®¡ç†Monad
2. å®ç°çŠ¶æ€ç®¡ç†
3. ç®¡ç†èµ„æºç”Ÿå‘½å‘¨æœŸ
4. å®ç°Monadicè®¡ç®—
```

### é…ç½®ç®¡ç†åº”ç”¨

```text
1. å®šä¹‰Reader Monad
2. ä¼ é€’é…ç½®ä¿¡æ¯
3. å®ç°é…ç½®å³ç¯å¢ƒ
4. å®ç°Reader Monadåº”ç”¨
```

---

## ğŸ”— ç›¸å…³æ¦‚å¿µ

- [9.1 èŒƒç•´è®ºè§†è§’çš„ç²¾ç¡®å®šä¹‰](./09.1_èŒƒç•´è®ºè§†è§’.md)
- [7.3 StatefulSetä¸Monadicè®¡ç®—](../07_æ•ˆåº”ç³»ç»Ÿ/07.3_StatefulSetä¸Monadicè®¡ç®—.md)
- [03.2 å˜é‡ä½œç”¨åŸŸä¸ç”Ÿå‘½å‘¨æœŸ](../03_ç¨‹åºæ§åˆ¶/03.2_å˜é‡ä½œç”¨åŸŸä¸ç”Ÿå‘½å‘¨æœŸ.md)

---

**è¿”å›**: [09. å½¢å¼åŒ–ç†è®ºæ¡†æ¶](./README.md) | [ä¸»é¢˜ç´¢å¼•](../README.md)
