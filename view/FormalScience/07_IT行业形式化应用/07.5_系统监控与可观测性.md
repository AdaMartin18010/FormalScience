# 07.5 系统监控与可观测性

> **来源**: view07.md

## 📋 内容概览

本文档从形式科学视角分析系统监控与可观测性，包括监控指标的形式化、日志分析等。

## 📊 监控指标的形式化

### 指标类型

#### 计数器（Counter）

**定义**：单调递增的指标

**形式化**：

```
C(t) = ∫₀ᵗ λ(τ) dτ
```

- **λ(t)**：事件速率
- **C(t)**：累计计数

#### 仪表（Gauge）

**定义**：可增可减的指标

**形式化**：

```
G(t) = G(0) + ∫₀ᵗ [λ_in(τ) - λ_out(τ)] dτ
```

- **λ_in(t)**：增加速率
- **λ_out(t)**：减少速率

#### 直方图（Histogram）

**定义**：值分布的统计

**形式化**：

```
H(b) = P(X ∈ bucket_b)
```

- **X**：随机变量
- **b**：桶（bucket）

### 指标聚合

#### 时间聚合

**平均**：

```
μ(t) = (1/T) ∫_{t-T}^t X(τ) dτ
```

**总和**：

```
S(t) = ∫_{t-T}^t X(τ) dτ
```

#### 空间聚合

**平均**：

```
μ = (1/N) Σᵢ Xᵢ
```

**总和**：

```
S = Σᵢ Xᵢ
```

## 📝 日志分析

### 日志作为时间序列

**日志流**：L(t) = {log₁(t), log₂(t), ...}

**日志密度**：

```
ρ(t) = dN/dt
```

- **N(t)**：累计日志数
- **ρ(t)**：日志生成速率

### 日志模式识别

**模式**：P = {pattern₁, pattern₂, ...}

**匹配**：

```
match(log, P) = {p ∈ P | log matches p}
```

### 异常检测

**异常定义**：偏离正常模式

**检测方法**：

- **统计方法**：基于统计分布
- **机器学习**：基于模型
- **规则方法**：基于规则

## 🔍 追踪系统

### 分布式追踪

**追踪**：T = {span₁, span₂, ...}

**跨度（Span）**：

```
span = (trace_id, span_id, parent_id, start_time, end_time, tags)
```

### 追踪分析

**延迟分析**：

```
latency = end_time - start_time
```

**依赖分析**：

```
dependency = parent_id → span_id
```

### 性能分析

**瓶颈识别**：

```
bottleneck = argmax(latency)
```

**优化建议**：

```
optimize = reduce(latency)
```

## 🚨 告警系统

### 告警规则

**规则**：R = (condition, action)

**条件**：

```
condition: metric > threshold
```

**动作**：

```
action: send_alert(severity, message)
```

### 告警聚合

**聚合策略**：

- **去重**：相同告警去重
- **分组**：相关告警分组
- **抑制**：抑制重复告警

### 告警优化

**减少噪音**：

- **阈值优化**：优化阈值
- **时间窗口**：使用时间窗口
- **机器学习**：使用ML优化

## 📈 可观测性指标

### 三大支柱

#### 指标（Metrics）

**定义**：数值型数据

**特点**：

- **聚合**：易于聚合
- **存储**：存储效率高
- **查询**：查询快速

#### 日志（Logs）

**定义**：事件记录

**特点**：

- **详细**：信息详细
- **灵活**：格式灵活
- **存储**：存储成本高

#### 追踪（Traces）

**定义**：请求路径

**特点**：

- **关联**：关联请求
- **性能**：性能分析
- **复杂**：实现复杂

### 可观测性度量

**可观测性**：O = f(Metrics, Logs, Traces)

**目标**：最大化可观测性

**约束**：成本、性能

## 🎯 监控最佳实践

### 实践1：黄金信号

**延迟**：请求处理时间

**流量**：系统负载

**错误**：错误率

**饱和度**：资源使用率

### 实践2：SLI/SLO/SLA

**SLI**：服务级别指标

**SLO**：服务级别目标

**SLA**：服务级别协议

### 实践3：分层监控

**层次**：

- **基础设施层**：CPU、内存、网络
- **应用层**：应用指标
- **业务层**：业务指标

## 🔗 相关文档

- [07.1_Kubernetes动力学.md](07.1_Kubernetes动力学.md)
- [07.2_EKS系统分析.md](07.2_EKS系统分析.md)
- [07.3_微服务架构.md](07.3_微服务架构.md)
- [07.4_分布式系统.md](07.4_分布式系统.md)

## 📖 扩展阅读

- 《Observability Engineering》- Charity Majors
- Wikipedia: [Observability](https://en.wikipedia.org/wiki/Observability)
