# 07.2 EKS系统分析

> **来源**: view07.md

## 📋 内容概览

本文档分析AWS EKS（Elastic Kubernetes Service）系统的动力学特性，揭示云原生系统的形式化结构。

## ☁️ L0：EKS控制平面（量子芝诺效应）

### 状态空间：托管抽象的慢流形

AWS将控制平面参数化为**隐藏变量**：

```
x_cp = [etcd_version, api_latency, cp_uptime, backup_age] ∈ M_slow
M_slow是AWS管理的低维流形（用户不可见）
```

### 动力学：绝热演化

```
d(cp_version)/dt = -∇V(upgrade) + ξ_AWS  (V=稳定性势能)
```

**用户感知**：控制平面状态被**量子芝诺测量**：高频健康检查使状态坍缩到{Running}，**阻止了故障相干的宏观积累**。

### 临界现象：版本滞后分岔

**参数**：用户版本 v_user vs AWS强制版本 v_AWS

**分岔**：当 v_AWS - v_user > Δv_crit ≈ 3个minor版本，**安全补丁流**中断 → **漏洞吸引子**深度增加

**预测**：2025年Q3，EKS 1.29 EOL后，未升级集群在90天内**CVE感染概率>85%**

## 🌐 L1：VPC CNI（IP地址的反应-扩散）

### 状态变量：IP地址作为守恒粒子

```
ρ_ip(x,t) = 可用IP密度 (x=子网空间)
R_pod(t) = 已分配Pod IP数
S_subnet(t) = 子网总容量
```

### 动力学：IP消耗反应方程

```
dR/dt = λ_pod_create·(S - R) - μ_pod_terminate·R  (当ρ>0)
∂ρ/∂t = D∇²ρ - ∇·(v·ρ) + Source(新子网) - Sink(IP耗尽)
```

### 与燃烧反应同构

- **Pod** = 燃料粒子
- **IP** = 氧化剂
- **CNI分配** = 反应速率
- **耗尽** = **熄火相变**

### 临界现象：IP耗尽雪崩

**参数**：子网大小 /26 (64 IPs), Pod密度 0.8 Pod/核

**分岔**：当 R → S - 5 (预留buffer)，**延迟激增**：

```
τ_assign ∝ 1/(S - R)²   (平方反比定律)
```

**预测**：在一个100节点(m5.xlarge)集群，/26子网在**业务高峰后3分钟内IP枯竭**，新Pod Pending。

## 🏗️ L2：节点组（NodeGroup）作为种群动力学

### 状态：Auto Scaling Group的相空间

```
N_spot(t) = Spot实例数
N_on_demand(t) = On-Demand实例数
N_reserved(t) = Reserved实例数
```

### 动力学：Lotka-Volterra + 价格捕食

```
dN_spot/dt = α·N_spot·(1 - (N_total)/K) - β·price_surge·N_spot
dN_on_demand/dt = γ·β·price_surge·N_spot - δ·cost_pressure
dN_reserved/dt = ε·(long_term_commitment) - ζ·N_reserved
```

**关键**：**price_surge**是**捕食者**，Spot实例是**猎物**

- 当Spot价格 > On-Demand, β→∞, **Spot种群灭绝**

### 临界现象：Spot中断级联

**参数**：Spot中断率 λ_interrupt ≈ 0.05/hour

**预测**：300节点全Spot集群，**期望生存时间**：

```
T_mean = 1/(λ·N) = 1/(0.05×300) = 0.067h = 4分钟
```

**动力学**：中断事件 = **泊松过程** → **群体灭绝**在4分钟内完成

## ⚡ L3：Fargate作为无服务器量子态

### 状态：一次性Pod的瞬时激发

Fargate Pod是**计算虚粒子**：

```
|Fargate⟩ = 创建 → 运行 → 销毁 （生命周期Δt≈任务时长）
```

### 动力学：Fokker-Planck方程

描述**任务时长分布**：

```
∂P(T)/∂t = -∂/∂T [A(T)P] + ∂²/∂T² [B(T)P]
```

- A(T) = **平均任务时长漂移** = 业务逻辑
- B(T) = **时长涨落** = 冷启动/IO波动

### 临界现象：冷启动相变

**参数**：VPC配置时间 τ_vpc ≈ 10-15s, Image大小 S_image

**分岔**：当任务时长 T_task < τ_vpc + S_image/pull_speed，**启动开销占比 > 50%** → **QoS崩溃**

**预测**：Fargate适合 T_task > 2分钟的批处理，不适合<10秒的实时API（**动力学无效**）

## 🔐 L4：IRSA（IAM for ServiceAccounts）作为身份场论

### 状态：权限作为规范场

```
A_μ^a(x,t) = 服务账户a在操作μ上的权限幅度
μ ∈ {get, list, create, delete}
x = 资源位置（S3 bucket, DynamoDB table）
```

### 动力学：Yang-Mills规范场方程

```
∂_μ F^{μν} = J^ν  (F = 曲率 = 权限冲突, J = 源 = 策略)
F_{μν} = ∂_μ A_ν - ∂_ν A_μ + [A_μ, A_ν]
```

**非对易性**[A_μ, A_ν] ≠ 0 → **策略冲突不可交换**（先allow s3:*再deny s3:Delete ≠ 先deny再allow）

### 临界现象：权限爆炸

**参数**：策略数N_policy, 角色数N_role

**分岔**：当N_policy × N_role > 1000（**EKS限制**），策略评估时间τ_eval ∝ N² → **API调用延迟>1秒**

**预测**：在一个50微服务+20S3 bucket的EKS集群，IRSA策略数=1000，**STS AssumeRole调用成为性能瓶颈**

## 📈 L5：Cluster Autoscaler作为捕食者-被捕食者

### 状态：ASG种群的Logistic增长

```
N_actual(t) = 当前实例数
N_desired(t) = CA计算值
N_max = AutoScalingGroup.MaxSize
```

### 动力学：时滞微分方程

```
dN/dt = α·(N_desired(t-τ) - N_actual) · (1 - N_actual/N_max)
```

**τ** = **AWS API延迟 + 启动时间 ≈ 2-3分钟**（**时滞**）

### 与捕食者-猎物模型同构

- **N_desired** = 猎物数量（Pending Pod）
- **N_actual** = 捕食者（节点）
- **τ** = **妊娠周期**（从需求到实例Ready）

### 临界现象：时滞振荡

**参数**：τ × α > π/2 → **Hopf分岔**

**预测**：当负载波动周期 T_load ≈ 5分钟，CA会**反相振荡**：负载高峰时缩容，低谷时扩容（**180度相位差**）

## 🔗 相关文档

- [07.1_Kubernetes动力学.md](07.1_Kubernetes动力学.md)
- [02_动力学系统理论/02.4_分岔理论与相变.md](../02_动力学系统理论/02.4_分岔理论与相变.md)

## 📖 扩展阅读

- AWS EKS官方文档
- 《Kubernetes in Action》
