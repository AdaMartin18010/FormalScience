# 6.1 可移植性理论 (Portability Theory)

## 目录

- [6.1 可移植性理论 (Portability Theory)](#61-可移植性理论-portability-theory)
  - [目录](#目录)
  - [核心命题](#核心命题)
  - [可移植性层次](#可移植性层次)
    - [L1：语法可移植](#l1语法可移植)
    - [L2：语义可移植](#l2语义可移植)
    - [L3：性能可移植](#l3性能可移植)
  - [抽象代价](#抽象代价)
  - [参考文献](#参考文献)

## 核心命题

**抽象不变性定理**：
\[
\llbracket P \rrbracket_{\text{Platform}_1} \equiv \llbracket P \rrbracket_{\text{Platform}_2}
\]

**POSIX 失败教训**：
\[
\text{Write-Once-Run-Anywhere} \not\Rightarrow \text{True}
\]

**Wasm 承诺**：
\[
\text{Behavior}(\text{Wasm}, \text{Input}) = f(\text{Input}) \quad \forall \text{Platform}
\]

---

## 可移植性层次

### L1：语法可移植

**定义**：代码在不同平台上可编译
\[
\text{Compile}(P, \text{Plat}_1) \wedge \text{Compile}(P, \text{Plat}_2)
\]

### L2：语义可移植

**定义**：执行结果一致
\[
\text{Exec}(P, \text{Plat}_1, I) = \text{Exec}(P, \text{Plat}_2, I)
\]

### L3：性能可移植

**定义**：性能特征相似
\[
\frac{\text{Perf}(\text{Plat}_1)}{\text{Perf}(\text{Plat}_2)} \approx 1 \pm \epsilon
\]

**Wasm 实现**：

- L1：✅ 二进制格式统一
- L2：✅ 确定性语义
- L3：❌ 硬件差异无法消除

---

## 抽象代价

**定理（抽象税不可避免）**：
\[
\forall \text{Abstraction} : \exists \text{Overhead} > 0
\]

**Wasm 抽象税**：
\[
\text{Tax}_{\text{wasm}} = \text{验证} + \text{边界检查} + \text{间接跳转} \approx 5-15\%
\]

**批判**：
> 可移植性是"便利的代价"。Wasm 保证跨平台一致，但付出了性能损失。这是工程现实，而非技术缺陷。

---

## 参考文献

1. **[Tanenbaum06]** Andrew S. Tanenbaum. "The Myth of Write Once, Run Anywhere." IEEE Software, 2006.
