# 7.4 可扩展性模式

> **子主题编号**: 07.4
> **主题**: Wasm视角

## 📋 目录

- [7.4 可扩展性模式](#74-可扩展性模式)
  - [📋 目录](#-目录)
  - [1 核心命题](#1-核心命题)
  - [2 水平扩展模式](#2-水平扩展模式)
    - [2.1 无状态设计](#21-无状态设计)
    - [2.2 负载均衡](#22-负载均衡)
  - [3 垂直扩展限制](#3-垂直扩展限制)
    - [3.1 单机瓶颈](#31-单机瓶颈)
    - [3.2 成本曲线](#32-成本曲线)
  - [4 弹性伸缩](#4-弹性伸缩)
    - [4.1 自动扩缩容](#41-自动扩缩容)
    - [4.2 成本优化](#42-成本优化)
  - [5 数据库扩展](#5-数据库扩展)
    - [5.1 读写分离](#51-读写分离)
    - [5.2 分片策略](#52-分片策略)
  - [6 批判性分析](#6-批判性分析)
  - [参考文献](#参考文献)

---

## 1 核心命题

**Amdahl 定律**：
\[
\text{Speedup}(N) = \frac{1}{(1-P) + \frac{P}{N}}
\]

**Universal Scalability Law**：
\[
\text{Throughput}(N) = \frac{N}{1 + \alpha(N-1) + \beta N(N-1)}
\]

**扩展目标**：
\[
\text{Throughput}(N) \propto N \quad (\text{理想})
\]

---

## 2 水平扩展模式

### 2.1 无状态设计

**原则**：
\[
\forall \text{Request} : \text{Process}(\text{Req}, \text{Node}_i) = \text{Process}(\text{Req}, \text{Node}_j)
\]

**Wasm 优势**：

- 函数级无状态
- 快速冷启动
- 高密度部署

### 2.2 负载均衡

**策略**：
\[
\begin{align*}
\text{Round-Robin} &: \text{Node}(i) = i \bmod N \\
\text{Least-Conn} &: \text{Node} = \arg\min_j \text{Conn}(j) \\
\text{Weighted} &: P(\text{Node}_j) \propto W_j
\end{align*}
\]

**Wasm 特定优化**：

- 实例池预热
- 智能路由（代码哈希）

---

## 3 垂直扩展限制

### 3.1 单机瓶颈

**性能上界**：
\[
\text{Perf}_{\text{max}} = \min(\text{CPU}, \text{Memory}, \text{Network})
\]

**Wasm 影响**：

- CPU：接近原生
- Memory：线性内存限制（4GB）
- Network：无直接影响

### 3.2 成本曲线

**非线性增长**：
\[
\text{Cost}(2N) > 2 \times \text{Cost}(N) \quad (\text{大型实例溢价})
\]

---

## 4 弹性伸缩

### 4.1 自动扩缩容

**规则**：
\[
N_{\text{target}} = \lceil \frac{\text{Load}}{\text{Capacity}_{\text{per-node}}} \rceil
\]

**Wasm 快速响应**：
\[
\begin{align*}
T_{\text{scale-out}} &\approx 5\text{s（vs 容器 60s）} \\
T_{\text{scale-in}} &\approx 1\text{s}
\end{align*}
\]

### 4.2 成本优化

**Spot 实例策略**：
\[
\text{Cost}_{\text{spot}} \approx 0.3 \times \text{Cost}_{\text{on-demand}}
\]

**Wasm 容错**：

- 快速迁移
- 无状态恢复

---

## 5 数据库扩展

### 5.1 读写分离

**架构**：

```text
Application (Wasm)
  ├─> Master DB (写)
  └─> Replica DB (读)
```

**性能提升**：
\[
\text{Read-Throughput} = N_{\text{replicas}} \times \text{Single-Throughput}
\]

### 5.2 分片策略

**哈希分片**：
\[
\text{Shard}(\text{key}) = \text{hash}(\text{key}) \bmod N
\]

**范围分片**：
\[
\text{Shard}(\text{key}) = \text{range-map}(\text{key})
\]

---

## 6 批判性分析

**命题**：
\[
\text{Scalability} \neq \text{Performance}
\]

**反例**：

- 系统可扩展到 1000 节点
- 但单请求延迟 10s（慢）

**批判**：
> 可扩展性是"并发能力"，而非"单体性能"。Wasm 提供高密度与快启动，但无法突破算法复杂度。架构设计比技术选型更重要。

---

## 参考文献

1. **[Gunther07]** Neil J. Gunther. "Guerrilla Capacity Planning." Springer, 2007.
