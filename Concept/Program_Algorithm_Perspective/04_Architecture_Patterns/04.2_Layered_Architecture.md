# 4.2 Layered Architecture

> **å­ä¸»é¢˜ç¼–å·**: 04.2
> **ä¸»é¢˜**: ç¨‹åºç®—æ³•è§†è§’

## 1 ğŸ“Š æ ¸å¿ƒæ¦‚å¿µæ·±åº¦åˆ†æ

<details>
<summary><b>ğŸ“šğŸ”¬ ç‚¹å‡»å±•å¼€ï¼šåˆ†å±‚æ¶æ„æ ¸å¿ƒæ´å¯Ÿ</b></summary>

**ç»ˆææ´å¯Ÿ**: åˆ†å±‚=å…³æ³¨ç‚¹åˆ†ç¦»çš„ç»å…¸å®ç°ã€‚æ ¸å¿ƒçº¦æŸï¼šå•å‘ä¾èµ–ï¼ŒLáµ¢åªèƒ½è°ƒç”¨Láµ¢â‚Šâ‚ï¼Œå½¢æˆä¾èµ–é“¾Lâ‚â†’Lâ‚‚â†’...â†’Lâ‚™ã€‚ç»å…¸å®ä¾‹ï¼šâ‘ OSIä¸ƒå±‚ç½‘ç»œæ¨¡å‹ï¼šåº”ç”¨â†’è¡¨ç¤ºâ†’ä¼šè¯â†’ä¼ è¾“â†’ç½‘ç»œâ†’æ•°æ®é“¾è·¯â†’ç‰©ç†ï¼Œæ¯å±‚åè®®ç‹¬ç«‹æ¼”åŒ–â‘¡ä¸‰å±‚Webåº”ç”¨ï¼šè¡¨ç¤ºå±‚ï¼ˆUIï¼‰â†’ä¸šåŠ¡é€»è¾‘å±‚â†’æ•°æ®è®¿é—®å±‚â‘¢DDDå››å±‚ï¼šç”¨æˆ·æ¥å£â†’åº”ç”¨å±‚â†’é¢†åŸŸå±‚â†’åŸºç¡€è®¾æ–½å±‚ã€‚ä¼˜åŠ¿ï¼šâ‘ å±‚ç‹¬ç«‹å¼€å‘æµ‹è¯•â‘¡æ¥å£ç¨³å®šæ˜“æ›¿æ¢â‘¢å…³æ³¨ç‚¹æ¸…æ™°ã€‚æŒ‘æˆ˜ï¼šâ‘ å±‚é—´é€šä¿¡å¼€é”€â‘¡ä¸¥æ ¼åˆ†å±‚vsæ”¾æ¾åˆ†å±‚ï¼ˆå…è®¸è·¨å±‚ï¼‰æƒè¡¡â‘¢"æ²‰åº•"åæ¨¡å¼ï¼ˆåº•å±‚æ‰¿è½½è¿‡å¤šé€»è¾‘ï¼‰ã€‚æ¶æ„å˜ä½“ï¼šâ‘ å…­è¾¹å½¢æ¶æ„ï¼ˆç«¯å£-é€‚é…å™¨ï¼‰ï¼šä¸šåŠ¡æ ¸å¿ƒåœ¨ä¸­å¿ƒï¼Œå¤–å›´æ˜¯é€‚é…å™¨â‘¡æ´‹è‘±æ¶æ„ï¼šä¾èµ–å‘å†…ï¼Œé¢†åŸŸæ¨¡å‹æœ€æ ¸å¿ƒâ‘¢æ¸…æ´æ¶æ„ï¼šä¾èµ–è§„åˆ™+æµ‹è¯•éš”ç¦»ã€‚å½¢å¼åŒ–éªŒè¯ï¼šç”¨DAGï¼ˆæœ‰å‘æ— ç¯å›¾ï¼‰è¡¨ç¤ºä¾èµ–ï¼Œæ£€æµ‹å¾ªç¯ä¾èµ–ã€éªŒè¯æ— è·¨å±‚è°ƒç”¨ã€‚å·¥å…·ï¼šArchUnit/NDependå®æ–½æ¶æ„è§„åˆ™ã€‚å…³é”®ï¼šåˆ†å±‚æ¶æ„ç‰ºç‰²æ€§èƒ½æ¢å–å¯ç»´æŠ¤æ€§å’Œæ¼”åŒ–èƒ½åŠ›ã€‚

</details>

---

## ğŸ“‹ ç›®å½•

- [åˆ†å±‚æ¶æ„ï¼ˆLayered Architectureï¼‰](#åˆ†å±‚æ¶æ„layered-architecture)
  - [1 ğŸ“Š æ ¸å¿ƒæ¦‚å¿µæ·±åº¦åˆ†æ](#1--æ ¸å¿ƒæ¦‚å¿µæ·±åº¦åˆ†æ)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [2 æ¦‚è¿°](#2-æ¦‚è¿°)
  - [1 . ç»å…¸åˆ†å±‚æ¨¡å‹](#1--ç»å…¸åˆ†å±‚æ¨¡å‹)
    - [1.1 OSI ä¸ƒå±‚æ¨¡å‹ï¼ˆç½‘ç»œåè®®ï¼‰](#11-osi-ä¸ƒå±‚æ¨¡å‹ç½‘ç»œåè®®)
    - [1.2 ä¸‰å±‚ Web åº”ç”¨](#12-ä¸‰å±‚-web-åº”ç”¨)
      - [1 ç¤ºä¾‹ï¼ˆSpring MVCï¼‰](#1-ç¤ºä¾‹spring-mvc)
    - [1.3 å››å±‚æ¶æ„ï¼ˆDDD è§†è§’ï¼‰](#13-å››å±‚æ¶æ„ddd-è§†è§’)
  - [2 . å½¢å¼åŒ–åˆ†å±‚çº¦æŸ](#2--å½¢å¼åŒ–åˆ†å±‚çº¦æŸ)
    - [2.1 ä¾èµ–è§„åˆ™](#21-ä¾èµ–è§„åˆ™)
    - [2.2 æ— ç¯æ€§éªŒè¯](#22-æ— ç¯æ€§éªŒè¯)
  - [3 . å±‚é—´é€šä¿¡æ¨¡å¼](#3--å±‚é—´é€šä¿¡æ¨¡å¼)
    - [3.1 åŒæ­¥è°ƒç”¨](#31-åŒæ­¥è°ƒç”¨)
    - [3.2 å¼‚æ­¥æ¶ˆæ¯](#32-å¼‚æ­¥æ¶ˆæ¯)
    - [3.3 å›è°ƒæ³¨å…¥](#33-å›è°ƒæ³¨å…¥)
  - [4 . åˆ†å±‚æ€§èƒ½ä¼˜åŒ–](#4--åˆ†å±‚æ€§èƒ½ä¼˜åŒ–)
    - [4.1 å±‚é—´ç¼“å­˜](#41-å±‚é—´ç¼“å­˜)
    - [4.2 æ‰¹é‡æ“ä½œ](#42-æ‰¹é‡æ“ä½œ)
    - [4.3 å±‚ç©¿é€ï¼ˆBypassï¼‰](#43-å±‚ç©¿é€bypass)
  - [5 . å¾®å†…æ ¸å˜ä½“ï¼ˆMicrokernel + Layersï¼‰](#5--å¾®å†…æ ¸å˜ä½“microkernel--layers)
  - [6 . å…­è¾¹å½¢æ¶æ„ï¼ˆHexagonal Architectureï¼‰](#6--å…­è¾¹å½¢æ¶æ„hexagonal-architecture)
  - [7 . æ´‹è‘±æ¶æ„ï¼ˆOnion Architectureï¼‰](#7--æ´‹è‘±æ¶æ„onion-architecture)
  - [8 . å½¢å¼åŒ–éªŒè¯](#8--å½¢å¼åŒ–éªŒè¯)
    - [8.1 ä¾èµ–çº¦æŸéªŒè¯](#81-ä¾èµ–çº¦æŸéªŒè¯)
    - [8.2 æ€§èƒ½å»ºæ¨¡](#82-æ€§èƒ½å»ºæ¨¡)
  - [9 . å®é™…æ¡ˆä¾‹](#9--å®é™…æ¡ˆä¾‹)
    - [9.1 Spring Boot ä¸‰å±‚æ¶æ„](#91-spring-boot-ä¸‰å±‚æ¶æ„)
    - [9.2 Android æ¶æ„ç»„ä»¶](#92-android-æ¶æ„ç»„ä»¶)
  - [10 . å¤§å­¦è¯¾ç¨‹å¯¹åº”](#10--å¤§å­¦è¯¾ç¨‹å¯¹åº”)
  - [11 . æ•™æå¯¹åº”](#11--æ•™æå¯¹åº”)
  - [12 . æœ¬åœ°é¡¹ç›®å¼•ç”¨](#12--æœ¬åœ°é¡¹ç›®å¼•ç”¨)
  - [13 . æ€»ç»“](#13--æ€»ç»“)
    - [1 æ ¸å¿ƒæ´å¯Ÿ](#1-æ ¸å¿ƒæ´å¯Ÿ)
    - [13.2 å·¥å…·é“¾æ¨è](#132-å·¥å…·é“¾æ¨è)
    - [13.3 å®æˆ˜å»ºè®®](#133-å®æˆ˜å»ºè®®)
  - [14 é™„å½• Aï¼šåˆ†å±‚æ¶æ„ Checklist](#14-é™„å½•-aåˆ†å±‚æ¶æ„-checklist)
  - [15 é™„å½• Bï¼šWikipedia æ¦‚å¿µå¯¹ç…§](#15-é™„å½•-bwikipedia-æ¦‚å¿µå¯¹ç…§)
  - [è·¨è§†è§’é“¾æ¥](#è·¨è§†è§’é“¾æ¥)

---

## 2 æ¦‚è¿°

**åˆ†å±‚æ¶æ„**æ˜¯æœ€ç»å…¸çš„æ¶æ„æ¨¡å¼ï¼Œå°†ç³»ç»Ÿç»„ç»‡æˆ**å±‚æ¬¡**ï¼Œæ¯å±‚åªèƒ½ä¾èµ–ä¸‹å±‚ã€‚æ ¸å¿ƒæ€æƒ³ï¼š

```text
åˆ†å±‚ = å…³æ³¨ç‚¹åˆ†ç¦» + å•å‘ä¾èµ– + æŠ½è±¡å±‚æ¬¡

å½¢å¼åŒ–ï¼š
  Layers = âŸ¨Lâ‚, Lâ‚‚, ..., Lâ‚™âŸ©
  Dependency: âˆ€i, Láµ¢ â†’ Láµ¢â‚Šâ‚
  Constraint: æ— å‘ä¸Šä¾èµ–ã€æ— è·¨å±‚ä¾èµ–
```

**ä¼˜ç‚¹**ï¼š

- å…³æ³¨ç‚¹åˆ†ç¦»
- å±‚ç‹¬ç«‹æ¼”åŒ–
- å¯æ›¿æ¢æ€§
- å¯æµ‹è¯•æ€§

**ç¼ºç‚¹**ï¼š

- æ€§èƒ½å¼€é”€ï¼ˆå±‚é—´è°ƒç”¨ï¼‰
- è¿‡åº¦æŠ½è±¡
- éš¾ä»¥è·¨å±‚ä¼˜åŒ–

---

## 1 ç»å…¸åˆ†å±‚æ¨¡å‹

### 1.1 OSI ä¸ƒå±‚æ¨¡å‹ï¼ˆç½‘ç»œåè®®ï¼‰

```text
7. åº”ç”¨å±‚ (Application)  - HTTP, FTP, SMTP
6. è¡¨ç¤ºå±‚ (Presentation) - åŠ å¯†ã€ç¼–ç 
5. ä¼šè¯å±‚ (Session)      - ä¼šè¯ç®¡ç†
4. ä¼ è¾“å±‚ (Transport)    - TCP, UDP
3. ç½‘ç»œå±‚ (Network)      - IP, è·¯ç”±
2. æ•°æ®é“¾è·¯å±‚ (Data Link) - MAC, ä»¥å¤ªç½‘
1. ç‰©ç†å±‚ (Physical)     - ç”µä¿¡å·
```

**å½¢å¼åŒ–**ï¼š

```text
Layeráµ¢ æä¾›æœåŠ¡æ¥å£ Sáµ¢
Layeráµ¢ ä½¿ç”¨ Layeráµ¢â‚Šâ‚ çš„æœåŠ¡

å°è£…ï¼š
  å‘é€ï¼šData â†’ åº”ç”¨å¤´ + Data â†’ ... â†’ ç‰©ç†ä¿¡å·
  æ¥æ”¶ï¼šç‰©ç†ä¿¡å· â†’ ... â†’ åº”ç”¨å¤´ + Data â†’ Data
```

### 1.2 ä¸‰å±‚ Web åº”ç”¨

```text
Presentation Layer (å±•ç¤ºå±‚)
    â†“
Business Logic Layer (ä¸šåŠ¡é€»è¾‘å±‚)
    â†“
Data Access Layer (æ•°æ®è®¿é—®å±‚)
    â†“
Database (æ•°æ®åº“)
```

**èŒè´£åˆ†ç¦»**ï¼š

```text
Presentationï¼š
  - UI æ¸²æŸ“
  - ç”¨æˆ·äº¤äº’
  - è¾“å…¥éªŒè¯

Business Logicï¼š
  - ä¸šåŠ¡è§„åˆ™
  - äº‹åŠ¡ç®¡ç†
  - é¢†åŸŸæ¨¡å‹

Data Accessï¼š
  - SQL æŸ¥è¯¢
  - ORM æ˜ å°„
  - ç¼“å­˜
```

#### 1 ç¤ºä¾‹ï¼ˆSpring MVCï¼‰

```java
// Presentation Layer (Controller)
@RestController
@RequestMapping("/api/users")
public class UserController {
    @Autowired
    private UserService userService;

    @GetMapping("/{id}")
    public UserDTO getUser(@PathVariable Long id) {
        return userService.findById(id);
    }
}

// Business Logic Layer (Service)
@Service
@Transactional
public class UserService {
    @Autowired
    private UserRepository userRepository;

    public UserDTO findById(Long id) {
        User user = userRepository.findById(id)
            .orElseThrow(() -> new NotFoundException());
        return UserDTO.from(user);
    }
}

// Data Access Layer (Repository)
@Repository
public interface UserRepository extends JpaRepository<User, Long> {
    Optional<User> findById(Long id);
}
```

### 1.3 å››å±‚æ¶æ„ï¼ˆDDD è§†è§’ï¼‰

```text
User Interface Layer (ç”¨æˆ·æ¥å£å±‚)
    â†“
Application Layer (åº”ç”¨å±‚)
    â†“
Domain Layer (é¢†åŸŸå±‚)
    â†“
Infrastructure Layer (åŸºç¡€è®¾æ–½å±‚)
```

**èŒè´£ç»†åŒ–**ï¼š

```text
User Interfaceï¼š
  - REST API
  - GraphQL
  - Web UI

Applicationï¼š
  - ç”¨ä¾‹ç¼–æ’
  - DTO è½¬æ¢
  - æƒé™æ£€æŸ¥

Domainï¼š
  - é¢†åŸŸæ¨¡å‹
  - ä¸šåŠ¡è§„åˆ™
  - é¢†åŸŸäº‹ä»¶

Infrastructureï¼š
  - æ•°æ®åº“
  - æ¶ˆæ¯é˜Ÿåˆ—
  - ç¬¬ä¸‰æ–¹æœåŠ¡
```

---

## 2 å½¢å¼åŒ–åˆ†å±‚çº¦æŸ

### 2.1 ä¾èµ–è§„åˆ™

**ä¸¥æ ¼åˆ†å±‚**ï¼ˆStrict Layeringï¼‰ï¼š

```text
âˆ€å±‚ Láµ¢, åªèƒ½è°ƒç”¨ Láµ¢â‚Šâ‚

å½¢å¼åŒ–ï¼š
  Dependency Graph G = (V, E)
  V = {Lâ‚, Lâ‚‚, ..., Lâ‚™}
  E âŠ† {(Láµ¢, Láµ¢â‚Šâ‚) | i < n}
```

**å®½æ¾åˆ†å±‚**ï¼ˆRelaxed Layeringï¼‰ï¼š

```text
âˆ€å±‚ Láµ¢, å¯ä»¥è°ƒç”¨ {Láµ¢â‚Šâ‚, Láµ¢â‚Šâ‚‚, ..., Lâ‚™}

E âŠ† {(Láµ¢, Lâ±¼) | i < j}
```

### 2.2 æ— ç¯æ€§éªŒè¯

**å®šç†**ï¼ˆåˆ†å±‚å¿…æ— ç¯ï¼‰ï¼š

```text
è‹¥ Dependency Graph æ˜¯ DAGï¼Œåˆ™æ— å¾ªç¯ä¾èµ–
```

**éªŒè¯æ–¹æ³•**ï¼šæ‹“æ‰‘æ’åº

**å·¥å…·**ï¼ˆé™æ€åˆ†æï¼‰ï¼š

```bash
# ä½¿ç”¨ jdeps åˆ†æ Java ä¾èµ–
jdeps -verbose:class -recursive my-app.jar

# ä½¿ç”¨ ArchUnit éªŒè¯æ¶æ„è§„åˆ™
@ArchTest
static ArchRule layers_should_respect_hierarchy =
    layeredArchitecture()
        .layer("Presentation").definedBy("..controller..")
        .layer("Business").definedBy("..service..")
        .layer("Data").definedBy("..repository..")
        .whereLayer("Presentation").mayNotBeAccessedByAnyLayer()
        .whereLayer("Business").mayOnlyBeAccessedByLayers("Presentation")
        .whereLayer("Data").mayOnlyBeAccessedByLayers("Business");
```

---

## 3 å±‚é—´é€šä¿¡æ¨¡å¼

### 3.1 åŒæ­¥è°ƒç”¨

```text
Layeráµ¢ â†’ call(method, params) â†’ Layeráµ¢â‚Šâ‚
          â† return(result) â†
```

**ä¼˜ç‚¹**ï¼šç®€å•ã€æ˜“ç†è§£
**ç¼ºç‚¹**ï¼šé˜»å¡ã€è€¦åˆ

### 3.2 å¼‚æ­¥æ¶ˆæ¯

```text
Layeráµ¢ â†’ publish(event) â†’ Event Bus
                            â†“
                         Layeráµ¢â‚Šâ‚ â† subscribe
```

**ä¼˜ç‚¹**ï¼šè§£è€¦ã€å¹¶è¡Œ
**ç¼ºç‚¹**ï¼šå¤æ‚æ€§ã€æœ€ç»ˆä¸€è‡´æ€§

### 3.3 å›è°ƒæ³¨å…¥

```text
Layeráµ¢ æä¾›æ¥å£ I
Layeráµ¢â‚Šâ‚ å®ç° I
Layeráµ¢â‚Šâ‚ æ³¨å…¥åˆ° Layeráµ¢
```

**ç¤ºä¾‹**ï¼ˆä¾èµ–å€’ç½® DIPï¼‰ï¼š

```java
// Domain Layer (é«˜å±‚)
public interface UserRepository {
    User findById(Long id);
}

// Infrastructure Layer (ä½å±‚)
public class JpaUserRepository implements UserRepository {
    @Override
    public User findById(Long id) {
        // JPA implementation
    }
}

// ä¾èµ–æ–¹å‘ï¼šInfrastructure â†’ Domainï¼ˆå€’ç½®ï¼ï¼‰
```

---

## 4 åˆ†å±‚æ€§èƒ½ä¼˜åŒ–

### 4.1 å±‚é—´ç¼“å­˜

```text
Presentation Layer
    â†“
Cache (L1)
    â†“
Business Layer
    â†“
Cache (L2)
    â†“
Data Access Layer
```

**ç­–ç•¥**ï¼š

- L1ï¼šä¼šè¯çº§ç¼“å­˜ï¼ˆç”¨æˆ·ç‰¹å®šï¼‰
- L2ï¼šå…¨å±€ç¼“å­˜ï¼ˆå…±äº«æ•°æ®ï¼‰

### 4.2 æ‰¹é‡æ“ä½œ

**é—®é¢˜**ï¼šN+1 æŸ¥è¯¢

```java
// åï¼šæ¯ä¸ªç”¨æˆ·å•ç‹¬æŸ¥è¯¢è®¢å•
for (User user : users) {
    List<Order> orders = orderService.findByUserId(user.getId());
}
```

**è§£å†³**ï¼šæ‰¹é‡åŠ è½½

```java
// å¥½ï¼šä¸€æ¬¡æŸ¥è¯¢æ‰€æœ‰è®¢å•
Set<Long> userIds = users.stream().map(User::getId).collect(toSet());
Map<Long, List<Order>> ordersByUser = orderService.findByUserIds(userIds);
```

### 4.3 å±‚ç©¿é€ï¼ˆBypassï¼‰

**åœºæ™¯**ï¼šè¯»å¤šå†™å°‘ï¼Œç»•è¿‡ä¸šåŠ¡å±‚ç›´æ¥æŸ¥è¯¢

```text
Query: Presentation â†’ Data (bypass Business)
Command: Presentation â†’ Business â†’ Data
```

**é£é™©**ï¼šç ´ååˆ†å±‚çº¯åº¦

---

## 5 å¾®å†…æ ¸å˜ä½“ï¼ˆMicrokernel + Layersï¼‰

```text
Core Layer (å¾®å†…æ ¸)
    â†‘
Plugin A | Plugin B | Plugin C
```

**ç‰¹ç‚¹**ï¼š

- Core æä¾›åŸºç¡€æœåŠ¡
- Plugins æ‰©å±•åŠŸèƒ½
- æ’ä»¶å¯ç‹¬ç«‹éƒ¨ç½²

**ç¤ºä¾‹**ï¼šEclipse IDE

```java
// Core
public interface Extension {
    void execute(Context ctx);
}

// Plugin
public class MyPlugin implements Extension {
    @Override
    public void execute(Context ctx) {
        // Plugin logic
    }
}

// Registry
public class ExtensionRegistry {
    private Map<String, Extension> extensions = new HashMap<>();

    public void register(String id, Extension ext) {
        extensions.put(id, ext);
    }

    public void execute(String id, Context ctx) {
        extensions.get(id).execute(ctx);
    }
}
```

---

## 6 å…­è¾¹å½¢æ¶æ„ï¼ˆHexagonal Architectureï¼‰

**æ ¸å¿ƒæ€æƒ³**ï¼šç«¯å£ä¸é€‚é…å™¨

```text
        Adapter (REST)
             â†“
        Port (Interface)
             â†“
    Domain (Business Logic) â† Port â†’ Adapter (DB)
             â†‘
        Port
             â†‘
        Adapter (Message Queue)
```

**å®šä¹‰**ï¼š

```text
Port: åº”ç”¨çš„è¾¹ç•Œæ¥å£
Adapter: å¤–éƒ¨æŠ€æœ¯çš„å®ç°

ä¾èµ–æ–¹å‘ï¼š
  Adapter â†’ Port â†’ Domain
```

**ç¤ºä¾‹**ï¼š

```java
// Port (Domain)
public interface PaymentGateway {
    PaymentResult charge(Amount amount);
}

// Adapter (Infrastructure)
public class StripeAdapter implements PaymentGateway {
    private StripeClient client;

    @Override
    public PaymentResult charge(Amount amount) {
        return client.charge(amount.toStripe());
    }
}

// Domain Service
public class OrderService {
    private final PaymentGateway paymentGateway;

    public OrderService(PaymentGateway paymentGateway) {
        this.paymentGateway = paymentGateway;
    }

    public Order checkout(Cart cart) {
        PaymentResult result = paymentGateway.charge(cart.total());
        // ...
    }
}
```

---

## 7 æ´‹è‘±æ¶æ„ï¼ˆOnion Architectureï¼‰

```text
              UI
             /  \
        Infrastructure
           /      \
      Application
         /    \
       Domain
```

**ç‰¹ç‚¹**ï¼š

- ä¾èµ–å‘å†…ï¼ˆå†…å±‚ä¸ä¾èµ–å¤–å±‚ï¼‰
- Domain æ˜¯æ ¸å¿ƒï¼Œæ— ä¾èµ–
- Infrastructure åœ¨å¤–å±‚

**ä¸åˆ†å±‚æ¶æ„çš„åŒºåˆ«**ï¼š

| ç»´åº¦ | åˆ†å±‚æ¶æ„ | æ´‹è‘±æ¶æ„ |
|------|----------|----------|
| **ä¾èµ–æ–¹å‘** | å•å‘å‘ä¸‹ | å‘å†…èšåˆ |
| **æ ¸å¿ƒ** | æ•°æ®åº“ | é¢†åŸŸæ¨¡å‹ |
| **å¯æµ‹è¯•æ€§** | ä¸€èˆ¬ | é«˜ï¼ˆå†…å±‚å¯ç‹¬ç«‹æµ‹è¯•ï¼‰ |

---

## 8 å½¢å¼åŒ–éªŒè¯

### 8.1 ä¾èµ–çº¦æŸéªŒè¯

**Coq å½¢å¼åŒ–**ï¼š

```coq
Require Import Coq.Lists.List.
Import ListNotations.

(* å±‚å®šä¹‰ *)
Inductive Layer : Type :=
| Presentation : Layer
| Business : Layer
| Data : Layer.

(* ä¾èµ–å…³ç³» *)
Definition allowed_dependency (from to : Layer) : Prop :=
  match from, to with
  | Presentation, Business => True
  | Presentation, Data => True  (* å®½æ¾åˆ†å±‚ *)
  | Business, Data => True
  | _, _ => False
  end.

(* ä¾èµ–å›¾ *)
Definition DependencyGraph := list (Layer * Layer).

(* éªŒè¯å›¾æ˜¯å¦åˆæ³• *)
Fixpoint valid_graph (g : DependencyGraph) : Prop :=
  match g with
  | [] => True
  | (from, to) :: rest =>
      allowed_dependency from to /\ valid_graph rest
  end.

(* ç¤ºä¾‹ *)
Definition example_graph : DependencyGraph :=
  [(Presentation, Business); (Business, Data)].

Theorem example_valid : valid_graph example_graph.
Proof.
  unfold example_graph, valid_graph.
  split. unfold allowed_dependency. auto.
  split. unfold allowed_dependency. auto.
  auto.
Qed.
```

### 8.2 æ€§èƒ½å»ºæ¨¡

**UPPAAL å»ºæ¨¡**ï¼ˆå±‚é—´å»¶è¿Ÿï¼‰ï¼š

```text
// å±‚æ¨¡å‹
process Presentation() {
  clock c;
  state idle, calling;

  idle -> calling { c = 0 }
  calling -> idle when c >= 10 { sync Business!call }
}

process Business() {
  clock c;
  state idle, processing;

  idle -> processing { sync call? }
  processing -> idle when c >= 50 { sync Data!query }
}

process Data() {
  clock c;
  state idle, querying;

  idle -> querying { sync query? }
  querying -> idle when c >= 100 { }
}

// éªŒè¯ç«¯åˆ°ç«¯å»¶è¿Ÿ â‰¤ 200ms
A[] Presentation.idle imply c <= 200
```

---

## 9 å®é™…æ¡ˆä¾‹

### 9.1 Spring Boot ä¸‰å±‚æ¶æ„

```text
@Controller (Presentation)
    â†“
@Service (Business)
    â†“
@Repository (Data)
    â†“
Database
```

**ä¾èµ–æ³¨å…¥**ï¼š

```java
@Configuration
public class AppConfig {
    @Bean
    public DataSource dataSource() {
        return new HikariDataSource();
    }

    @Bean
    public UserRepository userRepository(DataSource ds) {
        return new JpaUserRepository(ds);
    }

    @Bean
    public UserService userService(UserRepository repo) {
        return new UserServiceImpl(repo);
    }

    @Bean
    public UserController userController(UserService svc) {
        return new UserController(svc);
    }
}
```

### 9.2 Android æ¶æ„ç»„ä»¶

```text
Activity/Fragment (UI)
    â†“
ViewModel (Presentation Logic)
    â†“
Repository (Data Abstraction)
    â†“
Data Source (Local/Remote)
```

**ç‰¹ç‚¹**ï¼š

- ViewModel ç”Ÿå‘½å‘¨æœŸç‹¬ç«‹
- Repository ç»Ÿä¸€æ•°æ®æ¥å£
- LiveData å“åº”å¼æ›´æ–°

---

## 10 å¤§å­¦è¯¾ç¨‹å¯¹åº”

| è¯¾ç¨‹ | ç›¸å…³ç« èŠ‚ |
|------|----------|
| **CMU 17-313 è½¯ä»¶å·¥ç¨‹** | åˆ†å±‚æ¶æ„ã€ä¾èµ–ç®¡ç† |
| **Stanford CS 142 Web åº”ç”¨** | ä¸‰å±‚æ¶æ„ |
| **MIT 6.033 ç³»ç»Ÿå·¥ç¨‹** | OSI æ¨¡å‹ |
| **UC Berkeley CS 169 è½¯ä»¶å·¥ç¨‹** | MVCã€MVVM |

---

## 11 æ•™æå¯¹åº”

| æ•™æ | ç›¸å…³ç« èŠ‚ |
|------|----------|
| **Pattern-Oriented Software Architecture** (POSA) | Vol 1, Ch 2 |
| **Domain-Driven Design** (Evans) | Ch 4 (Layered Architecture) |
| **Clean Architecture** (Martin) | Ch 17-22 |
| **Implementing Domain-Driven Design** (Vernon) | Ch 4 |

---

## 12 æœ¬åœ°é¡¹ç›®å¼•ç”¨

- `04.0_Architecture_Overview.md` - æ¶æ„æ¨¡å¼æ€»è§ˆ
- `../02_Design_Patterns/02.1_GoF_Formal_Analysis.md` - åˆ†å±‚ä¸­çš„è®¾è®¡æ¨¡å¼
- `../../Software_Perspective/01_Foundational_Theory/01.4_Composability_Modularity.md` - æ¨¡å—åŒ–ç†è®º

---

## 13 æ€»ç»“

### 1 æ ¸å¿ƒæ´å¯Ÿ

```text
åˆ†å±‚æ¶æ„ = å…³æ³¨ç‚¹åˆ†ç¦» + å•å‘ä¾èµ–

å…³é”®çº¦æŸï¼š
  1. å±‚é—´æ¥å£æ˜ç¡®
  2. ä¾èµ–å•å‘ï¼ˆå‘ä¸‹æˆ–å‘å†…ï¼‰
  3. æ— è·¨å±‚è°ƒç”¨

å˜ä½“ï¼š
  - ä¸¥æ ¼åˆ†å±‚ vs å®½æ¾åˆ†å±‚
  - å…­è¾¹å½¢æ¶æ„ï¼ˆç«¯å£-é€‚é…å™¨ï¼‰
  - æ´‹è‘±æ¶æ„ï¼ˆä¾èµ–å‘å†…ï¼‰
```

### 13.2 å·¥å…·é“¾æ¨è

| åœºæ™¯ | æ¨èå·¥å…· |
|------|----------|
| **ä¾èµ–éªŒè¯** | ArchUnit (Java), NDepend (.NET) |
| **å¯è§†åŒ–** | Structure101, Lattix |
| **é™æ€åˆ†æ** | jdeps, SonarQube |
| **æ€§èƒ½å»ºæ¨¡** | UPPAAL |

### 13.3 å®æˆ˜å»ºè®®

1. **èµ·æ­¥**ï¼šä»æ ‡å‡†ä¸‰å±‚å¼€å§‹
2. **è¿›é˜¶**ï¼šå¼•å…¥ DIPï¼ˆä¾èµ–å€’ç½®ï¼‰
3. **ä¼˜åŒ–**ï¼šåŠ ç¼“å­˜ã€æ‰¹é‡æ“ä½œ
4. **æ¼”è¿›**ï¼šæŒ‰éœ€è¿ç§»åˆ°å…­è¾¹å½¢/æ´‹è‘±æ¶æ„
5. **å®ˆæŠ¤**ï¼šç”¨ ArchUnit æŒç»­éªŒè¯æ¶æ„çº¦æŸ

---

## 14 é™„å½• Aï¼šåˆ†å±‚æ¶æ„ Checklist

- [ ] æ¯å±‚èŒè´£æ¸…æ™°
- [ ] ä¾èµ–æ–¹å‘å•ä¸€
- [ ] å±‚é—´æ¥å£ç¨³å®š
- [ ] æ— å¾ªç¯ä¾èµ–
- [ ] å±‚å¯ç‹¬ç«‹æµ‹è¯•
- [ ] æ€§èƒ½ç“¶é¢ˆå·²è¯†åˆ«
- [ ] æœ‰ç›‘æ§æŒ‡æ ‡ï¼ˆæ¯å±‚å»¶è¿Ÿï¼‰
- [ ] ArchUnit æµ‹è¯•é€šè¿‡

---

## 15 é™„å½• Bï¼šWikipedia æ¦‚å¿µå¯¹ç…§

| æ¦‚å¿µ | Wikipedia æ¡ç›® | æœ¬æ–‡ç« èŠ‚ |
|------|----------------|----------|
| Layered Architecture | <https://en.wikipedia.org/wiki/Multitier_architecture> | Â§1 |
| OSI Model | <https://en.wikipedia.org/wiki/OSI_model> | Â§1.1 |
| Hexagonal Architecture | <https://en.wikipedia.org/wiki/Hexagonal_architecture_(software)> | Â§6 |
| Dependency Inversion | <https://en.wikipedia.org/wiki/Dependency_inversion_principle> | Â§3.3 |

---

**ç‰ˆæœ¬**ï¼šv1.0
**æœ€åæ›´æ–°**ï¼š2025-10-29
**ç»´æŠ¤è€…**ï¼šFormalScience Project
**è®¸å¯**ï¼šCC BY-SA 4.0

---

## è·¨è§†è§’é“¾æ¥

- [Software_Perspective](../../Software_Perspective/README.md)
- [Information_Theory_Perspective](../../Information_Theory_Perspective/README.md)
- [æ¦‚å¿µäº¤å‰ç´¢å¼•ï¼ˆä¸ƒè§†è§’ç‰ˆï¼‰](../../CONCEPT_CROSS_INDEX.md) - æŸ¥çœ‹ç›¸å…³æ¦‚å¿µçš„ä¸ƒè§†è§’åˆ†æï¼š
  - [éš”ç¦»](../../CONCEPT_CROSS_INDEX.md#112-éš”ç¦»-isolation-ä¸ƒè§†è§’) - åˆ†å±‚æ¶æ„ä¸­çš„å±‚æ¬¡éš”ç¦»æœºåˆ¶
  - [è™šæ‹ŸåŒ–](../../CONCEPT_CROSS_INDEX.md#212-è™šæ‹ŸåŒ–-virtualization-ä¸ƒè§†è§’) - åˆ†å±‚æ¶æ„çš„æŠ½è±¡ä¸è™šæ‹ŸåŒ–
  - [åèº«æ€§](../../CONCEPT_CROSS_INDEX.md#31-åèº«æ€§-reflexivity-ä¸ƒè§†è§’) - åˆ†å±‚ç³»ç»Ÿåœ¨å…ƒå±‚çº§æ“ä½œè‡ªèº«çš„èƒ½åŠ›
