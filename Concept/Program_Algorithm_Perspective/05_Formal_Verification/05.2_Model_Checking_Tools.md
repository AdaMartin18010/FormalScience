# 05.2 æ¨¡å‹æ£€æµ‹å·¥å…·ï¼šmCRL2, UPPAAL, TLA+

## ğŸ“Š æ ¸å¿ƒæ¦‚å¿µæ·±åº¦åˆ†æ

<details>
<summary><b>ğŸ”ğŸ”¬ ç‚¹å‡»å±•å¼€ï¼šæ¨¡å‹æ£€æµ‹æ ¸å¿ƒæ´å¯Ÿ</b></summary>

**ç»ˆææ´å¯Ÿ**: æ¨¡å‹æ£€æµ‹=ç©·ä¸¾æœç´¢çŠ¶æ€ç©ºé—´æ‰¾bugã€‚åŸºæœ¬æ€æƒ³ï¼šâ‘ å»ºç«‹ç³»ç»Ÿçš„æœ‰é™çŠ¶æ€æ¨¡å‹â‘¡ç”¨æ—¶åºé€»è¾‘è¡¨è¾¾æ€§è´¨ï¼ˆå¦‚"æ°¸ä¸æ­»é”"ï¼‰â‘¢è‡ªåŠ¨æœç´¢æ‰€æœ‰å¯è¾¾çŠ¶æ€éªŒè¯æ€§è´¨â‘£è‹¥å¤±è´¥ç»™å‡ºåä¾‹ï¼ˆbugæ‰§è¡Œè·¯å¾„ï¼‰ã€‚ä¸‰å¤§å·¥å…·ï¼šâ‘ mCRL2ï¼ˆè¿›ç¨‹ä»£æ•°ï¼‰ï¼šç”¨ACP/CCS/Ï€-æ¼”ç®—å»ºæ¨¡å¹¶å‘ç³»ç»Ÿï¼ŒÎ¼-calculuséªŒè¯æ€§è´¨ï¼Œé€‚åˆåè®®éªŒè¯â‘¡UPPAALï¼ˆæ—¶é—´è‡ªåŠ¨æœºï¼‰ï¼šå»ºæ¨¡å®æ—¶ç³»ç»Ÿï¼Œæ—¶é’Ÿçº¦æŸ+çŠ¶æ€è¿ç§»ï¼ŒCTLæ—¶åºé€»è¾‘ï¼Œé€‚åˆåµŒå…¥å¼éªŒè¯â‘¢TLA+ï¼ˆæ—¶åºé€»è¾‘ï¼‰ï¼šLamportçš„è§„çº¦è¯­è¨€ï¼Œæè¿°åˆ†å¸ƒå¼ç®—æ³•ï¼ŒTLCæ¨¡å‹æ£€æŸ¥å™¨ï¼ŒAmazon/Microsoftå¹¿æ³›ä½¿ç”¨ã€‚æ ¸å¿ƒæŒ‘æˆ˜ï¼šçŠ¶æ€çˆ†ç‚¸ï¼ˆçŠ¶æ€æ•°éšå˜é‡æŒ‡æ•°å¢é•¿ï¼‰ã€‚åº”å¯¹æŠ€æœ¯ï¼šâ‘ ç¬¦å·æ¨¡å‹æ£€æµ‹ï¼ˆBDDï¼‰â‘¡éƒ¨åˆ†åºçº¦ç®€ï¼ˆå¹¶å‘ç­‰ä»·ç±»ï¼‰â‘¢æŠ½è±¡ç²¾åŒ–â‘£æœ‰ç•Œæ¨¡å‹æ£€æµ‹ï¼ˆBMCï¼‰ã€‚éªŒè¯æ€§è´¨ï¼šâ‘ å®‰å…¨æ€§ï¼ˆSafetyï¼‰ï¼šåäº‹æ°¸ä¸å‘ç”Ÿï¼Œå¦‚æ— æ­»é”â‘¡æ´»æ€§ï¼ˆLivenessï¼‰ï¼šå¥½äº‹æœ€ç»ˆå‘ç”Ÿï¼Œå¦‚è¯·æ±‚æœ€ç»ˆå“åº”â‘¢å…¬å¹³æ€§ï¼ˆFairnessï¼‰ï¼šæ— é¥¥é¥¿ã€‚å·¥ä¸šåº”ç”¨ï¼šIntelï¼ˆèŠ¯ç‰‡åè®®ï¼‰ã€AWSï¼ˆåˆ†å¸ƒå¼ç®—æ³•ï¼‰ã€èˆªç©ºèˆªå¤©ï¼ˆé£æ§ç³»ç»Ÿï¼‰ã€‚å…³é”®ï¼šæ¨¡å‹æ£€æµ‹æä¾›è‡ªåŠ¨åŒ–éªŒè¯+åä¾‹è°ƒè¯•ï¼Œæ˜¯å‘ç°å¹¶å‘/åˆ†å¸ƒå¼ç³»ç»Ÿbugçš„åˆ©å™¨ã€‚

</details>

---

## ğŸ“š ç›®å½•

- [æ¦‚è¿°](#æ¦‚è¿°)
- [1. æ¨¡å‹æ£€æµ‹åŸºç¡€](#1-æ¨¡å‹æ£€æµ‹åŸºç¡€)
  - [1.1 æ ¸å¿ƒæ¦‚å¿µ](#11-æ ¸å¿ƒæ¦‚å¿µ)
  - [1.2 çŠ¶æ€çˆ†ç‚¸é—®é¢˜](#12-çŠ¶æ€çˆ†ç‚¸é—®é¢˜)
- [2. mCRL2ï¼šè¿›ç¨‹ä»£æ•°å»ºæ¨¡](#2-mcrl2è¿›ç¨‹ä»£æ•°å»ºæ¨¡)
  - [2.1 ä»‹ç»](#21-ä»‹ç»)
  - [2.2 è¯­æ³•åŸºç¡€](#22-è¯­æ³•åŸºç¡€)
  - [2.3 å®æˆ˜æ¡ˆä¾‹ï¼šç”Ÿäº§è€…-æ¶ˆè´¹è€…](#23-å®æˆ˜æ¡ˆä¾‹ç”Ÿäº§è€…-æ¶ˆè´¹è€…)
  - [2.4 æ€§è´¨éªŒè¯ï¼ˆÎ¼-calculusï¼‰](#24-æ€§è´¨éªŒè¯Î¼-calculus)
  - [2.5 å®æˆ˜æ¡ˆä¾‹ï¼šäº’æ–¥åè®®ï¼ˆPetersonç®—æ³•ï¼‰](#25-å®æˆ˜æ¡ˆä¾‹äº’æ–¥åè®®petersonç®—æ³•)
- [3. UPPAALï¼šå®æ—¶ç³»ç»ŸéªŒè¯](#3-uppaalå®æ—¶ç³»ç»ŸéªŒè¯)
  - [3.1 ä»‹ç»](#31-ä»‹ç»)
  - [3.2 æ—¶é—´è‡ªåŠ¨æœºåŸºç¡€](#32-æ—¶é—´è‡ªåŠ¨æœºåŸºç¡€)
  - [3.3 UPPAAL å»ºæ¨¡è¯­è¨€](#33-uppaal-å»ºæ¨¡è¯­è¨€)
  - [3.4 å®æˆ˜æ¡ˆä¾‹ï¼šç«è½¦è¿‡è½¨é“å£](#34-å®æˆ˜æ¡ˆä¾‹ç«è½¦è¿‡è½¨é“å£)
  - [3.5 åä¾‹åˆ†æ](#35-åä¾‹åˆ†æ)
  - [3.6 å®æˆ˜æ¡ˆä¾‹ï¼šFischer äº’æ–¥åè®®](#36-å®æˆ˜æ¡ˆä¾‹fischer-äº’æ–¥åè®®)
- [4. TLA+ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿè§„çº¦](#4-tlaåˆ†å¸ƒå¼ç³»ç»Ÿè§„çº¦)
  - [4.1 ä»‹ç»](#41-ä»‹ç»)
  - [4.2 TLA+ è¯­æ³•åŸºç¡€](#42-tla-è¯­æ³•åŸºç¡€)
  - [4.3 å®æˆ˜æ¡ˆä¾‹ï¼šä¸¤é˜¶æ®µæäº¤ï¼ˆ2PCï¼‰](#43-å®æˆ˜æ¡ˆä¾‹ä¸¤é˜¶æ®µæäº¤2pc)
  - [4.4 PlusCalï¼šç®—æ³•è¯­è¨€](#44-pluscalç®—æ³•è¯­è¨€)
- [5. å·¥å…·å¯¹æ¯”ä¸é€‰æ‹©](#5-å·¥å…·å¯¹æ¯”ä¸é€‰æ‹©)
- [7. å·¥ä¸šåº”ç”¨æ¡ˆä¾‹](#7-å·¥ä¸šåº”ç”¨æ¡ˆä¾‹)
- [8. æ‰©å±•é˜…è¯»](#8-æ‰©å±•é˜…è¯»)

---

## æ¦‚è¿°

**æ¨¡å‹æ£€æµ‹**ï¼ˆModel Checkingï¼‰æ˜¯ä¸€ç§è‡ªåŠ¨åŒ–éªŒè¯æŠ€æœ¯ï¼Œé€šè¿‡**ç©·ä¸¾æœç´¢**çŠ¶æ€ç©ºé—´æ¥éªŒè¯ç³»ç»Ÿæ€§è´¨ã€‚ä¸å®šç†è¯æ˜ä¸åŒï¼š

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              â”‚ æ¨¡å‹æ£€æµ‹         â”‚ å®šç†è¯æ˜        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è‡ªåŠ¨åŒ–ç¨‹åº¦    â”‚ å®Œå…¨è‡ªåŠ¨         â”‚ éœ€äººå·¥å¼•å¯¼      â”‚
â”‚ éªŒè¯èŒƒå›´      â”‚ æœ‰é™çŠ¶æ€         â”‚ æ— é™çŠ¶æ€        â”‚
â”‚ åä¾‹          â”‚ è‡ªåŠ¨ç”Ÿæˆ         â”‚ æ—              â”‚
â”‚ å­¦ä¹ æ›²çº¿      â”‚ å¹³ç¼“            â”‚ é™¡å³­             â”‚
â”‚ é€‚ç”¨åœºæ™¯      â”‚ åè®®ã€å¹¶å‘       â”‚ ç®—æ³•ã€æ•°æ®ç»“æ„   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

æœ¬æ–‡ä»‹ç»ä¸‰æ¬¾ä¸šç•Œä¸»æµå·¥å…·ï¼š

1. **mCRL2**ï¼šè¿›ç¨‹ä»£æ•°ï¼ˆProcess Algebraï¼‰å»ºæ¨¡
2. **UPPAAL**ï¼šå®æ—¶ç³»ç»Ÿï¼ˆTimed Automataï¼‰éªŒè¯
3. **TLA+**ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿï¼ˆTemporal Logicï¼‰è§„çº¦

---

## 1. æ¨¡å‹æ£€æµ‹åŸºç¡€

### 1.1 æ ¸å¿ƒæ¦‚å¿µ

**çŠ¶æ€ç©ºé—´ï¼ˆState Spaceï¼‰**ï¼š

```text
ç³»ç»Ÿ = âŸ¨S, sâ‚€, â†’, LâŸ©

S  : çŠ¶æ€é›†åˆ
sâ‚€ : åˆå§‹çŠ¶æ€
â†’  : è½¬ç§»å…³ç³»ï¼ˆS Ã— Sï¼‰
L  : æ ‡ç­¾å‡½æ•°ï¼ˆS â†’ 2^APï¼ŒAP ä¸ºåŸå­å‘½é¢˜ï¼‰
```

**æ—¶æ€é€»è¾‘ï¼ˆTemporal Logicï¼‰**ï¼š

```text
LTLï¼ˆLinear Temporal Logicï¼‰ï¼š
  Ï† ::= p | Â¬Ï† | Ï† âˆ§ Ï† | X Ï† | F Ï† | G Ï† | Ï† U Ï†
  
  X Ï† : ä¸‹ä¸€æ­¥ Ï† æˆç«‹ï¼ˆneXtï¼‰
  F Ï† : å°†æ¥æŸæ—¶åˆ» Ï† æˆç«‹ï¼ˆFutureï¼‰
  G Ï† : æ€»æ˜¯ Ï† æˆç«‹ï¼ˆGloballyï¼‰
  Ï† U Ïˆ : Ï† ä¸€ç›´æˆç«‹ç›´åˆ° Ïˆ æˆç«‹ï¼ˆUntilï¼‰

CTLï¼ˆComputation Tree Logicï¼‰ï¼š
  Ï† ::= p | Â¬Ï† | Ï† âˆ§ Ï† | AX Ï† | EX Ï† | AF Ï† | EF Ï† | ...
  
  A : æ‰€æœ‰è·¯å¾„ï¼ˆAll pathsï¼‰
  E : å­˜åœ¨è·¯å¾„ï¼ˆExists a pathï¼‰
```

**æ¨¡å‹æ£€æµ‹ç®—æ³•**ï¼š

```text
1. æ˜¾å¼çŠ¶æ€ï¼ˆExplicit Stateï¼‰ï¼š
   - DFS/BFS éå†çŠ¶æ€ç©ºé—´
   - é€‚åˆå°è§„æ¨¡ç³»ç»Ÿ

2. ç¬¦å·æ¨¡å‹æ£€æµ‹ï¼ˆSymbolicï¼‰ï¼š
   - ä½¿ç”¨ BDDï¼ˆBinary Decision Diagramï¼‰è¡¨ç¤ºçŠ¶æ€é›†åˆ
   - å¯å¤„ç† 10^20 ä¸ªçŠ¶æ€

3. æœ‰ç•Œæ¨¡å‹æ£€æµ‹ï¼ˆBoundedï¼‰ï¼š
   - é™åˆ¶è·¯å¾„é•¿åº¦ k
   - è½¬åŒ–ä¸º SAT é—®é¢˜
   - å¿«é€Ÿæ‰¾åˆ°çŸ­åä¾‹
```

### 1.2 çŠ¶æ€çˆ†ç‚¸é—®é¢˜

**æŒ‘æˆ˜**ï¼š

```text
ç¤ºä¾‹ï¼šn ä¸ªè¿›ç¨‹ï¼Œæ¯ä¸ªè¿›ç¨‹æœ‰ m ä¸ªçŠ¶æ€

çŠ¶æ€ç©ºé—´å¤§å° = m^n

n=10, m=10 â‡’ 10^10 ä¸ªçŠ¶æ€ï¼ˆ100äº¿ï¼‰
n=20, m=10 â‡’ 10^20 ä¸ªçŠ¶æ€ï¼ˆä¸å¯è¡Œï¼‰
```

**ç¼“è§£æŠ€æœ¯**ï¼š

```text
1. ååºå½’çº¦ï¼ˆPartial Order Reductionï¼‰ï¼š
   - åˆ©ç”¨ç‹¬ç«‹åŠ¨ä½œçš„äº¤æ¢æ€§
   - åªæ¢ç´¢ä»£è¡¨æ€§äº¤é”™ï¼ˆinterleavingï¼‰

2. æŠ½è±¡ï¼ˆAbstractionï¼‰ï¼š
   - å¿½ç•¥ä¸ç›¸å…³ç»†èŠ‚
   - ä¿æŒå…³é”®æ€§è´¨

3. ç»„åˆå¼ï¼ˆCompositionalï¼‰ï¼š
   - åˆ†åˆ«éªŒè¯å„ç»„ä»¶
   - å‡è®¾-ä¿è¯ï¼ˆAssume-Guaranteeï¼‰

4. å¯¹ç§°æ€§å½’çº¦ï¼ˆSymmetry Reductionï¼‰ï¼š
   - åˆ©ç”¨ç³»ç»Ÿå¯¹ç§°æ€§
   - åˆå¹¶å¯¹ç§°çŠ¶æ€
```

---

## 2. mCRL2ï¼šè¿›ç¨‹ä»£æ•°å»ºæ¨¡

### 2.1 ä»‹ç»

```text
mCRL2 = micro Common Representation Language 2

æ ¸å¿ƒç‰¹æ€§ï¼š
  - åŸºäº ACPï¼ˆAlgebra of Communicating Processesï¼‰
  - æ”¯æŒæ•°æ®ç±»å‹å’Œå‚æ•°åŒ–è¿›ç¨‹
  - å¼ºå¤§çš„å¯è§†åŒ–å·¥å…·
  - Î¼-calculus æ€§è´¨éªŒè¯
```

### 2.2 è¯­æ³•åŸºç¡€

#### è¿›ç¨‹å®šä¹‰

```mcrl2
% ç®€å•çš„äº¤é€šä¿¡å·ç¯
act
  red, yellow, green;  % åŠ¨ä½œå£°æ˜

proc
  TrafficLight = red . yellow . green . TrafficLight;

init
  TrafficLight;
```

#### æ•°æ®ç±»å‹

```mcrl2
sort
  Color = struct Red | Yellow | Green;
  
map
  next: Color -> Color;

eqn
  next(Red) = Yellow;
  next(Yellow) = Green;
  next(Green) = Red;

proc
  Light(c: Color) = signal(c) . Light(next(c));

init
  Light(Red);
```

#### å¹¶è¡Œç»„åˆ

```mcrl2
act
  send, receive, comm;  % åŠ¨ä½œ

proc
  Sender = send . Sender;
  Receiver = receive . Receiver;

init
  allow({comm},
    comm({send, receive},
      Sender || Receiver
    )
  );
```

### 2.3 å®æˆ˜æ¡ˆä¾‹ï¼šç”Ÿäº§è€…-æ¶ˆè´¹è€…

```mcrl2
% æœ‰ç•Œç¼“å†²åŒºçš„ç”Ÿäº§è€…-æ¶ˆè´¹è€…

sort
  Buffer = List(Nat);

act
  produce, consume: Nat;
  put, get: Nat;

proc
  Producer(n: Nat) =
    produce(n) . put(n) . Producer(n+1);
  
  Consumer =
    sum m: Nat . get(m) . consume(m) . Consumer;
  
  Buffer(buf: Buffer, capacity: Nat) =
    (#buf < capacity) ->
      sum x: Nat . put(x) . Buffer(x |> buf, capacity)
    +
    (#buf > 0) ->
      get(head(buf)) . Buffer(tail(buf), capacity);

init
  allow({produce, consume},
    comm({put|get -> tau},
      Producer(0) || Buffer([], 5) || Consumer
    )
  );
```

**ç”ŸæˆçŠ¶æ€ç©ºé—´**ï¼š

```bash
mcrl22lps producer_consumer.mcrl2 producer_consumer.lps
lps2lts producer_consumer.lps producer_consumer.lts

# å¯è§†åŒ–
ltsgraph producer_consumer.lts
```

### 2.4 æ€§è´¨éªŒè¯ï¼ˆÎ¼-calculusï¼‰

```mcrl2
% æ£€æŸ¥ï¼šç”Ÿäº§è€…æ€»èƒ½æœ€ç»ˆæ”¾å…¥æ•°æ®
[true*] <produce(0)> true

% æ£€æŸ¥ï¼šæ°¸è¿œä¸ä¼šæ­»é”
[true*] <true> true

% æ£€æŸ¥ï¼šç¼“å†²åŒºæ°¸ä¸æº¢å‡º
[true*.put(x)]
  val(#buffer < capacity)
```

**ä½¿ç”¨å·¥å…·**ï¼š

```bash
lps2pbes -f property.mcf producer_consumer.lps | pbes2bool
# è¾“å‡ºï¼štrue æˆ– falseï¼Œè‹¥ false åˆ™æä¾›åä¾‹
```

### 2.5 å®æˆ˜æ¡ˆä¾‹ï¼šäº’æ–¥åè®®ï¼ˆPetersonç®—æ³•ï¼‰

```mcrl2
sort
  ProcessID = struct P1 | P2;

act
  enter, exit: ProcessID;
  set_flag, set_turn: ProcessID;

proc
  Process(id: ProcessID, other: ProcessID) =
    % è¿›å…¥ä¸´ç•ŒåŒºåè®®
    set_flag(id) .
    set_turn(other) .
    wait_until(not flag[other] or turn == id) .
    enter(id) .
    % ä¸´ç•ŒåŒº
    exit(id) .
    % ç¦»å¼€
    clear_flag(id) .
    Process(id, other);

init
  Process(P1, P2) || Process(P2, P1);
```

**éªŒè¯æ€§è´¨**ï¼š

```mcrl2
% äº’æ–¥æ€§ï¼šä¸¤ä¸ªè¿›ç¨‹ä¸èƒ½åŒæ—¶åœ¨ä¸´ç•ŒåŒº
[true*] forall p, q: ProcessID .
  (p != q) => !(val(in_cs[p]) && val(in_cs[q]))

% æ— é¥¥é¥¿ï¼šæ¯ä¸ªè¯·æ±‚æœ€ç»ˆè¢«æ»¡è¶³
[true*] [set_flag(p)] mu X . (<true> true && [!enter(p)] X)
```

---

## 3. UPPAALï¼šå®æ—¶ç³»ç»ŸéªŒè¯

### 3.1 ä»‹ç»

```text
UPPAAL = Uppsala + Aalborg

æ ¸å¿ƒç‰¹æ€§ï¼š
  - æ—¶é—´è‡ªåŠ¨æœºï¼ˆTimed Automataï¼‰ç½‘ç»œ
  - æ—¶é’Ÿçº¦æŸï¼ˆClock Constraintsï¼‰
  - å›¾å½¢åŒ–å»ºæ¨¡ç•Œé¢
  - CTL æ€§è´¨éªŒè¯
  - åä¾‹åŠ¨ç”»æ¼”ç¤º
```

### 3.2 æ—¶é—´è‡ªåŠ¨æœºåŸºç¡€

**å®šä¹‰**ï¼š

```text
æ—¶é—´è‡ªåŠ¨æœº = âŸ¨L, lâ‚€, C, A, E, IâŸ©

L  : ä½ç½®é›†åˆ
lâ‚€ : åˆå§‹ä½ç½®
C  : æ—¶é’Ÿé›†åˆ
A  : åŠ¨ä½œé›†åˆ
E  : è¾¹ï¼ˆè½¬ç§»ï¼‰ï¼šl â†’^(g,a,r) l'
    g : å®ˆå«ï¼ˆclock constraintsï¼‰
    a : åŠ¨ä½œ
    r : æ—¶é’Ÿé‡ç½®
I  : ä¸å˜å¼ï¼ˆæ¯ä¸ªä½ç½®çš„æ—¶é’Ÿçº¦æŸï¼‰
```

**ç¤ºä¾‹**ï¼šç®€å•å®šæ—¶å™¨

```text
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”  x := 0  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
Startâ”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚ Running  â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚ x â‰¤ 10   â”‚
                         â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                          xâ‰¥10 â”‚
                         â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
                         â”‚ Timeout  â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 UPPAAL å»ºæ¨¡è¯­è¨€

#### å…¨å±€å£°æ˜

```c
// æ—¶é’Ÿ
clock x, y;

// æ•´æ•°å˜é‡
int[0,10] counter;

// é€šé“ï¼ˆåŒæ­¥ï¼‰
chan start, stop;
urgent chan error;  // ç«‹å³åŒæ­¥
```

#### ä½ç½®ä¸è½¬ç§»

```text
ä½ç½® L0:
  ä¸å˜å¼ï¼šx <= 5
  
è½¬ç§» L0 -> L1:
  å®ˆå«ï¼šx >= 2 && counter > 0
  åŒæ­¥ï¼šstart!  ï¼ˆå‘é€ï¼‰
  æ›´æ–°ï¼šcounter--, x := 0
```

### 3.4 å®æˆ˜æ¡ˆä¾‹ï¼šç«è½¦è¿‡è½¨é“å£

**é—®é¢˜**ï¼šç«è½¦ä¸è½¨é“å£çš„å®‰å…¨æ§åˆ¶

**æ¨¡å‹**ï¼š

```text
// Train è‡ªåŠ¨æœº
location Approaching {
  invariant x <= 5
}

location Crossing {
  invariant x <= 10
}

transition Approaching -> Crossing {
  guard x >= 3
  sync appr!
  update x := 0
}

transition Crossing -> Safe {
  guard x >= 7
  sync leave!
}

// Gate è‡ªåŠ¨æœº
location Up {
}

location Lowering {
  invariant y <= 2
}

location Down {
  invariant y <= 20
}

transition Up -> Lowering {
  sync appr?
  update y := 0
}

transition Lowering -> Down {
  guard y >= 2
}

transition Down -> Up {
  sync leave?
}
```

**æ€§è´¨éªŒè¯**ï¼š

```c
// å®‰å…¨æ€§ï¼šç«è½¦åœ¨è½¨é“å£æ—¶ï¼Œé—¨å¿…é¡»æ˜¯å…³é—­çš„
A[] (Train.Crossing imply Gate.Down)

// æ´»æ€§ï¼šç«è½¦æœ€ç»ˆä¼šé€šè¿‡
Train.Approaching --> Train.Safe

// æœ‰ç•Œæ€§ï¼šé—¨å…³é—­æ—¶é—´ä¸è¶…è¿‡ 25 ç§’
A[] (Gate.Lowering imply y <= 25)
```

**è¿è¡Œ**ï¼š

```bash
verifyta -t1 train_gate.xml
# è¾“å‡ºï¼šProperty is satisfied æˆ– æä¾›åä¾‹è½¨è¿¹
```

### 3.5 åä¾‹åˆ†æ

**åä¾‹è½¨è¿¹ç¤ºä¾‹**ï¼š

```text
State 0: Train.Approaching, Gate.Up, x=0, y=0
  --[delay 3.5]-->
State 1: Train.Approaching, Gate.Up, x=3.5, y=0
  --[appr!]-->
State 2: Train.Crossing, Gate.Lowering, x=0, y=0
  --[delay 1.5]-->  âŒ ç«è½¦å·²è¿›å…¥è½¨é“å£ï¼Œä½†é—¨å°šæœªå…³é—­ï¼
State 3: Train.Crossing, Gate.Lowering, x=1.5, y=1.5

ä¿®æ­£ï¼šå¢åŠ ç«è½¦ç­‰å¾…æ—¶é—´æˆ–åŠ å¿«é—¨å…³é—­é€Ÿåº¦
```

### 3.6 å®æˆ˜æ¡ˆä¾‹ï¼šFischer äº’æ–¥åè®®

```c
// å…¨å±€å˜é‡
int id;  // å…±äº« ID

// Process æ¨¡æ¿
process Process(const int pid) {
  clock x;
  
  location Idle {}
  
  location Req {
    invariant x <= k
  }
  
  location Wait {
    invariant x <= k
  }
  
  location CS {}
  
  // Idle -> Req
  transition {
    select Idle to Req
    guard id == 0
    update x := 0
  }
  
  // Req -> Wait
  transition {
    select Req to Wait
    guard x <= k
    update id := pid, x := 0
  }
  
  // Wait -> CS
  transition {
    select Wait to CS
    guard x >= k && id == pid
  }
  
  // CS -> Idle
  transition {
    select CS to Idle
    update id := 0
  }
}

// å®ä¾‹åŒ–
system Process1 = Process(1);
system Process2 = Process(2);
```

**éªŒè¯äº’æ–¥æ€§**ï¼š

```c
A[] not (Process1.CS and Process2.CS)

// å‚æ•°åŒ–éªŒè¯ï¼šæ‰¾åˆ°åˆé€‚çš„ k å€¼
// k = 0: è¿åäº’æ–¥
// k â‰¥ æŸä¸ªé˜ˆå€¼: æ»¡è¶³äº’æ–¥
```

---

## 4. TLA+ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿè§„çº¦

### 4.1 ä»‹ç»

```text
TLA+ = Temporal Logic of Actions +

æ ¸å¿ƒç‰¹æ€§ï¼š
  - æ•°å­¦ä¸¥æ ¼ï¼ˆåŸºäº ZF é›†åˆè®ºï¼‰
  - é€‚åˆé«˜å±‚è§„çº¦ï¼ˆä¸å…³å¿ƒå®ç°ç»†èŠ‚ï¼‰
  - TLC æ¨¡å‹æ£€æµ‹å™¨
  - PlusCal ç®—æ³•è¯­è¨€ï¼ˆå¯è½¬æ¢ä¸º TLA+ï¼‰
```

### 4.2 TLA+ è¯­æ³•åŸºç¡€

#### å¸¸é‡ä¸å˜é‡

```tla
CONSTANTS N, Data

VARIABLES x, y, pc
```

#### åˆå§‹çŠ¶æ€ä¸è½¬ç§»

```tla
Init == 
  /\ x = 0
  /\ y = 0
  /\ pc = "idle"

Next ==
  \/ Increment  \* é€‰æ‹©åˆ†æ”¯
  \/ Decrement

Increment ==
  /\ pc = "idle"
  /\ x' = x + 1  \* x çš„ä¸‹ä¸€ä¸ªçŠ¶æ€
  /\ y' = y
  /\ pc' = "inc"

Decrement ==
  /\ pc = "idle"
  /\ x' = x - 1
  /\ x' = y
  /\ pc' = "dec"

Spec == Init /\ [][Next]_<<x, y, pc>>
```

#### ä¸å˜å¼

```tla
TypeInvariant ==
  /\ x \in Int
  /\ y \in Int
  /\ pc \in {"idle", "inc", "dec"}

SafetyProperty ==
  pc = "inc" => x > 0
```

### 4.3 å®æˆ˜æ¡ˆä¾‹ï¼šä¸¤é˜¶æ®µæäº¤ï¼ˆ2PCï¼‰

```tla
---- MODULE TwoPhaseCommit ----
EXTENDS Integers, FiniteSets

CONSTANTS RM  \* èµ„æºç®¡ç†å™¨é›†åˆ

VARIABLES
  rmState,     \* RM -> {"working", "prepared", "committed", "aborted"}
  tmState,     \* TM çŠ¶æ€
  tmPrepared,  \* å·²å‡†å¤‡çš„ RM é›†åˆ
  msgs         \* æ¶ˆæ¯é›†åˆ

Messages ==
  [type : {"Prepare"}, rm : RM] \cup
  [type : {"Prepared", "Aborted"}, rm : RM] \cup
  [type : {"Commit", "Abort"}]

Init ==
  /\ rmState = [rm \in RM |-> "working"]
  /\ tmState = "init"
  /\ tmPrepared = {}
  /\ msgs = {}

\* RM å‘é€ Prepared æ¶ˆæ¯
RMPrepare(rm) ==
  /\ rmState[rm] = "working"
  /\ rmState' = [rmState EXCEPT ![rm] = "prepared"]
  /\ msgs' = msgs \cup {[type |-> "Prepared", rm |-> rm]}
  /\ UNCHANGED <<tmState, tmPrepared>>

\* RM é€‰æ‹©ä¸­æ­¢
RMChooseToAbort(rm) ==
  /\ rmState[rm] = "working"
  /\ rmState' = [rmState EXCEPT ![rm] = "aborted"]
  /\ msgs' = msgs \cup {[type |-> "Aborted", rm |-> rm]}
  /\ UNCHANGED <<tmState, tmPrepared>>

\* TM æ”¶é›† Prepared æ¶ˆæ¯
TMRcvPrepared(rm) ==
  /\ tmState = "init"
  /\ [type |-> "Prepared", rm |-> rm] \in msgs
  /\ tmPrepared' = tmPrepared \cup {rm}
  /\ UNCHANGED <<rmState, tmState, msgs>>

\* TM å†³å®šæäº¤
TMCommit ==
  /\ tmState = "init"
  /\ tmPrepared = RM  \* æ‰€æœ‰ RM éƒ½å‡†å¤‡å¥½
  /\ tmState' = "commit"
  /\ msgs' = msgs \cup {[type |-> "Commit"]}
  /\ UNCHANGED <<rmState, tmPrepared>>

\* TM å†³å®šä¸­æ­¢
TMAbort ==
  /\ tmState = "init"
  /\ tmState' = "abort"
  /\ msgs' = msgs \cup {[type |-> "Abort"]}
  /\ UNCHANGED <<rmState, tmPrepared>>

\* RM æ”¶åˆ° Commit æ¶ˆæ¯
RMRcvCommitMsg(rm) ==
  /\ [type |-> "Commit"] \in msgs
  /\ rmState' = [rmState EXCEPT ![rm] = "committed"]
  /\ UNCHANGED <<tmState, tmPrepared, msgs>>

\* RM æ”¶åˆ° Abort æ¶ˆæ¯
RMRcvAbortMsg(rm) ==
  /\ [type |-> "Abort"] \in msgs
  /\ rmState' = [rmState EXCEPT ![rm] = "aborted"]
  /\ UNCHANGED <<tmState, tmPrepared, msgs>>

Next ==
  \/ \E rm \in RM :
       \/ RMPrepare(rm)
       \/ RMChooseToAbort(rm)
       \/ TMRcvPrepared(rm)
       \/ RMRcvCommitMsg(rm)
       \/ RMRcvAbortMsg(rm)
  \/ TMCommit
  \/ TMAbort

Spec == Init /\ [][Next]_<<rmState, tmState, tmPrepared, msgs>>

\* ä¸å˜å¼ï¼šåŸå­æäº¤æ€§
Consistency ==
  \A rm1, rm2 \in RM :
    (rmState[rm1] = "committed" /\ rmState[rm2] = "aborted") => FALSE

====
```

**è¿è¡Œ TLC**ï¼š

```bash
# é…ç½®æ–‡ä»¶ TwoPhaseCommit.cfg
CONSTANTS RM = {rm1, rm2, rm3}
INVARIANT Consistency

# è¿è¡Œ
java -jar tla2tools.jar -workers 4 TwoPhaseCommit.tla
```

### 4.4 PlusCalï¼šç®—æ³•è¯­è¨€

**ç¤ºä¾‹**ï¼šEuclid GCD

```tla
---- MODULE GCD ----
EXTENDS Integers

(*--algorithm gcd
variables x = 24, y = 18;

begin
  while x /= y do
    if x > y then
      x := x - y;
    else
      y := y - x;
    end if;
  end while;
  print x;  \* è¾“å‡º GCD
end algorithm; *)

\* TLA+ ç¿»è¯‘ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
...
```

---

## 5. å·¥å…·å¯¹æ¯”ä¸é€‰æ‹©

### 5.1 ç‰¹æ€§å¯¹æ¯”

| ç‰¹æ€§ | mCRL2 | UPPAAL | TLA+ |
|------|-------|--------|------|
| **å»ºæ¨¡èŒƒå¼** | è¿›ç¨‹ä»£æ•° | æ—¶é—´è‡ªåŠ¨æœº | çŠ¶æ€æœº + åŠ¨ä½œ |
| **æ—¶é—´å»ºæ¨¡** | âŒ | âœ…ï¼ˆå®æ—¶ï¼‰ | âš ï¸ï¼ˆé€»è¾‘æ—¶é—´ï¼‰ |
| **æ•°æ®ç±»å‹** | âœ…ï¼ˆä¸°å¯Œï¼‰ | âš ï¸ï¼ˆæœ‰é™ï¼‰ | âœ…ï¼ˆé›†åˆè®ºï¼‰ |
| **å¯è§†åŒ–** | âœ…ï¼ˆLTSå›¾ï¼‰ | âœ…ï¼ˆè‡ªåŠ¨æœºå›¾ï¼‰ | âŒ |
| **åä¾‹** | âœ…ï¼ˆè½¨è¿¹ï¼‰ | âœ…ï¼ˆåŠ¨ç”»ï¼‰ | âœ…ï¼ˆçŠ¶æ€åºåˆ—ï¼‰ |
| **å­¦ä¹ æ›²çº¿** | ä¸­ç­‰ | å¹³ç¼“ | é™¡å³­ |
| **å·¥ä¸šåº”ç”¨** | é€šä¿¡åè®® | åµŒå…¥å¼ç³»ç»Ÿ | åˆ†å¸ƒå¼ç³»ç»Ÿ |

### 5.2 é€‰æ‹©æŒ‡å—

```text
é€‰æ‹© mCRL2 å¦‚æœï¼š
  - ç³»ç»Ÿä»¥æ¶ˆæ¯ä¼ é€’ä¸ºä¸»ï¼ˆCSP/ACP é£æ ¼ï¼‰
  - éœ€è¦ä¸°å¯Œçš„æ•°æ®ç±»å‹
  - éœ€è¦å¯è§†åŒ–çŠ¶æ€ç©ºé—´

é€‰æ‹© UPPAAL å¦‚æœï¼š
  - ç³»ç»Ÿæœ‰å®æ—¶çº¦æŸï¼ˆæ—¶é’Ÿã€å®šæ—¶å™¨ï¼‰
  - éœ€è¦å›¾å½¢åŒ–å»ºæ¨¡
  - éœ€è¦æ•™å­¦æˆ–æ¼”ç¤º

é€‰æ‹© TLA+ å¦‚æœï¼š
  - ç³»ç»Ÿæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿ
  - éœ€è¦é«˜å±‚è§„çº¦ï¼ˆä¸å…³å¿ƒå®ç°ç»†èŠ‚ï¼‰
  - å›¢é˜Ÿæœ‰æ•°å­¦èƒŒæ™¯
```

---

## 6. ä¸å›½é™…è¯¾ç¨‹å¯¹æ ‡

### 6.1 å¤§å­¦è¯¾ç¨‹æ˜ å°„

| è¯¾ç¨‹ | ç›¸å…³ç« èŠ‚ |
|------|---------|
| **MIT 6.826 è®¡ç®—æœºç³»ç»ŸåŸç†** | TLA+ è§„çº¦ |
| **CMU 15-414 è½¯ä»¶å·¥ç¨‹** | mCRL2 è¿›ç¨‹éªŒè¯ |
| **UC Berkeley CS294-126 å½¢å¼åŒ–æ–¹æ³•** | UPPAAL å®æ—¶ç³»ç»Ÿ |
| **ETH ZÃ¼rich å½¢å¼åŒ–æ–¹æ³•** | æ¨¡å‹æ£€æµ‹ç†è®º |

### 6.2 æ•™æå¯¹åº”

| æ•™æ | ç›¸å…³ç« èŠ‚ |
|------|---------|
| **Baier & Katoen "Principles of Model Checking"** | å®Œæ•´æ•™æ |
| **Clarke et al. "Model Checking"** | æ¨¡å‹æ£€æµ‹ç®—æ³• |
| **Lamport "Specifying Systems"** | TLA+ å®Œæ•´æŒ‡å— |
| **Alur & Dill "Theory of Timed Automata"** | UPPAAL ç†è®ºåŸºç¡€ |

---

## 7. å·¥ä¸šåº”ç”¨æ¡ˆä¾‹

### 7.1 Amazon Web Servicesï¼ˆTLA+ï¼‰

**åº”ç”¨**ï¼šS3, DynamoDB, EBS ç­‰æœåŠ¡çš„è§„çº¦

**å‘ç°çš„Bug**ï¼š

```text
1. S3 å¤åˆ¶åè®®ä¸­çš„ç«æ€æ¡ä»¶
2. DynamoDB çš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜
3. EBS çš„å·å¿«ç…§bug

å¼•ç”¨ï¼šhttp://lamport.azurewebsites.net/tla/amazon.html
```

### 7.2 æ¬§æ´²ç«è½¦æ§åˆ¶ç³»ç»Ÿï¼ˆUPPAALï¼‰

**åº”ç”¨**ï¼šERTMS/ETCS Level 2 åè®®éªŒè¯

**è§„æ¨¡**ï¼š

```text
- 50+ æ—¶é—´è‡ªåŠ¨æœº
- 100+ æ—¶é’Ÿ
- 10^8 çŠ¶æ€ç©ºé—´
- å‘ç° 12 ä¸ªè®¾è®¡ç¼ºé™·
```

### 7.3 é€šä¿¡åè®®ï¼ˆmCRL2ï¼‰

**åº”ç”¨**ï¼šIEEE 1394 FireWire åè®®éªŒè¯

**ç»“æœ**ï¼š

```text
- å‘ç°æ ‘æ ‡è¯†åè®®çš„æ­»é”
- æä¾›ä¿®æ­£å»ºè®®
- è®ºæ–‡ï¼šhttps://link.springer.com/chapter/10.1007/3-540-48153-2_34
```

---

## 8. æ‰©å±•é˜…è¯»

### 8.1 å­¦æœ¯è®ºæ–‡

1. **mCRL2**: Groote & Mousavi. "Modeling and Analysis of Communicating Systems." 2014.
2. **UPPAAL**: Bengtsson & Yi. "Timed Automata: Semantics, Algorithms and Tools." 2004.
3. **TLA+**: Lamport, L. "The Temporal Logic of Actions." ACM TOPLAS 1994.

### 8.2 åœ¨çº¿èµ„æº

- **mCRL2**: <https://mcrl2.org/>
- **UPPAAL**: <https://uppaal.org/>
- **TLA+**: <https://lamport.azurewebsites.net/tla/tla.html>

### 8.3 æœ¬åœ°é¡¹ç›®å¼•ç”¨

- **Coq å…¥é—¨**ï¼š[./05.1_Coq_Introduction.md](./05.1_Coq_Introduction.md)
- **è®¾è®¡æ¨¡å¼éªŒè¯**ï¼š[../02_Design_Patterns/02.1_GoF_Formal_Analysis.md](../02_Design_Patterns/02.1_GoF_Formal_Analysis.md)
- **å¹¶å‘æ¨¡å‹**ï¼š[../../FormalLanguage_Perspective/05_Computational_Models/](../../FormalLanguage_Perspective/05_Computational_Models/)

---

## é™„å½• Aï¼šWikipedia æ¦‚å¿µå¯¹ç…§

| æ¦‚å¿µ | Wikipedia æ¡ç›® | æœ¬æ–‡ç« èŠ‚ |
|------|---------------|----------|
| Model Checking | <https://en.wikipedia.org/wiki/Model_checking> | Â§1 |
| Temporal Logic | <https://en.wikipedia.org/wiki/Temporal_logic> | Â§1.1 |
| Process Algebra | <https://en.wikipedia.org/wiki/Process_calculus> | Â§2 |
| Timed Automata | <https://en.wikipedia.org/wiki/Timed_automaton> | Â§3 |
| TLA+ | <https://en.wikipedia.org/wiki/TLA%2B> | Â§4 |

---

## é™„å½• Bï¼šå·¥å…·å®‰è£…æŒ‡å—

### mCRL2

```bash
# macOS
brew install mcrl2

# Ubuntu
sudo apt-add-repository ppa:mcrl2/release-ppa
sudo apt install mcrl2

# éªŒè¯
mcrl22lps --version
```

### UPPAAL

```bash
# ä¸‹è½½ï¼ˆæ‰€æœ‰å¹³å°ï¼‰
wget https://people.cs.aau.dk/~marius/uppaal/uppaal64-4.1.26.zip
unzip uppaal64-4.1.26.zip

# è¿è¡Œ
cd uppaal64-4.1.26
./uppaal
```

### TLA+

```bash
# ä¸‹è½½ TLA+ Toolbox
wget https://github.com/tlaplus/tlaplus/releases/download/v1.7.1/TLAToolbox-1.7.1-linux.gtk.x86_64.zip

# æˆ–ä½¿ç”¨å‘½ä»¤è¡Œ TLC
java -jar tla2tools.jar -help
```

---

**ç‰ˆæœ¬**ï¼šv1.0  
**æœ€åæ›´æ–°**ï¼š2025-10-29  
**ç»´æŠ¤è€…**ï¼šFormalScience Project  
**è®¸å¯**ï¼šMIT
