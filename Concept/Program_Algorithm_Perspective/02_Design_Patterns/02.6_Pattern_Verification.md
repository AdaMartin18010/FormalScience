# è®¾è®¡æ¨¡å¼éªŒè¯å·¥å…·é“¾

## 1 ğŸ“Š æ ¸å¿ƒæ¦‚å¿µæ·±åº¦åˆ†æ

<details>
<summary><b>ğŸ”ğŸ”¬ ç‚¹å‡»å±•å¼€ï¼šæ¨¡å¼éªŒè¯æ ¸å¿ƒæ´å¯Ÿ</b></summary>

**ç»ˆææ´å¯Ÿ**: æ¨¡å¼éªŒè¯=æ¶æ„å®ˆæŠ¤çš„è‡ªåŠ¨åŒ–ã€‚ä¸‰å±‚éªŒè¯ä½“ç³»ï¼šâ‘ é™æ€æ¶æ„éªŒè¯ï¼ˆè½»é‡çº§ï¼‰ï¼šArchUnit/NDepend/Strukturï¼Œåœ¨ä»£ç å±‚é¢æ£€æŸ¥ä¾èµ–è§„åˆ™ã€åˆ†å±‚çº¦æŸã€å‘½åçº¦å®šï¼Œå¿«é€Ÿåé¦ˆä½†è¡¨è¾¾åŠ›æœ‰é™â‘¡æ¨¡å‹æ£€æµ‹ï¼ˆä¸­ç­‰å¼ºåº¦ï¼‰ï¼šmCRL2/SPIN/TLA+ï¼Œå»ºç«‹æŠ½è±¡æ¨¡å‹éªŒè¯å¹¶å‘æ€§è´¨ï¼ˆæ— æ­»é”/æ´»æ€§/å…¬å¹³æ€§ï¼‰ï¼Œèƒ½å‘ç°è®¾è®¡ç¼ºé™·ä½†éœ€è¦å»ºæ¨¡â‘¢å®šç†è¯æ˜ï¼ˆæœ€å¼ºä¿è¯ï¼‰ï¼šCoq/Lean/Isabelleï¼Œå½¢å¼åŒ–è¯æ˜æ¨¡å¼æ€§è´¨ï¼ˆSingletonå”¯ä¸€æ€§/Observerä¸€è‡´æ€§/Strategyå¯æ›¿æ¢æ€§ï¼‰ï¼Œå®Œå…¨æ­£ç¡®ä½†æˆæœ¬é«˜ã€‚éªŒè¯ç»´åº¦ï¼šâ‘ ç»“æ„æ­£ç¡®æ€§ï¼šä¾èµ–å…³ç³»ã€æ¥å£å¥‘çº¦â‘¡è¡Œä¸ºæ­£ç¡®æ€§ï¼šçŠ¶æ€æœºæ€§è´¨ã€æ—¶åºçº¦æŸâ‘¢æ€§èƒ½æ­£ç¡®æ€§ï¼šå®æ—¶æ€§ã€èµ„æºç•Œé™ã€‚å·¥å…·é€‰æ‹©çŸ©é˜µï¼šåŸå‹æœŸâ†’é™æ€æ£€æŸ¥ï¼Œå…³é”®ç³»ç»Ÿâ†’æ¨¡å‹æ£€æµ‹ï¼Œæè‡´å®‰å…¨â†’å®šç†è¯æ˜ã€‚CI/CDé›†æˆï¼šmake verifyä½œä¸ºè´¨é‡é—¨ç¦ï¼Œæ¶æ„è¿è§„è‡ªåŠ¨æ‹’ç»åˆå¹¶ã€‚æ¡ˆä¾‹ï¼šCompCertç”¨CoqéªŒè¯ç¼–è¯‘å™¨ã€AWSç”¨TLA+éªŒè¯åˆ†å¸ƒå¼ç®—æ³•ã€JUnitç”¨ArchUnitä¿æŠ¤æ¶æ„ã€‚å…³é”®ï¼šè‡ªåŠ¨åŒ–éªŒè¯å°†æ¶æ„çº¦æŸä»æ–‡æ¡£å˜ä¸ºå¯æ‰§è¡Œè§„èŒƒã€‚

</details>

---

## ğŸ“‹ ç›®å½•

- [è®¾è®¡æ¨¡å¼éªŒè¯å·¥å…·é“¾](#è®¾è®¡æ¨¡å¼éªŒè¯å·¥å…·é“¾)
  - [1 ğŸ“Š æ ¸å¿ƒæ¦‚å¿µæ·±åº¦åˆ†æ](#1--æ ¸å¿ƒæ¦‚å¿µæ·±åº¦åˆ†æ)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [2 æ¦‚è¿°](#2-æ¦‚è¿°)
  - [1 . é™æ€æ¶æ„éªŒè¯](#1--é™æ€æ¶æ„éªŒè¯)
    - [1.1 ArchUnitï¼ˆJavaï¼‰](#11-archunitjava)
    - [1.2 NDependï¼ˆC#/.NETï¼‰](#12-ndependcnet)
    - [1.3 Strukturï¼ˆGoï¼‰](#13-strukturgo)
  - [2 . æ¨¡å‹æ£€æµ‹éªŒè¯](#2--æ¨¡å‹æ£€æµ‹éªŒè¯)
    - [2.1 mCRL2ï¼šå¹¶å‘æ¨¡å¼](#21-mcrl2å¹¶å‘æ¨¡å¼)
    - [2.2 SPINï¼šçŠ¶æ€æœºæ¨¡å¼](#22-spinçŠ¶æ€æœºæ¨¡å¼)
    - [2.3 TLA+ï¼šåˆ†å¸ƒå¼æ¨¡å¼](#23-tlaåˆ†å¸ƒå¼æ¨¡å¼)
  - [3 . å®šç†è¯æ˜éªŒè¯](#3--å®šç†è¯æ˜éªŒè¯)
    - [3.1 Coqï¼šå•ä¾‹æ¨¡å¼](#31-coqå•ä¾‹æ¨¡å¼)
    - [3.2 Lean4ï¼šè§‚å¯Ÿè€…æ¨¡å¼](#32-lean4è§‚å¯Ÿè€…æ¨¡å¼)
    - [3.3 Isabelle/HOLï¼šç­–ç•¥æ¨¡å¼](#33-isabelleholç­–ç•¥æ¨¡å¼)
  - [4 . æ€§èƒ½éªŒè¯](#4--æ€§èƒ½éªŒè¯)
    - [4.1 UPPAALï¼šå®æ—¶æ¨¡å¼](#41-uppaalå®æ—¶æ¨¡å¼)
    - [4.2 K-Frameworkï¼šæˆæœ¬è¯­ä¹‰](#42-k-frameworkæˆæœ¬è¯­ä¹‰)
  - [5 . é›†æˆå·¥å…·é“¾](#5--é›†æˆå·¥å…·é“¾)
    - [5.1 CI/CD é›†æˆ](#51-cicd-é›†æˆ)
    - [5.2 VSCode æ‰©å±•](#52-vscode-æ‰©å±•)
  - [6 . æ¡ˆä¾‹ç ”ç©¶](#6--æ¡ˆä¾‹ç ”ç©¶)
    - [6.1 JUnit 5 æ¶æ„éªŒè¯](#61-junit-5-æ¶æ„éªŒè¯)
    - [6.2 Spring Framework è§‚å¯Ÿè€…æ¨¡å¼](#62-spring-framework-è§‚å¯Ÿè€…æ¨¡å¼)
    - [6.3 Akka Actor æ¨¡å‹éªŒè¯](#63-akka-actor-æ¨¡å‹éªŒè¯)
  - [7 . å·¥å…·å¯¹æ¯”](#7--å·¥å…·å¯¹æ¯”)
    - [7.1 é™æ€ vs åŠ¨æ€](#71-é™æ€-vs-åŠ¨æ€)
    - [7.2 è‡ªåŠ¨ vs æ‰‹å·¥](#72-è‡ªåŠ¨-vs-æ‰‹å·¥)
  - [8 . æœ€ä½³å®è·µ](#8--æœ€ä½³å®è·µ)
    - [8.1 éªŒè¯ç­–ç•¥](#81-éªŒè¯ç­–ç•¥)
    - [8.2 ä»£ç ç»„ç»‡](#82-ä»£ç ç»„ç»‡)
  - [9 . å¤§å­¦è¯¾ç¨‹å¯¹åº”](#9--å¤§å­¦è¯¾ç¨‹å¯¹åº”)
  - [10 å¿«é€Ÿå‚è€ƒ](#10-å¿«é€Ÿå‚è€ƒ)
    - [1 å·¥å…·é“¾é€ŸæŸ¥](#1-å·¥å…·é“¾é€ŸæŸ¥)
    - [10.2 å®æˆ˜å»ºè®®](#102-å®æˆ˜å»ºè®®)
  - [11 é™„å½• Aï¼šWikipedia æ¦‚å¿µå¯¹ç…§](#11-é™„å½•-awikipedia-æ¦‚å¿µå¯¹ç…§)

---

## 2 æ¦‚è¿°

**è®¾è®¡æ¨¡å¼éªŒè¯**æ˜¯æŒ‡ä½¿ç”¨å½¢å¼åŒ–æ–¹æ³•å’Œè‡ªåŠ¨åŒ–å·¥å…·ï¼Œç¡®ä¿æ¨¡å¼å®ç°çš„**æ­£ç¡®æ€§**ã€**æ€§èƒ½**å’Œ**å®‰å…¨æ€§**ã€‚

**æ ¸å¿ƒæ€æƒ³**ï¼š

```text
æ¨¡å¼éªŒè¯ = ç»“æ„æ£€æŸ¥ + è¡Œä¸ºéªŒè¯ + æ€§è´¨è¯æ˜

éªŒè¯å±‚æ¬¡ï¼š
  1. é™æ€æ£€æŸ¥ï¼šç±»å›¾ã€ä¾èµ–å…³ç³»
  2. åŠ¨æ€éªŒè¯ï¼šäº¤äº’åºåˆ—ã€çŠ¶æ€æœº
  3. æ€§è´¨è¯æ˜ï¼šæ­»é”è‡ªç”±ã€ä¸€è‡´æ€§
  4. æ€§èƒ½åˆ†æï¼šå»¶è¿Ÿã€ååé‡
```

**å·¥å…·åˆ†ç±»**ï¼š

| å±‚æ¬¡ | å·¥å…· | éªŒè¯å¯¹è±¡ | è‡ªåŠ¨åŒ– |
|------|------|----------|--------|
| **é™æ€** | ArchUnit, Struktur| æ¶æ„çº¦æŸ | é«˜ |
| **æ¨¡å‹** | mCRL2, SPIN | å¹¶å‘æ¨¡å¼ | ä¸­ |
| **å®šç†** | Coq, Isabelle | æ•°å­¦æ€§è´¨ | ä½ |
| **æ€§èƒ½** | UPPAAL, Timed | å®æ—¶æ€§ | ä¸­ |

---

## 1 . é™æ€æ¶æ„éªŒè¯

### 1.1 ArchUnitï¼ˆJavaï¼‰

**å®‰è£…**ï¼š

```xml
<dependency>
    <groupId>com.tngtech.archunit</groupId>
    <artifactId>archunit-junit5</artifactId>
    <version>1.1.0</version>
    <scope>test</scope>
</dependency>
```

**ç¤ºä¾‹1ï¼šåˆ†å±‚æ¶æ„æ£€æŸ¥**:

```java
import com.tngtech.archunit.core.domain.JavaClasses;
import com.tngtech.archunit.core.importer.ClassFileImporter;
import com.tngtech.archunit.library.Architectures.*;

@Test
public void layered_architecture_is_respected() {
    JavaClasses classes = new ClassFileImporter()
        .importPackages("com.example");

    layeredArchitecture()
        .layer("Controller").definedBy("..controller..")
        .layer("Service").definedBy("..service..")
        .layer("Persistence").definedBy("..persistence..")

        .whereLayer("Controller").mayNotBeAccessedByAnyLayer()
        .whereLayer("Service").mayOnlyBeAccessedByLayers("Controller")
        .whereLayer("Persistence").mayOnlyBeAccessedByLayers("Service")

        .check(classes);
}
```

**ç¤ºä¾‹2ï¼šè§‚å¯Ÿè€…æ¨¡å¼æ£€æŸ¥**:

```java
@Test
public void observer_pattern_structure() {
    classes()
        .that().haveSimpleNameEndingWith("Subject")
        .should().dependOnClassesThat().haveSimpleNameEndingWith("Observer")
        .check(importedClasses);

    classes()
        .that().haveSimpleNameEndingWith("Observer")
        .should().haveOnlyFinalFields()  // ä¸å¯å˜è§‚å¯Ÿè€…
        .check(importedClasses);
}
```

**ç¤ºä¾‹3ï¼šå•ä¾‹æ¨¡å¼æ£€æŸ¥**:

```java
@Test
public void singletons_have_private_constructor() {
    classes()
        .that().haveSimpleNameEndingWith("Singleton")
        .should().haveOnlyPrivateConstructors()
        .andShould().haveOnlyFinalFields()
        .check(importedClasses);
}
```

### 1.2 NDependï¼ˆC#/.NETï¼‰

**è§„åˆ™ç¤ºä¾‹**ï¼š

```csharp
// CQL (Code Query Language)
warnif count > 0
from t in JustMyCode.Types
where t.IsAbstract && !t.IsSealed
   && t.DeriveFromAbstract("Subject")
   && !t.MethodsAndContractors.Any(m => m.IsVirtual)
select new { t,
    Issue = "Subject class should have virtual notification method" }
```

### 1.3 Strukturï¼ˆGoï¼‰

**ç¤ºä¾‹**ï¼ˆæ£€æŸ¥ä¾èµ–æ³¨å…¥ï¼‰ï¼š

```go
package main

import "github.com/google/go-cmp/cmp"

func TestDependencyInjection(t *testing.T) {
    pkg := loadPackage("github.com/myapp")

    // æ£€æŸ¥ï¼šService é€šè¿‡æ¥å£ä¾èµ– Repository
    for _, svc := range pkg.Types().WithSuffix("Service") {
        deps := svc.Dependencies()
        assert.All(deps, func(d Type) bool {
            return d.IsInterface()
        })
    }
}
```

---

## 2 . æ¨¡å‹æ£€æµ‹éªŒè¯

### 2.1 mCRL2ï¼šå¹¶å‘æ¨¡å¼

**ç¤ºä¾‹ï¼šç”Ÿäº§è€…-æ¶ˆè´¹è€…**:

```mcrl2
sort Item = struct item1 | item2 | item3;

act produce, consume : Item;
    buffer_put, buffer_get : Item;

proc Producer = sum i:Item . produce(i) . buffer_put(i) . Producer;

proc Buffer(capacity: Nat, items: List(Item)) =
  (length(items) < capacity) ->
    sum i:Item . buffer_put(i) . Buffer(capacity, i |> items)
  +
  (length(items) > 0) ->
    buffer_get(rhead(items)) . Buffer(capacity, rtail(items));

proc Consumer = sum i:Item . buffer_get(i) . consume(i) . Consumer;

init allow({produce, consume},
  comm({buffer_put|buffer_get -> sync},
    Producer || Buffer(10, []) || Consumer));
```

**éªŒè¯æ€§è´¨**ï¼š

```bash
# ç¼–è¯‘
mcrl22lps producer_consumer.mcrl2 -o pc.lps

# ç”ŸæˆçŠ¶æ€ç©ºé—´
lps2lts pc.lps pc.lts

# æ£€æŸ¥æ­»é”
ltsconvert -edead pc.lts
# è¾“å‡ºï¼šNo deadlocks found

# éªŒè¯æ´»æ€§ï¼ˆæ€»èƒ½ç”Ÿäº§ï¼‰
lps2pbes -f "nu X. (<produce(item1)>true && [!produce(item1)]X)" pc.lps | pbes2bool
# è¾“å‡ºï¼štrue
```

### 2.2 SPINï¼šçŠ¶æ€æœºæ¨¡å¼

**ç¤ºä¾‹ï¼šTCP çŠ¶æ€æœº**:

```promela
mtype = { LISTEN, SYN_SENT, SYN_RCVD, ESTABLISHED,
          FIN_WAIT_1, FIN_WAIT_2, CLOSE_WAIT, CLOSING,
          LAST_ACK, TIME_WAIT, CLOSED };

mtype state = CLOSED;

chan input = [10] of { mtype };
chan output = [10] of { mtype };

active proctype TCPStateMachine() {
  do
  :: state == CLOSED && input?OPEN ->
       state = LISTEN;
       output!ACK;

  :: state == LISTEN && input?SYN ->
       state = SYN_RCVD;
       output!SYN_ACK;

  :: state == SYN_RCVD && input?ACK ->
       state = ESTABLISHED;

  :: state == ESTABLISHED && input?FIN ->
       state = CLOSE_WAIT;
       output!ACK;

  :: state == CLOSE_WAIT && input?CLOSE ->
       state = LAST_ACK;
       output!FIN;

  :: state == LAST_ACK && input?ACK ->
       state = CLOSED;
  od;
}

/* LTL æ€§è´¨ï¼šæ€»èƒ½å›åˆ° CLOSED */
ltl eventual_close { []<>(state == CLOSED) }
```

**éªŒè¯**ï¼š

```bash
spin -a tcp.pml
gcc -o pan pan.c
./pan -a  # éªŒè¯æ‰€æœ‰ LTL æ€§è´¨
```

### 2.3 TLA+ï¼šåˆ†å¸ƒå¼æ¨¡å¼

**ç¤ºä¾‹ï¼šSaga æ¨¡å¼**:

```tla
EXTENDS Integers, Sequences

VARIABLES
  transactions,       \* å·²æ‰§è¡Œçš„äº‹åŠ¡
  compensations,      \* å·²æ‰§è¡Œçš„è¡¥å¿
  state              \* "running", "committed", "aborted"

TypeOK ==
  /\ transactions \in Seq({"T1", "T2", "T3"})
  /\ compensations \in Seq({"C1", "C2", "C3"})
  /\ state \in {"running", "committed", "aborted"}

Init ==
  /\ transactions = <<>>
  /\ compensations = <<>>
  /\ state = "running"

ExecuteTransaction(t) ==
  /\ state = "running"
  /\ Len(transactions) < 3
  /\ transactions' = Append(transactions, t)
  /\ UNCHANGED <<compensations, state>>

FailTransaction ==
  /\ state = "running"
  /\ Len(transactions) > 0
  /\ state' = "aborted"
  /\ UNCHANGED <<transactions, compensations>>

Compensate ==
  /\ state = "aborted"
  /\ Len(compensations) < Len(transactions)
  /\ LET i == Len(transactions) - Len(compensations)
         c == "C" \o ToString(i)
     IN compensations' = Append(compensations, c)
  /\ UNCHANGED <<transactions, state>>

Commit ==
  /\ state = "running"
  /\ Len(transactions) = 3
  /\ state' = "committed"
  /\ UNCHANGED <<transactions, compensations>>

Next ==
  \/ ExecuteTransaction("T1")
  \/ ExecuteTransaction("T2")
  \/ ExecuteTransaction("T3")
  \/ FailTransaction
  \/ Compensate
  \/ Commit

(* Safety: ä¸åŒæ—¶æäº¤å’Œä¸­æ­¢ *)
Safety == ~(state = "committed" /\ state = "aborted")

(* Liveness: æœ€ç»ˆè¾¾åˆ°ç»ˆæ€ *)
Liveness == <>[](state \in {"committed", "aborted"})
```

**éªŒè¯**ï¼š

```bash
tlc saga.tla -workers 4
```

---

## 3 . å®šç†è¯æ˜éªŒè¯

### 3.1 Coqï¼šå•ä¾‹æ¨¡å¼

**å®šä¹‰**ï¼š

```coq
Record Singleton (A : Type) : Type := mkSingleton {
  instance : A;
  get_instance : unit -> A;

  (* ä¸å˜å¼ï¼šæ€»æ˜¯è¿”å›åŒä¸€ä¸ªå®ä¾‹ *)
  singleton_property : forall u1 u2,
    get_instance u1 = get_instance u2;
}.

(* è¯æ˜ï¼šå•ä¾‹æ˜¯å”¯ä¸€çš„ *)
Theorem singleton_uniqueness : forall (A : Type) (s : Singleton A) x y,
  x = s.(get_instance) tt ->
  y = s.(get_instance) tt ->
  x = y.
Proof.
  intros A s x y Hx Hy.
  rewrite Hx, Hy.
  apply s.(singleton_property).
Qed.
```

### 3.2 Lean4ï¼šè§‚å¯Ÿè€…æ¨¡å¼

**å®šä¹‰**ï¼š

```lean
structure Observer (Event : Type) where
  notify : Event â†’ IO Unit

structure Subject (Event : Type) where
  observers : List (Observer Event)
  attach : Observer Event â†’ Subject Event
  detach : Observer Event â†’ Subject Event
  notifyAll : Event â†’ IO Unit

-- ä¸å˜å¼ï¼šnotifyAll é€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€…
axiom notify_all_correct (s : Subject Event) (e : Event) :
  âˆ€ obs âˆˆ s.observers,
    (s.notifyAll e) >>= (fun _ => obs.notify e) = obs.notify e

-- å®šç†ï¼šè§‚å¯Ÿè€…é¡ºåºæ— å…³
theorem notify_order_independent
  (s : Subject Event)
  (obs1 obs2 : Observer Event)
  (e : Event) :
  let s1 := s.attach obs1 |>.attach obs2
  let s2 := s.attach obs2 |>.attach obs1
  s1.notifyAll e = s2.notifyAll e := by
  sorry  -- è¯æ˜ï¼šIO æ“ä½œå¯äº¤æ¢
```

### 3.3 Isabelle/HOLï¼šç­–ç•¥æ¨¡å¼

```isabelle
theory StrategyPattern
imports Main
begin

(* ç­–ç•¥æ¥å£ *)
type_synonym 'a strategy = "'a \<Rightarrow> 'a"

(* ä¸Šä¸‹æ–‡ *)
record 'a context =
  strategy :: "'a strategy"
  data :: "'a"

(* æ‰§è¡Œç­–ç•¥ *)
definition execute :: "'a context \<Rightarrow> 'a" where
  "execute ctx = (strategy ctx) (data ctx)"

(* å®šç†ï¼šç­–ç•¥å¯æ›¿æ¢æ€§ *)
theorem strategy_substitution:
  assumes "strategy ctx1 = s1"
      and "strategy ctx2 = s2"
      and "data ctx1 = data ctx2"
      and "\<forall>x. s1 x = s2 x"
  shows "execute ctx1 = execute ctx2"
  unfolding execute_def
  using assms by simp

end
```

---

## 4 . æ€§èƒ½éªŒè¯

### 4.1 UPPAALï¼šå®æ—¶æ¨¡å¼

**ç¤ºä¾‹ï¼šç”Ÿäº§è€…-æ¶ˆè´¹è€…ï¼ˆå®æ—¶çº¦æŸï¼‰**:

```uppaal
// Producer
clock t_prod;

process Producer() {
  state produce, idle;
  init produce;

  produce -> idle {
    guard t_prod <= 100;  // æœ€æ…¢ 100ms ç”Ÿäº§ä¸€ä¸ª
    sync produce_item!;
    assign t_prod = 0;
  }

  idle -> produce {
    guard t_prod >= 10;   // æœ€å¿« 10ms
  }
}

// Buffer
const int CAPACITY = 10;
int buffer_size = 0;

process Buffer() {
  state waiting;

  waiting -> waiting {
    sync produce_item?;
    guard buffer_size < CAPACITY;
    assign buffer_size++;
  }

  waiting -> waiting {
    sync consume_item!;
    guard buffer_size > 0;
    assign buffer_size--;
  }
}

// éªŒè¯æŸ¥è¯¢
A[] buffer_size <= CAPACITY          // Safety: ä¸æº¢å‡º
A[] Producer.t_prod <= 100           // Deadline: ç”Ÿäº§æ—¶é™
E<> buffer_size == CAPACITY          // Reachability: å¯æ»¡
```

### 4.2 K-Frameworkï¼šæˆæœ¬è¯­ä¹‰

**ç¤ºä¾‹ï¼šè£…é¥°å™¨æ¨¡å¼æˆæœ¬**:

```k
module DECORATOR-COST
  imports DOMAINS

  syntax Component ::= "base" | "decorator" "(" Component ")"

  syntax KResult ::= Int

  rule base => 10  [cost(10)]  // åŸºç¡€æˆæœ¬

  rule decorator(C) => C + 5   [cost(5)]  // è£…é¥°å™¨é¢å¤–æˆæœ¬

  // éªŒè¯ï¼šå¤šå±‚è£…é¥°å™¨æˆæœ¬çº¿æ€§å¢é•¿
  configuration <k> $PGM:Component </k>
                <cost> 0 </cost>

  rule <k> V:Int => . </k>
       <cost> C => C + V </cost>
```

**éªŒè¯**ï¼š

```bash
kompile decorator_cost.k
krun -cPGM="decorator(decorator(base))"
# è¾“å‡ºï¼š<cost> 25 </cost>  (10 + 5 + 5 + 5)
```

---

## 5 . é›†æˆå·¥å…·é“¾

### 5.1 CI/CD é›†æˆ

**GitHub Actions ç¤ºä¾‹**ï¼š

```yaml
name: Pattern Verification

on: [push, pull_request]

jobs:
  archunit-check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Set up JDK
        uses: actions/setup-java@v2
        with:
          java-version: '17'
      - name: Run ArchUnit tests
        run: mvn test -Dtest=ArchitectureTest

  mcrl2-verification:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Install mCRL2
        run: sudo apt-get install mcrl2
      - name: Verify concurrency patterns
        run: |
          mcrl22lps patterns/*.mcrl2 -o model.lps
          lps2lts model.lps model.lts
          ltsconvert -edead model.lts

  uppaal-performance:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Run UPPAAL verification
        run: |
          docker run -v $(pwd):/workspace uppaal/uppaal \
            verifyta /workspace/patterns/*.xml /workspace/queries.q
```

### 5.2 VSCode æ‰©å±•

**pattern-verifier æ‰©å±•**ï¼ˆä¼ªä»£ç ï¼‰ï¼š

```typescript
import * as vscode from 'vscode';
import { execSync } from 'child_process';

export function activate(context: vscode.ExtensionContext) {
  let disposable = vscode.commands.registerCommand(
    'pattern-verifier.verify',
    () => {
      const editor = vscode.window.activeTextEditor;
      if (!editor) return;

      const code = editor.document.getText();

      // æ£€æµ‹æ¨¡å¼
      const pattern = detectPattern(code);

      // é€‰æ‹©éªŒè¯å™¨
      if (pattern === 'Singleton') {
        verifySingleton(code);
      } else if (pattern === 'Observer') {
        verifyObserver(code);
      }
    });

  context.subscriptions.push(disposable);
}

function verifySingleton(code: string) {
  // é™æ€åˆ†æ
  const hasPrivateConstructor = /private\s+\w+\(/.test(code);
  const hasGetInstanceMethod = /getInstance\s*\(/.test(code);

  if (!hasPrivateConstructor) {
    vscode.window.showErrorMessage("Singleton must have private constructor");
  }

  if (!hasGetInstanceMethod) {
    vscode.window.showWarningMessage("Singleton should have getInstance method");
  }

  // è°ƒç”¨ Coq éªŒè¯
  try {
    execSync(`coqc singleton_proof.v`);
    vscode.window.showInformationMessage("Singleton verified âœ“");
  } catch (e) {
    vscode.window.showErrorMessage("Verification failed");
  }
}
```

---

## 6 . æ¡ˆä¾‹ç ”ç©¶

### 6.1 JUnit 5 æ¶æ„éªŒè¯

**ç›®æ ‡**ï¼šç¡®ä¿ JUnit 5 çš„æ’ä»¶æ¶æ„æ­£ç¡®

**ArchUnit è§„åˆ™**ï¼š

```java
@Test
public void junit_extension_api_is_stable() {
    noClasses()
        .that().resideInAPackage("org.junit.jupiter.api.extension..")
        .should().dependOnClassesThat().resideInAPackage("..internal..")
        .check(classes);
}

@Test
public void extensions_use_service_loader() {
    classes()
        .that().implement(Extension.class)
        .should().beAnnotatedWith(AutoService.class)
        .check(classes);
}
```

### 6.2 Spring Framework è§‚å¯Ÿè€…æ¨¡å¼

**ç›®æ ‡**ï¼šéªŒè¯ Spring äº‹ä»¶æœºåˆ¶

**mCRL2 æ¨¡å‹**ï¼š

```mcrl2
act publish_event, handle_event : String;

proc ApplicationContext =
  sum event:String . publish_event(event) . notify_listeners(event) . ApplicationContext;

proc notify_listeners(event:String) =
  sum listener:String . handle_event(event) . notify_listeners(event)
  +
  tau;  % ç»“æŸé€šçŸ¥

proc EventListener(name:String) =
  sum event:String . handle_event(event) . EventListener(name);

init allow({publish_event, handle_event},
  comm({},
    ApplicationContext || EventListener("listener1") || EventListener("listener2")));
```

**éªŒè¯**ï¼š

```bash
# éªŒè¯ï¼šæ¯ä¸ªäº‹ä»¶éƒ½ä¼šè¢«æ‰€æœ‰ç›‘å¬å™¨å¤„ç†
lps2pbes -f "forall e:String . [publish_event(e)] mu X. (<handle_event(e)>true || <tau>X)" \
  spring_events.lps | pbes2bool
```

### 6.3 Akka Actor æ¨¡å‹éªŒè¯

**ç›®æ ‡**ï¼šéªŒè¯ Actor ç³»ç»Ÿæ— æ­»é”

**mCRL2 å»ºæ¨¡**ï¼š

```mcrl2
act send, receive : Nat # Nat # String;

proc Actor(id: Nat, mailbox: List(String)) =
  (length(mailbox) == 0) ->
    sum sender:Nat, msg:String . receive(sender, id, msg) . Actor(id, [msg])
  +
  (length(mailbox) > 0) ->
    sum target:Nat . send(id, target, rhead(mailbox)) . Actor(id, rtail(mailbox));

init hide({tau},
  allow({send, receive},
    comm({send|receive -> tau},
      Actor(1, []) || Actor(2, []) || Actor(3, []))));
```

**éªŒè¯**ï¼š

```bash
ltsconvert -edead akka.lts
# è¾“å‡ºï¼šNo deadlocks foundï¼ˆå–å†³äºå…·ä½“äº¤äº’åè®®ï¼‰
```

---

## 7 . å·¥å…·å¯¹æ¯”

### 7.1 é™æ€ vs åŠ¨æ€

| ç»´åº¦ | é™æ€å·¥å…· | åŠ¨æ€å·¥å…· |
|------|----------|----------|
| **æ—¶æœº** | ç¼–è¯‘æœŸ/CI | è¿è¡Œæ—¶ |
| **æˆæœ¬** | ä½ | ä¸­ |
| **è¦†ç›–ç‡** | ç»“æ„ | è¡Œä¸º |
| **å‡é˜³æ€§** | é«˜ | ä½ |
| **ä¾‹å­** | ArchUnit | Loom (Rust) |

### 7.2 è‡ªåŠ¨ vs æ‰‹å·¥

| ç»´åº¦ | è‡ªåŠ¨åŒ–å·¥å…· | å®šç†è¯æ˜ |
|------|------------|----------|
| **å­¦ä¹ æ›²çº¿** | ä½ | é«˜ |
| **è¡¨è¾¾åŠ›** | ä¸­ | æé«˜ |
| **é€‚ç”¨åœºæ™¯** | å·¥ä¸šCI | å­¦æœ¯ç ”ç©¶ |
| **ä¾‹å­** | SPIN, TLA+ | Coq, Isabelle |

---

## 8 . æœ€ä½³å®è·µ

### 8.1 éªŒè¯ç­–ç•¥

```text
é‡‘å­—å¡”ç­–ç•¥ï¼š

  L3: å®šç†è¯æ˜ï¼ˆ1%ï¼‰
       â†‘
  L2: æ¨¡å‹æ£€æµ‹ï¼ˆ10%ï¼‰
       â†‘
  L1: é™æ€æ£€æŸ¥ï¼ˆ100%ï¼‰

å»ºè®®ï¼š
  - æ‰€æœ‰é¡¹ç›®ï¼šArchUnit/NDepend
  - å…³é”®æ¨¡å—ï¼šmCRL2/SPIN
  - å­¦æœ¯è®ºæ–‡ï¼šCoq/Isabelle
```

### 8.2 ä»£ç ç»„ç»‡

```text
project/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main/
â”‚   â”‚   â””â”€â”€ patterns/
â”‚   â”‚       â”œâ”€â”€ singleton/
â”‚   â”‚       â”œâ”€â”€ observer/
â”‚   â”‚       â””â”€â”€ strategy/
â”‚   â””â”€â”€ test/
â”‚       â”œâ”€â”€ unit/
â”‚       â”œâ”€â”€ integration/
â”‚       â””â”€â”€ verification/        # å½¢å¼åŒ–éªŒè¯
â”‚           â”œâ”€â”€ archunit/
â”‚           â”œâ”€â”€ mcrl2/
â”‚           â””â”€â”€ coq/
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ mcrl2/
â”‚   â”œâ”€â”€ uppaal/
â”‚   â””â”€â”€ tla+/
â””â”€â”€ .github/
    â””â”€â”€ workflows/
        â””â”€â”€ verification.yml
```

---

## 9 . å¤§å­¦è¯¾ç¨‹å¯¹åº”

| è¯¾ç¨‹ | ç›¸å…³å·¥å…· |
|------|----------|
| **CMU 15-414 Bug Catching** | ArchUnit, Dafny |
| **MIT 6.826 ç³»ç»ŸåŸç†** | TLA+, Coq |
| **UC Berkeley CS 164 ç¼–è¯‘å™¨** | mCRL2, K-Framework |
| **Stanford CS 357 è‡ªåŠ¨åŒ–æ¨ç†** | SPIN, UPPAAL |
| **ETH ZÃ¼rich å½¢å¼åŒ–æ–¹æ³•** | Isabelle/HOL |

---

## 10 å¿«é€Ÿå‚è€ƒ

### 1 å·¥å…·é“¾é€ŸæŸ¥

```bash
# é™æ€æ£€æŸ¥
mvn test -Dtest=ArchitectureTest      # ArchUnit (Java)
dotnet msbuild /t:RunCodeAnalysis     # NDepend (C#)

# æ¨¡å‹æ£€æµ‹
mcrl22lps model.mcrl2 | lps2lts       # mCRL2
spin -a model.pml && gcc pan.c && ./pan  # SPIN
tlc spec.tla                          # TLA+

# å®šç†è¯æ˜
coqc proof.v                          # Coq
isabelle build -D .                   # Isabelle
lake build                            # Lean4

# æ€§èƒ½éªŒè¯
verifyta model.xml queries.q          # UPPAAL
kompile spec.k && krun program        # K-Framework
```

### 10.2 å®æˆ˜å»ºè®®

1. **èµ·æ­¥**ï¼šArchUnitï¼ˆä½æˆæœ¬ï¼Œé«˜å›æŠ¥ï¼‰
2. **è¿›é˜¶**ï¼šmCRL2/SPINï¼ˆå¹¶å‘æ¨¡å¼ï¼‰
3. **é«˜çº§**ï¼šTLA+ï¼ˆåˆ†å¸ƒå¼ç³»ç»Ÿï¼‰
4. **ç ”ç©¶**ï¼šCoq/Isabelleï¼ˆè®ºæ–‡çº§è¯æ˜ï¼‰

---

## 11 é™„å½• Aï¼šWikipedia æ¦‚å¿µå¯¹ç…§

| æ¦‚å¿µ | Wikipedia æ¡ç›® | æœ¬æ–‡ç« èŠ‚ |
|------|----------------|----------|
| Model Checking | <https://en.wikipedia.org/wiki/Model_checking> | Â§2 |
| mCRL2 | <https://en.wikipedia.org/wiki/MCRL2> | Â§2.1 |
| SPIN | <https://en.wikipedia.org/wiki/SPIN_model_checker> | Â§2.2 |
| TLA+ | <https://en.wikipedia.org/wiki/TLA%2B> | Â§2.3 |
| Coq | <https://en.wikipedia.org/wiki/Coq> | Â§3.1 |
| UPPAAL | <https://en.wikipedia.org/wiki/UPPAAL> | Â§4.1 |

---

**ç‰ˆæœ¬**ï¼šv1.0
**æœ€åæ›´æ–°**ï¼š2025-10-29
**ç»´æŠ¤è€…**ï¼šFormalScience Project
**è®¸å¯**ï¼šCC BY-SA 4.0
