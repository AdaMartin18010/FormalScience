# 6.1 ä¸‰æ”¯æŸ±å¯è§‚æµ‹æ€§

> **æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0  
> **æœ€åæ›´æ–°**: 2025-10-27  
> **æ–‡æ¡£è§„æ¨¡**: 620è¡Œ | å¯è§‚æµ‹æ€§ä¸‰æ”¯æŸ±è¯¦è§£  
> **é˜…è¯»å»ºè®®**: æœ¬æ–‡æ·±å…¥å¯¹æ¯”Metrics/Logs/Tracesä¸‰å¤§æ”¯æŸ±åŠå…¶å·¥å…·æ ˆ

---

## ğŸ“Š æ ¸å¿ƒæ¦‚å¿µæ·±åº¦åˆ†æ

<details>
<summary><b>ğŸ‘ï¸ğŸ“Š ç‚¹å‡»å±•å¼€ï¼šå¯è§‚æµ‹æ€§ä¸‰æ”¯æŸ±æ ¸å¿ƒæ´å¯Ÿ</b></summary>

**ç»ˆææ´å¯Ÿ**: å¯è§‚æµ‹æ€§â‰ ç›‘æ§ã€‚ç›‘æ§å›ç­”"æ˜¯å¦æ­£å¸¸ï¼Ÿ"ï¼ˆå·²çŸ¥é—®é¢˜ï¼‰ï¼Œå¯è§‚æµ‹æ€§å›ç­”"ä¸ºä»€ä¹ˆä¸æ­£å¸¸ï¼Ÿ"ï¼ˆæœªçŸ¥é—®é¢˜ï¼‰ã€‚ä¸‰æ”¯æŸ±ï¼ˆHoneycomb 2016æå‡ºï¼‰ï¼šâ‘ MetricsæŒ‡æ ‡ï¼šæ—¶åºæ•°å€¼ï¼ˆCPU/å†…å­˜/QPSï¼‰ï¼Œèšåˆç»Ÿè®¡â‘¡Logsæ—¥å¿—ï¼šç¦»æ•£äº‹ä»¶ï¼ˆé”™è¯¯/å®¡è®¡/è°ƒè¯•ï¼‰ï¼Œå…¨æ–‡æœç´¢â‘¢Tracesè¿½è¸ªï¼šè¯·æ±‚é“¾è·¯ï¼ˆåˆ†å¸ƒå¼è°ƒç”¨ï¼‰ï¼Œå› æœå…³è”ã€‚æŠ€æœ¯æ ˆï¼šâ‘ Metricsï¼šPrometheusæ”¶é›†+Grafanaå¯è§†åŒ–â‘¡Logsï¼šELK/Lokiæ”¶é›†+å…¨æ–‡ç´¢å¼•â‘¢Tracesï¼šJaeger/Zipkin/Tempoè¿½è¸ª+OpenTelemetryæ ‡å‡†ã€‚ä¸‰æ”¯æŸ±äº’è¡¥ï¼šâ‘ Metricså‘ç°å¼‚å¸¸ï¼ˆQPSä¸‹é™ï¼‰â‘¡Logså®šä½é”™è¯¯ï¼ˆå…·ä½“æŠ¥é”™ï¼‰â‘¢Tracesè¿½è¸ªé“¾è·¯ï¼ˆæ…¢åœ¨å“ªä¸ªæœåŠ¡ï¼‰ã€‚ç»Ÿä¸€æ ‡å‡†ï¼šOpenTelemetryï¼ˆOTLPï¼‰ç»Ÿä¸€é‡‡é›†SDKã€‚é«˜çº§èƒ½åŠ›ï¼šâ‘ å…³è”åˆ†æï¼šTracesâ†’Logsâ†’Metricsæ‰“é€šâ‘¡AIOpsï¼šå¼‚å¸¸æ£€æµ‹ã€æ ¹å› åˆ†æâ‘¢æˆæœ¬ä¼˜åŒ–ï¼šé‡‡æ ·ç­–ç•¥ã€å­˜å‚¨åˆ†å±‚ã€‚å…³é”®ï¼šå¯è§‚æµ‹æ€§=é€šè¿‡å¤–éƒ¨è¾“å‡ºæ¨æ–­å†…éƒ¨çŠ¶æ€çš„èƒ½åŠ›ï¼Œä¸‰æ”¯æŸ±ç¼ºä¸€ä¸å¯ã€‚

</details>

---

## æ ¸å¿ƒå®šä¹‰

**å¯è§‚æµ‹æ€§**ï¼ˆObservabilityï¼‰ï¼šé€šè¿‡ç³»ç»Ÿå¤–éƒ¨è¾“å‡ºï¼ˆæŒ‡æ ‡ã€æ—¥å¿—ã€è¿½è¸ªï¼‰æ¨æ–­ç³»ç»Ÿå†…éƒ¨çŠ¶æ€çš„èƒ½åŠ›ã€‚

**ä¸ç›‘æ§çš„åŒºåˆ«**ï¼š
- **ç›‘æ§**ï¼ˆMonitoringï¼‰ï¼šå›ç­”"ç³»ç»Ÿæ˜¯å¦æ­£å¸¸ï¼Ÿ"ï¼ˆå·²çŸ¥é—®é¢˜ï¼‰
- **å¯è§‚æµ‹æ€§**ï¼ˆObservabilityï¼‰ï¼šå›ç­”"ä¸ºä»€ä¹ˆä¸æ­£å¸¸ï¼Ÿ"ï¼ˆæœªçŸ¥é—®é¢˜ï¼‰

## ä¸‰æ”¯æŸ±æ¡†æ¶

### èµ·æº

**Honeycomb äº 2016 å¹´æå‡º**ï¼š"å¯è§‚æµ‹æ€§çš„ä¸‰æ”¯æŸ±"
- Metricsï¼ˆæŒ‡æ ‡ï¼‰
- Tracesï¼ˆè¿½è¸ªï¼‰
- Logsï¼ˆæ—¥å¿—ï¼‰

### å®Œæ•´å¯¹æ¯”

| æ”¯æŸ± | æ•°æ®ç±»å‹ | é—®é¢˜åŸŸ | ç¤ºä¾‹ | å­˜å‚¨ |
|-----|---------|--------|------|------|
| **Metrics** | æ—¶é—´åºåˆ—æ•°å€¼ | "å‘ç”Ÿäº†ä»€ä¹ˆ" | CPU=80%, QPS=1000 | Prometheus |
| **Traces** | åˆ†å¸ƒå¼è°ƒç”¨é“¾ | "åœ¨å“ªæ…¢/é”™" | è¯·æ±‚ A è€—æ—¶ 2s | Jaeger, Tempo |
| **Logs** | ç»“æ„åŒ–/éç»“æ„åŒ–æ–‡æœ¬ | "è¯¦ç»†ä¿¡æ¯" | ERROR: NullPointer | Loki, ES |

---

## æ”¯æŸ± 1ï¼šMetricsï¼ˆæŒ‡æ ‡ï¼‰

### å®šä¹‰
**èšåˆçš„æ•°å€¼å‹æ—¶é—´åºåˆ—æ•°æ®**ï¼Œå›ç­”"ç³»ç»Ÿæ•´ä½“å¥åº·åº¦"

### ç±»å‹

| ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ | ç”¨é€” |
|-----|------|------|------|
| **Counter** | å•è°ƒé€’å¢è®¡æ•°å™¨ | http_requests_total | æ€»è¯·æ±‚æ•° |
| **Gauge** | å¯å¢å¯å‡çš„å³æ—¶å€¼ | memory_usage_bytes | å†…å­˜å ç”¨ |
| **Histogram** | å€¼çš„åˆ†å¸ƒï¼ˆæ¡¶ï¼‰ | http_request_duration_seconds | å»¶è¿Ÿåˆ†å¸ƒ |
| **Summary** | åˆ†ä½æ•°ç»Ÿè®¡ | http_request_duration_seconds{quantile="0.95"} | P95 å»¶è¿Ÿ |

### é»„é‡‘ä¿¡å·ï¼ˆGolden Signalsï¼‰

**Google SRE æå‡ºçš„å››å¤§å…³é”®æŒ‡æ ‡**ï¼š

1. **Latency**ï¼ˆå»¶è¿Ÿï¼‰
   ```promql
   # P95 å»¶è¿Ÿ
   histogram_quantile(0.95, 
     rate(http_request_duration_seconds_bucket[5m])
   )
   ```

2. **Traffic**ï¼ˆæµé‡ï¼‰
   ```promql
   # QPS
   rate(http_requests_total[1m])
   ```

3. **Errors**ï¼ˆé”™è¯¯ï¼‰
   ```promql
   # é”™è¯¯ç‡
   rate(http_requests_total{status=~"5.."}[5m]) /
   rate(http_requests_total[5m])
   ```

4. **Saturation**ï¼ˆé¥±å’Œåº¦ï¼‰
   ```promql
   # CPU ä½¿ç”¨ç‡
   100 - (avg by (instance) (irate(node_cpu_seconds_total{mode="idle"}[5m])) * 100)
   ```

### RED æ–¹æ³•ï¼ˆé¢å‘è¯·æ±‚ï¼‰

- **Rate**ï¼šè¯·æ±‚é€Ÿç‡
- **Errors**ï¼šé”™è¯¯æ•°é‡
- **Duration**ï¼šå»¶è¿Ÿ

### USE æ–¹æ³•ï¼ˆé¢å‘èµ„æºï¼‰

- **Utilization**ï¼šä½¿ç”¨ç‡
- **Saturation**ï¼šé¥±å’Œåº¦
- **Errors**ï¼šé”™è¯¯æ•°

### Prometheus ç¤ºä¾‹

**æš´éœ²æŒ‡æ ‡**ï¼ˆGoï¼‰ï¼š
```go
import (
    "github.com/prometheus/client_golang/prometheus"
    "github.com/prometheus/client_golang/prometheus/promauto"
)

var (
    httpRequestsTotal = promauto.NewCounterVec(
        prometheus.CounterOpts{
            Name: "http_requests_total",
            Help: "Total HTTP requests",
        },
        []string{"method", "endpoint", "status"},
    )
)

func handler(w http.ResponseWriter, r *http.Request) {
    httpRequestsTotal.WithLabelValues(
        r.Method, r.URL.Path, "200",
    ).Inc()
}
```

**æŸ¥è¯¢æŒ‡æ ‡**ï¼š
```promql
# æ¯ç§’è¯·æ±‚æ•°
rate(http_requests_total[5m])

# æŒ‰ç«¯ç‚¹åˆ†ç»„
sum by (endpoint) (rate(http_requests_total[5m]))

# é”™è¯¯ç‡
sum(rate(http_requests_total{status=~"5.."}[5m])) /
sum(rate(http_requests_total[5m]))
```

### ä¼˜ç‚¹
- âœ… èšåˆï¼Œæ•°æ®é‡å°
- âœ… æŸ¥è¯¢å¿«ï¼ˆæ—¶åºæ•°æ®åº“ä¼˜åŒ–ï¼‰
- âœ… é€‚åˆå‘Šè­¦ï¼ˆé˜ˆå€¼åˆ¤æ–­ï¼‰
- âœ… é•¿æœŸè¶‹åŠ¿åˆ†æ

### ç¼ºç‚¹
- âŒ ä¸¢å¤±ç»†èŠ‚ï¼ˆèšåˆåæ— æ³•è¿˜åŸå•ä¸ªè¯·æ±‚ï¼‰
- âŒ é«˜åŸºæ•°é—®é¢˜ï¼ˆlabel å¤ªå¤šä¼šçˆ†ç‚¸ï¼‰

---

## æ”¯æŸ± 2ï¼šTracesï¼ˆè¿½è¸ªï¼‰

### å®šä¹‰
**åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å•ä¸ªè¯·æ±‚çš„å®Œæ•´è°ƒç”¨é“¾**ï¼Œå›ç­”"æ…¢åœ¨å“ªé‡Œï¼Ÿé”™åœ¨å“ªé‡Œï¼Ÿ"

### æ ¸å¿ƒæ¦‚å¿µ

**Trace**ï¼šä¸€ä¸ªè¯·æ±‚çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸ
```
Trace ID: a1b2c3d4e5f6
```

**Span**ï¼šTrace ä¸­çš„ä¸€ä¸ªæ“ä½œå•å…ƒ
```
Span: API Gateway â†’ Auth Service
  - Start: 10:00:00.100
  - End: 10:00:00.150
  - Duration: 50ms
```

**Span å…³ç³»**ï¼š
```
Trace (æ€»è€—æ—¶ 500ms)
â”œâ”€ Span 1: API Gateway (500ms)
â”‚  â”œâ”€ Span 2: Auth Service (50ms)
â”‚  â””â”€ Span 3: Order Service (400ms)
â”‚     â”œâ”€ Span 4: Database Query (300ms) â† ç“¶é¢ˆ
â”‚     â””â”€ Span 5: Cache Check (50ms)
```

### OpenTelemetry Trace ç¤ºä¾‹

**åˆ›å»º Trace**ï¼ˆGoï¼‰ï¼š
```go
import (
    "go.opentelemetry.io/otel"
    "go.opentelemetry.io/otel/trace"
)

func processOrder(ctx context.Context, orderID string) error {
    tracer := otel.Tracer("order-service")
    ctx, span := tracer.Start(ctx, "processOrder")
    defer span.End()

    // æ·»åŠ å±æ€§
    span.SetAttributes(
        attribute.String("order.id", orderID),
        attribute.Int("order.items", 3),
    )

    // è°ƒç”¨å­æœåŠ¡ï¼ˆè‡ªåŠ¨åˆ›å»ºå­ Spanï¼‰
    err := validatePayment(ctx, orderID)
    if err != nil {
        span.RecordError(err)
        span.SetStatus(codes.Error, "payment validation failed")
        return err
    }

    return nil
}
```

**Trace ä¼ æ’­**ï¼š
```
HTTP Header:
traceparent: 00-a1b2c3d4e5f6-1234567890ab-01
             â””â”€ Trace ID â”€â”˜ â””â”€ Span ID â”€â”€â”˜

æœåŠ¡ A â†’ æœåŠ¡ B: é€šè¿‡ HTTP Header ä¼ é€’ Trace Context
```

### Jaeger UI ç¤ºä¾‹

```
Trace View (500ms total)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API Gateway          [â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•] 500ms
â”‚   Auth Service       [â•]                 50ms
â”‚   Order Service      [â•â•â•â•â•â•â•â•â•â•â•â•]     400ms
â”‚     DB Query         [â•â•â•â•â•â•â•â•â•â•]       300ms â† æ…¢
â”‚     Cache Check      [â•]                 50ms
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å…³é”®ç”¨é€”

1. **æ€§èƒ½åˆ†æ**ï¼šæ‰¾åˆ°æ…¢çš„æœåŠ¡/å‡½æ•°
2. **ä¾èµ–åˆ†æ**ï¼šç»˜åˆ¶æœåŠ¡è°ƒç”¨æ‹“æ‰‘
3. **æ ¹å› å®šä½**ï¼šä»é”™è¯¯ Span è¿½æº¯åˆ°æºå¤´
4. **å®¹é‡è§„åˆ’**ï¼šåˆ†æè°ƒç”¨é¢‘ç‡å’Œå»¶è¿Ÿ

### ä¼˜ç‚¹
- âœ… å®Œæ•´çš„è°ƒç”¨é“¾è·¯
- âœ… å‡†ç¡®å®šä½ç“¶é¢ˆ
- âœ… ä¸Šä¸‹æ–‡ä¸°å¯Œï¼ˆæºå¸¦ä¸šåŠ¡ä¿¡æ¯ï¼‰

### ç¼ºç‚¹
- âŒ æ•°æ®é‡å¤§ï¼ˆæ¯ä¸ªè¯·æ±‚éƒ½ç”Ÿæˆï¼‰
- âŒ é‡‡æ ·ç­–ç•¥å¤æ‚ï¼ˆä¸èƒ½ 100% é‡‡æ ·ï¼‰
- âŒ è·¨è¯­è¨€/æ¡†æ¶é›†æˆæˆæœ¬é«˜

---

## æ”¯æŸ± 3ï¼šLogsï¼ˆæ—¥å¿—ï¼‰

### å®šä¹‰
**ç¦»æ•£çš„äº‹ä»¶è®°å½•**ï¼Œå›ç­”"å…·ä½“å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ"

### ç±»å‹

| ç±»å‹ | æ ¼å¼ | ç¤ºä¾‹ | æŸ¥è¯¢ |
|-----|------|------|------|
| **éç»“æ„åŒ–** | çº¯æ–‡æœ¬ | `[ERROR] Connection timeout` | æ­£åˆ™/å…¨æ–‡ |
| **åŠç»“æ„åŒ–** | Key-Value | `level=error msg="timeout" latency=5s` | å­—æ®µç´¢å¼• |
| **ç»“æ„åŒ–** | JSON | `{"level":"error","msg":"timeout"}` | ç»“æ„åŒ–æŸ¥è¯¢ |

### æ—¥å¿—çº§åˆ«

```
TRACE   (æœ€è¯¦ç»†ï¼Œè°ƒè¯•ç”¨)
DEBUG   (è°ƒè¯•ä¿¡æ¯)
INFO    (æ­£å¸¸ä¿¡æ¯) â† ç”Ÿäº§é»˜è®¤
WARN    (è­¦å‘Šï¼Œéœ€å…³æ³¨)
ERROR   (é”™è¯¯ï¼Œå½±å“åŠŸèƒ½)
FATAL   (è‡´å‘½ï¼Œç³»ç»Ÿå´©æºƒ)
```

### ç»“æ„åŒ–æ—¥å¿—ç¤ºä¾‹

**ä¼ ç»Ÿæ—¥å¿—**ï¼ˆéš¾è§£æï¼‰ï¼š
```
2025-01-15 10:00:00 ERROR Failed to process order 12345 due to timeout after 5s
```

**ç»“æ„åŒ–æ—¥å¿—**ï¼ˆæ˜“æŸ¥è¯¢ï¼‰ï¼š
```json
{
  "timestamp": "2025-01-15T10:00:00Z",
  "level": "error",
  "message": "Failed to process order",
  "order_id": "12345",
  "error": "timeout",
  "latency_seconds": 5,
  "service": "order-service",
  "trace_id": "a1b2c3d4e5f6"
}
```

### OpenTelemetry Logs é›†æˆ

```go
import "go.opentelemetry.io/otel/log"

logger := log.Logger("order-service")

logger.Error(
    "Failed to process order",
    log.String("order_id", orderID),
    log.String("error", err.Error()),
    log.Int64("latency_ms", latency),
)
```

### æ—¥å¿—èšåˆå·¥å…·

| å·¥å…· | ç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ |
|-----|------|---------|
| **Elasticsearch** | å…¨æ–‡æœç´¢å¼º | å¤§è§„æ¨¡æ—¥å¿— |
| **Loki** | K8s åŸç”Ÿï¼Œä½æˆæœ¬ | äº‘åŸç”Ÿç¯å¢ƒ |
| **Splunk** | å•†ä¸šï¼ŒåŠŸèƒ½å…¨ | ä¼ä¸šçº§ |
| **CloudWatch Logs** | AWS åŸç”Ÿ | AWS ç¯å¢ƒ |

### Loki æŸ¥è¯¢ç¤ºä¾‹

```logql
# æŸ¥è¯¢åŒ…å«"error"çš„æ—¥å¿—
{app="order-service"} |= "error"

# ç»Ÿè®¡é”™è¯¯æ•°
count_over_time({app="order-service"} |= "error" [5m])

# æŒ‰ order_id åˆ†ç»„
sum by (order_id) (
  count_over_time({app="order-service"} | json [5m])
)
```

### æ—¥å¿—ä¸ Trace å…³è”

```go
// åœ¨æ—¥å¿—ä¸­è®°å½• Trace ID
span := trace.SpanFromContext(ctx)
logger.Error(
    "Database query failed",
    log.String("trace_id", span.SpanContext().TraceID().String()),
    log.String("span_id", span.SpanContext().SpanID().String()),
)
```

**æ•ˆæœ**ï¼š
- ä»æ—¥å¿—è·³è½¬åˆ° Trace
- ä» Trace æŸ¥çœ‹è¯¦ç»†æ—¥å¿—

### ä¼˜ç‚¹
- âœ… ä¿¡æ¯æœ€è¯¦ç»†
- âœ… çµæ´»ï¼ˆå¯è®°å½•ä»»ä½•ä¿¡æ¯ï¼‰
- âœ… é€‚åˆè°ƒè¯•

### ç¼ºç‚¹
- âŒ æ•°æ®é‡å·¨å¤§
- âŒ æŸ¥è¯¢æ…¢ï¼ˆå…¨æ–‡æœç´¢ï¼‰
- âŒ å­˜å‚¨æˆæœ¬é«˜

---

## ä¸‰æ”¯æŸ±ååŒ

### å…¸å‹æ•…éšœæ’æŸ¥æµç¨‹

```
1. Metrics å‘Šè­¦
   â†“
   "é”™è¯¯ç‡ > 5%"
   
2. æŸ¥çœ‹ Metrics è¶‹åŠ¿
   â†“
   "10:00 å¼€å§‹é£™å‡"
   
3. æŸ¥è¯¢ Traces
   â†“
   "order-service â†’ database è€—æ—¶ 5sï¼ˆæ­£å¸¸ 50msï¼‰"
   
4. æŸ¥çœ‹ Logs
   â†“
   "ERROR: Connection pool exhausted"
   
5. æ ¹å› å®šä½
   â†“
   "æ•°æ®åº“è¿æ¥æ± ä¸è¶³"
```

### æ•°æ®å…³è”

**é€šè¿‡ Trace ID å…³è”**ï¼š
```
Metric â”€â”
        â”œâ”€â†’ Trace ID: a1b2c3d4
Trace â”€â”€â”¤
        â”œâ”€â†’ Log: trace_id=a1b2c3d4
Log â”€â”€â”€â”€â”˜
```

**Grafana Tempo + Loki ç¤ºä¾‹**ï¼š
```
1. Grafana çœ‹åˆ°é”™è¯¯ç‡é£™å‡ï¼ˆMetricï¼‰
2. ç‚¹å‡»"æŸ¥çœ‹ Traces" â†’ è·³è½¬åˆ° Tempo
3. åœ¨ Tempo ä¸­é€‰æ‹©ä¸€ä¸ªæ…¢ Trace
4. ç‚¹å‡»"æŸ¥çœ‹ Logs" â†’ è·³è½¬åˆ° Loki
5. çœ‹åˆ°è¯¦ç»†é”™è¯¯å †æ ˆ
```

---

## OpenTelemetryï¼šç»Ÿä¸€æ ‡å‡†

### ä¸ºä»€ä¹ˆéœ€è¦ç»Ÿä¸€ï¼Ÿ

**è¿‡å»çš„ç¢ç‰‡åŒ–**ï¼š
- Metricsï¼šPrometheus
- Tracesï¼šJaeger, Zipkin
- Logsï¼šFluentd, Filebeat

æ¯ä¸ªéƒ½æœ‰è‡ªå·±çš„ SDKã€åè®®ã€æ ¼å¼ã€‚

**OpenTelemetry ç›®æ ‡**ï¼š
- ç»Ÿä¸€ SDK
- ç»Ÿä¸€åè®®ï¼ˆOTLPï¼‰
- ç»Ÿä¸€è¯­ä¹‰çº¦å®š

### æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åº”ç”¨ï¼ˆä»»ä½•è¯­è¨€ï¼‰          â”‚
â”‚  - é›†æˆ OTel SDK            â”‚
â”‚  - å‘é€ Metrics/Traces/Logs â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚ OTLP (gRPC/HTTP)
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OTel Collector            â”‚
â”‚  - æ¥æ”¶æ•°æ®                â”‚
â”‚  - è½¬æ¢æ ¼å¼                â”‚
â”‚  - è·¯ç”±åˆ°åç«¯              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
       â”Œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”
       â†“     â†“     â†“
   Prometheus Tempo Loki
```

### æ ¸å¿ƒç»„ä»¶

| ç»„ä»¶ | ä½œç”¨ |
|-----|------|
| **SDK** | åº”ç”¨ç«¯åŸ‹ç‚¹ |
| **API** | å‚å•†æ— å…³æ¥å£ |
| **Collector** | æ•°æ®æ”¶é›†/è½¬æ¢/å¯¼å‡º |
| **OTLP** | ä¼ è¾“åè®® |

### ç¤ºä¾‹é…ç½®

**åº”ç”¨ç«¯**ï¼ˆGoï¼‰ï¼š
```go
import (
    "go.opentelemetry.io/otel"
    "go.opentelemetry.io/otel/exporters/otlp/otlptrace/otlptracegrpc"
    "go.opentelemetry.io/otel/sdk/trace"
)

// é…ç½® OTLP å¯¼å‡ºå™¨
exporter, _ := otlptracegrpc.New(ctx,
    otlptracegrpc.WithEndpoint("otel-collector:4317"),
)

tp := trace.NewTracerProvider(
    trace.WithBatcher(exporter),
)
otel.SetTracerProvider(tp)
```

**Collector é…ç½®**ï¼š
```yaml
receivers:
  otlp:
    protocols:
      grpc:
      http:

processors:
  batch:

exporters:
  prometheus:
    endpoint: "0.0.0.0:8889"
  jaeger:
    endpoint: "jaeger:14250"
  loki:
    endpoint: "http://loki:3100/loki/api/v1/push"

service:
  pipelines:
    traces:
      receivers: [otlp]
      processors: [batch]
      exporters: [jaeger]
    metrics:
      receivers: [otlp]
      processors: [batch]
      exporters: [prometheus]
```

---

## æœ€ä½³å®è·µ

### 1. é‡‡æ ·ç­–ç•¥

**Metrics**ï¼š100%ï¼ˆèšåˆæ•°æ®ï¼Œé‡å°ï¼‰
**Traces**ï¼š
- å¤´éƒ¨é‡‡æ ·ï¼ˆHead-basedï¼‰ï¼š1-10%ï¼ˆæ ¹æ® Trace ID å“ˆå¸Œï¼‰
- å°¾éƒ¨é‡‡æ ·ï¼ˆTail-basedï¼‰ï¼šæ™ºèƒ½ï¼ˆä¿ç•™é”™è¯¯å’Œæ…¢è¯·æ±‚ï¼‰

**Logs**ï¼š
- DEBUG çº§åˆ«ï¼š0%ï¼ˆç”Ÿäº§ç¦ç”¨ï¼‰
- ERROR çº§åˆ«ï¼š100%

### 2. é«˜åŸºæ•°é—®é¢˜

**é”™è¯¯ç¤ºä¾‹**ï¼ˆçˆ†ç‚¸ï¼‰ï¼š
```promql
http_requests_total{user_id="12345", session_id="abcd..."}
# user_id æœ‰ç™¾ä¸‡ä¸ª â†’ ç™¾ä¸‡ä¸ªæ—¶é—´åºåˆ—
```

**æ­£ç¡®åšæ³•**ï¼š
```promql
http_requests_total{endpoint="/api/orders", status="200"}
# endpoint åªæœ‰å‡ åä¸ª â†’ å¯æ§
```

**è§„åˆ™**ï¼šlabel çš„å”¯ä¸€å€¼æ•°é‡åº” < 100

### 3. å…³è”ä¸‰æ”¯æŸ±

**æ ‡å‡†å­—æ®µ**ï¼š
```json
{
  "trace_id": "a1b2c3d4",
  "span_id": "1234567890ab",
  "service.name": "order-service",
  "service.version": "v1.2.3"
}
```

æ‰€æœ‰ä¸‰æ”¯æŸ±éƒ½åŒ…å«è¿™äº›å­—æ®µï¼Œæ–¹ä¾¿è·³è½¬ã€‚

### 4. å‘Šè­¦åˆ†å±‚

```
L1: Metrics å‘Šè­¦ï¼ˆå¿«é€Ÿå‘ç°ï¼‰
    â†“
L2: Trace é‡‡æ ·å‘Šè­¦ï¼ˆå¼‚å¸¸è¯·æ±‚ï¼‰
    â†“
L3: Log å…³é”®è¯å‘Šè­¦ï¼ˆç‰¹å®šé”™è¯¯ï¼‰
```

---

## æœªæ¥è¶‹åŠ¿

### 1. æŒç»­æ€§èƒ½åˆ†æï¼ˆContinuous Profilingï¼‰

**ç¬¬å››æ”¯æŸ±**ï¼šProfiling
- CPU ç«ç„°å›¾
- å†…å­˜åˆ†é…
- é”ç«äº‰

**å·¥å…·**ï¼šParca, Pyroscope

### 2. eBPF åŠ é€Ÿ

**å†…æ ¸çº§å¯è§‚æµ‹æ€§**ï¼š
- æ— éœ€ä¿®æ”¹ä»£ç 
- é›¶æ€§èƒ½æŸè€—
- å…¨æ ˆå¯è§

**å·¥å…·**ï¼šPixie, Cilium

### 3. AI é©±åŠ¨çš„å¼‚å¸¸æ£€æµ‹

```
Metrics + Traces + Logs
    â†“ ML æ¨¡å‹
è‡ªåŠ¨å‘ç°å¼‚å¸¸æ¨¡å¼
    â†“ è‡ªåŠ¨å…³è”
ç”Ÿæˆæ ¹å› æŠ¥å‘Š
```

---

## å…³é”®æ´å¯Ÿ

### æ´å¯Ÿ 1ï¼šä¸‰æ”¯æŸ±äº’è¡¥

- **Metrics**ï¼šå¿«é€Ÿå‘ç°"ä»€ä¹ˆåœ°æ–¹"å‡ºé—®é¢˜
- **Traces**ï¼šç²¾ç¡®å®šä½"å“ªä¸ªç¯èŠ‚"æ…¢/é”™
- **Logs**ï¼šè¯¦ç»†è§£é‡Š"å…·ä½“åŸå› "

### æ´å¯Ÿ 2ï¼šå¯è§‚æµ‹æ€§ â‰  ç›‘æ§

**ç›‘æ§**ï¼šé¢„è®¾ä»ªè¡¨ç›˜ + å‘Šè­¦ï¼ˆå·²çŸ¥æœªçŸ¥ï¼‰
**å¯è§‚æµ‹æ€§**ï¼šéšæ—¶æ¢ç´¢ï¼ˆæœªçŸ¥æœªçŸ¥ï¼‰

### æ´å¯Ÿ 3ï¼šæˆæœ¬ä¸ä»·å€¼çš„å¹³è¡¡

**å…¨é‡é‡‡é›†**ï¼š
- æˆæœ¬ï¼šé«˜ï¼ˆå­˜å‚¨ã€æŸ¥è¯¢ï¼‰
- ä»·å€¼ï¼šé«˜ï¼ˆå®Œæ•´ä¿¡æ¯ï¼‰

**æ™ºèƒ½é‡‡æ ·**ï¼š
- æˆæœ¬ï¼šä½
- ä»·å€¼ï¼šä¸­ï¼ˆå¯èƒ½ä¸¢å¤±å…³é”®ä¿¡æ¯ï¼‰

**æœ€ä¼˜ç­–ç•¥**ï¼šå°¾éƒ¨é‡‡æ ·ï¼ˆåªä¿ç•™å¼‚å¸¸ï¼‰

---

## ç›¸å…³ä¸»é¢˜

- [4.2 OTLP å¯è§‚æµ‹æ€§åè®®](../04_Self_Healing_Systems/04.2_OTLP_Observability.md)
- [6.2 OpenTelemetry æ ‡å‡†](./06.2_OpenTelemetry_Standard.md)
- [4.1 è‡ªæ„ˆæ¶æ„åŸç†](../04_Self_Healing_Systems/04.1_Self_Healing_Architecture.md)

---

**å¯¼èˆª**ï¼š[è¿”å›å¯è§‚æµ‹æ€§ä¸æ²»ç†](./README.md) | [ä¸‹ä¸€èŠ‚ï¼šOpenTelemetry æ ‡å‡† â†’](./06.2_OpenTelemetry_Standard.md)

